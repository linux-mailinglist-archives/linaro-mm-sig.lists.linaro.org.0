Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 652E0350BEA
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  1 Apr 2021 03:25:33 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 91D4B6186A
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  1 Apr 2021 01:25:32 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 861A46600E; Thu,  1 Apr 2021 01:25:32 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=5.0 tests=BAYES_00,DKIM_ADSP_CUSTOM_MED,
	FREEMAIL_FROM,MAILING_LIST_MULTI,RCVD_IN_DNSWL_HI,RCVD_IN_MSPIKE_H3,
	RCVD_IN_MSPIKE_WL,SPF_HELO_NONE autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 3EF4765FE5;
	Thu,  1 Apr 2021 01:24:35 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id A20836186A
 for <linaro-mm-sig@lists.linaro.org>; Thu,  1 Apr 2021 01:24:31 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 9247E6600E; Thu,  1 Apr 2021 01:24:31 +0000 (UTC)
Received: from mail-pl1-f180.google.com (mail-pl1-f180.google.com
 [209.85.214.180])
 by lists.linaro.org (Postfix) with ESMTPS id 4CB376600C
 for <linaro-mm-sig@lists.linaro.org>; Thu,  1 Apr 2021 01:23:59 +0000 (UTC)
Received: by mail-pl1-f180.google.com with SMTP id e14so168604plj.2
 for <linaro-mm-sig@lists.linaro.org>; Wed, 31 Mar 2021 18:23:59 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=8cT+XlzU5zlDYGz9BluEu8eKHFv4/9nyqH51vh3hcvA=;
 b=gp2YlBbIDFK3NgFrPHgBg36lmNF+qhbkj07qC8tJ0dkJluVUNFurIxNvInOGMZHChW
 9JWVJ7Y097xsaXmBxTiMCCLT16HKe5qHlyeWPejmolxiGR/JieGQkJMRXEQVt1D2ZDAU
 AvmaF9RDFdh46Oh73osPK9yNMzpfYTO7X9ixHoeWiq3Kv+ODRpA5LvmkODrBO7IAANTA
 5917zjmbH7Jebin4PNhtYM5RoutBWY2vlZYsKWLgLJLcyhtFDmnPw3bEzpTiPCaMzDLT
 kF9665iDiGKZwpd/PPTTGBx7ofZ04KNzXuqVrnMMFMiaXmQ+xveIKkyxEmgZZ6AIExp+
 5/6w==
X-Gm-Message-State: AOAM531EZ/gEJH9Bcd84CbW8IklzerDIITY7Ffo8dh8SMxhK+pat8Z2e
 29eL1ahC8q3l99lfixcWKi4=
X-Google-Smtp-Source: ABdhPJx19SrCOXWa4tQngoMfeYPmtRrvqE4PBxLlbi9rJsA3eBjK/1tQsaOhr4pfPMu8XLWXnHhCaA==
X-Received: by 2002:a17:902:e80a:b029:e6:c4c4:1f05 with SMTP id
 u10-20020a170902e80ab02900e6c4c41f05mr5749363plg.33.1617240238504; 
 Wed, 31 Mar 2021 18:23:58 -0700 (PDT)
Received: from localhost ([2601:1c0:5200:a6:307:a401:7b76:c6e5])
 by smtp.gmail.com with ESMTPSA id x1sm3449485pfj.209.2021.03.31.18.23.57
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 31 Mar 2021 18:23:57 -0700 (PDT)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Date: Wed, 31 Mar 2021 18:27:19 -0700
Message-Id: <20210401012722.527712-3-robdclark@gmail.com>
X-Mailer: git-send-email 2.30.2
In-Reply-To: <20210401012722.527712-1-robdclark@gmail.com>
References: <20210331221630.488498-1-robdclark@gmail.com>
 <20210401012722.527712-1-robdclark@gmail.com>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: Rob Clark <robdclark@chromium.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU"
 <freedreno@lists.freedesktop.org>, David Airlie <airlied@linux.ie>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <linux-arm-msm@vger.kernel.org>,
 Douglas Anderson <dianders@chromium.org>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 "moderated list:DMA BUFFER SHARING FRAMEWORK" <linaro-mm-sig@lists.linaro.org>,
 Rob Clark <robdclark@gmail.com>, Daniel Vetter <daniel@ffwll.ch>,
 Sean Paul <sean@poorly.run>, open list <linux-kernel@vger.kernel.org>,
 "open list:DMA BUFFER SHARING FRAMEWORK" <linux-media@vger.kernel.org>
Subject: [Linaro-mm-sig] [PATCH v2 2/4] drm/msm: Avoid mutex in
	shrinker_count()
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKV2hlbiB0aGUgc3lzdGVt
IGlzIHVuZGVyIGhlYXZ5IG1lbW9yeSBwcmVzc3VyZSwgd2UgY2FuIGVuZCB1cCB3aXRoIGxvdHMK
b2YgY29uY3VycmVudCBjYWxscyBpbnRvIHRoZSBzaHJpbmtlci4gIEtlZXBpbmcgYSBydW5uaW5n
IHRhYiBvbiB3aGF0IHdlCmNhbiBzaHJpbmsgYXZvaWRzIGdyYWJiaW5nIGEgbG9jayBpbiBzaHJp
bmtlci0+Y291bnQoKSwgYW5kIGF2b2lkcwpzaHJpbmtlci0+c2NhbigpIGdldHRpbmcgY2FsbGVk
IHdoZW4gbm90IHByb2ZpdGFibGUuCgpBbHNvLCB3ZSBjYW4ga2VlcCBwdXJnZWQgb2JqZWN0cyBp
biB0aGVpciBvd24gbGlzdCB0byBhdm9pZCByZS10cmF2ZXJzaW5nCnRoZW0gdG8gaGVscCBjdXQg
ZG93biB0aW1lIGluIHRoZSBjcml0aWNhbCBzZWN0aW9uIGZ1cnRoZXIuCgpTaWduZWQtb2ZmLWJ5
OiBSb2IgQ2xhcmsgPHJvYmRjbGFya0BjaHJvbWl1bS5vcmc+ClRlc3RlZC1ieTogRG91Z2xhcyBB
bmRlcnNvbiA8ZGlhbmRlcnNAY2hyb21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tc20v
bXNtX2Rydi5jICAgICAgICAgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2Lmgg
ICAgICAgICAgfCAgNiArKy0KIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbS5jICAgICAgICAg
IHwgMjAgKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmggICAgICAgICAg
fCA1MyArKysrKysrKysrKysrKysrKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
Z2VtX3Nocmlua2VyLmMgfCAyOCArKysrKystLS0tLS0tLQogNSBmaWxlcyBjaGFuZ2VkLCA4MSBp
bnNlcnRpb25zKCspLCAyNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vbXNtL21zbV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2Rydi5jCmluZGV4IDRm
OWZhMDE4OWEwNy4uMzQ2MmIwZWExNGM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNt
L21zbV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9kcnYuYwpAQCAtNDc2LDYg
KzQ3Niw3IEBAIHN0YXRpYyBpbnQgbXNtX2RybV9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgY29u
c3Qgc3RydWN0IGRybV9kcml2ZXIgKmRydikKIAogCUlOSVRfTElTVF9IRUFEKCZwcml2LT5pbmFj
dGl2ZV93aWxsbmVlZCk7CiAJSU5JVF9MSVNUX0hFQUQoJnByaXYtPmluYWN0aXZlX2RvbnRuZWVk
KTsKKwlJTklUX0xJU1RfSEVBRCgmcHJpdi0+aW5hY3RpdmVfcHVyZ2VkKTsKIAltdXRleF9pbml0
KCZwcml2LT5tbV9sb2NrKTsKIAogCS8qIFRlYWNoIGxvY2tkZXAgYWJvdXQgbG9jayBvcmRlcmlu
ZyB3cnQuIHNocmlua2VyOiAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
ZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9kcnYuaAppbmRleCBhMTI2NGNmY2FjNWUu
LjUwMzE2ODgxN2UyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2LmgKQEAgLTE3OSw4ICsxNzksOCBAQCBz
dHJ1Y3QgbXNtX2RybV9wcml2YXRlIHsKIAkgKiBpbmFjdGl2ZSBsaXN0cyAoZGVwZW5kaW5nIG9u
IHdoZXRoZXIgb3Igbm90IGl0IGlzIHNocmlua2FibGUpIG9yCiAJICogZ3B1LT5hY3RpdmVfbGlz
dCAoZm9yIHRoZSBncHUgaXQgaXMgYWN0aXZlIG9uWzFdKQogCSAqCi0JICogVGhlc2UgbGlzdHMg
YXJlIHByb3RlY3RlZCBieSBtbV9sb2NrLiAgSWYgc3RydWN0X211dGV4IGlzIGludm9sdmVkLCBp
dAotCSAqIHNob3VsZCBiZSBhcXVpcmVkIHByaW9yIHRvIG1tX2xvY2suICBPbmUgc2hvdWxkICpu
b3QqIGhvbGQgbW1fbG9jayBpbgorCSAqIFRoZXNlIGxpc3RzIGFyZSBwcm90ZWN0ZWQgYnkgbW1f
bG9jayAod2hpY2ggc2hvdWxkIGJlIGFjcXVpcmVkCisJICogYmVmb3JlIHBlciBHRU0gb2JqZWN0
IGxvY2spLiAgT25lIHNob3VsZCAqbm90KiBob2xkIG1tX2xvY2sgaW4KIAkgKiBnZXRfcGFnZXMo
KS92bWFwKCkvZXRjIHBhdGhzLCBhcyB0aGV5IGNhbiB0cmlnZ2VyIHRoZSBzaHJpbmtlci4KIAkg
KgogCSAqIFsxXSBpZiBzb21lb25lIGV2ZXIgYWRkZWQgc3VwcG9ydCBmb3IgdGhlIG9sZCAyZCBj
b3JlcywgdGhlcmUgY291bGQgYmUKQEAgLTE4OCw2ICsxODgsOCBAQCBzdHJ1Y3QgbXNtX2RybV9w
cml2YXRlIHsKIAkgKi8KIAlzdHJ1Y3QgbGlzdF9oZWFkIGluYWN0aXZlX3dpbGxuZWVkOyAgLyog
aW5hY3RpdmUgKyAhc2hyaW5rYWJsZSAqLwogCXN0cnVjdCBsaXN0X2hlYWQgaW5hY3RpdmVfZG9u
dG5lZWQ7ICAvKiBpbmFjdGl2ZSArICBzaHJpbmthYmxlICovCisJc3RydWN0IGxpc3RfaGVhZCBp
bmFjdGl2ZV9wdXJnZWQ7ICAgIC8qIGluYWN0aXZlICsgIHB1cmdlZCAqLworCWxvbmcgc2hyaW5r
YWJsZV9jb3VudDsgICAgICAgICAgICAgICAvKiB3cml0ZSBhY2Nlc3MgdW5kZXIgbW1fbG9jayAq
LwogCXN0cnVjdCBtdXRleCBtbV9sb2NrOwogCiAJc3RydWN0IHdvcmtxdWV1ZV9zdHJ1Y3QgKndx
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vbXNtL21zbV9nZW0uYwppbmRleCA5ZDEwNzM5YzRlYjIuLmJlYzAxYmI0OGZjZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL21zbS9tc21fZ2VtLmMKQEAgLTcxOSw2ICs3MTksNyBAQCB2b2lkIG1zbV9nZW1fcHVyZ2Uo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiAJcHV0X2lvdmFfdm1hcyhvYmopOwogCiAJbXNt
X29iai0+bWFkdiA9IF9fTVNNX01BRFZfUFVSR0VEOworCW1hcmtfdW5wdXJnYWJsZShtc21fb2Jq
KTsKIAogCWRybV92bWFfbm9kZV91bm1hcCgmb2JqLT52bWFfbm9kZSwgZGV2LT5hbm9uX2lub2Rl
LT5pX21hcHBpbmcpOwogCWRybV9nZW1fZnJlZV9tbWFwX29mZnNldChvYmopOwpAQCAtNzkwLDEw
ICs3OTEsMTEgQEAgdm9pZCBtc21fZ2VtX2FjdGl2ZV9nZXQoc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmosIHN0cnVjdCBtc21fZ3B1ICpncHUpCiAJbWlnaHRfc2xlZXAoKTsKIAlXQVJOX09OKCFt
c21fZ2VtX2lzX2xvY2tlZChvYmopKTsKIAlXQVJOX09OKG1zbV9vYmotPm1hZHYgIT0gTVNNX01B
RFZfV0lMTE5FRUQpOworCVdBUk5fT04obXNtX29iai0+ZG9udG5lZWQpOwogCiAJaWYgKG1zbV9v
YmotPmFjdGl2ZV9jb3VudCsrID09IDApIHsKIAkJbXV0ZXhfbG9jaygmcHJpdi0+bW1fbG9jayk7
Ci0JCWxpc3RfZGVsX2luaXQoJm1zbV9vYmotPm1tX2xpc3QpOworCQlsaXN0X2RlbCgmbXNtX29i
ai0+bW1fbGlzdCk7CiAJCWxpc3RfYWRkX3RhaWwoJm1zbV9vYmotPm1tX2xpc3QsICZncHUtPmFj
dGl2ZV9saXN0KTsKIAkJbXV0ZXhfdW5sb2NrKCZwcml2LT5tbV9sb2NrKTsKIAl9CkBAIC04MTgs
MTEgKzgyMCwxOSBAQCBzdGF0aWMgdm9pZCB1cGRhdGVfaW5hY3RpdmUoc3RydWN0IG1zbV9nZW1f
b2JqZWN0ICptc21fb2JqKQogCW11dGV4X2xvY2soJnByaXYtPm1tX2xvY2spOwogCVdBUk5fT04o
bXNtX29iai0+YWN0aXZlX2NvdW50ICE9IDApOwogCi0JbGlzdF9kZWxfaW5pdCgmbXNtX29iai0+
bW1fbGlzdCk7Ci0JaWYgKG1zbV9vYmotPm1hZHYgPT0gTVNNX01BRFZfV0lMTE5FRUQpCisJaWYg
KG1zbV9vYmotPmRvbnRuZWVkKQorCQltYXJrX3VucHVyZ2FibGUobXNtX29iaik7CisKKwlsaXN0
X2RlbCgmbXNtX29iai0+bW1fbGlzdCk7CisJaWYgKG1zbV9vYmotPm1hZHYgPT0gTVNNX01BRFZf
V0lMTE5FRUQpIHsKIAkJbGlzdF9hZGRfdGFpbCgmbXNtX29iai0+bW1fbGlzdCwgJnByaXYtPmlu
YWN0aXZlX3dpbGxuZWVkKTsKLQllbHNlCisJfSBlbHNlIGlmIChtc21fb2JqLT5tYWR2ID09IE1T
TV9NQURWX0RPTlRORUVEKSB7CiAJCWxpc3RfYWRkX3RhaWwoJm1zbV9vYmotPm1tX2xpc3QsICZw
cml2LT5pbmFjdGl2ZV9kb250bmVlZCk7CisJCW1hcmtfcHVyZ2FibGUobXNtX29iaik7CisJfSBl
bHNlIHsKKwkJV0FSTl9PTihtc21fb2JqLT5tYWR2ICE9IF9fTVNNX01BRFZfUFVSR0VEKTsKKwkJ
bGlzdF9hZGRfdGFpbCgmbXNtX29iai0+bW1fbGlzdCwgJnByaXYtPmluYWN0aXZlX3B1cmdlZCk7
CisJfQogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5tbV9sb2NrKTsKIH0KQEAgLTk3MSw2ICs5ODEs
OCBAQCB2b2lkIG1zbV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmop
CiAJc3RydWN0IG1zbV9kcm1fcHJpdmF0ZSAqcHJpdiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAKIAlt
dXRleF9sb2NrKCZwcml2LT5tbV9sb2NrKTsKKwlpZiAobXNtX29iai0+ZG9udG5lZWQpCisJCW1h
cmtfdW5wdXJnYWJsZShtc21fb2JqKTsKIAlsaXN0X2RlbCgmbXNtX29iai0+bW1fbGlzdCk7CiAJ
bXV0ZXhfdW5sb2NrKCZwcml2LT5tbV9sb2NrKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9tc21fZ2VtLmggYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW0uaAppbmRleCA3
YTkxMDdjZjE4MTguLjEzYWFiZmU5MmRhYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21z
bS9tc21fZ2VtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmgKQEAgLTUwLDE4
ICs1MCwyNCBAQCBzdHJ1Y3QgbXNtX2dlbV9vYmplY3QgewogCSAqLwogCXVpbnQ4X3QgbWFkdjsK
IAorCS8qKgorCSAqIElzIG9iamVjdCBvbiBpbmFjdGl2ZV9kb250bmVlZCBsaXN0IChpZS4gY291
bnRlZCBpbiBwcml2LT5zaHJpbmthYmxlX2NvdW50KT8KKwkgKi8KKwlib29sIGRvbnRuZWVkIDog
MTsKKwogCS8qKgogCSAqIGNvdW50IG9mIGFjdGl2ZSB2bWFwJ2luZwogCSAqLwogCXVpbnQ4X3Qg
dm1hcF9jb3VudDsKIAotCS8qIEFuZCBvYmplY3QgaXMgZWl0aGVyOgotCSAqICBpbmFjdGl2ZSAt
IG9uIHByaXYtPmluYWN0aXZlX2xpc3QKKwkvKioKKwkgKiBBbiBvYmplY3QgaXMgZWl0aGVyOgor
CSAqICBpbmFjdGl2ZSAtIG9uIHByaXYtPmluYWN0aXZlX2RvbnRuZWVkL3dpbGxuZWVkL3B1cmdl
ZCBkZXBlbmRpbmcKKwkgKiAgICAgb24gc3RhdHVzCiAJICogIGFjdGl2ZSAgIC0gb24gb25lIG9u
ZSBvZiB0aGUgZ3B1J3MgYWN0aXZlX2xpc3QuLiAgd2VsbCwgYXQKIAkgKiAgICAgbGVhc3QgZm9y
IG5vdyB3ZSBkb24ndCBoYXZlIChJIGRvbid0IHRoaW5rKSBodyBzeW5jIGJldHdlZW4KIAkgKiAg
ICAgMmQgYW5kIDNkIG9uZSBkZXZpY2VzIHdoaWNoIGhhdmUgYm90aCwgbWVhbmluZyB3ZSBuZWVk
IHRvCiAJICogICAgIGJsb2NrIG9uIHN1Ym1pdCBpZiBhIGJvIGlzIGFscmVhZHkgb24gb3RoZXIg
cmluZwotCSAqCiAJICovCiAJc3RydWN0IGxpc3RfaGVhZCBtbV9saXN0OwogCkBAIC0xODYsMTAg
KzE5MiwxNiBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNfYWN0aXZlKHN0cnVjdCBtc21fZ2VtX29i
amVjdCAqbXNtX29iaikKIAlyZXR1cm4gbXNtX29iai0+YWN0aXZlX2NvdW50OwogfQogCisvKiBp
bXBvcnRlZC9leHBvcnRlZCBvYmplY3RzIGFyZSBub3QgcHVyZ2FibGU6ICovCitzdGF0aWMgaW5s
aW5lIGJvb2wgaXNfdW5wdXJnYWJsZShzdHJ1Y3QgbXNtX2dlbV9vYmplY3QgKm1zbV9vYmopCit7
CisJcmV0dXJuIG1zbV9vYmotPmJhc2UuZG1hX2J1ZiAmJiBtc21fb2JqLT5iYXNlLmltcG9ydF9h
dHRhY2g7Cit9CisKIHN0YXRpYyBpbmxpbmUgYm9vbCBpc19wdXJnZWFibGUoc3RydWN0IG1zbV9n
ZW1fb2JqZWN0ICptc21fb2JqKQogewogCXJldHVybiAobXNtX29iai0+bWFkdiA9PSBNU01fTUFE
Vl9ET05UTkVFRCkgJiYgbXNtX29iai0+c2d0ICYmCi0JCQkhbXNtX29iai0+YmFzZS5kbWFfYnVm
ICYmICFtc21fb2JqLT5iYXNlLmltcG9ydF9hdHRhY2g7CisJCQkhaXNfdW5wdXJnYWJsZShtc21f
b2JqKTsKIH0KIAogc3RhdGljIGlubGluZSBib29sIGlzX3Z1bm1hcGFibGUoc3RydWN0IG1zbV9n
ZW1fb2JqZWN0ICptc21fb2JqKQpAQCAtMTk4LDYgKzIxMCwzOSBAQCBzdGF0aWMgaW5saW5lIGJv
b2wgaXNfdnVubWFwYWJsZShzdHJ1Y3QgbXNtX2dlbV9vYmplY3QgKm1zbV9vYmopCiAJcmV0dXJu
IChtc21fb2JqLT52bWFwX2NvdW50ID09IDApICYmIG1zbV9vYmotPnZhZGRyOwogfQogCitzdGF0
aWMgaW5saW5lIHZvaWQgbWFya19wdXJnYWJsZShzdHJ1Y3QgbXNtX2dlbV9vYmplY3QgKm1zbV9v
YmopCit7CisJc3RydWN0IG1zbV9kcm1fcHJpdmF0ZSAqcHJpdiA9IG1zbV9vYmotPmJhc2UuZGV2
LT5kZXZfcHJpdmF0ZTsKKworCVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmcHJpdi0+bW1fbG9j
aykpOworCisJaWYgKGlzX3VucHVyZ2FibGUobXNtX29iaikpCisJCXJldHVybjsKKworCWlmIChX
QVJOX09OKG1zbV9vYmotPmRvbnRuZWVkKSkKKwkJcmV0dXJuOworCisJcHJpdi0+c2hyaW5rYWJs
ZV9jb3VudCArPSBtc21fb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVDsKKwltc21fb2JqLT5k
b250bmVlZCA9IHRydWU7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBtYXJrX3VucHVyZ2FibGUo
c3RydWN0IG1zbV9nZW1fb2JqZWN0ICptc21fb2JqKQoreworCXN0cnVjdCBtc21fZHJtX3ByaXZh
dGUgKnByaXYgPSBtc21fb2JqLT5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CisKKwlXQVJOX09OKCFt
dXRleF9pc19sb2NrZWQoJnByaXYtPm1tX2xvY2spKTsKKworCWlmIChpc191bnB1cmdhYmxlKG1z
bV9vYmopKQorCQlyZXR1cm47CisKKwlpZiAoV0FSTl9PTighbXNtX29iai0+ZG9udG5lZWQpKQor
CQlyZXR1cm47CisKKwlwcml2LT5zaHJpbmthYmxlX2NvdW50IC09IG1zbV9vYmotPmJhc2Uuc2l6
ZSA+PiBQQUdFX1NISUZUOworCVdBUk5fT04ocHJpdi0+c2hyaW5rYWJsZV9jb3VudCA8IDApOwor
CW1zbV9vYmotPmRvbnRuZWVkID0gZmFsc2U7Cit9CisKIHZvaWQgbXNtX2dlbV9wdXJnZShzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiB2b2lkIG1zbV9nZW1fdnVubWFwKHN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqb2JqKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
Z2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fc2hyaW5rZXIuYwpp
bmRleCA5ZDUyNDhiZTc0NmYuLmYzZTk0OGFmMDFjNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9tc21fZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
Z2VtX3Nocmlua2VyLmMKQEAgLTE0LDIyICsxNCw3IEBAIG1zbV9nZW1fc2hyaW5rZXJfY291bnQo
c3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykKIHsK
IAlzdHJ1Y3QgbXNtX2RybV9wcml2YXRlICpwcml2ID0KIAkJY29udGFpbmVyX29mKHNocmlua2Vy
LCBzdHJ1Y3QgbXNtX2RybV9wcml2YXRlLCBzaHJpbmtlcik7Ci0Jc3RydWN0IG1zbV9nZW1fb2Jq
ZWN0ICptc21fb2JqOwotCXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOwotCi0JbXV0ZXhfbG9jaygm
cHJpdi0+bW1fbG9jayk7Ci0KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG1zbV9vYmosICZwcml2LT5p
bmFjdGl2ZV9kb250bmVlZCwgbW1fbGlzdCkgewotCQlpZiAoIW1zbV9nZW1fdHJ5bG9jaygmbXNt
X29iai0+YmFzZSkpCi0JCQljb250aW51ZTsKLQkJaWYgKGlzX3B1cmdlYWJsZShtc21fb2JqKSkK
LQkJCWNvdW50ICs9IG1zbV9vYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwotCQltc21fZ2Vt
X3VubG9jaygmbXNtX29iai0+YmFzZSk7Ci0JfQotCi0JbXV0ZXhfdW5sb2NrKCZwcml2LT5tbV9s
b2NrKTsKLQotCXJldHVybiBjb3VudDsKKwlyZXR1cm4gcHJpdi0+c2hyaW5rYWJsZV9jb3VudDsK
IH0KIAogc3RhdGljIHVuc2lnbmVkIGxvbmcKQEAgLTQ1LDYgKzMwLDkgQEAgbXNtX2dlbV9zaHJp
bmtlcl9zY2FuKHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29udHJv
bCAqc2MpCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShtc21fb2JqLCAmcHJpdi0+aW5hY3RpdmVfZG9u
dG5lZWQsIG1tX2xpc3QpIHsKIAkJaWYgKGZyZWVkID49IHNjLT5ucl90b19zY2FuKQogCQkJYnJl
YWs7CisJCS8qIFVzZSB0cnlsb2NrLCBiZWNhdXNlIHdlIGNhbm5vdCBibG9jayBvbiBhIG9iaiB0
aGF0CisJCSAqIG1pZ2h0IGJlIHRyeWluZyB0byBhY3F1aXJlIG1tX2xvY2sKKwkJICovCiAJCWlm
ICghbXNtX2dlbV90cnlsb2NrKCZtc21fb2JqLT5iYXNlKSkKIAkJCWNvbnRpbnVlOwogCQlpZiAo
aXNfcHVyZ2VhYmxlKG1zbV9vYmopKSB7CkBAIC01Niw4ICs0NCwxMSBAQCBtc21fZ2VtX3Nocmlu
a2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9s
ICpzYykKIAogCW11dGV4X3VubG9jaygmcHJpdi0+bW1fbG9jayk7CiAKLQlpZiAoZnJlZWQgPiAw
KQorCWlmIChmcmVlZCA+IDApIHsKIAkJdHJhY2VfbXNtX2dlbV9wdXJnZShmcmVlZCA8PCBQQUdF
X1NISUZUKTsKKwl9IGVsc2UgeworCQlyZXR1cm4gU0hSSU5LX1NUT1A7CisJfQogCiAJcmV0dXJu
IGZyZWVkOwogfQpAQCAtNzUsNiArNjYsOSBAQCB2bWFwX3NocmluayhzdHJ1Y3QgbGlzdF9oZWFk
ICptbV9saXN0KQogCXVuc2lnbmVkIHVubWFwcGVkID0gMDsKIAogCWxpc3RfZm9yX2VhY2hfZW50
cnkobXNtX29iaiwgbW1fbGlzdCwgbW1fbGlzdCkgeworCQkvKiBVc2UgdHJ5bG9jaywgYmVjYXVz
ZSB3ZSBjYW5ub3QgYmxvY2sgb24gYSBvYmogdGhhdAorCQkgKiBtaWdodCBiZSB0cnlpbmcgdG8g
YWNxdWlyZSBtbV9sb2NrCisJCSAqLwogCQlpZiAoIW1zbV9nZW1fdHJ5bG9jaygmbXNtX29iai0+
YmFzZSkpCiAJCQljb250aW51ZTsKIAkJaWYgKGlzX3Z1bm1hcGFibGUobXNtX29iaikpIHsKLS0g
CjIuMzAuMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
TGluYXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QKTGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3Jn
Cmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2xpbmFyby1tbS1zaWcK
