Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id B19493A94FD
	for <lists+linaro-mm-sig@lfdr.de>; Wed, 16 Jun 2021 10:27:23 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 0B47E618E8
	for <lists+linaro-mm-sig@lfdr.de>; Wed, 16 Jun 2021 08:27:22 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 7BB6A6350A; Wed, 16 Jun 2021 08:27:16 +0000 (UTC)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id DE5AF61A2A;
	Wed, 16 Jun 2021 08:27:11 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id AF9F8608C6
 for <linaro-mm-sig@lists.linaro.org>; Wed, 16 Jun 2021 08:27:03 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id A854561A29; Wed, 16 Jun 2021 08:27:03 +0000 (UTC)
Received: from mail-ed1-f42.google.com (mail-ed1-f42.google.com
 [209.85.208.42])
 by lists.linaro.org (Postfix) with ESMTPS id 937E9608C6
 for <linaro-mm-sig@lists.linaro.org>; Wed, 16 Jun 2021 08:27:01 +0000 (UTC)
Received: by mail-ed1-f42.google.com with SMTP id z12so1568836edc.1
 for <linaro-mm-sig@lists.linaro.org>; Wed, 16 Jun 2021 01:27:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=gH3OUhd3wXODbH6KpjmAlhZdfVecYYvZR4fcrZvAXRQ=;
 b=tYxvk49yyGvTd8vEGSVaCnxFvwFkVCpsUMnteHFBbcJSiCa9f7yiKk3IAxuwoEzIHM
 DsNEKfPn5ZZG/Gzt5/goj6jN9vFtjg8UWoG76YxDEwmKQWwa/9LEJ50GshNb9nVVt0J1
 Rpoc/Z58kE7LRRJqvUXjs2xhJgBdHSN27aqqWXj3vrs4er6qr675VMwtk1BrOkuQQLki
 kzonZ95ZHRvR7ydrkVjOxJksBpymEf7jfB83+npzBMPJXekPDel2c6/9hF8fDbFXRl8g
 3DjQeAQdObC7q++IFfYHliGT95LofP/flAapNDxXtLCEBAnQt6F6Ed1tSZAhcQt+Hpch
 Pw8A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=gH3OUhd3wXODbH6KpjmAlhZdfVecYYvZR4fcrZvAXRQ=;
 b=t05uO9CBIvaUmyEZNp5DWdHwn78VIK2Z/NFT/MqSS1omaKiDU2R7VmiKBsxCtEPRRO
 1owc2I02mliajvsSZskw19UB9UjythveDMZ85I010HidaPI7p1S8zPJtYa3qSET0Tu7Z
 Wo7S4Fp4MjaHg+8GW/lnr+Leh8G95j76wdoPiNqtiJz0YP9bCsdlIxNgZNPQDhIdy/mm
 FQPbiAl4fjbopmdsDAP4KdJD5G7A/r5r3Y7UeTCCcis9Rj9h6AwybwxsYAzWusp+MwVh
 wBEfIbKP17q4ohwmtimcXaO6cJtt4HPmRnaPXUmsaan79V9Yp/4lI8ZljNACztohf74o
 4ziA==
X-Gm-Message-State: AOAM533D1LQsIzuTdcNqPwKltvIswXnOX1vzvp+LY4ZxoIBQUVcuDhOH
 +VDoXQhps6xStjZebTUCWow=
X-Google-Smtp-Source: ABdhPJyoEYuhmKxBRIP4z0Q2CNfPcVS2L6+e9AYh23KI9VbQsFNPnAWmb3Pc18CsbpC5neEG9/X/0Q==
X-Received: by 2002:aa7:dd0b:: with SMTP id i11mr2693934edv.51.1623832020758; 
 Wed, 16 Jun 2021 01:27:00 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:8b88:17a4:582b:121f])
 by smtp.gmail.com with ESMTPSA id v7sm1152639edx.38.2021.06.16.01.26.59
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 16 Jun 2021 01:27:00 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: daniel@ffwll.ch, dri-devel@lists.freedesktop.org,
 linaro-mm-sig@lists.linaro.org, linux-media@vger.kernel.org,
 sumit.semwal@linaro.org
Date: Wed, 16 Jun 2021 10:26:50 +0200
Message-Id: <20210616082655.111001-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210616082655.111001-1-christian.koenig@amd.com>
References: <20210616082655.111001-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Subject: [Linaro-mm-sig] [PATCH 2/7] dma-buf: fix and rework dma_buf_poll v2
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RGFuaWVsIHBvaW50ZWQgbWUgdG93YXJkcyB0aGlzIGZ1bmN0aW9uIGFuZCB0aGVyZSBhcmUgbXVs
dGlwbGUgb2J2aW91cyBwcm9ibGVtcwppbiB0aGUgaW1wbGVtZW50YXRpb24uCgpGaXJzdCBvZiBh
bGwgdGhlIHJldHJ5IGxvb3AgaXMgbm90IHdvcmtpbmcgYXMgaW50ZW5kZWQuIEluIGdlbmVyYWwg
dGhlIHJldHJ5Cm1ha2VzIG9ubHkgc2Vuc2UgaWYgeW91IGdyYWIgdGhlIHJlZmVyZW5jZSBmaXJz
dCBhbmQgdGhlbiBjaGVjayB0aGUgc2VxdWVuY2UKdmFsdWVzLgoKSXQncyBhbHNvIGdvb2QgcHJh
Y3RpY2UgdG8ga2VlcCB0aGUgcmVmZXJlbmNlIGFyb3VuZCB3aGVuIGluc3RhbGxpbmcgY2FsbGJh
Y2tzCnRvIGZlbmNlcyB5b3UgZG9uJ3Qgb3duLgoKVGhlbiB3ZSBza2lwcGVkIGNoZWNraW5nIHRo
ZSBleGNsdXNpdmUgZmVuY2Ugd2hlbiBzaGFyZWQgZmVuY2VzIHdlcmUgcHJlc2VudC4KCkFuZCBs
YXN0IHRoZSB3aG9sZSBpbXBsZW1lbnRhdGlvbiB3YXMgdW5uZWNlc3NhcnkgY29tcGxleCBhbmQg
cmF0aGVyIGhhcmQgdG8KdW5kZXJzdGFuZCB3aGljaCBjb3VsZCBsZWFkIHRvIHByb2JhYmx5IHVu
ZXhwZWN0ZWQgYmVoYXZpb3Igb2YgdGhlIElPQ1RMLgoKRml4IGFsbCB0aGlzIGJ5IHJld29ya2lu
ZyB0aGUgaW1wbGVtZW50YXRpb24gZnJvbSBzY3JhdGNoLgoKT25seSBtaWxkbHkgdGVzdGVkIGFu
ZCBuZWVkcyBhIHRob3VnaHRmdWwgcmV2aWV3IG9mIHRoZSBjb2RlLgoKdjI6IGZpeCB0aGUgcmVm
ZXJlbmNlIGNvdW50aW5nIGFzIHdlbGwKClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcg
PGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5j
IHwgMTMzICsrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2xp
bnV4L2RtYS1idWYuaCAgIHwgICAyICstCiAyIGZpbGVzIGNoYW5nZWQsIDU1IGluc2VydGlvbnMo
KyksIDgwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVm
LmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jCmluZGV4IDUxMWZlMGQyMTdhMC4uYjY3ZmJm
NGUzNzA1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jCisrKyBiL2RyaXZl
cnMvZG1hLWJ1Zi9kbWEtYnVmLmMKQEAgLTcyLDcgKzcyLDcgQEAgc3RhdGljIHZvaWQgZG1hX2J1
Zl9yZWxlYXNlKHN0cnVjdCBkZW50cnkgKmRlbnRyeSkKIAkgKiBJZiB5b3UgaGl0IHRoaXMgQlVH
KCkgaXQgbWVhbnMgc29tZW9uZSBkcm9wcGVkIHRoZWlyIHJlZiB0byB0aGUKIAkgKiBkbWEtYnVm
IHdoaWxlIHN0aWxsIGhhdmluZyBwZW5kaW5nIG9wZXJhdGlvbiB0byB0aGUgYnVmZmVyLgogCSAq
LwotCUJVR19PTihkbWFidWYtPmNiX3NoYXJlZC5hY3RpdmUgfHwgZG1hYnVmLT5jYl9leGNsLmFj
dGl2ZSk7CisJQlVHX09OKGRtYWJ1Zi0+Y2JfaW4uYWN0aXZlIHx8IGRtYWJ1Zi0+Y2Jfb3V0LmFj
dGl2ZSk7CiAKIAlkbWFidWYtPm9wcy0+cmVsZWFzZShkbWFidWYpOwogCkBAIC0yMDIsMTYgKzIw
MiwyMCBAQCBzdGF0aWMgdm9pZCBkbWFfYnVmX3BvbGxfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQogCXdha2VfdXBfbG9ja2VkX3BvbGwoZGNiLT5w
b2xsLCBkY2ItPmFjdGl2ZSk7CiAJZGNiLT5hY3RpdmUgPSAwOwogCXNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJmRjYi0+cG9sbC0+bG9jaywgZmxhZ3MpOworCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwog
fQogCiBzdGF0aWMgX19wb2xsX3QgZG1hX2J1Zl9wb2xsKHN0cnVjdCBmaWxlICpmaWxlLCBwb2xs
X3RhYmxlICpwb2xsKQogeworCXN0cnVjdCBkbWFfYnVmX3BvbGxfY2JfdCAqZGNiOwogCXN0cnVj
dCBkbWFfYnVmICpkbWFidWY7CiAJc3RydWN0IGRtYV9yZXN2ICpyZXN2OwogCXN0cnVjdCBkbWFf
cmVzdl9saXN0ICpmb2JqOwogCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlX2V4Y2w7Ci0JX19wb2xs
X3QgZXZlbnRzOwogCXVuc2lnbmVkIHNoYXJlZF9jb3VudCwgc2VxOworCXN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlOworCV9fcG9sbF90IGV2ZW50czsKKwlpbnQgciwgaTsKIAogCWRtYWJ1ZiA9IGZp
bGUtPnByaXZhdGVfZGF0YTsKIAlpZiAoIWRtYWJ1ZiB8fCAhZG1hYnVmLT5yZXN2KQpAQCAtMjI1
LDk5ICsyMjksNzAgQEAgc3RhdGljIF9fcG9sbF90IGRtYV9idWZfcG9sbChzdHJ1Y3QgZmlsZSAq
ZmlsZSwgcG9sbF90YWJsZSAqcG9sbCkKIAlpZiAoIWV2ZW50cykKIAkJcmV0dXJuIDA7CiAKKwlk
Y2IgPSBldmVudHMgJiBFUE9MTE9VVCA/ICZkbWFidWYtPmNiX291dCA6ICZkbWFidWYtPmNiX2lu
OworCisJLyogT25seSBxdWV1ZSBhIG5ldyBvbmUgaWYgd2UgYXJlIG5vdCBzdGlsbCB3YWl0aW5n
IGZvciB0aGUgb2xkIG9uZSAqLworCXNwaW5fbG9ja19pcnEoJmRtYWJ1Zi0+cG9sbC5sb2NrKTsK
KwlpZiAoZGNiLT5hY3RpdmUpCisJCWV2ZW50cyA9IDA7CisJZWxzZQorCQlkY2ItPmFjdGl2ZSA9
IGV2ZW50czsKKwlzcGluX3VubG9ja19pcnEoJmRtYWJ1Zi0+cG9sbC5sb2NrKTsKKwlpZiAoIWV2
ZW50cykKKwkJcmV0dXJuIDA7CisKIHJldHJ5OgogCXNlcSA9IHJlYWRfc2VxY291bnRfYmVnaW4o
JnJlc3YtPnNlcSk7CiAJcmN1X3JlYWRfbG9jaygpOwogCiAJZm9iaiA9IHJjdV9kZXJlZmVyZW5j
ZShyZXN2LT5mZW5jZSk7Ci0JaWYgKGZvYmopCisJaWYgKGZvYmogJiYgZXZlbnRzICYgRVBPTExP
VVQpCiAJCXNoYXJlZF9jb3VudCA9IGZvYmotPnNoYXJlZF9jb3VudDsKIAllbHNlCiAJCXNoYXJl
ZF9jb3VudCA9IDA7Ci0JZmVuY2VfZXhjbCA9IGRtYV9yZXN2X2V4Y2xfZmVuY2UocmVzdik7Ci0J
aWYgKHJlYWRfc2VxY291bnRfcmV0cnkoJnJlc3YtPnNlcSwgc2VxKSkgewotCQlyY3VfcmVhZF91
bmxvY2soKTsKLQkJZ290byByZXRyeTsKLQl9CiAKLQlpZiAoZmVuY2VfZXhjbCAmJiAoIShldmVu
dHMgJiBFUE9MTE9VVCkgfHwgc2hhcmVkX2NvdW50ID09IDApKSB7Ci0JCXN0cnVjdCBkbWFfYnVm
X3BvbGxfY2JfdCAqZGNiID0gJmRtYWJ1Zi0+Y2JfZXhjbDsKLQkJX19wb2xsX3QgcGV2ZW50cyA9
IEVQT0xMSU47Ci0KLQkJaWYgKHNoYXJlZF9jb3VudCA9PSAwKQotCQkJcGV2ZW50cyB8PSBFUE9M
TE9VVDsKLQotCQlzcGluX2xvY2tfaXJxKCZkbWFidWYtPnBvbGwubG9jayk7Ci0JCWlmIChkY2It
PmFjdGl2ZSkgewotCQkJZGNiLT5hY3RpdmUgfD0gcGV2ZW50czsKLQkJCWV2ZW50cyAmPSB+cGV2
ZW50czsKLQkJfSBlbHNlCi0JCQlkY2ItPmFjdGl2ZSA9IHBldmVudHM7Ci0JCXNwaW5fdW5sb2Nr
X2lycSgmZG1hYnVmLT5wb2xsLmxvY2spOwotCi0JCWlmIChldmVudHMgJiBwZXZlbnRzKSB7Ci0J
CQlpZiAoIWRtYV9mZW5jZV9nZXRfcmN1KGZlbmNlX2V4Y2wpKSB7Ci0JCQkJLyogZm9yY2UgYSBy
ZWNoZWNrICovCi0JCQkJZXZlbnRzICY9IH5wZXZlbnRzOwotCQkJCWRtYV9idWZfcG9sbF9jYihO
VUxMLCAmZGNiLT5jYik7Ci0JCQl9IGVsc2UgaWYgKCFkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGZl
bmNlX2V4Y2wsICZkY2ItPmNiLAotCQkJCQkJCSAgIGRtYV9idWZfcG9sbF9jYikpIHsKLQkJCQll
dmVudHMgJj0gfnBldmVudHM7Ci0JCQkJZG1hX2ZlbmNlX3B1dChmZW5jZV9leGNsKTsKLQkJCX0g
ZWxzZSB7Ci0JCQkJLyoKLQkJCQkgKiBObyBjYWxsYmFjayBxdWV1ZWQsIHdha2UgdXAgYW55IGFk
ZGl0aW9uYWwKLQkJCQkgKiB3YWl0ZXJzLgotCQkJCSAqLwotCQkJCWRtYV9mZW5jZV9wdXQoZmVu
Y2VfZXhjbCk7Ci0JCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2ItPmNiKTsKLQkJCX0KKwlm
b3IgKGkgPSAwOyBpIDwgc2hhcmVkX2NvdW50OyArK2kpIHsKKwkJZmVuY2UgPSByY3VfZGVyZWZl
cmVuY2UoZm9iai0+c2hhcmVkW2ldKTsKKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShmZW5j
ZSk7CisJCWlmICghZmVuY2UgfHwgcmVhZF9zZXFjb3VudF9yZXRyeSgmcmVzdi0+c2VxLCBzZXEp
KSB7CisJCQkvKiBDb25jdXJyZW50IG1vZGlmeSBkZXRlY3RlZCwgZm9yY2UgcmUtY2hlY2sgKi8K
KwkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQkJcmN1X3JlYWRfdW5sb2NrKCk7CisJCQlnb3Rv
IHJldHJ5OwogCQl9Ci0JfQogCi0JaWYgKChldmVudHMgJiBFUE9MTE9VVCkgJiYgc2hhcmVkX2Nv
dW50ID4gMCkgewotCQlzdHJ1Y3QgZG1hX2J1Zl9wb2xsX2NiX3QgKmRjYiA9ICZkbWFidWYtPmNi
X3NoYXJlZDsKLQkJaW50IGk7Ci0KLQkJLyogT25seSBxdWV1ZSBhIG5ldyBjYWxsYmFjayBpZiBu
byBldmVudCBoYXMgZmlyZWQgeWV0ICovCi0JCXNwaW5fbG9ja19pcnEoJmRtYWJ1Zi0+cG9sbC5s
b2NrKTsKLQkJaWYgKGRjYi0+YWN0aXZlKQotCQkJZXZlbnRzICY9IH5FUE9MTE9VVDsKLQkJZWxz
ZQotCQkJZGNiLT5hY3RpdmUgPSBFUE9MTE9VVDsKLQkJc3Bpbl91bmxvY2tfaXJxKCZkbWFidWYt
PnBvbGwubG9jayk7Ci0KLQkJaWYgKCEoZXZlbnRzICYgRVBPTExPVVQpKQorCQlyID0gZG1hX2Zl
bmNlX2FkZF9jYWxsYmFjayhmZW5jZSwgJmRjYi0+Y2IsIGRtYV9idWZfcG9sbF9jYik7CisJCWlm
ICghcikgeworCQkJLyogQ2FsbGJhY2sgcXVldWVkICovCisJCQlldmVudHMgPSAwOwogCQkJZ290
byBvdXQ7CisJCX0KKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJfQogCi0JCWZvciAoaSA9IDA7
IGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBy
Y3VfZGVyZWZlcmVuY2UoZm9iai0+c2hhcmVkW2ldKTsKLQotCQkJaWYgKCFkbWFfZmVuY2VfZ2V0
X3JjdShmZW5jZSkpIHsKLQkJCQkvKgotCQkJCSAqIGZlbmNlIHJlZmNvdW50IGRyb3BwZWQgdG8g
emVybywgdGhpcyBtZWFucwotCQkJCSAqIHRoYXQgZm9iaiBoYXMgYmVlbiBmcmVlZAotCQkJCSAq
Ci0JCQkJICogY2FsbCBkbWFfYnVmX3BvbGxfY2IgYW5kIGZvcmNlIGEgcmVjaGVjayEKLQkJCQkg
Ki8KLQkJCQlldmVudHMgJj0gfkVQT0xMT1VUOwotCQkJCWRtYV9idWZfcG9sbF9jYihOVUxMLCAm
ZGNiLT5jYik7Ci0JCQkJYnJlYWs7Ci0JCQl9Ci0JCQlpZiAoIWRtYV9mZW5jZV9hZGRfY2FsbGJh
Y2soZmVuY2UsICZkY2ItPmNiLAotCQkJCQkJICAgIGRtYV9idWZfcG9sbF9jYikpIHsKLQkJCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKLQkJCQlldmVudHMgJj0gfkVQT0xMT1VUOwotCQkJCWJyZWFr
OwotCQkJfQorCWZlbmNlID0gZG1hX3Jlc3ZfZXhjbF9mZW5jZShyZXN2KTsKKwlpZiAoZmVuY2Up
IHsKKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSk7CisJCWlmICghZmVuY2UgfHwg
cmVhZF9zZXFjb3VudF9yZXRyeSgmcmVzdi0+c2VxLCBzZXEpKSB7CisJCQkvKiBDb25jdXJyZW50
IG1vZGlmeSBkZXRlY3RlZCwgZm9yY2UgcmUtY2hlY2sgKi8KIAkJCWRtYV9mZW5jZV9wdXQoZmVu
Y2UpOworCQkJcmN1X3JlYWRfdW5sb2NrKCk7CisJCQlnb3RvIHJldHJ5OworCiAJCX0KIAotCQkv
KiBObyBjYWxsYmFjayBxdWV1ZWQsIHdha2UgdXAgYW55IGFkZGl0aW9uYWwgd2FpdGVycy4gKi8K
LQkJaWYgKGkgPT0gc2hhcmVkX2NvdW50KQotCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2It
PmNiKTsKKwkJciA9IGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZmVuY2UsICZkY2ItPmNiLCBkbWFf
YnVmX3BvbGxfY2IpOworCQlpZiAoIXIpIHsKKwkJCS8qIENhbGxiYWNrIHF1ZXVlZCAqLworCQkJ
ZXZlbnRzID0gMDsKKwkJCWdvdG8gb3V0OworCQl9CisJCWRtYV9mZW5jZV9wdXQoZmVuY2VfZXhj
bCk7CiAJfQogCisJLyogTm8gY2FsbGJhY2sgcXVldWVkLCB3YWtlIHVwIGFueSBhZGRpdGlvbmFs
IHdhaXRlcnMuICovCisJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2ItPmNiKTsKKwogb3V0Ogog
CXJjdV9yZWFkX3VubG9jaygpOwogCXJldHVybiBldmVudHM7CkBAIC01NjIsOCArNTM3LDggQEAg
c3RydWN0IGRtYV9idWYgKmRtYV9idWZfZXhwb3J0KGNvbnN0IHN0cnVjdCBkbWFfYnVmX2V4cG9y
dF9pbmZvICpleHBfaW5mbykKIAlkbWFidWYtPm93bmVyID0gZXhwX2luZm8tPm93bmVyOwogCXNw
aW5fbG9ja19pbml0KCZkbWFidWYtPm5hbWVfbG9jayk7CiAJaW5pdF93YWl0cXVldWVfaGVhZCgm
ZG1hYnVmLT5wb2xsKTsKLQlkbWFidWYtPmNiX2V4Y2wucG9sbCA9IGRtYWJ1Zi0+Y2Jfc2hhcmVk
LnBvbGwgPSAmZG1hYnVmLT5wb2xsOwotCWRtYWJ1Zi0+Y2JfZXhjbC5hY3RpdmUgPSBkbWFidWYt
PmNiX3NoYXJlZC5hY3RpdmUgPSAwOworCWRtYWJ1Zi0+Y2JfaW4ucG9sbCA9IGRtYWJ1Zi0+Y2Jf
b3V0LnBvbGwgPSAmZG1hYnVmLT5wb2xsOworCWRtYWJ1Zi0+Y2JfaW4uYWN0aXZlID0gZG1hYnVm
LT5jYl9vdXQuYWN0aXZlID0gMDsKIAogCWlmICghcmVzdikgewogCQlyZXN2ID0gKHN0cnVjdCBk
bWFfcmVzdiAqKSZkbWFidWZbMV07CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1idWYu
aCBiL2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5oCmluZGV4IGVmZGM1NmI5ZDk1Zi4uN2U3NDdhZDU0
YzgxIDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1idWYuaAorKysgYi9pbmNsdWRlL2xp
bnV4L2RtYS1idWYuaApAQCAtMzI5LDcgKzMyOSw3IEBAIHN0cnVjdCBkbWFfYnVmIHsKIAkJd2Fp
dF9xdWV1ZV9oZWFkX3QgKnBvbGw7CiAKIAkJX19wb2xsX3QgYWN0aXZlOwotCX0gY2JfZXhjbCwg
Y2Jfc2hhcmVkOworCX0gY2JfaW4sIGNiX291dDsKIH07CiAKIC8qKgotLSAKMi4yNS4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpMaW5hcm8tbW0tc2ln
IG1haWxpbmcgbGlzdApMaW5hcm8tbW0tc2lnQGxpc3RzLmxpbmFyby5vcmcKaHR0cHM6Ly9saXN0
cy5saW5hcm8ub3JnL21haWxtYW4vbGlzdGluZm8vbGluYXJvLW1tLXNpZwo=
