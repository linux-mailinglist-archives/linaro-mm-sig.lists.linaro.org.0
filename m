Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id B4AB62CAA4C
	for <lists+linaro-mm-sig@lfdr.de>; Tue,  1 Dec 2020 18:56:31 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id DCD4360BE0
	for <lists+linaro-mm-sig@lfdr.de>; Tue,  1 Dec 2020 17:56:30 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id D129C65FD7; Tue,  1 Dec 2020 17:56:30 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D28A9665F2;
	Tue,  1 Dec 2020 17:52:49 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 0081D60BE0
 for <linaro-mm-sig@lists.linaro.org>; Tue,  1 Dec 2020 17:52:39 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id E5CA265FCE; Tue,  1 Dec 2020 17:52:38 +0000 (UTC)
Received: from mail-pg1-f194.google.com (mail-pg1-f194.google.com
 [209.85.215.194])
 by lists.linaro.org (Postfix) with ESMTPS id F333860BE0
 for <linaro-mm-sig@lists.linaro.org>; Tue,  1 Dec 2020 17:51:59 +0000 (UTC)
Received: by mail-pg1-f194.google.com with SMTP id f17so1617594pge.6
 for <linaro-mm-sig@lists.linaro.org>; Tue, 01 Dec 2020 09:51:59 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=bYRnT6meiNHkxAgZPYwSbGdDS48Uvqnd+UI5WVDlRIo=;
 b=VdtMid35f59hK1IWY4wywm+Evn4kp27AHeLSeuuoPYPZ6bvxl9VmAhULkW7cGe97ub
 lxf0UkXCaXBS33zXuGWcZu3khqKmWw6RtSm4nxhDNo45CgI/0eiLNVjYEnJt1YC5Kih1
 hVjhmQ24FHooVYuKSMM92UCtfjIOXSgtSpSLSwa6umWM0kuikhHYEb1JItR/NytAsYds
 ZmW/99JHMXF74Qd8/VZazT0+7a3G5NM36pMgnBxGDvTyqAMfo8ca9lvrLEkNRWa5qEmV
 QqE2YQ9V7CarLFzrvBKZ9A1QMFZuq4xwUldW4gjx1XDMucizduQPzpigUqu0FBW85atn
 Mt5Q==
X-Gm-Message-State: AOAM532hxUdLbEh+t5ocrappK5ILX+hEBpCPrPR/BQO/w8cv75kTgpjj
 /Op+FYIAIlMndoSQ7PwbjfE=
X-Google-Smtp-Source: ABdhPJxPMBUU5/Z5mNi1wm+3qVG2Z14gAaQt2uPUeLlEWWh2TAsg5KL2eW8/0LCEd/AJCDUVDQXCfg==
X-Received: by 2002:aa7:8595:0:b029:198:159e:52d4 with SMTP id
 w21-20020aa785950000b0290198159e52d4mr3509713pfn.7.1606845119118; 
 Tue, 01 Dec 2020 09:51:59 -0800 (PST)
Received: from bbox-1.mtv.corp.google.com
 ([2620:15c:211:201:7220:84ff:fe09:5e58])
 by smtp.gmail.com with ESMTPSA id q23sm390082pfg.192.2020.12.01.09.51.57
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 01 Dec 2020 09:51:58 -0800 (PST)
From: Minchan Kim <minchan@kernel.org>
To: Andrew Morton <akpm@linux-foundation.org>
Date: Tue,  1 Dec 2020 09:51:44 -0800
Message-Id: <20201201175144.3996569-5-minchan@kernel.org>
X-Mailer: git-send-email 2.29.2.454.gaff20da3a2-goog
In-Reply-To: <20201201175144.3996569-1-minchan@kernel.org>
References: <20201201175144.3996569-1-minchan@kernel.org>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: robh@kernel.org, devicetree@vger.kernel.org, linux-media@vger.kernel.org,
 david@redhat.com, Minchan Kim <minchan@kernel.org>,
 LKML <linux-kernel@vger.kernel.org>, willy@infradead.org,
 Brian.Starkey@arm.com, linaro-mm-sig@lists.linaro.org,
 linux-mm <linux-mm@kvack.org>, john.stultz@linaro.org,
 christian.koenig@amd.com, joaodias@google.com, hridya@google.com,
 iamjoonsoo.kim@lge.com, pullip.cho@samsung.com, surenb@google.com,
 vbabka@suse.cz, hyesoo.yu@samsung.com
Subject: [Linaro-mm-sig] [PATCH v2 4/4] dma-buf: heaps: add chunk heap to
	dmabuf heaps
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RnJvbTogSHllc29vIFl1IDxoeWVzb28ueXVAc2Ftc3VuZy5jb20+CgpUaGlzIHBhdGNoIHN1cHBv
cnRzIGNodW5rIGhlYXAgdGhhdCBhbGxvY2F0ZXMgdGhlIGJ1ZmZlcnMgdGhhdAphcnJhbmdlZCBp
bnRvIGEgbGlzdCBhIGZpeGVkIHNpemUgY2h1bmtzIHRha2VuIGZyb20gQ01BLgoKVGhlIGNodW5r
IGhlYXAgZG9lc24ndCB1c2UgaGVhcC1oZWxwZXIgYWx0aG91Z2ggaXQgY2FuIHJlbW92ZQpkdXBs
aWNhdGVkIGNvZGUgc2luY2UgaGVhcC1oZWxwZXIgaXMgdW5kZXIgZGVwcmVjYXRlZCBwcm9jZXNz
LlsxXQoKTk9URTogVGhpcyBwYXRjaCBvbmx5IGFkZHMgdGhlIGRlZmF1bHQgQ01BIGhlYXAgdG8g
YWxsb2NhdGUgY2h1bmsKcGFnZXMuIFdlIHdpbGwgYWRkIGFub3RoZXIgQ01BIG1lbW9yeSByZWdp
b25zIHRvIHRoZSBkbWFidWYgaGVhcHMKaW50ZXJmYWNlIHdpdGggYSBsYXRlciBwYXRjaCAod2hp
Y2ggcmVxdWlyZXMgYSBkdCBiaW5kaW5nKQoKWzFdIGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL3Bh
dGNod29yay9wYXRjaC8xMzM2MDAyCgpTaWduZWQtb2ZmLWJ5OiBIeWVzb28gWXUgPGh5ZXNvby55
dUBzYW1zdW5nLmNvbT4KU2lnbmVkLW9mZi1ieTogTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVs
Lm9yZz4KLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyAgICAgIHwgIDE1ICsKIGRy
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSAgICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVm
L2hlYXBzL2NodW5rX2hlYXAuYyB8IDQyOSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKwog
MyBmaWxlcyBjaGFuZ2VkLCA0NDUgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRy
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9jaHVua19oZWFwLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Rt
YS1idWYvaGVhcHMvS2NvbmZpZyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmluZGV4
IGE1ZWVmMDZjNDIyNi4uOTE1M2Y4M2FmZWQ3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYv
aGVhcHMvS2NvbmZpZworKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtMTIs
MyArMTIsMTggQEAgY29uZmlnIERNQUJVRl9IRUFQU19DTUEKIAkgIENob29zZSB0aGlzIG9wdGlv
biB0byBlbmFibGUgZG1hLWJ1ZiBDTUEgaGVhcC4gVGhpcyBoZWFwIGlzIGJhY2tlZAogCSAgYnkg
dGhlIENvbnRpZ3VvdXMgTWVtb3J5IEFsbG9jYXRvciAoQ01BKS4gSWYgeW91ciBzeXN0ZW0gaGFz
IHRoZXNlCiAJICByZWdpb25zLCB5b3Ugc2hvdWxkIHNheSBZIGhlcmUuCisKK2NvbmZpZyBETUFC
VUZfSEVBUFNfQ0hVTksKKwl0cmlzdGF0ZSAiRE1BLUJVRiBDSFVOSyBIZWFwIgorCWRlcGVuZHMg
b24gRE1BQlVGX0hFQVBTICYmIERNQV9DTUEKKwloZWxwCisJICBDaG9vc2UgdGhpcyBvcHRpb24g
dG8gZW5hYmxlIGRtYS1idWYgQ0hVTksgaGVhcC4gVGhpcyBoZWFwIGlzIGJhY2tlZAorCSAgYnkg
dGhlIENvbnRpZ3VvdXMgTWVtb3J5IEFsbG9jYXRvciAoQ01BKSBhbmQgYWxsb2NhdGVzIHRoZSBi
dWZmZXJzIHRoYXQKKwkgIGFycmFuZ2VkIGludG8gYSBsaXN0IG9mIGZpeGVkIHNpemUgY2h1bmtz
IHRha2VuIGZyb20gQ01BLgorCitjb25maWcgRE1BQlVGX0hFQVBTX0NIVU5LX09SREVSCisJaW50
ICJDaHVuayBwYWdlIG9yZGVyIGZvciBkbWFidWYgY2h1bmsgaGVhcCIKKwlkZWZhdWx0IDQKKwlk
ZXBlbmRzIG9uIERNQUJVRl9IRUFQU19DSFVOSworCWhlbHAKKwkgIFNldCBwYWdlIG9yZGVyIG9m
IGZpeGVkIGNodW5rIHNpemUgdG8gYWxsb2NhdGUgZnJvbSBDTUEuCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZp
bGUKaW5kZXggOTc0NDY3NzkxMDMyLi44ZmFhNmNmZGMwYzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
ZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZp
bGUKQEAgLTEsMyArMSw0IEBACiAjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCiBv
YmotJChDT05GSUdfRE1BQlVGX0hFQVBTX1NZU1RFTSkJKz0gc3lzdGVtX2hlYXAubwogb2JqLSQo
Q09ORklHX0RNQUJVRl9IRUFQU19DTUEpCQkrPSBjbWFfaGVhcC5vCitvYmotJChDT05GSUdfRE1B
QlVGX0hFQVBTX0NIVU5LKQkrPSBjaHVua19oZWFwLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1h
LWJ1Zi9oZWFwcy9jaHVua19oZWFwLmMgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY2h1bmtfaGVh
cC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMDI3NzcwN2E5M2E5
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NodW5rX2hlYXAuYwpA
QCAtMCwwICsxLDQyOSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8q
CisgKiBJT04gTWVtb3J5IEFsbG9jYXRvciBjaHVuayBoZWFwIGV4cG9ydGVyCisgKgorICogQ29w
eXJpZ2h0IChjKSAyMDIwIFNhbXN1bmcgRWxlY3Ryb25pY3MgQ28uLCBMdGQuCisgKiBBdXRob3I6
IDxoeWVzb28ueXVAc2Ftc3VuZy5jb20+IGZvciBTYW1zdW5nIEVsZWN0cm9uaWNzLgorICovCisK
KyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9jbWEu
aD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+
CisjaW5jbHVkZSA8bGludXgvZG1hLWhlYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtbWFwLW9w
cy5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+Cisj
aW5jbHVkZSA8bGludXgvaGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3NjaGVkL3NpZ25hbC5oPgorI2luY2x1ZGUgPGxpbnV4L29mX3Jlc2VydmVk
X21lbS5oPgorI2luY2x1ZGUgPGxpbnV4L29mLmg+CisKK3N0cnVjdCBjaHVua19oZWFwIHsKKwlz
dHJ1Y3QgZG1hX2hlYXAgKmhlYXA7CisJdW5zaWduZWQgaW50IG9yZGVyOworCXN0cnVjdCBjbWEg
KmNtYTsKK307CisKK3N0cnVjdCBjaHVua19oZWFwX2J1ZmZlciB7CisJc3RydWN0IGNodW5rX2hl
YXAgKmhlYXA7CisJc3RydWN0IGxpc3RfaGVhZCBhdHRhY2htZW50czsKKwlzdHJ1Y3QgbXV0ZXgg
bG9jazsKKwlzdHJ1Y3Qgc2dfdGFibGUgc2dfdGFibGU7CisJdW5zaWduZWQgbG9uZyBsZW47CisJ
aW50IHZtYXBfY250OworCXZvaWQgKnZhZGRyOworfTsKKworc3RydWN0IGNodW5rX2hlYXBfYXR0
YWNobWVudCB7CisJc3RydWN0IGRldmljZSAqZGV2OworCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7
CisJc3RydWN0IGxpc3RfaGVhZCBsaXN0OworCWJvb2wgbWFwcGVkOworfTsKKworc3RhdGljIHN0
cnVjdCBzZ190YWJsZSAqZHVwX3NnX3RhYmxlKHN0cnVjdCBzZ190YWJsZSAqdGFibGUpCit7CisJ
c3RydWN0IHNnX3RhYmxlICpuZXdfdGFibGU7CisJaW50IHJldCwgaTsKKwlzdHJ1Y3Qgc2NhdHRl
cmxpc3QgKnNnLCAqbmV3X3NnOworCisJbmV3X3RhYmxlID0ga3phbGxvYyhzaXplb2YoKm5ld190
YWJsZSksIEdGUF9LRVJORUwpOworCWlmICghbmV3X3RhYmxlKQorCQlyZXR1cm4gRVJSX1BUUigt
RU5PTUVNKTsKKworCXJldCA9IHNnX2FsbG9jX3RhYmxlKG5ld190YWJsZSwgdGFibGUtPm9yaWdf
bmVudHMsIEdGUF9LRVJORUwpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUobmV3X3RhYmxlKTsKKwkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJfQorCisJbmV3X3NnID0gbmV3X3RhYmxlLT5zZ2w7
CisJZm9yX2VhY2hfc2d0YWJsZV9zZyh0YWJsZSwgc2csIGkpIHsKKwkJc2dfc2V0X3BhZ2UobmV3
X3NnLCBzZ19wYWdlKHNnKSwgc2ctPmxlbmd0aCwgc2ctPm9mZnNldCk7CisJCW5ld19zZyA9IHNn
X25leHQobmV3X3NnKTsKKwl9CisKKwlyZXR1cm4gbmV3X3RhYmxlOworfQorCitzdGF0aWMgaW50
IGNodW5rX2hlYXBfYXR0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVm
X2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7CisJc3RydWN0IGNodW5rX2hlYXBfYnVmZmVyICpi
dWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IGNodW5rX2hlYXBfYXR0YWNobWVudCAqYTsK
KwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOworCisJYSA9IGt6YWxsb2Moc2l6ZW9mKCphKSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFhKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXRhYmxlID0gZHVwX3Nn
X3RhYmxlKCZidWZmZXItPnNnX3RhYmxlKTsKKwlpZiAoSVNfRVJSKHRhYmxlKSkgeworCQlrZnJl
ZShhKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJYS0+dGFibGUgPSB0YWJsZTsKKwlhLT5k
ZXYgPSBhdHRhY2htZW50LT5kZXY7CisJSU5JVF9MSVNUX0hFQUQoJmEtPmxpc3QpOworCWEtPm1h
cHBlZCA9IGZhbHNlOworCisJYXR0YWNobWVudC0+cHJpdiA9IGE7CisKKwltdXRleF9sb2NrKCZi
dWZmZXItPmxvY2spOworCWxpc3RfYWRkKCZhLT5saXN0LCAmYnVmZmVyLT5hdHRhY2htZW50cyk7
CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyB2b2lkIGNodW5rX2hlYXBfZGV0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBk
bWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7CisJc3RydWN0IGNodW5rX2hlYXBfYnVm
ZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IGNodW5rX2hlYXBfYXR0YWNobWVu
dCAqYSA9IGF0dGFjaG1lbnQtPnByaXY7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOwor
CWxpc3RfZGVsKCZhLT5saXN0KTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7CisKKwlz
Z19mcmVlX3RhYmxlKGEtPnRhYmxlKTsKKwlrZnJlZShhLT50YWJsZSk7CisJa2ZyZWUoYSk7Cit9
CisKK3N0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKmNodW5rX2hlYXBfbWFwX2RtYV9idWYoc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCwKKwkJCQkJICAgICAgIGVudW0gZG1hX2Rh
dGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9hdHRhY2htZW50
ICphID0gYXR0YWNobWVudC0+cHJpdjsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlID0gYS0+dGFi
bGU7CisJaW50IHJldDsKKworCXJldCA9IGRtYV9tYXBfc2d0YWJsZShhdHRhY2htZW50LT5kZXYs
IHRhYmxlLCBkaXJlY3Rpb24sIDApOworCWlmIChyZXQpCisJCXJldHVybiBFUlJfUFRSKHJldCk7
CisKKwlhLT5tYXBwZWQgPSB0cnVlOworCXJldHVybiB0YWJsZTsKK30KKworc3RhdGljIHZvaWQg
Y2h1bmtfaGVhcF91bm1hcF9kbWFfYnVmKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aG1lbnQsCisJCQkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlLAorCQkJCSAgICAgZW51bSBk
bWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQoreworCXN0cnVjdCBjaHVua19oZWFwX2F0dGFj
aG1lbnQgKmEgPSBhdHRhY2htZW50LT5wcml2OworCisJYS0+bWFwcGVkID0gZmFsc2U7CisJZG1h
X3VubWFwX3NndGFibGUoYXR0YWNobWVudC0+ZGV2LCB0YWJsZSwgZGlyZWN0aW9uLCAwKTsKK30K
Kworc3RhdGljIGludCBjaHVua19oZWFwX2RtYV9idWZfYmVnaW5fY3B1X2FjY2VzcyhzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hYnVmLAorCQkJCQkJZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9u
KQoreworCXN0cnVjdCBjaHVua19oZWFwX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2Owor
CXN0cnVjdCBjaHVua19oZWFwX2F0dGFjaG1lbnQgKmE7CisKKwltdXRleF9sb2NrKCZidWZmZXIt
PmxvY2spOworCisJaWYgKGJ1ZmZlci0+dm1hcF9jbnQpCisJCWludmFsaWRhdGVfa2VybmVsX3Zt
YXBfcmFuZ2UoYnVmZmVyLT52YWRkciwgYnVmZmVyLT5sZW4pOworCisJbGlzdF9mb3JfZWFjaF9l
bnRyeShhLCAmYnVmZmVyLT5hdHRhY2htZW50cywgbGlzdCkgeworCQlpZiAoIWEtPm1hcHBlZCkK
KwkJCWNvbnRpbnVlOworCQlkbWFfc3luY19zZ3RhYmxlX2Zvcl9jcHUoYS0+ZGV2LCBhLT50YWJs
ZSwgZGlyZWN0aW9uKTsKKwl9CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY2h1bmtfaGVhcF9kbWFfYnVmX2VuZF9jcHVfYWNjZXNz
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkJCSAgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0
aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRt
YWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9hdHRhY2htZW50ICphOworCisJbXV0ZXhf
bG9jaygmYnVmZmVyLT5sb2NrKTsKKworCWlmIChidWZmZXItPnZtYXBfY250KQorCQlmbHVzaF9r
ZXJuZWxfdm1hcF9yYW5nZShidWZmZXItPnZhZGRyLCBidWZmZXItPmxlbik7CisKKwlsaXN0X2Zv
cl9lYWNoX2VudHJ5KGEsICZidWZmZXItPmF0dGFjaG1lbnRzLCBsaXN0KSB7CisJCWlmICghYS0+
bWFwcGVkKQorCQkJY29udGludWU7CisJCWRtYV9zeW5jX3NndGFibGVfZm9yX2RldmljZShhLT5k
ZXYsIGEtPnRhYmxlLCBkaXJlY3Rpb24pOworCX0KKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9j
ayk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaHVua19oZWFwX21tYXAoc3RydWN0
IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCit7CisJc3RydWN0
IGNodW5rX2hlYXBfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IHNnX3Rh
YmxlICp0YWJsZSA9ICZidWZmZXItPnNnX3RhYmxlOworCXVuc2lnbmVkIGxvbmcgYWRkciA9IHZt
YS0+dm1fc3RhcnQ7CisJc3RydWN0IHNnX3BhZ2VfaXRlciBwaXRlcjsKKwlpbnQgcmV0OworCisJ
Zm9yX2VhY2hfc2d0YWJsZV9wYWdlKHRhYmxlLCAmcGl0ZXIsIHZtYS0+dm1fcGdvZmYpIHsKKwkJ
c3RydWN0IHBhZ2UgKnBhZ2UgPSBzZ19wYWdlX2l0ZXJfcGFnZSgmcGl0ZXIpOworCisJCXJldCA9
IHJlbWFwX3Bmbl9yYW5nZSh2bWEsIGFkZHIsIHBhZ2VfdG9fcGZuKHBhZ2UpLCBQQUdFX1NJWkUs
CisJCQkJICAgICAgdm1hLT52bV9wYWdlX3Byb3QpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJl
dDsKKwkJYWRkciArPSBQQUdFX1NJWkU7CisJCWlmIChhZGRyID49IHZtYS0+dm1fZW5kKQorCQkJ
cmV0dXJuIDA7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCAqY2h1bmtfaGVhcF9k
b192bWFwKHN0cnVjdCBjaHVua19oZWFwX2J1ZmZlciAqYnVmZmVyKQoreworCXN0cnVjdCBzZ190
YWJsZSAqdGFibGUgPSAmYnVmZmVyLT5zZ190YWJsZTsKKwlpbnQgbnBhZ2VzID0gUEFHRV9BTElH
TihidWZmZXItPmxlbikgLyBQQUdFX1NJWkU7CisJc3RydWN0IHBhZ2UgKipwYWdlcyA9IHZtYWxs
b2Moc2l6ZW9mKHN0cnVjdCBwYWdlICopICogbnBhZ2VzKTsKKwlzdHJ1Y3QgcGFnZSAqKnRtcCA9
IHBhZ2VzOworCXN0cnVjdCBzZ19wYWdlX2l0ZXIgcGl0ZXI7CisJdm9pZCAqdmFkZHI7CisKKwlp
ZiAoIXBhZ2VzKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKworCWZvcl9lYWNoX3NndGFi
bGVfcGFnZSh0YWJsZSwgJnBpdGVyLCAwKSB7CisJCVdBUk5fT04odG1wIC0gcGFnZXMgPj0gbnBh
Z2VzKTsKKwkJKnRtcCsrID0gc2dfcGFnZV9pdGVyX3BhZ2UoJnBpdGVyKTsKKwl9CisKKwl2YWRk
ciA9IHZtYXAocGFnZXMsIG5wYWdlcywgVk1fTUFQLCBQQUdFX0tFUk5FTCk7CisJdmZyZWUocGFn
ZXMpOworCisJaWYgKCF2YWRkcikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlyZXR1
cm4gdmFkZHI7Cit9CisKK3N0YXRpYyBpbnQgY2h1bmtfaGVhcF92bWFwKHN0cnVjdCBkbWFfYnVm
ICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQoreworCXN0cnVjdCBjaHVua19oZWFw
X2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCWludCByZXQgPSAwOworCXZvaWQgKnZh
ZGRyOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwlpZiAoYnVmZmVyLT52bWFwX2Nu
dCkgeworCQl2YWRkciA9IGJ1ZmZlci0+dmFkZHI7CisJCWdvdG8gZG9uZTsKKwl9CisKKwl2YWRk
ciA9IGNodW5rX2hlYXBfZG9fdm1hcChidWZmZXIpOworCWlmIChJU19FUlIodmFkZHIpKSB7CisJ
CXJldCA9IFBUUl9FUlIodmFkZHIpOworCQlnb3RvIGVycjsKKwl9CisKKwlidWZmZXItPnZhZGRy
ID0gdmFkZHI7Citkb25lOgorCWJ1ZmZlci0+dm1hcF9jbnQrKzsKKwlkbWFfYnVmX21hcF9zZXRf
dmFkZHIobWFwLCB2YWRkcik7CitlcnI6CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgY2h1bmtfaGVhcF92dW5tYXAoc3RydWN0
IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IGRtYV9idWZfbWFwICptYXApCit7CisJc3RydWN0IGNo
dW5rX2hlYXBfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9sb2NrKCZi
dWZmZXItPmxvY2spOworCWlmICghLS1idWZmZXItPnZtYXBfY250KSB7CisJCXZ1bm1hcChidWZm
ZXItPnZhZGRyKTsKKwkJYnVmZmVyLT52YWRkciA9IE5VTEw7CisJfQorCW11dGV4X3VubG9jaygm
YnVmZmVyLT5sb2NrKTsKK30KKworc3RhdGljIHZvaWQgY2h1bmtfaGVhcF9kbWFfYnVmX3JlbGVh
c2Uoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9idWZmZXIg
KmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgY2h1bmtfaGVhcCAqY2h1bmtfaGVhcCA9
IGJ1ZmZlci0+aGVhcDsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOworCXN0cnVjdCBzY2F0dGVy
bGlzdCAqc2c7CisJaW50IGk7CisKKwl0YWJsZSA9ICZidWZmZXItPnNnX3RhYmxlOworCWZvcl9l
YWNoX3NndGFibGVfc2codGFibGUsIHNnLCBpKQorCQljbWFfcmVsZWFzZShjaHVua19oZWFwLT5j
bWEsIHNnX3BhZ2Uoc2cpLCAxIDw8IGNodW5rX2hlYXAtPm9yZGVyKTsKKwlzZ19mcmVlX3RhYmxl
KHRhYmxlKTsKKwlrZnJlZShidWZmZXIpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9i
dWZfb3BzIGNodW5rX2hlYXBfYnVmX29wcyA9IHsKKwkuYXR0YWNoID0gY2h1bmtfaGVhcF9hdHRh
Y2gsCisJLmRldGFjaCA9IGNodW5rX2hlYXBfZGV0YWNoLAorCS5tYXBfZG1hX2J1ZiA9IGNodW5r
X2hlYXBfbWFwX2RtYV9idWYsCisJLnVubWFwX2RtYV9idWYgPSBjaHVua19oZWFwX3VubWFwX2Rt
YV9idWYsCisJLmJlZ2luX2NwdV9hY2Nlc3MgPSBjaHVua19oZWFwX2RtYV9idWZfYmVnaW5fY3B1
X2FjY2VzcywKKwkuZW5kX2NwdV9hY2Nlc3MgPSBjaHVua19oZWFwX2RtYV9idWZfZW5kX2NwdV9h
Y2Nlc3MsCisJLm1tYXAgPSBjaHVua19oZWFwX21tYXAsCisJLnZtYXAgPSBjaHVua19oZWFwX3Zt
YXAsCisJLnZ1bm1hcCA9IGNodW5rX2hlYXBfdnVubWFwLAorCS5yZWxlYXNlID0gY2h1bmtfaGVh
cF9kbWFfYnVmX3JlbGVhc2UsCit9OworCitzdGF0aWMgaW50IGNodW5rX2hlYXBfYWxsb2NhdGUo
c3RydWN0IGRtYV9oZWFwICpoZWFwLCB1bnNpZ25lZCBsb25nIGxlbiwKKwkJCSAgICAgICB1bnNp
Z25lZCBsb25nIGZkX2ZsYWdzLCB1bnNpZ25lZCBsb25nIGhlYXBfZmxhZ3MpCit7CisJc3RydWN0
IGNodW5rX2hlYXAgKmNodW5rX2hlYXAgPSBkbWFfaGVhcF9nZXRfZHJ2ZGF0YShoZWFwKTsKKwlz
dHJ1Y3QgY2h1bmtfaGVhcF9idWZmZXIgKmJ1ZmZlcjsKKwlERUZJTkVfRE1BX0JVRl9FWFBPUlRf
SU5GTyhleHBfaW5mbyk7CisJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKKwlzdHJ1Y3Qgc2dfdGFi
bGUgKnRhYmxlOworCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CisJc3RydWN0IHBhZ2UgKipwYWdl
czsKKwl1bnNpZ25lZCBpbnQgY2h1bmtfc2l6ZSA9IFBBR0VfU0laRSA8PCBjaHVua19oZWFwLT5v
cmRlcjsKKwl1bnNpZ25lZCBpbnQgY291bnQsIGFsbG9jZWQgPSAwOworCXVuc2lnbmVkIGludCBu
dW1fcmV0cnkgPSA1OworCWludCByZXQgPSAtRU5PTUVNOworCXBnb2ZmX3QgcGc7CisKKwlidWZm
ZXIgPSBremFsbG9jKHNpemVvZigqYnVmZmVyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFidWZmZXIp
CisJCXJldHVybiByZXQ7CisKKwlJTklUX0xJU1RfSEVBRCgmYnVmZmVyLT5hdHRhY2htZW50cyk7
CisJbXV0ZXhfaW5pdCgmYnVmZmVyLT5sb2NrKTsKKwlidWZmZXItPmhlYXAgPSBjaHVua19oZWFw
OworCWJ1ZmZlci0+bGVuID0gQUxJR04obGVuLCBjaHVua19zaXplKTsKKwljb3VudCA9IGJ1ZmZl
ci0+bGVuIC8gY2h1bmtfc2l6ZTsKKworCXBhZ2VzID0ga3ZtYWxsb2NfYXJyYXkoY291bnQsIHNp
emVvZigqcGFnZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXBhZ2VzKQorCQlnb3RvIGVycl9wYWdl
czsKKworCXdoaWxlIChudW1fcmV0cnktLSkgeworCQl1bnNpZ25lZCBsb25nIG5yX3BhZ2VzOwor
CisJCXJldCA9IGNtYV9hbGxvY19idWxrKGNodW5rX2hlYXAtPmNtYSwgY2h1bmtfaGVhcC0+b3Jk
ZXIsCisJCQkJICAgICBudW1fcmV0cnkgPyB0cnVlIDogZmFsc2UsCisJCQkJICAgICBjaHVua19o
ZWFwLT5vcmRlciwgY291bnQgLSBhbGxvY2VkLAorCQkJCSAgICAgcGFnZXMgKyBhbGxvY2VkLCAm
bnJfcGFnZXMpOworCQlhbGxvY2VkICs9IG5yX3BhZ2VzOworCQlpZiAoYWxsb2NlZCA9PSBjb3Vu
dCkKKwkJCWJyZWFrOworCQlpZiAocmV0ICE9IC1FQlVTWSkKKwkJCWJyZWFrOworCisJfQorCWlm
IChyZXQgPCAwKQorCQlnb3RvIGVycl9hbGxvYzsKKworCXRhYmxlID0gJmJ1ZmZlci0+c2dfdGFi
bGU7CisJaWYgKHNnX2FsbG9jX3RhYmxlKHRhYmxlLCBjb3VudCwgR0ZQX0tFUk5FTCkpCisJCWdv
dG8gZXJyX2FsbG9jOworCisJc2cgPSB0YWJsZS0+c2dsOworCWZvciAocGcgPSAwOyBwZyA8IGNv
dW50OyBwZysrKSB7CisJCXNnX3NldF9wYWdlKHNnLCBwYWdlc1twZ10sIGNodW5rX3NpemUsIDAp
OworCQlzZyA9IHNnX25leHQoc2cpOworCX0KKworCWV4cF9pbmZvLm9wcyA9ICZjaHVua19oZWFw
X2J1Zl9vcHM7CisJZXhwX2luZm8uc2l6ZSA9IGJ1ZmZlci0+bGVuOworCWV4cF9pbmZvLmZsYWdz
ID0gZmRfZmxhZ3M7CisJZXhwX2luZm8ucHJpdiA9IGJ1ZmZlcjsKKwlkbWFidWYgPSBkbWFfYnVm
X2V4cG9ydCgmZXhwX2luZm8pOworCWlmIChJU19FUlIoZG1hYnVmKSkgeworCQlyZXQgPSBQVFJf
RVJSKGRtYWJ1Zik7CisJCWdvdG8gZXJyX2V4cG9ydDsKKwl9CisJa3ZmcmVlKHBhZ2VzKTsKKwor
CXJldCA9IGRtYV9idWZfZmQoZG1hYnVmLCBmZF9mbGFncyk7CisJaWYgKHJldCA8IDApIHsKKwkJ
ZG1hX2J1Zl9wdXQoZG1hYnVmKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK2Vy
cl9leHBvcnQ6CisJc2dfZnJlZV90YWJsZSh0YWJsZSk7CitlcnJfYWxsb2M6CisJZm9yIChwZyA9
IDA7IHBnIDwgYWxsb2NlZDsgcGcrKykKKwkJY21hX3JlbGVhc2UoY2h1bmtfaGVhcC0+Y21hLCBw
YWdlc1twZ10sIDEgPDwgY2h1bmtfaGVhcC0+b3JkZXIpOworCWt2ZnJlZShwYWdlcyk7CitlcnJf
cGFnZXM6CisJa2ZyZWUoYnVmZmVyKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25z
dCBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNodW5rX2hlYXBfb3BzID0geworCS5hbGxvY2F0ZSA9IGNo
dW5rX2hlYXBfYWxsb2NhdGUsCit9OworCisjaWZkZWYgQ09ORklHX0RNQUJVRl9IRUFQU19DSFVO
S19PUkRFUgorI2RlZmluZSBDSFVOS19IRUFQX09SREVSIChDT05GSUdfRE1BQlVGX0hFQVBTX0NI
VU5LX09SREVSKQorI2Vsc2UKKyNkZWZpbmUgQ0hVTktfSEVBUF9PUkRFUiAoMCkKKyNlbmRpZgor
CitzdGF0aWMgaW50IF9faW5pdCBjaHVua19oZWFwX2luaXQodm9pZCkKK3sKKwlzdHJ1Y3QgY21h
ICpkZWZhdWx0X2NtYSA9IGRldl9nZXRfY21hX2FyZWEoTlVMTCk7CisJc3RydWN0IGRtYV9oZWFw
X2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCXN0cnVjdCBjaHVua19oZWFwICpjaHVua19oZWFwOwor
CisJaWYgKCFkZWZhdWx0X2NtYSkKKwkJcmV0dXJuIDA7CisKKwljaHVua19oZWFwID0ga3phbGxv
YyhzaXplb2YoKmNodW5rX2hlYXApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNodW5rX2hlYXApCisJ
CXJldHVybiAtRU5PTUVNOworCisJY2h1bmtfaGVhcC0+b3JkZXIgPSBDSFVOS19IRUFQX09SREVS
OworCWNodW5rX2hlYXAtPmNtYSA9IGRlZmF1bHRfY21hOworCisJZXhwX2luZm8ubmFtZSA9IGNt
YV9nZXRfbmFtZShkZWZhdWx0X2NtYSk7CisJZXhwX2luZm8ub3BzID0gJmNodW5rX2hlYXBfb3Bz
OworCWV4cF9pbmZvLnByaXYgPSBjaHVua19oZWFwOworCisJY2h1bmtfaGVhcC0+aGVhcCA9IGRt
YV9oZWFwX2FkZCgmZXhwX2luZm8pOworCWlmIChJU19FUlIoY2h1bmtfaGVhcC0+aGVhcCkpIHsK
KwkJaW50IHJldCA9IFBUUl9FUlIoY2h1bmtfaGVhcC0+aGVhcCk7CisKKwkJa2ZyZWUoY2h1bmtf
aGVhcCk7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9Cittb2R1bGVfaW5pdChj
aHVua19oZWFwX2luaXQpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJETUEtQlVGIENodW5rIEhlYXAi
KTsKK01PRFVMRV9MSUNFTlNFKCJHUEwgdjIiKTsKLS0gCjIuMjkuMi40NTQuZ2FmZjIwZGEzYTIt
Z29vZwoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTGlu
YXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QKTGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3JnCmh0
dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2xpbmFyby1tbS1zaWcK
