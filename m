Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id AEDAE5B7AC6
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 13 Sep 2022 21:28:41 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 0EF99479F8
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 13 Sep 2022 19:28:41 +0000 (UTC)
Received: from madras.collabora.co.uk (madras.collabora.co.uk [46.235.227.172])
	by lists.linaro.org (Postfix) with ESMTPS id C785C479FA
	for <linaro-mm-sig@lists.linaro.org>; Tue, 13 Sep 2022 19:28:37 +0000 (UTC)
Received: from dimapc.. (109-252-122-187.nat.spd-mgts.ru [109.252.122.187])
	(using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
	 key-exchange X25519 server-signature RSA-PSS (4096 bits) server-digest SHA256)
	(No client certificate requested)
	(Authenticated sender: dmitry.osipenko)
	by madras.collabora.co.uk (Postfix) with ESMTPSA id 2BA446601FFB;
	Tue, 13 Sep 2022 20:28:31 +0100 (BST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=collabora.com;
	s=mail; t=1663097317;
	bh=45S+M9YrC4atv+yqFGCjIB90pcGMljXr98/AqjYL+QI=;
	h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
	b=SPdWqlRHsshRPmPvcyWWjiePvvrAnXxQx3Mgfq3vsgx8BOo1ihtdyQ464BOcEuFYq
	 g1+p/hGZPJ6dSxvvLgb3N8rfYpAeINMZ+I0xaw5PGL4XO08pYXtHH4HrM5XoQ4iFfY
	 Lpf1U8NxWcrCXlHiqfBv8Wtk3RSCMg+NlmM7d74/YyP/zUPx/1xPeeZsmVv44T1nA9
	 q/wdP7ySPJ3Pyot//WRlIJnNGjVgMU8/lfrI1ppRqH0A9XzljEmjNCcHuIeufTOwdD
	 eAyvtYX3tr3UY+746RjZitu6vOuP5q3vUX7i54Xsmb1Sza4iHzznqVgSI2wakRbkq8
	 BIS0kz5Qkf1zg==
From: Dmitry Osipenko <dmitry.osipenko@collabora.com>
To: David Airlie <airlied@linux.ie>,
	Gerd Hoffmann <kraxel@redhat.com>,
	Gurchetan Singh <gurchetansingh@chromium.org>,
	Chia-I Wu <olvaffe@gmail.com>,
	Daniel Vetter <daniel@ffwll.ch>,
	Daniel Almeida <daniel.almeida@collabora.com>,
	Gert Wollny <gert.wollny@collabora.com>,
	Gustavo Padovan <gustavo.padovan@collabora.com>,
	Daniel Stone <daniel@fooishbar.org>,
	Tomeu Vizoso <tomeu.vizoso@collabora.com>,
	Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
	Maxime Ripard <mripard@kernel.org>,
	Thomas Zimmermann <tzimmermann@suse.de>,
	Rob Clark <robdclark@gmail.com>,
	Sumit Semwal <sumit.semwal@linaro.org>,
	=?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
	"Pan, Xinhui" <Xinhui.Pan@amd.com>,
	Thierry Reding <thierry.reding@gmail.com>,
	Tomasz Figa <tfiga@chromium.org>,
	Marek Szyprowski <m.szyprowski@samsung.com>,
	Mauro Carvalho Chehab <mchehab@kernel.org>,
	Alex Deucher <alexander.deucher@amd.com>,
	Jani Nikula <jani.nikula@linux.intel.com>,
	Joonas Lahtinen <joonas.lahtinen@linux.intel.com>,
	Rodrigo Vivi <rodrigo.vivi@intel.com>,
	Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
	=?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas_os@shipmail.org>,
	Qiang Yu <yuq825@gmail.com>,
	Srinivas Kandagatla <srinivas.kandagatla@linaro.org>,
	Amol Maheshwari <amahesh@qti.qualcomm.com>,
	Jason Gunthorpe <jgg@ziepe.ca>,
	Leon Romanovsky <leon@kernel.org>,
	Juergen Gross <jgross@suse.com>,
	Stefano Stabellini <sstabellini@kernel.org>,
	Oleksandr Tyshchenko <oleksandr_tyshchenko@epam.com>,
	Tomi Valkeinen <tomba@kernel.org>,
	Russell King <linux@armlinux.org.uk>,
	Lucas Stach <l.stach@pengutronix.de>,
	Christian Gmeiner <christian.gmeiner@gmail.com>,
	Ruhl Michael J <michael.j.ruhl@intel.com>
Date: Tue, 13 Sep 2022 22:27:39 +0300
Message-Id: <20220913192757.37727-4-dmitry.osipenko@collabora.com>
X-Mailer: git-send-email 2.37.3
In-Reply-To: <20220913192757.37727-1-dmitry.osipenko@collabora.com>
References: <20220913192757.37727-1-dmitry.osipenko@collabora.com>
MIME-Version: 1.0
Message-ID-Hash: ZQDCESSYSYN3V7R5RKEQ4X44VJHTPDXS
X-Message-ID-Hash: ZQDCESSYSYN3V7R5RKEQ4X44VJHTPDXS
X-MailFrom: dmitry.osipenko@collabora.com
X-Mailman-Rule-Hits: nonmember-moderation
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation
CC: dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org, Dmitry Osipenko <digetx@gmail.com>, linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org, amd-gfx@lists.freedesktop.org, intel-gfx@lists.freedesktop.org, kernel@collabora.com, virtualization@lists.linux-foundation.org, linux-rdma@vger.kernel.org, linux-arm-msm@vger.kernel.org
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH v5 03/21] drm/gem: Take reservation lock for vmap/vunmap operations
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/ZQDCESSYSYN3V7R5RKEQ4X44VJHTPDXS/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

VGhlIG5ldyBjb21tb24gZG1hLWJ1ZiBsb2NraW5nIGNvbnZlbnRpb24gd2lsbCByZXF1aXJlIGJ1
ZmZlciBpbXBvcnRlcnMNCnRvIGhvbGQgdGhlIHJlc2VydmF0aW9uIGxvY2sgYXJvdW5kIG1hcHBp
bmcgb3BlcmF0aW9ucy4gTWFrZSBEUk0gR0VNIGNvcmUNCnRvIHRha2UgdGhlIGxvY2sgYXJvdW5k
IHRoZSB2bWFwcGluZyBvcGVyYXRpb25zIGFuZCB1cGRhdGUgRFJNIGRyaXZlcnMgdG8NCnVzZSB0
aGUgbG9ja2VkIGZ1bmN0aW9ucyBmb3IgdGhlIGNhc2Ugd2hlcmUgRFJNIGNvcmUgbm93IGhvbGRz
IHRoZSBsb2NrLg0KVGhpcyBwYXRjaCBwcmVwYXJlcyBEUk0gY29yZSBhbmQgZHJpdmVycyB0byB0
aGUgY29tbW9uIGR5bmFtaWMgZG1hLWJ1Zg0KbG9ja2luZyBjb252ZW50aW9uLg0KDQpBY2tlZC1i
eTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPg0KU2lnbmVkLW9m
Zi1ieTogRG1pdHJ5IE9zaXBlbmtvIDxkbWl0cnkub3NpcGVua29AY29sbGFib3JhLmNvbT4NCi0t
LQ0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50LmMgICAgICAgICAgICAgICAgIHwgIDQgKyst
LQ0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMgICAgICAgICAgICAgICAgICAgIHwgMjQgKysr
KysrKysrKysrKysrKysrKysNCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9kbWFfaGVscGVyLmMg
ICAgICAgICB8ICA2ICsrLS0tDQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fZnJhbWVidWZmZXJf
aGVscGVyLmMgfCAgNiArKy0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3R0bV9oZWxwZXIu
YyAgICAgICAgIHwgIDkgKy0tLS0tLS0NCiBkcml2ZXJzL2dwdS9kcm0vbGltYS9saW1hX3NjaGVk
LmMgICAgICAgICAgICB8ICA0ICsrLS0NCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3RfZHVtcC5jICAgICB8ICA0ICsrLS0NCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3RfcGVyZmNudC5jICB8ICA2ICsrLS0tDQogZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0
LmMgICAgICAgICAgICAgfCAxNyArKysrKysrLS0tLS0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9xeGwv
cXhsX3ByaW1lLmMgICAgICAgICAgICAgIHwgIDQgKystLQ0KIGluY2x1ZGUvZHJtL2RybV9nZW0u
aCAgICAgICAgICAgICAgICAgICAgICAgIHwgIDMgKysrDQogMTEgZmlsZXMgY2hhbmdlZCwgNTQg
aW5zZXJ0aW9ucygrKSwgMzMgZGVsZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2NsaWVudC5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnQuYw0KaW5kZXgg
MmIyMzBiNGQ2OTQyLi5mYmNiMWU5OTUzODQgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2NsaWVudC5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jDQpAQCAtMzIz
LDcgKzMyMyw3IEBAIGRybV9jbGllbnRfYnVmZmVyX3ZtYXAoc3RydWN0IGRybV9jbGllbnRfYnVm
ZmVyICpidWZmZXIsDQogCSAqIGZkX2luc3RhbGwgc3RlcCBvdXQgb2YgdGhlIGRyaXZlciBiYWNr
ZW5kIGhvb2tzLCB0byBtYWtlIHRoYXQNCiAJICogZmluYWwgc3RlcCBvcHRpb25hbCBmb3IgaW50
ZXJuYWwgdXNlcnMuDQogCSAqLw0KLQlyZXQgPSBkcm1fZ2VtX3ZtYXAoYnVmZmVyLT5nZW0sIG1h
cCk7DQorCXJldCA9IGRybV9nZW1fdm1hcF91bmxvY2tlZChidWZmZXItPmdlbSwgbWFwKTsNCiAJ
aWYgKHJldCkNCiAJCXJldHVybiByZXQ7DQogDQpAQCAtMzQ1LDcgKzM0NSw3IEBAIHZvaWQgZHJt
X2NsaWVudF9idWZmZXJfdnVubWFwKHN0cnVjdCBkcm1fY2xpZW50X2J1ZmZlciAqYnVmZmVyKQ0K
IHsNCiAJc3RydWN0IGlvc3lzX21hcCAqbWFwID0gJmJ1ZmZlci0+bWFwOw0KIA0KLQlkcm1fZ2Vt
X3Z1bm1hcChidWZmZXItPmdlbSwgbWFwKTsNCisJZHJtX2dlbV92dW5tYXBfdW5sb2NrZWQoYnVm
ZmVyLT5nZW0sIG1hcCk7DQogfQ0KIEVYUE9SVF9TWU1CT0woZHJtX2NsaWVudF9idWZmZXJfdnVu
bWFwKTsNCiANCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW0uYw0KaW5kZXggOGI2OGEzYzFlNmFiLi5iOGRiNjc1ZTdmYjUgMTAw
NjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jDQorKysgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2dlbS5jDQpAQCAtMTE1OCw2ICsxMTU4LDggQEAgaW50IGRybV9nZW1fdm1hcChzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IGlvc3lzX21hcCAqbWFwKQ0KIHsNCiAJaW50
IHJldDsNCiANCisJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQob2JqLT5yZXN2KTsNCisNCiAJaWYgKCFv
YmotPmZ1bmNzLT52bWFwKQ0KIAkJcmV0dXJuIC1FT1BOT1RTVVBQOw0KIA0KQEAgLTExNzMsNiAr
MTE3NSw4IEBAIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92bWFwKTsNCiANCiB2b2lkIGRybV9nZW1f
dnVubWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgaW9zeXNfbWFwICptYXAp
DQogew0KKwlkbWFfcmVzdl9hc3NlcnRfaGVsZChvYmotPnJlc3YpOw0KKw0KIAlpZiAoaW9zeXNf
bWFwX2lzX251bGwobWFwKSkNCiAJCXJldHVybjsNCiANCkBAIC0xMTg0LDYgKzExODgsMjYgQEAg
dm9pZCBkcm1fZ2VtX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IGlv
c3lzX21hcCAqbWFwKQ0KIH0NCiBFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnVubWFwKTsNCiANCitp
bnQgZHJtX2dlbV92bWFwX3VubG9ja2VkKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1
Y3QgaW9zeXNfbWFwICptYXApDQorew0KKwlpbnQgcmV0Ow0KKw0KKwlkbWFfcmVzdl9sb2NrKG9i
ai0+cmVzdiwgTlVMTCk7DQorCXJldCA9IGRybV9nZW1fdm1hcChvYmosIG1hcCk7DQorCWRtYV9y
ZXN2X3VubG9jayhvYmotPnJlc3YpOw0KKw0KKwlyZXR1cm4gcmV0Ow0KK30NCitFWFBPUlRfU1lN
Qk9MKGRybV9nZW1fdm1hcF91bmxvY2tlZCk7DQorDQordm9pZCBkcm1fZ2VtX3Z1bm1hcF91bmxv
Y2tlZChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IGlvc3lzX21hcCAqbWFwKQ0K
K3sNCisJZG1hX3Jlc3ZfbG9jayhvYmotPnJlc3YsIE5VTEwpOw0KKwlkcm1fZ2VtX3Z1bm1hcChv
YmosIG1hcCk7DQorCWRtYV9yZXN2X3VubG9jayhvYmotPnJlc3YpOw0KK30NCitFWFBPUlRfU1lN
Qk9MKGRybV9nZW1fdnVubWFwX3VubG9ja2VkKTsNCisNCiAvKioNCiAgKiBkcm1fZ2VtX2xvY2tf
cmVzZXJ2YXRpb25zIC0gU2V0cyB1cCB0aGUgd3cgY29udGV4dCBhbmQgYWNxdWlyZXMNCiAgKiB0
aGUgbG9jayBvbiBhbiBhcnJheSBvZiBHRU0gb2JqZWN0cy4NCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vZHJtX2dlbV9kbWFfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9k
bWFfaGVscGVyLmMNCmluZGV4IGY2OTAxZmY5N2JiYi4uMWU2NThjNDQ4MzY2IDEwMDY0NA0KLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fZG1hX2hlbHBlci5jDQorKysgYi9kcml2ZXJzL2dw
dS9kcm0vZHJtX2dlbV9kbWFfaGVscGVyLmMNCkBAIC0yMzAsNyArMjMwLDcgQEAgdm9pZCBkcm1f
Z2VtX2RtYV9mcmVlKHN0cnVjdCBkcm1fZ2VtX2RtYV9vYmplY3QgKmRtYV9vYmopDQogDQogCWlm
IChnZW1fb2JqLT5pbXBvcnRfYXR0YWNoKSB7DQogCQlpZiAoZG1hX29iai0+dmFkZHIpDQotCQkJ
ZG1hX2J1Zl92dW5tYXAoZ2VtX29iai0+aW1wb3J0X2F0dGFjaC0+ZG1hYnVmLCAmbWFwKTsNCisJ
CQlkbWFfYnVmX3Z1bm1hcF91bmxvY2tlZChnZW1fb2JqLT5pbXBvcnRfYXR0YWNoLT5kbWFidWYs
ICZtYXApOw0KIAkJZHJtX3ByaW1lX2dlbV9kZXN0cm95KGdlbV9vYmosIGRtYV9vYmotPnNndCk7
DQogCX0gZWxzZSBpZiAoZG1hX29iai0+dmFkZHIpIHsNCiAJCWlmIChkbWFfb2JqLT5tYXBfbm9u
Y29oZXJlbnQpDQpAQCAtNTgxLDcgKzU4MSw3IEBAIGRybV9nZW1fZG1hX3ByaW1lX2ltcG9ydF9z
Z190YWJsZV92bWFwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsDQogCXN0cnVjdCBpb3N5c19tYXAg
bWFwOw0KIAlpbnQgcmV0Ow0KIA0KLQlyZXQgPSBkbWFfYnVmX3ZtYXAoYXR0YWNoLT5kbWFidWYs
ICZtYXApOw0KKwlyZXQgPSBkbWFfYnVmX3ZtYXBfdW5sb2NrZWQoYXR0YWNoLT5kbWFidWYsICZt
YXApOw0KIAlpZiAocmV0KSB7DQogCQlEUk1fRVJST1IoIkZhaWxlZCB0byB2bWFwIFBSSU1FIGJ1
ZmZlclxuIik7DQogCQlyZXR1cm4gRVJSX1BUUihyZXQpOw0KQEAgLTU4OSw3ICs1ODksNyBAQCBk
cm1fZ2VtX2RtYV9wcmltZV9pbXBvcnRfc2dfdGFibGVfdm1hcChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LA0KIA0KIAlvYmogPSBkcm1fZ2VtX2RtYV9wcmltZV9pbXBvcnRfc2dfdGFibGUoZGV2LCBh
dHRhY2gsIHNndCk7DQogCWlmIChJU19FUlIob2JqKSkgew0KLQkJZG1hX2J1Zl92dW5tYXAoYXR0
YWNoLT5kbWFidWYsICZtYXApOw0KKwkJZG1hX2J1Zl92dW5tYXBfdW5sb2NrZWQoYXR0YWNoLT5k
bWFidWYsICZtYXApOw0KIAkJcmV0dXJuIG9iajsNCiAJfQ0KIA0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJt
L2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmMNCmluZGV4IDg4MGE0OTc1NTA3Zi4uZTM1ZTIy
NGU2MzAzIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fZnJhbWVidWZmZXJf
aGVscGVyLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBl
ci5jDQpAQCAtMzU0LDcgKzM1NCw3IEBAIGludCBkcm1fZ2VtX2ZiX3ZtYXAoc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBpb3N5c19tYXAgKm1hcCwNCiAJCQlyZXQgPSAtRUlOVkFM
Ow0KIAkJCWdvdG8gZXJyX2RybV9nZW1fdnVubWFwOw0KIAkJfQ0KLQkJcmV0ID0gZHJtX2dlbV92
bWFwKG9iaiwgJm1hcFtpXSk7DQorCQlyZXQgPSBkcm1fZ2VtX3ZtYXBfdW5sb2NrZWQob2JqLCAm
bWFwW2ldKTsNCiAJCWlmIChyZXQpDQogCQkJZ290byBlcnJfZHJtX2dlbV92dW5tYXA7DQogCX0N
CkBAIC0zNzYsNyArMzc2LDcgQEAgaW50IGRybV9nZW1fZmJfdm1hcChzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwgc3RydWN0IGlvc3lzX21hcCAqbWFwLA0KIAkJb2JqID0gZHJtX2dlbV9mYl9n
ZXRfb2JqKGZiLCBpKTsNCiAJCWlmICghb2JqKQ0KIAkJCWNvbnRpbnVlOw0KLQkJZHJtX2dlbV92
dW5tYXAob2JqLCAmbWFwW2ldKTsNCisJCWRybV9nZW1fdnVubWFwX3VubG9ja2VkKG9iaiwgJm1h
cFtpXSk7DQogCX0NCiAJcmV0dXJuIHJldDsNCiB9DQpAQCAtNDAzLDcgKzQwMyw3IEBAIHZvaWQg
ZHJtX2dlbV9mYl92dW5tYXAoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBpb3N5
c19tYXAgKm1hcCkNCiAJCQljb250aW51ZTsNCiAJCWlmIChpb3N5c19tYXBfaXNfbnVsbCgmbWFw
W2ldKSkNCiAJCQljb250aW51ZTsNCi0JCWRybV9nZW1fdnVubWFwKG9iaiwgJm1hcFtpXSk7DQor
CQlkcm1fZ2VtX3Z1bm1hcF91bmxvY2tlZChvYmosICZtYXBbaV0pOw0KIAl9DQogfQ0KIEVYUE9S
VF9TWU1CT0woZHJtX2dlbV9mYl92dW5tYXApOw0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fZ2VtX3R0bV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3R0bV9oZWxw
ZXIuYw0KaW5kZXggZTVmYzg3NTk5MGM0Li5kNTk2MmEzNGMwMWQgMTAwNjQ0DQotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV90dG1faGVscGVyLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fZ2VtX3R0bV9oZWxwZXIuYw0KQEAgLTY0LDEzICs2NCw4IEBAIGludCBkcm1fZ2VtX3R0bV92
bWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtLA0KIAkJICAgICBzdHJ1Y3QgaW9zeXNfbWFw
ICptYXApDQogew0KIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gZHJtX2dlbV90dG1f
b2ZfZ2VtKGdlbSk7DQotCWludCByZXQ7DQotDQotCWRtYV9yZXN2X2xvY2soZ2VtLT5yZXN2LCBO
VUxMKTsNCi0JcmV0ID0gdHRtX2JvX3ZtYXAoYm8sIG1hcCk7DQotCWRtYV9yZXN2X3VubG9jayhn
ZW0tPnJlc3YpOw0KIA0KLQlyZXR1cm4gcmV0Ow0KKwlyZXR1cm4gdHRtX2JvX3ZtYXAoYm8sIG1h
cCk7DQogfQ0KIEVYUE9SVF9TWU1CT0woZHJtX2dlbV90dG1fdm1hcCk7DQogDQpAQCAtODcsOSAr
ODIsNyBAQCB2b2lkIGRybV9nZW1fdHRtX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdl
bSwNCiB7DQogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSBkcm1fZ2VtX3R0bV9vZl9n
ZW0oZ2VtKTsNCiANCi0JZG1hX3Jlc3ZfbG9jayhnZW0tPnJlc3YsIE5VTEwpOw0KIAl0dG1fYm9f
dnVubWFwKGJvLCBtYXApOw0KLQlkbWFfcmVzdl91bmxvY2soZ2VtLT5yZXN2KTsNCiB9DQogRVhQ
T1JUX1NZTUJPTChkcm1fZ2VtX3R0bV92dW5tYXApOw0KIA0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9saW1hL2xpbWFfc2NoZWQuYyBiL2RyaXZlcnMvZ3B1L2RybS9saW1hL2xpbWFfc2No
ZWQuYw0KaW5kZXggZTgyOTMxNzEyZDhhLi5mZjAwMzQwM2ZiYmMgMTAwNjQ0DQotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vbGltYS9saW1hX3NjaGVkLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9saW1h
L2xpbWFfc2NoZWQuYw0KQEAgLTM3MSw3ICszNzEsNyBAQCBzdGF0aWMgdm9pZCBsaW1hX3NjaGVk
X2J1aWxkX2Vycm9yX3Rhc2tfbGlzdChzdHJ1Y3QgbGltYV9zY2hlZF90YXNrICp0YXNrKQ0KIAkJ
fSBlbHNlIHsNCiAJCQlidWZmZXJfY2h1bmstPnNpemUgPSBsaW1hX2JvX3NpemUoYm8pOw0KIA0K
LQkJCXJldCA9IGRybV9nZW1fc2htZW1fdm1hcCgmYm8tPmJhc2UsICZtYXApOw0KKwkJCXJldCA9
IGRybV9nZW1fdm1hcF91bmxvY2tlZCgmYm8tPmJhc2UuYmFzZSwgJm1hcCk7DQogCQkJaWYgKHJl
dCkgew0KIAkJCQlrdmZyZWUoZXQpOw0KIAkJCQlnb3RvIG91dDsNCkBAIC0zNzksNyArMzc5LDcg
QEAgc3RhdGljIHZvaWQgbGltYV9zY2hlZF9idWlsZF9lcnJvcl90YXNrX2xpc3Qoc3RydWN0IGxp
bWFfc2NoZWRfdGFzayAqdGFzaykNCiANCiAJCQltZW1jcHkoYnVmZmVyX2NodW5rICsgMSwgbWFw
LnZhZGRyLCBidWZmZXJfY2h1bmstPnNpemUpOw0KIA0KLQkJCWRybV9nZW1fc2htZW1fdnVubWFw
KCZiby0+YmFzZSwgJm1hcCk7DQorCQkJZHJtX2dlbV92dW5tYXBfdW5sb2NrZWQoJmJvLT5iYXNl
LmJhc2UsICZtYXApOw0KIAkJfQ0KIA0KIAkJYnVmZmVyX2NodW5rID0gKHZvaWQgKikoYnVmZmVy
X2NodW5rICsgMSkgKyBidWZmZXJfY2h1bmstPnNpemU7DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2R1bXAuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9wYW5mcm9zdF9kdW1wLmMNCmluZGV4IDg5MDU2YTFhYWM3ZC4uZjYyYTAxOWNjNTIzIDEwMDY0
NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2R1bXAuYw0KKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2R1bXAuYw0KQEAgLTIwOSw3ICsyMDks
NyBAQCB2b2lkIHBhbmZyb3N0X2NvcmVfZHVtcChzdHJ1Y3QgcGFuZnJvc3Rfam9iICpqb2IpDQog
CQkJZ290byBkdW1wX2hlYWRlcjsNCiAJCX0NCiANCi0JCXJldCA9IGRybV9nZW1fc2htZW1fdm1h
cCgmYm8tPmJhc2UsICZtYXApOw0KKwkJcmV0ID0gZHJtX2dlbV92bWFwX3VubG9ja2VkKCZiby0+
YmFzZS5iYXNlLCAmbWFwKTsNCiAJCWlmIChyZXQpIHsNCiAJCQlkZXZfZXJyKHBmZGV2LT5kZXYs
ICJQYW5mcm9zdCBEdW1wOiBjb3VsZG4ndCBtYXAgQnVmZmVyIE9iamVjdFxuIik7DQogCQkJaXRl
ci5oZHItPmJvbWFwLnZhbGlkID0gMDsNCkBAIC0yMzYsNyArMjM2LDcgQEAgdm9pZCBwYW5mcm9z
dF9jb3JlX2R1bXAoc3RydWN0IHBhbmZyb3N0X2pvYiAqam9iKQ0KIAkJdmFkZHIgPSBtYXAudmFk
ZHI7DQogCQltZW1jcHkoaXRlci5kYXRhLCB2YWRkciwgYm8tPmJhc2UuYmFzZS5zaXplKTsNCiAN
Ci0JCWRybV9nZW1fc2htZW1fdnVubWFwKCZiby0+YmFzZSwgJm1hcCk7DQorCQlkcm1fZ2VtX3Z1
bm1hcF91bmxvY2tlZCgmYm8tPmJhc2UuYmFzZSwgJm1hcCk7DQogDQogCQlpdGVyLmhkci0+Ym9t
YXAudmFsaWQgPSBjcHVfdG9fbGUzMigxKTsNCiANCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvcGFuZnJvc3RfcGVyZmNudC5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L3BhbmZyb3N0X3BlcmZjbnQuYw0KaW5kZXggYmMwZGY5M2Y3ZjIxLi5iYTliNmUyYjI2MzYgMTAw
NjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfcGVyZmNudC5jDQor
KysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfcGVyZmNudC5jDQpAQCAtMTA2
LDcgKzEwNiw3IEBAIHN0YXRpYyBpbnQgcGFuZnJvc3RfcGVyZmNudF9lbmFibGVfbG9ja2VkKHN0
cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LA0KIAkJZ290byBlcnJfY2xvc2VfYm87DQogCX0N
CiANCi0JcmV0ID0gZHJtX2dlbV9zaG1lbV92bWFwKGJvLCAmbWFwKTsNCisJcmV0ID0gZHJtX2dl
bV92bWFwX3VubG9ja2VkKCZiby0+YmFzZSwgJm1hcCk7DQogCWlmIChyZXQpDQogCQlnb3RvIGVy
cl9wdXRfbWFwcGluZzsNCiAJcGVyZmNudC0+YnVmID0gbWFwLnZhZGRyOw0KQEAgLTE2NSw3ICsx
NjUsNyBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X3BlcmZjbnRfZW5hYmxlX2xvY2tlZChzdHJ1Y3Qg
cGFuZnJvc3RfZGV2aWNlICpwZmRldiwNCiAJcmV0dXJuIDA7DQogDQogZXJyX3Z1bm1hcDoNCi0J
ZHJtX2dlbV9zaG1lbV92dW5tYXAoYm8sICZtYXApOw0KKwlkcm1fZ2VtX3Z1bm1hcF91bmxvY2tl
ZCgmYm8tPmJhc2UsICZtYXApOw0KIGVycl9wdXRfbWFwcGluZzoNCiAJcGFuZnJvc3RfZ2VtX21h
cHBpbmdfcHV0KHBlcmZjbnQtPm1hcHBpbmcpOw0KIGVycl9jbG9zZV9ibzoNCkBAIC0xOTUsNyAr
MTk1LDcgQEAgc3RhdGljIGludCBwYW5mcm9zdF9wZXJmY250X2Rpc2FibGVfbG9ja2VkKHN0cnVj
dCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LA0KIAkJICBHUFVfUEVSRkNOVF9DRkdfTU9ERShHUFVf
UEVSRkNOVF9DRkdfTU9ERV9PRkYpKTsNCiANCiAJcGVyZmNudC0+dXNlciA9IE5VTEw7DQotCWRy
bV9nZW1fc2htZW1fdnVubWFwKCZwZXJmY250LT5tYXBwaW5nLT5vYmotPmJhc2UsICZtYXApOw0K
Kwlkcm1fZ2VtX3Z1bm1hcF91bmxvY2tlZCgmcGVyZmNudC0+bWFwcGluZy0+b2JqLT5iYXNlLmJh
c2UsICZtYXApOw0KIAlwZXJmY250LT5idWYgPSBOVUxMOw0KIAlwYW5mcm9zdF9nZW1fY2xvc2Uo
JnBlcmZjbnQtPm1hcHBpbmctPm9iai0+YmFzZS5iYXNlLCBmaWxlX3ByaXYpOw0KIAlwYW5mcm9z
dF9tbXVfYXNfcHV0KHBmZGV2LCBwZXJmY250LT5tYXBwaW5nLT5tbXUpOw0KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9x
eGxfb2JqZWN0LmMNCmluZGV4IDY5NWQ5MzA4ZDFmMC4uMDZhNThkYWQ1ZjVjIDEwMDY0NA0KLS0t
IGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMNCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9xeGwvcXhsX29iamVjdC5jDQpAQCAtMTY4LDkgKzE2OCwxNiBAQCBpbnQgcXhsX2JvX3ZtYXBf
bG9ja2VkKHN0cnVjdCBxeGxfYm8gKmJvLCBzdHJ1Y3QgaW9zeXNfbWFwICptYXApDQogCQliby0+
bWFwX2NvdW50Kys7DQogCQlnb3RvIG91dDsNCiAJfQ0KLQlyID0gdHRtX2JvX3ZtYXAoJmJvLT50
Ym8sICZiby0+bWFwKTsNCisNCisJciA9IF9fcXhsX2JvX3Bpbihibyk7DQogCWlmIChyKQ0KIAkJ
cmV0dXJuIHI7DQorDQorCXIgPSB0dG1fYm9fdm1hcCgmYm8tPnRibywgJmJvLT5tYXApOw0KKwlp
ZiAocikgew0KKwkJX19xeGxfYm9fdW5waW4oYm8pOw0KKwkJcmV0dXJuIHI7DQorCX0NCiAJYm8t
Pm1hcF9jb3VudCA9IDE7DQogDQogCS8qIFRPRE86IFJlbW92ZSBrcHRyIGluIGZhdm9yIG9mIG1h
cCBldmVyeXdoZXJlLiAqLw0KQEAgLTE5MiwxMiArMTk5LDYgQEAgaW50IHF4bF9ib192bWFwKHN0
cnVjdCBxeGxfYm8gKmJvLCBzdHJ1Y3QgaW9zeXNfbWFwICptYXApDQogCWlmIChyKQ0KIAkJcmV0
dXJuIHI7DQogDQotCXIgPSBfX3F4bF9ib19waW4oYm8pOw0KLQlpZiAocikgew0KLQkJcXhsX2Jv
X3VucmVzZXJ2ZShibyk7DQotCQlyZXR1cm4gcjsNCi0JfQ0KLQ0KIAlyID0gcXhsX2JvX3ZtYXBf
bG9ja2VkKGJvLCBtYXApOw0KIAlxeGxfYm9fdW5yZXNlcnZlKGJvKTsNCiAJcmV0dXJuIHI7DQpA
QCAtMjQ3LDYgKzI0OCw3IEBAIHZvaWQgcXhsX2JvX3Z1bm1hcF9sb2NrZWQoc3RydWN0IHF4bF9i
byAqYm8pDQogCQlyZXR1cm47DQogCWJvLT5rcHRyID0gTlVMTDsNCiAJdHRtX2JvX3Z1bm1hcCgm
Ym8tPnRibywgJmJvLT5tYXApOw0KKwlfX3F4bF9ib191bnBpbihibyk7DQogfQ0KIA0KIGludCBx
eGxfYm9fdnVubWFwKHN0cnVjdCBxeGxfYm8gKmJvKQ0KQEAgLTI1OCw3ICsyNjAsNiBAQCBpbnQg
cXhsX2JvX3Z1bm1hcChzdHJ1Y3QgcXhsX2JvICpibykNCiAJCXJldHVybiByOw0KIA0KIAlxeGxf
Ym9fdnVubWFwX2xvY2tlZChibyk7DQotCV9fcXhsX2JvX3VucGluKGJvKTsNCiAJcXhsX2JvX3Vu
cmVzZXJ2ZShibyk7DQogCXJldHVybiAwOw0KIH0NCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vcXhsL3F4bF9wcmltZS5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfcHJpbWUuYw0KaW5k
ZXggMTQyZDAxNDE1YWNiLi45MTY5YzI2MzU3ZDMgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vcXhsL3F4bF9wcmltZS5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9wcmltZS5j
DQpAQCAtNTksNyArNTksNyBAQCBpbnQgcXhsX2dlbV9wcmltZV92bWFwKHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqLCBzdHJ1Y3QgaW9zeXNfbWFwICptYXApDQogCXN0cnVjdCBxeGxfYm8gKmJv
ID0gZ2VtX3RvX3F4bF9ibyhvYmopOw0KIAlpbnQgcmV0Ow0KIA0KLQlyZXQgPSBxeGxfYm9fdm1h
cChibywgbWFwKTsNCisJcmV0ID0gcXhsX2JvX3ZtYXBfbG9ja2VkKGJvLCBtYXApOw0KIAlpZiAo
cmV0IDwgMCkNCiAJCXJldHVybiByZXQ7DQogDQpAQCAtNzEsNSArNzEsNSBAQCB2b2lkIHF4bF9n
ZW1fcHJpbWVfdnVubWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLA0KIHsNCiAJc3RydWN0
IHF4bF9ibyAqYm8gPSBnZW1fdG9fcXhsX2JvKG9iaik7DQogDQotCXF4bF9ib192dW5tYXAoYm8p
Ow0KKwlxeGxfYm9fdnVubWFwX2xvY2tlZChibyk7DQogfQ0KZGlmZiAtLWdpdCBhL2luY2x1ZGUv
ZHJtL2RybV9nZW0uaCBiL2luY2x1ZGUvZHJtL2RybV9nZW0uaA0KaW5kZXggYmQ0MmYyNWU0NDlj
Li5mNGQ4OThhZTBmYjAgMTAwNjQ0DQotLS0gYS9pbmNsdWRlL2RybS9kcm1fZ2VtLmgNCisrKyBi
L2luY2x1ZGUvZHJtL2RybV9nZW0uaA0KQEAgLTQ3NSw0ICs0NzUsNyBAQCB2b2lkIGRybV9nZW1f
bHJ1X21vdmVfdGFpbChzdHJ1Y3QgZHJtX2dlbV9scnUgKmxydSwgc3RydWN0IGRybV9nZW1fb2Jq
ZWN0ICpvYmopOw0KIHVuc2lnbmVkIGxvbmcgZHJtX2dlbV9scnVfc2NhbihzdHJ1Y3QgZHJtX2dl
bV9scnUgKmxydSwgdW5zaWduZWQgbnJfdG9fc2NhbiwNCiAJCQkgICAgICAgYm9vbCAoKnNocmlu
aykoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopKTsNCiANCitpbnQgZHJtX2dlbV92bWFwX3Vu
bG9ja2VkKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgaW9zeXNfbWFwICptYXAp
Ow0KK3ZvaWQgZHJtX2dlbV92dW5tYXBfdW5sb2NrZWQoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpv
YmosIHN0cnVjdCBpb3N5c19tYXAgKm1hcCk7DQorDQogI2VuZGlmIC8qIF9fRFJNX0dFTV9IX18g
Ki8NCi0tIA0KMi4zNy4zDQoNCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0IC0tIGxpbmFyby1tbS1zaWdAbGlz
dHMubGluYXJvLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVtYWlsIHRvIGxpbmFyby1tbS1z
aWctbGVhdmVAbGlzdHMubGluYXJvLm9yZwo=
