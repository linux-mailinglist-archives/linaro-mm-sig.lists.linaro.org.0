Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 5AC9E832B31
	for <lists+linaro-mm-sig@lfdr.de>; Fri, 19 Jan 2024 15:16:11 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 6AAC63EC20
	for <lists+linaro-mm-sig@lfdr.de>; Fri, 19 Jan 2024 14:16:10 +0000 (UTC)
Received: from aposti.net (aposti.net [89.234.176.197])
	by lists.linaro.org (Postfix) with ESMTPS id 94D9243D14
	for <linaro-mm-sig@lists.linaro.org>; Fri, 19 Jan 2024 14:14:43 +0000 (UTC)
Authentication-Results: lists.linaro.org;
	dkim=pass header.d=crapouillou.net header.s=mail header.b=QLAS56wg;
	spf=pass (lists.linaro.org: domain of paul@crapouillou.net designates 89.234.176.197 as permitted sender) smtp.mailfrom=paul@crapouillou.net;
	dmarc=pass (policy=none) header.from=crapouillou.net
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=crapouillou.net;
	s=mail; t=1705673654;
	h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
	 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
	 content-transfer-encoding:content-transfer-encoding:
	 in-reply-to:in-reply-to:references:references;
	bh=HEEYiuLeIQ4/+QA+DhT4nVTv5/edVx50oVzMxKrH1w4=;
	b=QLAS56wgZGcnmqpfLGkhpK2KY6pPcsu9xTYj6Ew50+hPNTxlR3ICIKcjyYllFnQrPQHFHj
	Rck42IjixnGA44D199A8PCaacR7czLUsqGSRtUIwThMaBwfToU4WaT1N7G6WfDPlNSt9gs
	DafXR9L6AJP3uMdMCBmlY18Ml7FqGzg=
From: Paul Cercueil <paul@crapouillou.net>
To: Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
	Jonathan Corbet <corbet@lwn.net>,
	Sumit Semwal <sumit.semwal@linaro.org>,
	=?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Date: Fri, 19 Jan 2024 15:14:01 +0100
Message-ID: <20240119141402.44262-6-paul@crapouillou.net>
In-Reply-To: <20240119141402.44262-1-paul@crapouillou.net>
References: <20240119141402.44262-1-paul@crapouillou.net>
MIME-Version: 1.0
X-Rspamd-Action: no action
X-Spamd-Result: default: False [-5.50 / 15.00];
	REPLY(-4.00)[];
	BAYES_HAM(-3.00)[100.00%];
	SUSPICIOUS_RECIPS(1.50)[];
	MID_CONTAINS_FROM(1.00)[];
	DMARC_POLICY_ALLOW(-0.50)[crapouillou.net,none];
	R_DKIM_ALLOW(-0.20)[crapouillou.net:s=mail];
	R_SPF_ALLOW(-0.20)[+a:c];
	MIME_GOOD(-0.10)[text/plain];
	ARC_NA(0.00)[];
	ASN(0.00)[asn:203432, ipnet:89.234.176.0/23, country:FR];
	MIME_TRACE(0.00)[0:+];
	MISSING_XM_UA(0.00)[];
	RCPT_COUNT_TWELVE(0.00)[15];
	TAGGED_RCPT(0.00)[];
	NEURAL_HAM(-0.00)[-1.000];
	TO_DN_SOME(0.00)[];
	FREEMAIL_CC(0.00)[kernel.org,gmail.com,analog.com,vger.kernel.org,lists.freedesktop.org,lists.linaro.org,crapouillou.net,ffwll.ch];
	RCVD_COUNT_ZERO(0.00)[0];
	FROM_HAS_DN(0.00)[];
	TO_MATCH_ENVRCPT_SOME(0.00)[];
	FROM_EQ_ENVFROM(0.00)[];
	DKIM_TRACE(0.00)[crapouillou.net:+]
X-Rspamd-Server: lists.linaro.org
X-Rspamd-Queue-Id: 94D9243D14
X-Spamd-Bar: -----
Message-ID-Hash: RY3ZY6URXFPXPAZV2ZWIOS2EQT3OPXVF
X-Message-ID-Hash: RY3ZY6URXFPXPAZV2ZWIOS2EQT3OPXVF
X-MailFrom: paul@crapouillou.net
X-Mailman-Rule-Hits: nonmember-moderation
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation
CC: Jonathan Cameron <jic23@kernel.org>, =?UTF-8?q?Nuno=20S=C3=A1?= <noname.nuno@gmail.com>, Michael Hennerich <Michael.Hennerich@analog.com>, linux-usb@vger.kernel.org, linux-doc@vger.kernel.org, linux-kernel@vger.kernel.org, linux-media@vger.kernel.org, dri-devel@lists.freedesktop.org, linaro-mm-sig@lists.linaro.org, Paul Cercueil <paul@crapouillou.net>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH v5 5/6] usb: gadget: functionfs: Add DMABUF import interface
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/RY3ZY6URXFPXPAZV2ZWIOS2EQT3OPXVF/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

VGhpcyBwYXRjaCBpbnRyb2R1Y2VzIHRocmVlIG5ldyBpb2N0bHMuIFRoZXkgYWxsIHNob3VsZCBi
ZSBjYWxsZWQgb24gYQ0KZGF0YSBlbmRwb2ludCAoaWUuIG5vdCBlcDApLiBUaGV5IGFyZToNCg0K
LSBGVU5DVElPTkZTX0RNQUJVRl9BVFRBQ0gsIHdoaWNoIHRha2VzIHRoZSBmaWxlIGRlc2NyaXB0
b3Igb2YgYSBETUFCVUYNCiAgb2JqZWN0IHRvIGF0dGFjaCB0byB0aGUgZW5kcG9pbnQuDQoNCi0g
RlVOQ1RJT05GU19ETUFCVUZfREVUQUNILCB3aGljaCB0YWtlcyB0aGUgZmlsZSBkZXNjcmlwdG9y
IG9mIHRoZQ0KICBETUFCVUYgdG8gZGV0YWNoIGZyb20gdGhlIGVuZHBvaW50LiBOb3RlIHRoYXQg
Y2xvc2luZyB0aGUgZW5kcG9pbnQncw0KICBmaWxlIGRlc2NyaXB0b3Igd2lsbCBhdXRvbWF0aWNh
bGx5IGRldGFjaCBhbGwgYXR0YWNoZWQgRE1BQlVGcy4NCg0KLSBGVU5DVElPTkZTX0RNQUJVRl9U
UkFOU0ZFUiwgd2hpY2ggcmVxdWVzdHMgYSBkYXRhIHRyYW5zZmVyIGZyb20gLyB0bw0KICB0aGUg
Z2l2ZW4gRE1BQlVGLiBJdHMgYXJndW1lbnQgaXMgYSBzdHJ1Y3R1cmUgdGhhdCBwYWNrcyB0aGUg
RE1BQlVGJ3MNCiAgZmlsZSBkZXNjcmlwdG9yLCB0aGUgc2l6ZSBpbiBieXRlcyB0byB0cmFuc2Zl
ciAod2hpY2ggc2hvdWxkIGdlbmVyYWxseQ0KICBiZSBzZXQgdG8gdGhlIHNpemUgb2YgdGhlIERN
QUJVRiksIGFuZCBhICdmbGFncycgZmllbGQgd2hpY2ggaXMgdW51c2VkDQogIGZvciBub3cuDQog
IEJlZm9yZSB0aGlzIGlvY3RsIGNhbiBiZSB1c2VkLCB0aGUgcmVsYXRlZCBETUFCVUYgbXVzdCBi
ZSBhdHRhY2hlZA0KICB3aXRoIEZVTkNUSU9ORlNfRE1BQlVGX0FUVEFDSC4NCg0KVGhlc2UgdGhy
ZWUgaW9jdGxzIGVuYWJsZSB0aGUgRnVuY3Rpb25GUyBjb2RlIHRvIHRyYW5zZmVyIGRhdGEgYmV0
d2Vlbg0KdGhlIFVTQiBzdGFjayBhbmQgYSBETUFCVUYgb2JqZWN0LCB3aGljaCBjYW4gYmUgcHJv
dmlkZWQgYnkgYSBkcml2ZXINCmZyb20gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCBzdWJzeXN0ZW0s
IGluIGEgemVyby1jb3B5IGZhc2hpb24uDQoNClNpZ25lZC1vZmYtYnk6IFBhdWwgQ2VyY3VlaWwg
PHBhdWxAY3JhcG91aWxsb3UubmV0Pg0KQWNrZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52
ZXR0ZXJAZmZ3bGwuY2g+DQpBY2tlZC1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtv
ZW5pZ0BhbWQuY29tPg0KDQotLS0NCnYyOg0KLSBNYWtlIGZmc19kbWFfcmVzdl9sb2NrKCkgc3Rh
dGljDQotIEFkZCBNT0RVTEVfSU1QT1JUX05TKERNQV9CVUYpOw0KLSBUaGUgYXR0YWNoL2RldGFj
aCBmdW5jdGlvbnMgYXJlIG5vdyBwZXJmb3JtZWQgd2l0aG91dCBsb2NraW5nIHRoZQ0KICBlcHNf
bG9jayBzcGlubG9jay4gVGhlIHRyYW5zZmVyIGZ1bmN0aW9uIHN0YXJ0cyB3aXRoIHRoZSBzcGlu
bG9jaw0KICB1bmxvY2tlZCwgdGhlbiBsb2NrcyBpdCBiZWZvcmUgYWxsb2NhdGluZyBhbmQgcXVl
dWVpbmcgdGhlIFVTQg0KICB0cmFuc2Zlci4NCg0KdjM6DQotIElubGluZSB0b19mZnNfZG1hX2Zl
bmNlKCkgd2hpY2ggd2FzIGNhbGxlZCBvbmx5IG9uY2UuDQotIFNpbXBsaWZ5IGZmc19kbWFfcmVz
dl9sb2NrKCkNCi0gQWRkIGNvbW1lbnQgZXhwbGFpbmluZyB3aHkgd2UgdW5yZWYgdHdpY2UgaW4g
ZmZzX2RtYWJ1Zl9kZXRhY2goKQ0KLSBEb2N1bWVudCB1YXBpIHN0cnVjdCB1c2JfZmZzX2RtYWJ1
Zl90cmFuc2Zlcl9yZXEgYW5kIElPQ1RMcw0KDQp2NDoNCi0gUHJvdGVjdCB0aGUgRE1BQlVGIGxp
c3Qgd2l0aCBhIG11dGV4DQotIFVzZSBpbmNyZW1lbnRhbCBzZXF1ZW5jZSBudW1iZXIgZm9yIHRo
ZSBkbWFfZmVuY2VzDQotIFVucmVmIGF0dGFjaG1lbnRzIGFuZCBETUFCVUZzIGluIHdvcmtlcnMN
Ci0gUmVtb3ZlIGRlYWQgY29kZSBpbiBmZnNfZG1hX3Jlc3ZfbG9jaygpDQotIEZpeCBub24tYmxv
Y2sgYWN0dWFsbHkgYmxvY2tpbmcNCi0gVXNlIGRtYV9mZW5jZV9iZWdpbi9lbmRfc2lnbmFsbGlu
ZygpDQotIEFkZCBjb21tZW50IGFib3V0IGNhY2hlLW1hbmFnZW1lbnQgYW5kIGRtYV9idWZfdW5t
YXBfYXR0YWNobWVudCgpDQotIE1ha2Ugc3VyZSBkbWFfYnVmX21hcF9hdHRhY2htZW50KCkgaXMg
Y2FsbGVkIHdpdGggdGhlIGRtYS1yZXN2IGxvY2tlZA0KDQp2NToNCi0gQ2FjaGUgdGhlIGRtYV9i
dWZfYXR0YWNobWVudCB3aGlsZSB0aGUgRE1BQlVGIGlzIGF0dGFjaGVkLg0KLSBVc2UgZG1hX2J1
Zl9iZWdpbi9lbmRfYWNjZXNzKCkgdG8gZW5zdXJlIHRoYXQgdGhlIERNQUJVRiBkYXRhIHdpbGwg
YmUNCiAgY29oZXJlbnQgdG8gdGhlIGhhcmR3YXJlLg0KLSBSZW1vdmUgY29tbWVudCBhYm91dCBj
YWNoZS1tYW5hZ2VtZW50IGFuZCBkbWFfYnVmX3VubWFwX2F0dGFjaG1lbnQoKSwNCiAgc2luY2Ug
d2Ugbm93IHVzZSBkbWFfYnVmX2JlZ2luL2VuZF9hY2Nlc3MoKS4NCi0gQWRkZWQgQ2hyaXN0aWFu
J3MgQUNLDQotIFNlbGVjdCBETUFfU0hBUkVEX0JVRkZFUiBpbiBLY29uZmlnIGVudHJ5DQotLS0N
CiBkcml2ZXJzL3VzYi9nYWRnZXQvS2NvbmZpZyAgICAgICAgICB8ICAgMSArDQogZHJpdmVycy91
c2IvZ2FkZ2V0L2Z1bmN0aW9uL2ZfZnMuYyAgfCA0NTYgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKw0KIGluY2x1ZGUvdWFwaS9saW51eC91c2IvZnVuY3Rpb25mcy5oIHwgIDQxICsrKw0KIDMg
ZmlsZXMgY2hhbmdlZCwgNDk4IGluc2VydGlvbnMoKykNCg0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
dXNiL2dhZGdldC9LY29uZmlnIGIvZHJpdmVycy91c2IvZ2FkZ2V0L0tjb25maWcNCmluZGV4IGIz
NTkyYmNiMGY5Ni4uNTY2ZmYwYjEyODJhIDEwMDY0NA0KLS0tIGEvZHJpdmVycy91c2IvZ2FkZ2V0
L0tjb25maWcNCisrKyBiL2RyaXZlcnMvdXNiL2dhZGdldC9LY29uZmlnDQpAQCAtMTkwLDYgKzE5
MCw3IEBAIGNvbmZpZyBVU0JfRl9NQVNTX1NUT1JBR0UNCiAJdHJpc3RhdGUNCiANCiBjb25maWcg
VVNCX0ZfRlMNCisJc2VsZWN0IERNQV9TSEFSRURfQlVGRkVSDQogCXRyaXN0YXRlDQogDQogY29u
ZmlnIFVTQl9GX1VBQzENCmRpZmYgLS1naXQgYS9kcml2ZXJzL3VzYi9nYWRnZXQvZnVuY3Rpb24v
Zl9mcy5jIGIvZHJpdmVycy91c2IvZ2FkZ2V0L2Z1bmN0aW9uL2ZfZnMuYw0KaW5kZXggZWQyYTZk
NWZjZWY3Li44MmNjNDQ5YTRkN2UgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL3VzYi9nYWRnZXQvZnVu
Y3Rpb24vZl9mcy5jDQorKysgYi9kcml2ZXJzL3VzYi9nYWRnZXQvZnVuY3Rpb24vZl9mcy5jDQpA
QCAtMTUsNiArMTUsOSBAQA0KIC8qICNkZWZpbmUgVkVSQk9TRV9ERUJVRyAqLw0KIA0KICNpbmNs
dWRlIDxsaW51eC9ibGtkZXYuaD4NCisjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPg0KKyNpbmNs
dWRlIDxsaW51eC9kbWEtZmVuY2UuaD4NCisjaW5jbHVkZSA8bGludXgvZG1hLXJlc3YuaD4NCiAj
aW5jbHVkZSA8bGludXgvcGFnZW1hcC5oPg0KICNpbmNsdWRlIDxsaW51eC9leHBvcnQuaD4NCiAj
aW5jbHVkZSA8bGludXgvZnNfcGFyc2VyLmg+DQpAQCAtNDMsNiArNDYsOCBAQA0KIA0KICNkZWZp
bmUgRlVOQ1RJT05GU19NQUdJQwkweGE2NDczNjEgLyogQ2hvc2VuIGJ5IGEgaG9uZXN0IGRpY2Ug
cm9sbCA7KSAqLw0KIA0KK01PRFVMRV9JTVBPUlRfTlMoRE1BX0JVRik7DQorDQogLyogUmVmZXJl
bmNlIGNvdW50ZXIgaGFuZGxpbmcgKi8NCiBzdGF0aWMgdm9pZCBmZnNfZGF0YV9nZXQoc3RydWN0
IGZmc19kYXRhICpmZnMpOw0KIHN0YXRpYyB2b2lkIGZmc19kYXRhX3B1dChzdHJ1Y3QgZmZzX2Rh
dGEgKmZmcyk7DQpAQCAtMTI0LDYgKzEyOSwyMyBAQCBzdHJ1Y3QgZmZzX2VwIHsNCiAJdTgJCQkJ
bnVtOw0KIH07DQogDQorc3RydWN0IGZmc19kbWFidWZfcHJpdiB7DQorCXN0cnVjdCBsaXN0X2hl
YWQgZW50cnk7DQorCXN0cnVjdCBrcmVmIHJlZjsNCisJc3RydWN0IGZmc19kYXRhICpmZnM7DQor
CXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsNCisJc3RydWN0IHNnX3RhYmxlICpz
Z3Q7DQorCWVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcjsNCisJc3BpbmxvY2tfdCBsb2NrOw0K
Kwl1NjQgY29udGV4dDsNCit9Ow0KKw0KK3N0cnVjdCBmZnNfZG1hX2ZlbmNlIHsNCisJc3RydWN0
IGRtYV9mZW5jZSBiYXNlOw0KKwlzdHJ1Y3QgZmZzX2RtYWJ1Zl9wcml2ICpwcml2Ow0KKwlzdHJ1
Y3Qgd29ya19zdHJ1Y3Qgd29yazsNCit9Ow0KKw0KIHN0cnVjdCBmZnNfZXBmaWxlIHsNCiAJLyog
UHJvdGVjdHMgZXAtPmVwIGFuZCBlcC0+cmVxLiAqLw0KIAlzdHJ1Y3QgbXV0ZXgJCQltdXRleDsN
CkBAIC0xOTcsNiArMjE5LDExIEBAIHN0cnVjdCBmZnNfZXBmaWxlIHsNCiAJdW5zaWduZWQgY2hh
cgkJCWlzb2M7CS8qIFA6IGZmcy0+ZXBzX2xvY2sgKi8NCiANCiAJdW5zaWduZWQgY2hhcgkJCV9w
YWQ7DQorDQorCS8qIFByb3RlY3RzIGRtYWJ1ZnMgKi8NCisJc3RydWN0IG11dGV4CQkJZG1hYnVm
c19tdXRleDsNCisJc3RydWN0IGxpc3RfaGVhZAkJZG1hYnVmczsgLyogUDogZG1hYnVmc19tdXRl
eCAqLw0KKwlhdG9taWNfdAkJCXNlcW5vOw0KIH07DQogDQogc3RydWN0IGZmc19idWZmZXIgew0K
QEAgLTEyNzEsMTAgKzEyOTgsNTEgQEAgc3RhdGljIHNzaXplX3QgZmZzX2VwZmlsZV9yZWFkX2l0
ZXIoc3RydWN0IGtpb2NiICpraW9jYiwgc3RydWN0IGlvdl9pdGVyICp0bykNCiAJcmV0dXJuIHJl
czsNCiB9DQogDQorc3RhdGljIHZvaWQgZmZzX2RtYWJ1Zl9yZWxlYXNlKHN0cnVjdCBrcmVmICpy
ZWYpDQorew0KKwlzdHJ1Y3QgZmZzX2RtYWJ1Zl9wcml2ICpwcml2ID0gY29udGFpbmVyX29mKHJl
Ziwgc3RydWN0IGZmc19kbWFidWZfcHJpdiwgcmVmKTsNCisJc3RydWN0IGRtYV9idWZfYXR0YWNo
bWVudCAqYXR0YWNoID0gcHJpdi0+YXR0YWNoOw0KKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmID0g
YXR0YWNoLT5kbWFidWY7DQorDQorCXByX2RlYnVnKCJGRlMgRE1BQlVGIHJlbGVhc2VcbiIpOw0K
KwlkbWFfcmVzdl9sb2NrKGRtYWJ1Zi0+cmVzdiwgTlVMTCk7DQorCWRtYV9idWZfdW5tYXBfYXR0
YWNobWVudChhdHRhY2gsIHByaXYtPnNndCwgcHJpdi0+ZGlyKTsNCisJZG1hX3Jlc3ZfdW5sb2Nr
KGRtYWJ1Zi0+cmVzdik7DQorDQorCWRtYV9idWZfZGV0YWNoKGF0dGFjaC0+ZG1hYnVmLCBhdHRh
Y2gpOw0KKwlkbWFfYnVmX3B1dChkbWFidWYpOw0KKwlrZnJlZShwcml2KTsNCit9DQorDQorc3Rh
dGljIHZvaWQgZmZzX2RtYWJ1Zl9nZXQoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNo
KQ0KK3sNCisJc3RydWN0IGZmc19kbWFidWZfcHJpdiAqcHJpdiA9IGF0dGFjaC0+aW1wb3J0ZXJf
cHJpdjsNCisNCisJa3JlZl9nZXQoJnByaXYtPnJlZik7DQorfQ0KKw0KK3N0YXRpYyB2b2lkIGZm
c19kbWFidWZfcHV0KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCkNCit7DQorCXN0
cnVjdCBmZnNfZG1hYnVmX3ByaXYgKnByaXYgPSBhdHRhY2gtPmltcG9ydGVyX3ByaXY7DQorDQor
CWtyZWZfcHV0KCZwcml2LT5yZWYsIGZmc19kbWFidWZfcmVsZWFzZSk7DQorfQ0KKw0KIHN0YXRp
YyBpbnQNCiBmZnNfZXBmaWxlX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZp
bGUgKmZpbGUpDQogew0KIAlzdHJ1Y3QgZmZzX2VwZmlsZSAqZXBmaWxlID0gaW5vZGUtPmlfcHJp
dmF0ZTsNCisJc3RydWN0IGZmc19kbWFidWZfcHJpdiAqcHJpdiwgKnRtcDsNCisNCisJbXV0ZXhf
bG9jaygmZXBmaWxlLT5kbWFidWZzX211dGV4KTsNCisNCisJLyogQ2xvc2UgYWxsIGF0dGFjaGVk
IERNQUJVRnMgKi8NCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHByaXYsIHRtcCwgJmVwZmls
ZS0+ZG1hYnVmcywgZW50cnkpIHsNCisJCWxpc3RfZGVsKCZwcml2LT5lbnRyeSk7DQorCQlmZnNf
ZG1hYnVmX3B1dChwcml2LT5hdHRhY2gpOw0KKwl9DQorDQorCW11dGV4X3VubG9jaygmZXBmaWxl
LT5kbWFidWZzX211dGV4KTsNCiANCiAJX19mZnNfZXBmaWxlX3JlYWRfYnVmZmVyX2ZyZWUoZXBm
aWxlKTsNCiAJZmZzX2RhdGFfY2xvc2VkKGVwZmlsZS0+ZmZzKTsNCkBAIC0xMjgyLDYgKzEzNTAs
MzU0IEBAIGZmc19lcGZpbGVfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmls
ZSAqZmlsZSkNCiAJcmV0dXJuIDA7DQogfQ0KIA0KK3N0YXRpYyB2b2lkIGZmc19kbWFidWZfdW5t
YXBfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQorew0KKwlzdHJ1Y3QgZmZzX2RtYV9m
ZW5jZSAqZG1hX2ZlbmNlID0NCisJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZmZzX2RtYV9m
ZW5jZSwgd29yayk7DQorCXN0cnVjdCBmZnNfZG1hYnVmX3ByaXYgKnByaXYgPSBkbWFfZmVuY2Ut
PnByaXY7DQorCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCA9IHByaXYtPmF0dGFj
aDsNCisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSAmZG1hX2ZlbmNlLT5iYXNlOw0KKw0KKwlm
ZnNfZG1hYnVmX3B1dChhdHRhY2gpOw0KKwlkbWFfZmVuY2VfcHV0KGZlbmNlKTsNCit9DQorDQor
c3RhdGljIHZvaWQgZmZzX2RtYWJ1Zl9zaWduYWxfZG9uZShzdHJ1Y3QgZmZzX2RtYV9mZW5jZSAq
ZG1hX2ZlbmNlLCBpbnQgcmV0KQ0KK3sNCisJc3RydWN0IGZmc19kbWFidWZfcHJpdiAqcHJpdiA9
IGRtYV9mZW5jZS0+cHJpdjsNCisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSAmZG1hX2ZlbmNl
LT5iYXNlOw0KKwlib29sIGNvb2tpZSA9IGRtYV9mZW5jZV9iZWdpbl9zaWduYWxsaW5nKCk7DQor
DQorCWRtYV9mZW5jZV9nZXQoZmVuY2UpOw0KKwlkbWFfYnVmX2VuZF9hY2Nlc3MocHJpdi0+YXR0
YWNoLCBwcml2LT5zZ3QsIHByaXYtPmRpcik7DQorDQorCWZlbmNlLT5lcnJvciA9IHJldDsNCisJ
ZG1hX2ZlbmNlX3NpZ25hbChmZW5jZSk7DQorCWRtYV9mZW5jZV9lbmRfc2lnbmFsbGluZyhjb29r
aWUpOw0KKw0KKwkvKg0KKwkgKiBUaGUgZmVuY2Ugd2lsbCBiZSB1bnJlZidkIGluIGZmc19kbWFi
dWZfdW5tYXBfd29yay4NCisJICogSXQgY2FuJ3QgYmUgZG9uZSBoZXJlLCBhcyB0aGUgdW5yZWYg
ZnVuY3Rpb25zIG1pZ2h0IHRyeSB0byBsb2NrDQorCSAqIHRoZSByZXN2IG9iamVjdCwgd2hpY2gg
d291bGQgZGVhZGxvY2suDQorCSAqLw0KKwlJTklUX1dPUksoJmRtYV9mZW5jZS0+d29yaywgZmZz
X2RtYWJ1Zl91bm1hcF93b3JrKTsNCisJcXVldWVfd29yayhwcml2LT5mZnMtPmlvX2NvbXBsZXRp
b25fd3EsICZkbWFfZmVuY2UtPndvcmspOw0KK30NCisNCitzdGF0aWMgdm9pZCBmZnNfZXBmaWxl
X2RtYWJ1Zl9pb19jb21wbGV0ZShzdHJ1Y3QgdXNiX2VwICplcCwNCisJCQkJCSAgc3RydWN0IHVz
Yl9yZXF1ZXN0ICpyZXEpDQorew0KKwlwcl9kZWJ1ZygiRkZTOiBETUFCVUYgdHJhbnNmZXIgY29t
cGxldGUsIHN0YXR1cz0lZFxuIiwgcmVxLT5zdGF0dXMpOw0KKwlmZnNfZG1hYnVmX3NpZ25hbF9k
b25lKHJlcS0+Y29udGV4dCwgcmVxLT5zdGF0dXMpOw0KKwl1c2JfZXBfZnJlZV9yZXF1ZXN0KGVw
LCByZXEpOw0KK30NCisNCitzdGF0aWMgY29uc3QgY2hhciAqZmZzX2RtYWJ1Zl9nZXRfZHJpdmVy
X25hbWUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpDQorew0KKwlyZXR1cm4gImZ1bmN0aW9uZnMi
Ow0KK30NCisNCitzdGF0aWMgY29uc3QgY2hhciAqZmZzX2RtYWJ1Zl9nZXRfdGltZWxpbmVfbmFt
ZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkNCit7DQorCXJldHVybiAiIjsNCit9DQorDQorc3Rh
dGljIHZvaWQgZmZzX2RtYWJ1Zl9mZW5jZV9yZWxlYXNlKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQ0KK3sNCisJc3RydWN0IGZmc19kbWFfZmVuY2UgKmRtYV9mZW5jZSA9DQorCQljb250YWluZXJf
b2YoZmVuY2UsIHN0cnVjdCBmZnNfZG1hX2ZlbmNlLCBiYXNlKTsNCisNCisJa2ZyZWUoZG1hX2Zl
bmNlKTsNCit9DQorDQorc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIGZmc19kbWFi
dWZfZmVuY2Vfb3BzID0gew0KKwkuZ2V0X2RyaXZlcl9uYW1lCT0gZmZzX2RtYWJ1Zl9nZXRfZHJp
dmVyX25hbWUsDQorCS5nZXRfdGltZWxpbmVfbmFtZQk9IGZmc19kbWFidWZfZ2V0X3RpbWVsaW5l
X25hbWUsDQorCS5yZWxlYXNlCQk9IGZmc19kbWFidWZfZmVuY2VfcmVsZWFzZSwNCit9Ow0KKw0K
K3N0YXRpYyBpbnQgZmZzX2RtYV9yZXN2X2xvY2soc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwgYm9v
bCBub25ibG9jaykNCit7DQorCWlmICghbm9uYmxvY2spDQorCQlyZXR1cm4gZG1hX3Jlc3ZfbG9j
a19pbnRlcnJ1cHRpYmxlKGRtYWJ1Zi0+cmVzdiwgTlVMTCk7DQorDQorCWlmICghZG1hX3Jlc3Zf
dHJ5bG9jayhkbWFidWYtPnJlc3YpKQ0KKwkJcmV0dXJuIC1FQlVTWTsNCisNCisJcmV0dXJuIDA7
DQorfQ0KKw0KK3N0YXRpYyBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICoNCitmZnNfZG1hYnVm
X2ZpbmRfYXR0YWNobWVudChzdHJ1Y3QgZmZzX2VwZmlsZSAqZXBmaWxlLCBzdHJ1Y3QgZG1hX2J1
ZiAqZG1hYnVmKQ0KK3sNCisJc3RydWN0IGRldmljZSAqZGV2ID0gZXBmaWxlLT5mZnMtPmdhZGdl
dC0+ZGV2LnBhcmVudDsNCisJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoID0gTlVM
TDsNCisJc3RydWN0IGZmc19kbWFidWZfcHJpdiAqcHJpdjsNCisNCisJbXV0ZXhfbG9jaygmZXBm
aWxlLT5kbWFidWZzX211dGV4KTsNCisNCisJbGlzdF9mb3JfZWFjaF9lbnRyeShwcml2LCAmZXBm
aWxlLT5kbWFidWZzLCBlbnRyeSkgew0KKwkJaWYgKHByaXYtPmF0dGFjaC0+ZGV2ID09IGRldg0K
KwkJICAgICYmIHByaXYtPmF0dGFjaC0+ZG1hYnVmID09IGRtYWJ1Zikgew0KKwkJCWF0dGFjaCA9
IHByaXYtPmF0dGFjaDsNCisJCQlicmVhazsNCisJCX0NCisJfQ0KKw0KKwlpZiAoYXR0YWNoKQ0K
KwkJZmZzX2RtYWJ1Zl9nZXQoYXR0YWNoKTsNCisNCisJbXV0ZXhfdW5sb2NrKCZlcGZpbGUtPmRt
YWJ1ZnNfbXV0ZXgpOw0KKw0KKwlyZXR1cm4gYXR0YWNoID86IEVSUl9QVFIoLUVQRVJNKTsNCit9
DQorDQorc3RhdGljIGludCBmZnNfZG1hYnVmX2F0dGFjaChzdHJ1Y3QgZmlsZSAqZmlsZSwgaW50
IGZkKQ0KK3sNCisJYm9vbCBub25ibG9jayA9IGZpbGUtPmZfZmxhZ3MgJiBPX05PTkJMT0NLOw0K
KwlzdHJ1Y3QgZmZzX2VwZmlsZSAqZXBmaWxlID0gZmlsZS0+cHJpdmF0ZV9kYXRhOw0KKwlzdHJ1
Y3QgdXNiX2dhZGdldCAqZ2FkZ2V0ID0gZXBmaWxlLT5mZnMtPmdhZGdldDsNCisJc3RydWN0IGRt
YV9idWZfYXR0YWNobWVudCAqYXR0YWNoOw0KKwlzdHJ1Y3QgZmZzX2RtYWJ1Zl9wcml2ICpwcml2
Ow0KKwllbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXI7DQorCXN0cnVjdCBzZ190YWJsZSAqc2df
dGFibGU7DQorCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7DQorCWludCBlcnI7DQorDQorCWlmICgh
Z2FkZ2V0IHx8ICFnYWRnZXQtPnNnX3N1cHBvcnRlZCkNCisJCXJldHVybiAtRVBFUk07DQorDQor
CWRtYWJ1ZiA9IGRtYV9idWZfZ2V0KGZkKTsNCisJaWYgKElTX0VSUihkbWFidWYpKQ0KKwkJcmV0
dXJuIFBUUl9FUlIoZG1hYnVmKTsNCisNCisJYXR0YWNoID0gZG1hX2J1Zl9hdHRhY2goZG1hYnVm
LCBnYWRnZXQtPmRldi5wYXJlbnQpOw0KKwlpZiAoSVNfRVJSKGF0dGFjaCkpIHsNCisJCWVyciA9
IFBUUl9FUlIoYXR0YWNoKTsNCisJCWdvdG8gZXJyX2RtYWJ1Zl9wdXQ7DQorCX0NCisNCisJcHJp
diA9IGt6YWxsb2Moc2l6ZW9mKCpwcml2KSwgR0ZQX0tFUk5FTCk7DQorCWlmICghcHJpdikgew0K
KwkJZXJyID0gLUVOT01FTTsNCisJCWdvdG8gZXJyX2RtYWJ1Zl9kZXRhY2g7DQorCX0NCisNCisJ
ZGlyID0gZXBmaWxlLT5pbiA/IERNQV9GUk9NX0RFVklDRSA6IERNQV9UT19ERVZJQ0U7DQorDQor
CWVyciA9IGZmc19kbWFfcmVzdl9sb2NrKGRtYWJ1Ziwgbm9uYmxvY2spOw0KKwlpZiAoZXJyKQ0K
KwkJZ290byBlcnJfZnJlZV9wcml2Ow0KKw0KKwlzZ190YWJsZSA9IGRtYV9idWZfbWFwX2F0dGFj
aG1lbnQoYXR0YWNoLCBkaXIpOw0KKwlkbWFfcmVzdl91bmxvY2soZG1hYnVmLT5yZXN2KTsNCisN
CisJaWYgKElTX0VSUihzZ190YWJsZSkpIHsNCisJCWVyciA9IFBUUl9FUlIoc2dfdGFibGUpOw0K
KwkJZ290byBlcnJfZnJlZV9wcml2Ow0KKwl9DQorDQorCWF0dGFjaC0+aW1wb3J0ZXJfcHJpdiA9
IHByaXY7DQorDQorCXByaXYtPnNndCA9IHNnX3RhYmxlOw0KKwlwcml2LT5kaXIgPSBkaXI7DQor
CXByaXYtPmZmcyA9IGVwZmlsZS0+ZmZzOw0KKwlwcml2LT5hdHRhY2ggPSBhdHRhY2g7DQorCXNw
aW5fbG9ja19pbml0KCZwcml2LT5sb2NrKTsNCisJa3JlZl9pbml0KCZwcml2LT5yZWYpOw0KKwlw
cml2LT5jb250ZXh0ID0gZG1hX2ZlbmNlX2NvbnRleHRfYWxsb2MoMSk7DQorDQorCW11dGV4X2xv
Y2soJmVwZmlsZS0+ZG1hYnVmc19tdXRleCk7DQorCWxpc3RfYWRkKCZwcml2LT5lbnRyeSwgJmVw
ZmlsZS0+ZG1hYnVmcyk7DQorCW11dGV4X3VubG9jaygmZXBmaWxlLT5kbWFidWZzX211dGV4KTsN
CisNCisJcmV0dXJuIDA7DQorDQorZXJyX2ZyZWVfcHJpdjoNCisJa2ZyZWUocHJpdik7DQorZXJy
X2RtYWJ1Zl9kZXRhY2g6DQorCWRtYV9idWZfZGV0YWNoKGRtYWJ1ZiwgYXR0YWNoKTsNCitlcnJf
ZG1hYnVmX3B1dDoNCisJZG1hX2J1Zl9wdXQoZG1hYnVmKTsNCisNCisJcmV0dXJuIGVycjsNCit9
DQorDQorc3RhdGljIGludCBmZnNfZG1hYnVmX2RldGFjaChzdHJ1Y3QgZmlsZSAqZmlsZSwgaW50
IGZkKQ0KK3sNCisJc3RydWN0IGZmc19lcGZpbGUgKmVwZmlsZSA9IGZpbGUtPnByaXZhdGVfZGF0
YTsNCisJc3RydWN0IGRldmljZSAqZGV2ID0gZXBmaWxlLT5mZnMtPmdhZGdldC0+ZGV2LnBhcmVu
dDsNCisJc3RydWN0IGZmc19kbWFidWZfcHJpdiAqcHJpdjsNCisJc3RydWN0IGRtYV9idWYgKmRt
YWJ1ZjsNCisJaW50IHJldCA9IC1FUEVSTTsNCisNCisJZG1hYnVmID0gZG1hX2J1Zl9nZXQoZmQp
Ow0KKwlpZiAoSVNfRVJSKGRtYWJ1ZikpDQorCQlyZXR1cm4gUFRSX0VSUihkbWFidWYpOw0KKw0K
KwltdXRleF9sb2NrKCZlcGZpbGUtPmRtYWJ1ZnNfbXV0ZXgpOw0KKw0KKwlsaXN0X2Zvcl9lYWNo
X2VudHJ5KHByaXYsICZlcGZpbGUtPmRtYWJ1ZnMsIGVudHJ5KSB7DQorCQlpZiAocHJpdi0+YXR0
YWNoLT5kZXYgPT0gZGV2DQorCQkgICAgJiYgcHJpdi0+YXR0YWNoLT5kbWFidWYgPT0gZG1hYnVm
KSB7DQorCQkJbGlzdF9kZWwoJnByaXYtPmVudHJ5KTsNCisNCisJCQkvKiBVbnJlZiB0aGUgcmVm
ZXJlbmNlIGZyb20gZmZzX2RtYWJ1Zl9hdHRhY2goKSAqLw0KKwkJCWZmc19kbWFidWZfcHV0KHBy
aXYtPmF0dGFjaCk7DQorCQkJcmV0ID0gMDsNCisJCQlicmVhazsNCisJCX0NCisJfQ0KKw0KKwlt
dXRleF91bmxvY2soJmVwZmlsZS0+ZG1hYnVmc19tdXRleCk7DQorCWRtYV9idWZfcHV0KGRtYWJ1
Zik7DQorDQorCXJldHVybiByZXQ7DQorfQ0KKw0KK3N0YXRpYyBpbnQgZmZzX2RtYWJ1Zl90cmFu
c2ZlcihzdHJ1Y3QgZmlsZSAqZmlsZSwNCisJCQkgICAgICAgY29uc3Qgc3RydWN0IHVzYl9mZnNf
ZG1hYnVmX3RyYW5zZmVyX3JlcSAqcmVxKQ0KK3sNCisJYm9vbCBub25ibG9jayA9IGZpbGUtPmZf
ZmxhZ3MgJiBPX05PTkJMT0NLOw0KKwlzdHJ1Y3QgZmZzX2VwZmlsZSAqZXBmaWxlID0gZmlsZS0+
cHJpdmF0ZV9kYXRhOw0KKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7DQorCXN0
cnVjdCBmZnNfZG1hYnVmX3ByaXYgKnByaXY7DQorCXN0cnVjdCBmZnNfZG1hX2ZlbmNlICpmZW5j
ZTsNCisJc3RydWN0IHVzYl9yZXF1ZXN0ICp1c2JfcmVxOw0KKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1h
YnVmOw0KKwlzdHJ1Y3QgZmZzX2VwICplcDsNCisJYm9vbCBjb29raWU7DQorCXUzMiBzZXFubzsN
CisJaW50IHJldDsNCisNCisJaWYgKHJlcS0+ZmxhZ3MgJiB+VVNCX0ZGU19ETUFCVUZfVFJBTlNG
RVJfTUFTSykNCisJCXJldHVybiAtRUlOVkFMOw0KKw0KKwlkbWFidWYgPSBkbWFfYnVmX2dldChy
ZXEtPmZkKTsNCisJaWYgKElTX0VSUihkbWFidWYpKQ0KKwkJcmV0dXJuIFBUUl9FUlIoZG1hYnVm
KTsNCisNCisJaWYgKHJlcS0+bGVuZ3RoID4gZG1hYnVmLT5zaXplIHx8IHJlcS0+bGVuZ3RoID09
IDApIHsNCisJCXJldCA9IC1FSU5WQUw7DQorCQlnb3RvIGVycl9kbWFidWZfcHV0Ow0KKwl9DQor
DQorCWF0dGFjaCA9IGZmc19kbWFidWZfZmluZF9hdHRhY2htZW50KGVwZmlsZSwgZG1hYnVmKTsN
CisJaWYgKElTX0VSUihhdHRhY2gpKSB7DQorCQlyZXQgPSBQVFJfRVJSKGF0dGFjaCk7DQorCQln
b3RvIGVycl9kbWFidWZfcHV0Ow0KKwl9DQorDQorCXByaXYgPSBhdHRhY2gtPmltcG9ydGVyX3By
aXY7DQorDQorCWVwID0gZmZzX2VwZmlsZV93YWl0X2VwKGZpbGUpOw0KKwlpZiAoSVNfRVJSKGVw
KSkgew0KKwkJcmV0ID0gUFRSX0VSUihlcCk7DQorCQlnb3RvIGVycl9hdHRhY2htZW50X3B1dDsN
CisJfQ0KKw0KKwlyZXQgPSBkbWFfYnVmX2JlZ2luX2FjY2VzcyhhdHRhY2gsIHByaXYtPnNndCwg
cHJpdi0+ZGlyKTsNCisJaWYgKHJldCkNCisJCWdvdG8gZXJyX2F0dGFjaG1lbnRfcHV0Ow0KKw0K
KwlyZXQgPSBmZnNfZG1hX3Jlc3ZfbG9jayhkbWFidWYsIG5vbmJsb2NrKTsNCisJaWYgKHJldCkN
CisJCWdvdG8gZXJyX2VuZF9hY2Nlc3M7DQorDQorCS8qIE1ha2Ugc3VyZSB3ZSBkb24ndCBoYXZl
IHdyaXRlcnMgKi8NCisJaWYgKCFkbWFfcmVzdl90ZXN0X3NpZ25hbGVkKGRtYWJ1Zi0+cmVzdiwg
RE1BX1JFU1ZfVVNBR0VfV1JJVEUpKSB7DQorCQlwcl9kZWJ1ZygiRkZTIFdSSVRFIGZlbmNlIGlz
IG5vdCBzaWduYWxlZFxuIik7DQorCQlyZXQgPSAtRUJVU1k7DQorCQlnb3RvIGVycl9yZXN2X3Vu
bG9jazsNCisJfQ0KKw0KKwkvKiBJZiB3ZSdyZSB3cml0aW5nIHRvIHRoZSBETUFCVUYsIG1ha2Ug
c3VyZSB3ZSBkb24ndCBoYXZlIHJlYWRlcnMgKi8NCisJaWYgKGVwZmlsZS0+aW4gJiYNCisJICAg
ICFkbWFfcmVzdl90ZXN0X3NpZ25hbGVkKGRtYWJ1Zi0+cmVzdiwgRE1BX1JFU1ZfVVNBR0VfUkVB
RCkpIHsNCisJCXByX2RlYnVnKCJGRlMgUkVBRCBmZW5jZSBpcyBub3Qgc2lnbmFsZWRcbiIpOw0K
KwkJcmV0ID0gLUVCVVNZOw0KKwkJZ290byBlcnJfcmVzdl91bmxvY2s7DQorCX0NCisNCisJcmV0
ID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9mZW5jZXMoZG1hYnVmLT5yZXN2LCAxKTsNCisJaWYgKHJldCkN
CisJCWdvdG8gZXJyX3Jlc3ZfdW5sb2NrOw0KKw0KKwlmZW5jZSA9IGttYWxsb2Moc2l6ZW9mKCpm
ZW5jZSksIEdGUF9LRVJORUwpOw0KKwlpZiAoIWZlbmNlKSB7DQorCQlyZXQgPSAtRU5PTUVNOw0K
KwkJZ290byBlcnJfcmVzdl91bmxvY2s7DQorCX0NCisNCisJZmVuY2UtPnByaXYgPSBwcml2Ow0K
Kw0KKwlzcGluX2xvY2tfaXJxKCZlcGZpbGUtPmZmcy0+ZXBzX2xvY2spOw0KKw0KKwkvKiBJbiB0
aGUgbWVhbnRpbWUsIGVuZHBvaW50IGdvdCBkaXNhYmxlZCBvciBjaGFuZ2VkLiAqLw0KKwlpZiAo
ZXBmaWxlLT5lcCAhPSBlcCkgew0KKwkJcmV0ID0gLUVTSFVURE9XTjsNCisJCWdvdG8gZXJyX2Zl
bmNlX3B1dDsNCisJfQ0KKw0KKwl1c2JfcmVxID0gdXNiX2VwX2FsbG9jX3JlcXVlc3QoZXAtPmVw
LCBHRlBfQVRPTUlDKTsNCisJaWYgKCF1c2JfcmVxKSB7DQorCQlyZXQgPSAtRU5PTUVNOw0KKwkJ
Z290byBlcnJfZmVuY2VfcHV0Ow0KKwl9DQorDQorCS8qDQorCSAqIHVzYl9lcF9xdWV1ZSgpIGd1
YXJhbnRlZXMgdGhhdCBhbGwgdHJhbnNmZXJzIGFyZSBwcm9jZXNzZWQgaW4gdGhlDQorCSAqIG9y
ZGVyIHRoZXkgYXJlIGVucXVldWVkLCBzbyB3ZSBjYW4gdXNlIGEgc2ltcGxlIGluY3JlbWVudGlu
Zw0KKwkgKiBzZXF1ZW5jZSBudW1iZXIgZm9yIHRoZSBkbWFfZmVuY2UuDQorCSAqLw0KKwlzZXFu
byA9IGF0b21pY19hZGRfcmV0dXJuKDEsICZlcGZpbGUtPnNlcW5vKTsNCisNCisJZG1hX2ZlbmNl
X2luaXQoJmZlbmNlLT5iYXNlLCAmZmZzX2RtYWJ1Zl9mZW5jZV9vcHMsDQorCQkgICAgICAgJnBy
aXYtPmxvY2ssIHByaXYtPmNvbnRleHQsIHNlcW5vKTsNCisNCisJZG1hX3Jlc3ZfYWRkX2ZlbmNl
KGRtYWJ1Zi0+cmVzdiwgJmZlbmNlLT5iYXNlLA0KKwkJCSAgIGRtYV9yZXN2X3VzYWdlX3J3KGVw
ZmlsZS0+aW4pKTsNCisJZG1hX3Jlc3ZfdW5sb2NrKGRtYWJ1Zi0+cmVzdik7DQorDQorCS8qIE5v
dyB0aGF0IHRoZSBkbWFfZmVuY2UgaXMgaW4gcGxhY2UsIHF1ZXVlIHRoZSB0cmFuc2Zlci4gKi8N
CisNCisJdXNiX3JlcS0+bGVuZ3RoID0gcmVxLT5sZW5ndGg7DQorCXVzYl9yZXEtPmJ1ZiA9IE5V
TEw7DQorCXVzYl9yZXEtPnNnID0gcHJpdi0+c2d0LT5zZ2w7DQorCXVzYl9yZXEtPm51bV9zZ3Mg
PSBzZ19uZW50c19mb3JfbGVuKHByaXYtPnNndC0+c2dsLCByZXEtPmxlbmd0aCk7DQorCXVzYl9y
ZXEtPnNnX3dhc19tYXBwZWQgPSB0cnVlOw0KKwl1c2JfcmVxLT5jb250ZXh0ICA9IGZlbmNlOw0K
Kwl1c2JfcmVxLT5jb21wbGV0ZSA9IGZmc19lcGZpbGVfZG1hYnVmX2lvX2NvbXBsZXRlOw0KKw0K
Kwljb29raWUgPSBkbWFfZmVuY2VfYmVnaW5fc2lnbmFsbGluZygpOw0KKwlyZXQgPSB1c2JfZXBf
cXVldWUoZXAtPmVwLCB1c2JfcmVxLCBHRlBfQVRPTUlDKTsNCisJZG1hX2ZlbmNlX2VuZF9zaWdu
YWxsaW5nKGNvb2tpZSk7DQorCWlmIChyZXQpIHsNCisJCXByX3dhcm4oIkZGUzogRmFpbGVkIHRv
IHF1ZXVlIERNQUJVRjogJWRcbiIsIHJldCk7DQorCQlmZnNfZG1hYnVmX3NpZ25hbF9kb25lKGZl
bmNlLCByZXQpOw0KKwkJdXNiX2VwX2ZyZWVfcmVxdWVzdChlcC0+ZXAsIHVzYl9yZXEpOw0KKwl9
DQorDQorCXNwaW5fdW5sb2NrX2lycSgmZXBmaWxlLT5mZnMtPmVwc19sb2NrKTsNCisJZG1hX2J1
Zl9wdXQoZG1hYnVmKTsNCisNCisJcmV0dXJuIHJldDsNCisNCitlcnJfZmVuY2VfcHV0Og0KKwlz
cGluX3VubG9ja19pcnEoJmVwZmlsZS0+ZmZzLT5lcHNfbG9jayk7DQorCWRtYV9mZW5jZV9wdXQo
JmZlbmNlLT5iYXNlKTsNCitlcnJfcmVzdl91bmxvY2s6DQorCWRtYV9yZXN2X3VubG9jayhkbWFi
dWYtPnJlc3YpOw0KK2Vycl9lbmRfYWNjZXNzOg0KKwlkbWFfYnVmX2VuZF9hY2Nlc3MoYXR0YWNo
LCBwcml2LT5zZ3QsIHByaXYtPmRpcik7DQorZXJyX2F0dGFjaG1lbnRfcHV0Og0KKwlmZnNfZG1h
YnVmX3B1dChhdHRhY2gpOw0KK2Vycl9kbWFidWZfcHV0Og0KKwlkbWFfYnVmX3B1dChkbWFidWYp
Ow0KKw0KKwlyZXR1cm4gcmV0Ow0KK30NCisNCiBzdGF0aWMgbG9uZyBmZnNfZXBmaWxlX2lvY3Rs
KHN0cnVjdCBmaWxlICpmaWxlLCB1bnNpZ25lZCBjb2RlLA0KIAkJCSAgICAgdW5zaWduZWQgbG9u
ZyB2YWx1ZSkNCiB7DQpAQCAtMTI5Miw2ICsxNzA4LDQ0IEBAIHN0YXRpYyBsb25nIGZmc19lcGZp
bGVfaW9jdGwoc3RydWN0IGZpbGUgKmZpbGUsIHVuc2lnbmVkIGNvZGUsDQogCWlmIChXQVJOX09O
KGVwZmlsZS0+ZmZzLT5zdGF0ZSAhPSBGRlNfQUNUSVZFKSkNCiAJCXJldHVybiAtRU5PREVWOw0K
IA0KKwlzd2l0Y2ggKGNvZGUpIHsNCisJY2FzZSBGVU5DVElPTkZTX0RNQUJVRl9BVFRBQ0g6DQor
CXsNCisJCWludCBmZDsNCisNCisJCWlmIChjb3B5X2Zyb21fdXNlcigmZmQsICh2b2lkIF9fdXNl
ciAqKXZhbHVlLCBzaXplb2YoZmQpKSkgew0KKwkJCXJldCA9IC1FRkFVTFQ7DQorCQkJYnJlYWs7
DQorCQl9DQorDQorCQlyZXR1cm4gZmZzX2RtYWJ1Zl9hdHRhY2goZmlsZSwgZmQpOw0KKwl9DQor
CWNhc2UgRlVOQ1RJT05GU19ETUFCVUZfREVUQUNIOg0KKwl7DQorCQlpbnQgZmQ7DQorDQorCQlp
ZiAoY29weV9mcm9tX3VzZXIoJmZkLCAodm9pZCBfX3VzZXIgKil2YWx1ZSwgc2l6ZW9mKGZkKSkp
IHsNCisJCQlyZXQgPSAtRUZBVUxUOw0KKwkJCWJyZWFrOw0KKwkJfQ0KKw0KKwkJcmV0dXJuIGZm
c19kbWFidWZfZGV0YWNoKGZpbGUsIGZkKTsNCisJfQ0KKwljYXNlIEZVTkNUSU9ORlNfRE1BQlVG
X1RSQU5TRkVSOg0KKwl7DQorCQlzdHJ1Y3QgdXNiX2Zmc19kbWFidWZfdHJhbnNmZXJfcmVxIHJl
cTsNCisNCisJCWlmIChjb3B5X2Zyb21fdXNlcigmcmVxLCAodm9pZCBfX3VzZXIgKil2YWx1ZSwg
c2l6ZW9mKHJlcSkpKSB7DQorCQkJcmV0ID0gLUVGQVVMVDsNCisJCQlicmVhazsNCisJCX0NCisN
CisJCXJldHVybiBmZnNfZG1hYnVmX3RyYW5zZmVyKGZpbGUsICZyZXEpOw0KKwl9DQorCWRlZmF1
bHQ6DQorCQlicmVhazsNCisJfQ0KKw0KIAkvKiBXYWl0IGZvciBlbmRwb2ludCB0byBiZSBlbmFi
bGVkICovDQogCWVwID0gZmZzX2VwZmlsZV93YWl0X2VwKGZpbGUpOw0KIAlpZiAoSVNfRVJSKGVw
KSkNCkBAIC0xODY5LDYgKzIzMjMsOCBAQCBzdGF0aWMgaW50IGZmc19lcGZpbGVzX2NyZWF0ZShz
dHJ1Y3QgZmZzX2RhdGEgKmZmcykNCiAJZm9yIChpID0gMTsgaSA8PSBjb3VudDsgKytpLCArK2Vw
ZmlsZSkgew0KIAkJZXBmaWxlLT5mZnMgPSBmZnM7DQogCQltdXRleF9pbml0KCZlcGZpbGUtPm11
dGV4KTsNCisJCW11dGV4X2luaXQoJmVwZmlsZS0+ZG1hYnVmc19tdXRleCk7DQorCQlJTklUX0xJ
U1RfSEVBRCgmZXBmaWxlLT5kbWFidWZzKTsNCiAJCWlmIChmZnMtPnVzZXJfZmxhZ3MgJiBGVU5D
VElPTkZTX1ZJUlRVQUxfQUREUikNCiAJCQlzcHJpbnRmKGVwZmlsZS0+bmFtZSwgImVwJTAyeCIs
IGZmcy0+ZXBzX2FkZHJtYXBbaV0pOw0KIAkJZWxzZQ0KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFw
aS9saW51eC91c2IvZnVuY3Rpb25mcy5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L3VzYi9mdW5jdGlv
bmZzLmgNCmluZGV4IDA3ODA5OGU3M2ZkMy4uOWY4OGRlOWMzZDY2IDEwMDY0NA0KLS0tIGEvaW5j
bHVkZS91YXBpL2xpbnV4L3VzYi9mdW5jdGlvbmZzLmgNCisrKyBiL2luY2x1ZGUvdWFwaS9saW51
eC91c2IvZnVuY3Rpb25mcy5oDQpAQCAtODYsNiArODYsMjIgQEAgc3RydWN0IHVzYl9leHRfcHJv
cF9kZXNjIHsNCiAJX19sZTE2CXdQcm9wZXJ0eU5hbWVMZW5ndGg7DQogfSBfX2F0dHJpYnV0ZV9f
KChwYWNrZWQpKTsNCiANCisvKiBGbGFncyBmb3IgdXNiX2Zmc19kbWFidWZfdHJhbnNmZXJfcmVx
LT5mbGFncyAobm9uZSBmb3Igbm93KSAqLw0KKyNkZWZpbmUgVVNCX0ZGU19ETUFCVUZfVFJBTlNG
RVJfTUFTSwkweDANCisNCisvKioNCisgKiBzdHJ1Y3QgdXNiX2Zmc19kbWFidWZfdHJhbnNmZXJf
cmVxIC0gVHJhbnNmZXIgcmVxdWVzdCBmb3IgYSBETUFCVUYgb2JqZWN0DQorICogQGZkOgkJZmls
ZSBkZXNjcmlwdG9yIG9mIHRoZSBETUFCVUYgb2JqZWN0DQorICogQGZsYWdzOglvbmUgb3IgbW9y
ZSBVU0JfRkZTX0RNQUJVRl9UUkFOU0ZFUl8qIGZsYWdzDQorICogQGxlbmd0aDoJbnVtYmVyIG9m
IGJ5dGVzIHVzZWQgaW4gdGhpcyBETUFCVUYgZm9yIHRoZSBkYXRhIHRyYW5zZmVyLg0KKyAqCQlT
aG91bGQgZ2VuZXJhbGx5IGJlIHNldCB0byB0aGUgRE1BQlVGJ3Mgc2l6ZS4NCisgKi8NCitzdHJ1
Y3QgdXNiX2Zmc19kbWFidWZfdHJhbnNmZXJfcmVxIHsNCisJaW50IGZkOw0KKwlfX3UzMiBmbGFn
czsNCisJX191NjQgbGVuZ3RoOw0KK30gX19hdHRyaWJ1dGVfXygocGFja2VkKSk7DQorDQogI2lm
bmRlZiBfX0tFUk5FTF9fDQogDQogLyoNCkBAIC0yOTAsNiArMzA2LDMxIEBAIHN0cnVjdCB1c2Jf
ZnVuY3Rpb25mc19ldmVudCB7DQogI2RlZmluZQlGVU5DVElPTkZTX0VORFBPSU5UX0RFU0MJX0lP
UignZycsIDEzMCwgXA0KIAkJCQkJICAgICBzdHJ1Y3QgdXNiX2VuZHBvaW50X2Rlc2NyaXB0b3Ip
DQogDQorLyoNCisgKiBBdHRhY2ggdGhlIERNQUJVRiBvYmplY3QsIGlkZW50aWZpZWQgYnkgaXRz
IGZpbGUgZGVzY3JpcHRvciwgdG8gdGhlDQorICogZGF0YSBlbmRwb2ludC4gUmV0dXJucyB6ZXJv
IG9uIHN1Y2Nlc3MsIGFuZCBhIG5lZ2F0aXZlIGVycm5vIHZhbHVlDQorICogb24gZXJyb3IuDQor
ICovDQorI2RlZmluZSBGVU5DVElPTkZTX0RNQUJVRl9BVFRBQ0gJX0lPVygnZycsIDEzMSwgaW50
KQ0KKw0KIA0KKy8qDQorICogRGV0YWNoIHRoZSBnaXZlbiBETUFCVUYgb2JqZWN0LCBpZGVudGlm
aWVkIGJ5IGl0cyBmaWxlIGRlc2NyaXB0b3IsDQorICogZnJvbSB0aGUgZGF0YSBlbmRwb2ludC4g
UmV0dXJucyB6ZXJvIG9uIHN1Y2Nlc3MsIGFuZCBhIG5lZ2F0aXZlDQorICogZXJybm8gdmFsdWUg
b24gZXJyb3IuIE5vdGUgdGhhdCBjbG9zaW5nIHRoZSBlbmRwb2ludCdzIGZpbGUNCisgKiBkZXNj
cmlwdG9yIHdpbGwgYXV0b21hdGljYWxseSBkZXRhY2ggYWxsIGF0dGFjaGVkIERNQUJVRnMuDQor
ICovDQorI2RlZmluZSBGVU5DVElPTkZTX0RNQUJVRl9ERVRBQ0gJX0lPVygnZycsIDEzMiwgaW50
KQ0KKw0KKy8qDQorICogRW5xdWV1ZSB0aGUgcHJldmlvdXNseSBhdHRhY2hlZCBETUFCVUYgdG8g
dGhlIHRyYW5zZmVyIHF1ZXVlLg0KKyAqIFRoZSBhcmd1bWVudCBpcyBhIHN0cnVjdHVyZSB0aGF0
IHBhY2tzIHRoZSBETUFCVUYncyBmaWxlIGRlc2NyaXB0b3IsDQorICogdGhlIHNpemUgaW4gYnl0
ZXMgdG8gdHJhbnNmZXIgKHdoaWNoIHNob3VsZCBnZW5lcmFsbHkgY29ycmVzcG9uZCB0bw0KKyAq
IHRoZSBzaXplIG9mIHRoZSBETUFCVUYpLCBhbmQgYSAnZmxhZ3MnIGZpZWxkIHdoaWNoIGlzIHVu
dXNlZA0KKyAqIGZvciBub3cuIFJldHVybnMgemVybyBvbiBzdWNjZXNzLCBhbmQgYSBuZWdhdGl2
ZSBlcnJubyB2YWx1ZSBvbg0KKyAqIGVycm9yLg0KKyAqLw0KKyNkZWZpbmUgRlVOQ1RJT05GU19E
TUFCVUZfVFJBTlNGRVIJX0lPVygnZycsIDEzMywgXA0KKwkJCQkJICAgICBzdHJ1Y3QgdXNiX2Zm
c19kbWFidWZfdHJhbnNmZXJfcmVxKQ0KIA0KICNlbmRpZiAvKiBfVUFQSV9fTElOVVhfRlVOQ1RJ
T05GU19IX18gKi8NCi0tIA0KMi40My4wDQoNCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0IC0tIGxpbmFyby1t
bS1zaWdAbGlzdHMubGluYXJvLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVtYWlsIHRvIGxp
bmFyby1tbS1zaWctbGVhdmVAbGlzdHMubGluYXJvLm9yZwo=
