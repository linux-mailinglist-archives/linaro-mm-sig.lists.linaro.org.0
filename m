Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 626C845A58C
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 23 Nov 2021 15:23:24 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 644FA62FA8
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 23 Nov 2021 14:23:23 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id B938262C9A; Tue, 23 Nov 2021 14:22:51 +0000 (UTC)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 2B88E62FE7;
	Tue, 23 Nov 2021 14:22:43 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 9328560AB6
 for <linaro-mm-sig@lists.linaro.org>; Tue, 23 Nov 2021 14:21:51 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 48C1662A45; Tue, 23 Nov 2021 14:21:51 +0000 (UTC)
Received: from mail-wr1-f49.google.com (mail-wr1-f49.google.com
 [209.85.221.49])
 by lists.linaro.org (Postfix) with ESMTPS id AA00E620CA
 for <linaro-mm-sig@lists.linaro.org>; Tue, 23 Nov 2021 14:21:47 +0000 (UTC)
Received: by mail-wr1-f49.google.com with SMTP id u1so39233537wru.13
 for <linaro-mm-sig@lists.linaro.org>; Tue, 23 Nov 2021 06:21:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20210112;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=vWCwx9Su+VRnoL1JlAwGcp1087mputsOyY+fssc6IfU=;
 b=HuhTw0grcBHeINXCILZO2ql2nDB3Ux5faafaeqZ6CHfr855Jy8dpUDSukIOArXAAwL
 biEHyo8EU2NpTqXyFe1Ixdqem4RVCir6XEv0glqr79A5Njk9/wGcrPGLsvqPfr3Nre7h
 TxxXvx+k2KTCB5qsLNQNztiDWuZQRn2hZ+/Nerikq0TenooJa4S76k10NMDKUbC8DgZN
 UfrDCN+wciPDJ1h+DCAeK5OI5NmxOT5z3YTDM3oYMAHEG5AdC0TGQcj0a2L833X42dhC
 1eQSuzsPhm9tnV7s6tfTWhLDMf7DrFanRiiQVnAK6mSQTx67bJz3sjQjSaor7WKKbxB8
 YbkQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=vWCwx9Su+VRnoL1JlAwGcp1087mputsOyY+fssc6IfU=;
 b=sUrtTjEXp7941K7qQLj9AmhzVQJPLoOhoBCwxjAhewunfXWLc4AtZ//1G73sIUwuYK
 t0rIVeC6HcuLRXhw5LX3xWKByinmWcUWN2NEL0740PM53RxjTsfx/OvhQsNIqVIKcCQK
 neL0cgQPF5BOFnsYpDd8J16mJkY5dQYYe/CXkXRrVA8c61HxX6dEpDJBgUj130R1HlpK
 9/s47US2iwpfZje3TGge8b6KeZdnlEPkX5yxIMxX11EUe75WYvxQ3k9Q/Wzxs07CBfvi
 RrdXjwmJGfEUzy0AWRl0H5anCnGev7Nx5/wUendQQi1SVfRsPnHZ2NQwisGhmxkMA9tm
 kM1w==
X-Gm-Message-State: AOAM532eQiYZ4Y1cMq2CMZ+G0vGEftCoaA6cB2QUeZDYxSLxgq6C59nH
 oI6Fyg4OMrr1UQgkRtGOVU5g+oC56ag=
X-Google-Smtp-Source: ABdhPJx4MnuwdWj7TaMedc/latmqYtoZGDWuUerO2x4hWGVCJ26qK0auSMMPdZg+F6MOMj75lgZ3eA==
X-Received: by 2002:a5d:6043:: with SMTP id j3mr7511469wrt.375.1637677306387; 
 Tue, 23 Nov 2021 06:21:46 -0800 (PST)
Received: from abel.fritz.box (p57b0b77b.dip0.t-ipconnect.de. [87.176.183.123])
 by smtp.gmail.com with ESMTPSA id t8sm1645928wmq.32.2021.11.23.06.21.44
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 23 Nov 2021 06:21:46 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: sumit.semwal@linaro.org,
	daniel@ffwll.ch
Date: Tue, 23 Nov 2021 15:21:03 +0100
Message-Id: <20211123142111.3885-19-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20211123142111.3885-1-christian.koenig@amd.com>
References: <20211123142111.3885-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Subject: [Linaro-mm-sig] [PATCH 18/26] dma-buf/drivers: make reserving a
 shared slot mandatory
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Cc: linaro-mm-sig@lists.linaro.org, dri-devel@lists.freedesktop.org,
 linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

QXVkaXQgYWxsIHRoZSB1c2VycyBvZiBkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZSgpIGFuZCBtYWtl
IHN1cmUgdGhleQpyZXNlcnZlIGEgc2hhcmVkIHNsb3QgYWxzbyB3aGVuIG9ubHkgdHJ5aW5nIHRv
IGFkZCBhbiBleGNsdXNpdmUgZmVuY2UuCgpUaGlzIGlzIHRoZSBuZXh0IHN0ZXAgdG93YXJkcyBo
YW5kbGluZyB0aGUgZXhjbHVzaXZlIGZlbmNlIGxpa2UgYQpzaGFyZWQgb25lLgoKU2lnbmVkLW9m
Zi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgotLS0KIGRy
aXZlcnMvZG1hLWJ1Zi9zdC1kbWEtcmVzdi5jICAgICAgICAgICAgICAgICB8IDY0ICsrKysrKysr
Ky0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyAg
ICB8ICA4ICsrKwogZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMg
IHwgIDggKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jICAg
fCAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwg
IDggKy0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9taWdyYXRlLmMgfCAg
NSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgIDYg
KysKIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jICB8ICA3ICsr
CiBkcml2ZXJzL2dwdS9kcm0vbGltYS9saW1hX2dlbS5jICAgICAgICAgICAgICAgfCAxMCArKy0K
IGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbV9zdWJtaXQuYyAgICAgICAgICB8IDE4ICsrKy0t
LQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9mZW5jZS5jICAgICAgIHwgIDkgKy0t
CiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmMgICAgICAgfCAgNCArKwog
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jICAgICAgICAgICAgIHwgMTIgKysrLQog
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMgICAgICAgIHwgMTEgKystLQog
ZHJpdmVycy9ncHUvZHJtL3YzZC92M2RfZ2VtLmMgICAgICAgICAgICAgICAgIHwgMTUgKysrLS0K
IGRyaXZlcnMvZ3B1L2RybS92Z2VtL3ZnZW1fZmVuY2UuYyAgICAgICAgICAgICB8IDEyICsrLS0K
IGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyAgICAgICAgICB8ICA5ICsrKwog
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYyAgICAgICAgICAgIHwgMTYgKysrLS0K
IDE4IGZpbGVzIGNoYW5nZWQsIDEzMyBpbnNlcnRpb25zKCspLCA5MiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLXJlc3YuYyBiL2RyaXZlcnMvZG1hLWJ1
Zi9zdC1kbWEtcmVzdi5jCmluZGV4IGNiZTk5OWM2ZTdhNi4uZjMzYmFmYzc4NjkzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLXJlc3YuYworKysgYi9kcml2ZXJzL2RtYS1idWYv
c3QtZG1hLXJlc3YuYwpAQCAtNzUsMTcgKzc1LDE2IEBAIHN0YXRpYyBpbnQgdGVzdF9zaWduYWxp
bmcodm9pZCAqYXJnLCBib29sIHNoYXJlZCkKIAkJZ290byBlcnJfZnJlZTsKIAl9CiAKLQlpZiAo
c2hhcmVkKSB7Ci0JCXIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCgmcmVzdiwgMSk7Ci0JCWlm
IChyKSB7Ci0JCQlwcl9lcnIoIlJlc3Ygc2hhcmVkIHNsb3QgYWxsb2NhdGlvbiBmYWlsZWRcbiIp
OwotCQkJZ290byBlcnJfdW5sb2NrOwotCQl9CisJciA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVk
KCZyZXN2LCAxKTsKKwlpZiAocikgeworCQlwcl9lcnIoIlJlc3Ygc2hhcmVkIHNsb3QgYWxsb2Nh
dGlvbiBmYWlsZWRcbiIpOworCQlnb3RvIGVycl91bmxvY2s7CisJfQogCisJaWYgKHNoYXJlZCkK
IAkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSgmcmVzdiwgZik7Ci0JfSBlbHNlIHsKKwllbHNl
CiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKCZyZXN2LCBmKTsKLQl9CiAKIAlpZiAoZG1hX3Jl
c3ZfdGVzdF9zaWduYWxlZCgmcmVzdiwgc2hhcmVkKSkgewogCQlwcl9lcnIoIlJlc3YgdW5leHBl
Y3RlZGx5IHNpZ25hbGVkXG4iKTsKQEAgLTEzNCwxNyArMTMzLDE2IEBAIHN0YXRpYyBpbnQgdGVz
dF9mb3JfZWFjaCh2b2lkICphcmcsIGJvb2wgc2hhcmVkKQogCQlnb3RvIGVycl9mcmVlOwogCX0K
IAotCWlmIChzaGFyZWQpIHsKLQkJciA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKCZyZXN2LCAx
KTsKLQkJaWYgKHIpIHsKLQkJCXByX2VycigiUmVzdiBzaGFyZWQgc2xvdCBhbGxvY2F0aW9uIGZh
aWxlZFxuIik7Ci0JCQlnb3RvIGVycl91bmxvY2s7Ci0JCX0KKwlyID0gZG1hX3Jlc3ZfcmVzZXJ2
ZV9zaGFyZWQoJnJlc3YsIDEpOworCWlmIChyKSB7CisJCXByX2VycigiUmVzdiBzaGFyZWQgc2xv
dCBhbGxvY2F0aW9uIGZhaWxlZFxuIik7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CiAKKwlpZiAo
c2hhcmVkKQogCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKCZyZXN2LCBmKTsKLQl9IGVsc2Ug
eworCWVsc2UKIAkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UoJnJlc3YsIGYpOwotCX0KIAogCXIg
PSAtRU5PRU5UOwogCWRtYV9yZXN2X2Zvcl9lYWNoX2ZlbmNlKCZjdXJzb3IsICZyZXN2LCBzaGFy
ZWQsIGZlbmNlKSB7CkBAIC0yMDYsMTggKzIwNCwxNyBAQCBzdGF0aWMgaW50IHRlc3RfZm9yX2Vh
Y2hfdW5sb2NrZWQodm9pZCAqYXJnLCBib29sIHNoYXJlZCkKIAkJZ290byBlcnJfZnJlZTsKIAl9
CiAKLQlpZiAoc2hhcmVkKSB7Ci0JCXIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCgmcmVzdiwg
MSk7Ci0JCWlmIChyKSB7Ci0JCQlwcl9lcnIoIlJlc3Ygc2hhcmVkIHNsb3QgYWxsb2NhdGlvbiBm
YWlsZWRcbiIpOwotCQkJZG1hX3Jlc3ZfdW5sb2NrKCZyZXN2KTsKLQkJCWdvdG8gZXJyX2ZyZWU7
Ci0JCX0KKwlyID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQoJnJlc3YsIDEpOworCWlmIChyKSB7
CisJCXByX2VycigiUmVzdiBzaGFyZWQgc2xvdCBhbGxvY2F0aW9uIGZhaWxlZFxuIik7CisJCWRt
YV9yZXN2X3VubG9jaygmcmVzdik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQogCisJaWYgKHNoYXJl
ZCkKIAkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSgmcmVzdiwgZik7Ci0JfSBlbHNlIHsKKwll
bHNlCiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKCZyZXN2LCBmKTsKLQl9CiAJZG1hX3Jlc3Zf
dW5sb2NrKCZyZXN2KTsKIAogCXIgPSAtRU5PRU5UOwpAQCAtMjkwLDE4ICsyODcsMTcgQEAgc3Rh
dGljIGludCB0ZXN0X2dldF9mZW5jZXModm9pZCAqYXJnLCBib29sIHNoYXJlZCkKIAkJZ290byBl
cnJfcmVzdjsKIAl9CiAKLQlpZiAoc2hhcmVkKSB7Ci0JCXIgPSBkbWFfcmVzdl9yZXNlcnZlX3No
YXJlZCgmcmVzdiwgMSk7Ci0JCWlmIChyKSB7Ci0JCQlwcl9lcnIoIlJlc3Ygc2hhcmVkIHNsb3Qg
YWxsb2NhdGlvbiBmYWlsZWRcbiIpOwotCQkJZG1hX3Jlc3ZfdW5sb2NrKCZyZXN2KTsKLQkJCWdv
dG8gZXJyX3Jlc3Y7Ci0JCX0KKwlyID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQoJnJlc3YsIDEp
OworCWlmIChyKSB7CisJCXByX2VycigiUmVzdiBzaGFyZWQgc2xvdCBhbGxvY2F0aW9uIGZhaWxl
ZFxuIik7CisJCWRtYV9yZXN2X3VubG9jaygmcmVzdik7CisJCWdvdG8gZXJyX3Jlc3Y7CisJfQog
CisJaWYgKHNoYXJlZCkKIAkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSgmcmVzdiwgZik7Ci0J
fSBlbHNlIHsKKwllbHNlCiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKCZyZXN2LCBmKTsKLQl9
CiAJZG1hX3Jlc3ZfdW5sb2NrKCZyZXN2KTsKIAogCXIgPSBkbWFfcmVzdl9nZXRfZmVuY2VzKCZy
ZXN2LCBzaGFyZWQsICZpLCAmZmVuY2VzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuYwppbmRleCA0ZmNmYzIzMTNiOGMuLjFiZWNkNGU3ZTQ2MyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtMTM2Nyw2ICsxMzY3LDE0
IEBAIHZvaWQgYW1kZ3B1X2JvX2ZlbmNlKHN0cnVjdCBhbWRncHVfYm8gKmJvLCBzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZSwKIAkJICAgICBib29sIHNoYXJlZCkKIHsKIAlzdHJ1Y3QgZG1hX3Jlc3Yg
KnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKKwlpbnQgcjsKKworCXIgPSBkbWFfcmVzdl9yZXNl
cnZlX2ZlbmNlcyhyZXN2LCAxKTsKKwlpZiAocikgeworCQkvKiBBcyBsYXN0IHJlc29ydCBvbiBP
T00gd2UgYmxvY2sgZm9yIHRoZSBmZW5jZSAqLworCQlkbWFfZmVuY2Vfd2FpdChmZW5jZSwgZmFs
c2UpOworCQlyZXR1cm47CisJfQogCiAJaWYgKHNoYXJlZCkKIAkJZG1hX3Jlc3ZfYWRkX3NoYXJl
ZF9mZW5jZShyZXN2LCBmZW5jZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZp
di9ldG5hdml2X2dlbV9zdWJtaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZf
Z2VtX3N1Ym1pdC5jCmluZGV4IDQyODZkYzkzZmRhYS4uZDRhNzA3MzE5MGVjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYwpAQCAtMTc5LDExICsxNzks
OSBAQCBzdGF0aWMgaW50IHN1Ym1pdF9mZW5jZV9zeW5jKHN0cnVjdCBldG5hdml2X2dlbV9zdWJt
aXQgKnN1Ym1pdCkKIAkJc3RydWN0IGV0bmF2aXZfZ2VtX3N1Ym1pdF9ibyAqYm8gPSAmc3VibWl0
LT5ib3NbaV07CiAJCXN0cnVjdCBkbWFfcmVzdiAqcm9iaiA9IGJvLT5vYmotPmJhc2UucmVzdjsK
IAotCQlpZiAoIShiby0+ZmxhZ3MgJiBFVE5BX1NVQk1JVF9CT19XUklURSkpIHsKLQkJCXJldCA9
IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHJvYmosIDEpOwotCQkJaWYgKHJldCkKLQkJCQlyZXR1
cm4gcmV0OwotCQl9CisJCXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHJvYmosIDEpOwor
CQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKIAogCQlpZiAoc3VibWl0LT5mbGFncyAmIEVUTkFf
U1VCTUlUX05PX0lNUExJQ0lUKQogCQkJY29udGludWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NsZmx1c2guYwppbmRleCBmMDQzNWM2ZmViNjguLmZjNTdhYjkxNGI2MCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jCkBAIC0xMDAs
NyArMTAwLDggQEAgYm9vbCBpOTE1X2dlbV9jbGZsdXNoX29iamVjdChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9jbGZsdXNoKG9iaik7CiAK
IAljbGZsdXNoID0gTlVMTDsKLQlpZiAoIShmbGFncyAmIEk5MTVfQ0xGTFVTSF9TWU5DKSkKKwlp
ZiAoIShmbGFncyAmIEk5MTVfQ0xGTFVTSF9TWU5DKSAmJgorCSAgICBkbWFfcmVzdl9yZXNlcnZl
X3NoYXJlZChvYmotPmJhc2UucmVzdiwgMSkgPT0gMCkKIAkJY2xmbHVzaCA9IGNsZmx1c2hfd29y
a19jcmVhdGUob2JqKTsKIAlpZiAoY2xmbHVzaCkgewogCQlpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jl
c2VydmF0aW9uKCZjbGZsdXNoLT5iYXNlLmNoYWluLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggNGQ3ZGEwNzQ0MmYyLi5mYzBlMTYyNTg0
N2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YwpAQCAtOTg5LDExICs5ODksOSBAQCBzdGF0aWMgaW50IGViX3ZhbGlkYXRlX3ZtYXMoc3RydWN0
IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCQl9CiAJCX0KIAotCQlpZiAoIShldi0+ZmxhZ3MgJiBF
WEVDX09CSkVDVF9XUklURSkpIHsKLQkJCWVyciA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHZt
YS0+cmVzdiwgMSk7Ci0JCQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7Ci0JCX0KKwkJZXJyID0g
ZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQodm1hLT5yZXN2LCAxKTsKKwkJaWYgKGVycikKKwkJCXJl
dHVybiBlcnI7CiAKIAkJR0VNX0JVR19PTihkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9k
ZSkgJiYKIAkJCSAgIGViX3ZtYV9taXNwbGFjZWQoJmViLT5leGVjW2ldLCB2bWEsIGV2LT5mbGFn
cykpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9taWdyYXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21pZ3JhdGUuYwppbmRleCAyOGE3MDBmMDhiNDkuLjJiZjQ5MWZkNWNkZiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9taWdyYXRlLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9taWdyYXRl
LmMKQEAgLTE3OSw3ICsxNzksMTAgQEAgc3RhdGljIGludCBpZ3RfbG1lbV9wYWdlc19taWdyYXRl
KHZvaWQgKmFyZykKIAkJCQkJICBpOTE1X2dlbV9vYmplY3RfaXNfbG1lbShvYmopLAogCQkJCQkg
IDB4ZGVhZGJlYWYsICZycSk7CiAJCWlmIChycSkgewotCQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVu
Y2Uob2JqLT5iYXNlLnJlc3YsICZycS0+ZmVuY2UpOworCQkJZXJyID0gZG1hX3Jlc3ZfcmVzZXJ2
ZV9zaGFyZWQob2JqLT5iYXNlLnJlc3YsIDEpOworCQkJaWYgKCFlcnIpCisJCQkJZG1hX3Jlc3Zf
YWRkX2V4Y2xfZmVuY2Uob2JqLT5iYXNlLnJlc3YsCisJCQkJCQkJJnJxLT5mZW5jZSk7CiAJCQlp
OTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJfQogCQlpZiAoZXJyKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmMKaW5kZXggYmVmNzk1ZTI2NWE2Li41ZWM4N2RlNjM5NjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYwpAQCAtMTI1NSw2ICsxMjU1LDEyIEBAIGludCBfaTkxNV92bWFfbW92ZV90b19hY3RpdmUo
c3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQlpbnRlbF9mcm9udGJ1ZmZlcl9wdXQoZnJvbnQpOwog
CQl9CiAKKwkJaWYgKCEoZmxhZ3MgJiBfX0VYRUNfT0JKRUNUX05PX1JFU0VSVkUpKSB7CisJCQll
cnIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCh2bWEtPnJlc3YsIDEpOworCQkJaWYgKHVubGlr
ZWx5KGVycikpCisJCQkJcmV0dXJuIGVycjsKKwkJfQorCiAJCWlmIChmZW5jZSkgewogCQkJZG1h
X3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uodm1hLT5yZXN2LCBmZW5jZSk7CiAJCQlvYmotPndyaXRlX2Rv
bWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2ludGVsX21lbW9yeV9yZWdpb24uYwppbmRleCA0MThjYWFlODQ3NTku
LmI4NWFmMTY3MmE3ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2ludGVsX21lbW9yeV9yZWdpb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jCkBAIC04OTQsNiArODk0LDEzIEBAIHN0YXRpYyBpbnQg
aWd0X2xtZW1fd3JpdGVfY3B1KHZvaWQgKmFyZykKIAl9CiAKIAlpOTE1X2dlbV9vYmplY3RfbG9j
ayhvYmosIE5VTEwpOworCisJZXJyID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQob2JqLT5iYXNl
LnJlc3YsIDEpOworCWlmIChlcnIpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwor
CQlnb3RvIG91dF9wdXQ7CisJfQorCiAJLyogUHV0IHRoZSBwYWdlcyBpbnRvIGEga25vd24gc3Rh
dGUgLS0gZnJvbSB0aGUgZ3B1IGZvciBhZGRlZCBmdW4gKi8KIAlpbnRlbF9lbmdpbmVfcG1fZ2V0
KGVuZ2luZSk7CiAJZXJyID0gaW50ZWxfY29udGV4dF9taWdyYXRlX2NsZWFyKGVuZ2luZS0+Z3Qt
Pm1pZ3JhdGUuY29udGV4dCwgTlVMTCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9saW1h
L2xpbWFfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbGltYS9saW1hX2dlbS5jCmluZGV4IDI3MjNk
MzMzYzYwOC4uNDg3NTgxZTJmNzE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbGltYS9s
aW1hX2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9saW1hL2xpbWFfZ2VtLmMKQEAgLTI1NSwx
MyArMjU1LDExIEBAIGludCBsaW1hX2dlbV9nZXRfaW5mbyhzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUs
IHUzMiBoYW5kbGUsIHUzMiAqdmEsIHU2NCAqb2Zmc2V0KQogc3RhdGljIGludCBsaW1hX2dlbV9z
eW5jX2JvKHN0cnVjdCBsaW1hX3NjaGVkX3Rhc2sgKnRhc2ssIHN0cnVjdCBsaW1hX2JvICpibywK
IAkJCSAgICBib29sIHdyaXRlLCBib29sIGV4cGxpY2l0KQogewotCWludCBlcnIgPSAwOworCWlu
dCBlcnI7CiAKLQlpZiAoIXdyaXRlKSB7Ci0JCWVyciA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVk
KGxpbWFfYm9fcmVzdihibyksIDEpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQl9CisJ
ZXJyID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQobGltYV9ib19yZXN2KGJvKSwgMSk7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKIAogCS8qIGV4cGxpY2l0IHN5bmMgdXNlIHVzZXIgcGFzc2Vk
IGRlcCBmZW5jZSAqLwogCWlmIChleHBsaWNpdCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vbXNtX2dlbV9zdWJtaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbV9zdWJt
aXQuYwppbmRleCAzY2IwMjlmMTA5MjUuLmU4NzRkMDliNzRlZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9tc21fZ2VtX3N1Ym1pdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20v
bXNtX2dlbV9zdWJtaXQuYwpAQCAtMzIwLDE2ICszMjAsMTQgQEAgc3RhdGljIGludCBzdWJtaXRf
ZmVuY2Vfc3luYyhzdHJ1Y3QgbXNtX2dlbV9zdWJtaXQgKnN1Ym1pdCwgYm9vbCBub19pbXBsaWNp
dCkKIAkJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSAmc3VibWl0LT5ib3NbaV0ub2JqLT5i
YXNlOwogCQlib29sIHdyaXRlID0gc3VibWl0LT5ib3NbaV0uZmxhZ3MgJiBNU01fU1VCTUlUX0JP
X1dSSVRFOwogCi0JCWlmICghd3JpdGUpIHsKLQkJCS8qIE5PVEU6IF9yZXNlcnZlX3NoYXJlZCgp
IG11c3QgaGFwcGVuIGJlZm9yZQotCQkJICogX2FkZF9zaGFyZWRfZmVuY2UoKSwgd2hpY2ggbWFr
ZXMgdGhpcyBhIHNsaWdodGx5Ci0JCQkgKiBzdHJhbmdlIHBsYWNlIHRvIGNhbGwgaXQuICBPVE9I
IHRoaXMgaXMgYQotCQkJICogY29udmVuaWVudCBjYW4tZmFpbCBwb2ludCB0byBob29rIGl0IGlu
LgotCQkJICovCi0JCQlyZXQgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZChvYmotPnJlc3YsIDEp
OwotCQkJaWYgKHJldCkKLQkJCQlyZXR1cm4gcmV0OwotCQl9CisJCS8qIE5PVEU6IF9yZXNlcnZl
X3NoYXJlZCgpIG11c3QgaGFwcGVuIGJlZm9yZQorCQkgKiBfYWRkX3NoYXJlZF9mZW5jZSgpLCB3
aGljaCBtYWtlcyB0aGlzIGEgc2xpZ2h0bHkKKwkJICogc3RyYW5nZSBwbGFjZSB0byBjYWxsIGl0
LiAgT1RPSCB0aGlzIGlzIGEKKwkJICogY29udmVuaWVudCBjYW4tZmFpbCBwb2ludCB0byBob29r
IGl0IGluLgorCQkgKi8KKwkJcmV0ID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQob2JqLT5yZXN2
LCAxKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CiAKIAkJLyogZXhjbHVzaXZlIGZlbmNl
cyBtdXN0IGJlIG9yZGVyZWQgKi8KIAkJaWYgKG5vX2ltcGxpY2l0ICYmICF3cml0ZSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYwppbmRleCAyNmY5Mjk5ZGY4ODEuLmNkNjcx
NWJkNmQ2YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9mZW5j
ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYwpAQCAtMzQ5
LDEyICszNDksOSBAQCBub3V2ZWF1X2ZlbmNlX3N5bmMoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8s
IHN0cnVjdCBub3V2ZWF1X2NoYW5uZWwgKmNoYW4sCiAJc3RydWN0IG5vdXZlYXVfZmVuY2UgKmY7
CiAJaW50IHJldDsKIAotCWlmICghZXhjbHVzaXZlKSB7Ci0JCXJldCA9IGRtYV9yZXN2X3Jlc2Vy
dmVfc2hhcmVkKHJlc3YsIDEpOwotCi0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KKwly
ZXQgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZChyZXN2LCAxKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OwogCiAJZG1hX3Jlc3ZfZm9yX2VhY2hfZmVuY2UoJmN1cnNvciwgcmVzdiwgZXhjbHVz
aXZlLCBmZW5jZSkgewogCQlzdHJ1Y3Qgbm91dmVhdV9jaGFubmVsICpwcmV2ID0gTlVMTDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYyBiL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYwppbmRleCA5MDhkNzk1MjA4NTMuLjg5
YzNmZTM4OTQ3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X2pvYi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYwpAQCAt
MjQ3LDYgKzI0NywxMCBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X2FjcXVpcmVfb2JqZWN0X2ZlbmNl
cyhzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipib3MsCiAJaW50IGksIHJldDsKIAogCWZvciAoaSA9
IDA7IGkgPCBib19jb3VudDsgaSsrKSB7CisJCXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVk
KGJvc1tpXS0+cmVzdiwgMSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCiAJCS8qIHBh
bmZyb3N0IGFsd2F5cyB1c2VzIHdyaXRlIG1vZGUgaW4gaXRzIGN1cnJlbnQgdWFwaSAqLwogCQly
ZXQgPSBkcm1fc2NoZWRfam9iX2FkZF9pbXBsaWNpdF9kZXBlbmRlbmNpZXMoam9iLCBib3NbaV0s
CiAJCQkJCQkJICAgICAgdHJ1ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9ib191dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKaW5kZXggNzJh
OTQzMDFiYzk1Li5lYTllYWJjYzBhMGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX2JvX3V0aWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKQEAg
LTIyMSw5ICsyMjEsNiBAQCBzdGF0aWMgaW50IHR0bV9idWZmZXJfb2JqZWN0X3RyYW5zZmVyKHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAKIAlmYm8tPmJhc2UgPSAqYm87CiAKLQl0dG1f
Ym9fZ2V0KGJvKTsKLQlmYm8tPmJvID0gYm87Ci0KIAkvKioKIAkgKiBGaXggdXAgbWVtYmVycyB0
aGF0IHdlIHNob3VsZG4ndCBjb3B5IGRpcmVjdGx5OgogCSAqIFRPRE86IEV4cGxpY2l0IG1lbWJl
ciBjb3B5IHdvdWxkIHByb2JhYmx5IGJlIGJldHRlciBoZXJlLgpAQCAtMjQ2LDYgKzI0MywxNSBA
QCBzdGF0aWMgaW50IHR0bV9idWZmZXJfb2JqZWN0X3RyYW5zZmVyKHN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8sCiAJcmV0ID0gZG1hX3Jlc3ZfdHJ5bG9jaygmZmJvLT5iYXNlLmJhc2UuX3Jl
c3YpOwogCVdBUk5fT04oIXJldCk7CiAKKwlyZXQgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCgm
ZmJvLT5iYXNlLmJhc2UuX3Jlc3YsIDEpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUoZmJvKTsKKwkJ
cmV0dXJuIHJldDsKKwl9CisKKwl0dG1fYm9fZ2V0KGJvKTsKKwlmYm8tPmJvID0gYm87CisKIAl0
dG1fYm9fbW92ZV90b19scnVfdGFpbF91bmxvY2tlZCgmZmJvLT5iYXNlKTsKIAogCSpuZXdfb2Jq
ID0gJmZiby0+YmFzZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2V4ZWNi
dWZfdXRpbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKaW5kZXgg
MDcxYzQ4ZDY3MmM2Li41ZGE5MjI2MzlkNTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2V4ZWNidWZfdXRpbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2V4ZWNi
dWZfdXRpbC5jCkBAIC05MCw2ICs5MCw3IEBAIGludCB0dG1fZXVfcmVzZXJ2ZV9idWZmZXJzKHN0
cnVjdCB3d19hY3F1aXJlX2N0eCAqdGlja2V0LAogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShlbnRy
eSwgbGlzdCwgaGVhZCkgewogCQlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gZW50cnkt
PmJvOworCQl1bnNpZ25lZCBpbnQgbnVtX2ZlbmNlczsKIAogCQlyZXQgPSB0dG1fYm9fcmVzZXJ2
ZShibywgaW50ciwgKHRpY2tldCA9PSBOVUxMKSwgdGlja2V0KTsKIAkJaWYgKHJldCA9PSAtRUFM
UkVBRFkgJiYgZHVwcykgewpAQCAtMTAwLDEyICsxMDEsMTAgQEAgaW50IHR0bV9ldV9yZXNlcnZl
X2J1ZmZlcnMoc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQsCiAJCQljb250aW51ZTsKIAkJ
fQogCisJCW51bV9mZW5jZXMgPSBtaW4oZW50cnktPm51bV9zaGFyZWQsIDF1KTsKIAkJaWYgKCFy
ZXQpIHsKLQkJCWlmICghZW50cnktPm51bV9zaGFyZWQpCi0JCQkJY29udGludWU7Ci0KIAkJCXJl
dCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKGJvLT5iYXNlLnJlc3YsCi0JCQkJCQkJCWVudHJ5
LT5udW1fc2hhcmVkKTsKKwkJCQkJCSAgICAgIG51bV9mZW5jZXMpOwogCQkJaWYgKCFyZXQpCiAJ
CQkJY29udGludWU7CiAJCX0KQEAgLTEyMCw5ICsxMTksOSBAQCBpbnQgdHRtX2V1X3Jlc2VydmVf
YnVmZmVycyhzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKnRpY2tldCwKIAkJCXJldCA9IHR0bV9ib19y
ZXNlcnZlX3Nsb3dwYXRoKGJvLCBpbnRyLCB0aWNrZXQpOwogCQl9CiAKLQkJaWYgKCFyZXQgJiYg
ZW50cnktPm51bV9zaGFyZWQpCisJCWlmICghcmV0KQogCQkJcmV0ID0gZG1hX3Jlc3ZfcmVzZXJ2
ZV9zaGFyZWQoYm8tPmJhc2UucmVzdiwKLQkJCQkJCQkJZW50cnktPm51bV9zaGFyZWQpOworCQkJ
CQkJICAgICAgbnVtX2ZlbmNlcyk7CiAKIAkJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkgewogCQkJ
aWYgKHRpY2tldCkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3YzZC92M2RfZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vdjNkL3YzZF9nZW0uYwppbmRleCBjN2VkMmUxY2JhYjYuLjFiZWE5
MGU0MGNlMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3YzZC92M2RfZ2VtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3YzZC92M2RfZ2VtLmMKQEAgLTI1OSwxNiArMjU5LDIxIEBAIHYzZF9s
b2NrX2JvX3Jlc2VydmF0aW9ucyhzdHJ1Y3QgdjNkX2pvYiAqam9iLAogCQlyZXR1cm4gcmV0Owog
CiAJZm9yIChpID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7IGkrKykgeworCQlyZXQgPSBkbWFfcmVz
dl9yZXNlcnZlX3NoYXJlZChqb2ItPmJvW2ldLT5yZXN2LCAxKTsKKwkJaWYgKHJldCkKKwkJCWdv
dG8gZmFpbDsKKwogCQlyZXQgPSBkcm1fc2NoZWRfam9iX2FkZF9pbXBsaWNpdF9kZXBlbmRlbmNp
ZXMoJmpvYi0+YmFzZSwKIAkJCQkJCQkgICAgICBqb2ItPmJvW2ldLCB0cnVlKTsKLQkJaWYgKHJl
dCkgewotCQkJZHJtX2dlbV91bmxvY2tfcmVzZXJ2YXRpb25zKGpvYi0+Ym8sIGpvYi0+Ym9fY291
bnQsCi0JCQkJCQkgICAgYWNxdWlyZV9jdHgpOwotCQkJcmV0dXJuIHJldDsKLQkJfQorCQlpZiAo
cmV0KQorCQkJZ290byBmYWlsOwogCX0KIAogCXJldHVybiAwOworCitmYWlsOgorCWRybV9nZW1f
dW5sb2NrX3Jlc2VydmF0aW9ucyhqb2ItPmJvLCBqb2ItPmJvX2NvdW50LCBhY3F1aXJlX2N0eCk7
CisJcmV0dXJuIHJldDsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmdl
bS92Z2VtX2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmdlbS92Z2VtX2ZlbmNlLmMKaW5kZXgg
YmQ2Zjc1Mjg1ZmQ5Li5hNGNiMjk2ZDRmY2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92
Z2VtL3ZnZW1fZmVuY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmdlbS92Z2VtX2ZlbmNlLmMK
QEAgLTE1NywxMiArMTU3LDE0IEBAIGludCB2Z2VtX2ZlbmNlX2F0dGFjaF9pb2N0bChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCX0KIAogCS8qIEV4cG9zZSB0aGUgZmVuY2UgdmlhIHRoZSBkbWEt
YnVmICovCi0JcmV0ID0gMDsKIAlkbWFfcmVzdl9sb2NrKHJlc3YsIE5VTEwpOwotCWlmIChhcmct
PmZsYWdzICYgVkdFTV9GRU5DRV9XUklURSkKLQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UocmVz
diwgZmVuY2UpOwotCWVsc2UgaWYgKChyZXQgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZChyZXN2
LCAxKSkgPT0gMCkKLQkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShyZXN2LCBmZW5jZSk7CisJ
cmV0ID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQocmVzdiwgMSk7CisJaWYgKCFyZXQpIHsKKwkJ
aWYgKGFyZy0+ZmxhZ3MgJiBWR0VNX0ZFTkNFX1dSSVRFKQorCQkJZG1hX3Jlc3ZfYWRkX2V4Y2xf
ZmVuY2UocmVzdiwgZmVuY2UpOworCQllbHNlCisJCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNl
KHJlc3YsIGZlbmNlKTsKKwl9CiAJZG1hX3Jlc3ZfdW5sb2NrKHJlc3YpOwogCiAJLyogUmVjb3Jk
IHRoZSBmZW5jZSBpbiBvdXIgaWRyIGZvciBsYXRlciBzaWduYWxpbmcgKi8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9nZW0uYwppbmRleCAyZGU2MWI2M2VmOTEuLmFlYzEwNWNkZDY0YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYwpAQCAtMjE0LDYgKzIxNCw3IEBAIHZvaWQg
dmlydGlvX2dwdV9hcnJheV9hZGRfb2JqKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAq
b2JqcywKIAogaW50IHZpcnRpb19ncHVfYXJyYXlfbG9ja19yZXN2KHN0cnVjdCB2aXJ0aW9fZ3B1
X29iamVjdF9hcnJheSAqb2JqcykKIHsKKwl1bnNpZ25lZCBpbnQgaTsKIAlpbnQgcmV0OwogCiAJ
aWYgKG9ianMtPm5lbnRzID09IDEpIHsKQEAgLTIyMiw2ICsyMjMsMTQgQEAgaW50IHZpcnRpb19n
cHVfYXJyYXlfbG9ja19yZXN2KHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqcykK
IAkJcmV0ID0gZHJtX2dlbV9sb2NrX3Jlc2VydmF0aW9ucyhvYmpzLT5vYmpzLCBvYmpzLT5uZW50
cywKIAkJCQkJCSZvYmpzLT50aWNrZXQpOwogCX0KKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJZm9yIChpID0gMDsgaSA8IG9ianMtPm5lbnRzOyArK2kpIHsKKwkJcmV0ID0gZG1hX3Jlc3Zf
cmVzZXJ2ZV9zaGFyZWQob2Jqcy0+b2Jqc1tpXS0+cmVzdiwgMSk7CisJCWlmIChyZXQpCisJCQly
ZXR1cm4gcmV0OworCX0KIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
Ym8uYwppbmRleCBmZDAwN2YxYzE3NzYuLmY4MTc2N2YwYTVjYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4
L3Ztd2dmeF9iby5jCkBAIC0xMDUzLDE2ICsxMDUzLDIyIEBAIHZvaWQgdm13X2JvX2ZlbmNlX3Np
bmdsZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQkJIHN0cnVjdCB2bXdfZmVuY2Vf
b2JqICpmZW5jZSkKIHsKIAlzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiA9IGJvLT5iZGV2OwotCiAJ
c3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiA9CiAJCWNvbnRhaW5lcl9vZihiZGV2LCBzdHJ1
Y3Qgdm13X3ByaXZhdGUsIGJkZXYpOworCWludCByZXQ7CiAKLQlpZiAoZmVuY2UgPT0gTlVMTCkg
eworCWlmIChmZW5jZSA9PSBOVUxMKQogCQl2bXdfZXhlY2J1Zl9mZW5jZV9jb21tYW5kcyhOVUxM
LCBkZXZfcHJpdiwgJmZlbmNlLCBOVUxMKTsKKwllbHNlCisJCWRtYV9mZW5jZV9nZXQoJmZlbmNl
LT5iYXNlKTsKKworCXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKGJvLT5iYXNlLnJlc3Ys
IDEpOworCWlmICghcmV0KQogCQlkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZShiby0+YmFzZS5yZXN2
LCAmZmVuY2UtPmJhc2UpOwotCQlkbWFfZmVuY2VfcHV0KCZmZW5jZS0+YmFzZSk7Ci0JfSBlbHNl
Ci0JCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKGJvLT5iYXNlLnJlc3YsICZmZW5jZS0+YmFzZSk7
CisJZWxzZQorCQkvKiBMYXN0IHJlc29ydCBmYWxsYmFjayB3aGVuIHdlIGFyZSBPT00gKi8KKwkJ
ZG1hX2ZlbmNlX3dhaXQoJmZlbmNlLT5iYXNlLCBmYWxzZSk7CisJZG1hX2ZlbmNlX3B1dCgmZmVu
Y2UtPmJhc2UpOwogfQogCiAKLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KTGluYXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QKTGluYXJvLW1t
LXNpZ0BsaXN0cy5saW5hcm8ub3JnCmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2xpbmFyby1tbS1zaWcK
