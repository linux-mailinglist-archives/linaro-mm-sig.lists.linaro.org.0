Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A43C247F3C
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 18 Aug 2020 09:17:00 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id A86C660BD7
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 18 Aug 2020 07:16:59 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 99EB160E39; Tue, 18 Aug 2020 07:16:59 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id BE96560E68;
	Tue, 18 Aug 2020 07:14:44 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id F1F0D60BD7
 for <linaro-mm-sig@lists.linaro.org>; Tue, 18 Aug 2020 07:14:33 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id E3008619D1; Tue, 18 Aug 2020 07:14:33 +0000 (UTC)
Received: from mail-pl1-f194.google.com (mail-pl1-f194.google.com
 [209.85.214.194])
 by lists.linaro.org (Postfix) with ESMTPS id 1BADC60BD7
 for <linaro-mm-sig@lists.linaro.org>; Tue, 18 Aug 2020 07:14:10 +0000 (UTC)
Received: by mail-pl1-f194.google.com with SMTP id k13so8778814plk.13
 for <linaro-mm-sig@lists.linaro.org>; Tue, 18 Aug 2020 00:14:10 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=8COG6FJI3FN38sEKLueWsPuQIansxIOysmiVis9B+Ek=;
 b=Ryrw8trNprpeAzHyRrG43i8PkbzWaod3mtFiggCbH970jT7QBuvASXRtvmGW0iYCas
 Qi6MwGMOuGaZK24iwIMwbHpmsKdKyeUbrAtrKz5H32JqoZQsofLZ9aH6dk/E/0BDFlCQ
 8+wQNP0Egtn2s3CEm8/EWqeE11bO7An9w4LchhO7iD7wVSaRjXrpCX6OQD7hzTHt22Ta
 HtxL8Ic+THaCAZx/thzTNovzoQZZ28DlH3cMmeGHjGHgtnDzgLdp9OBVSpB0ay1JuI1T
 8U39qI2vkdjNjZXEv7Ay04WaNHsNPv37eDyVdmij+0FOJ7odsSvge74DfFs7MgkUIoJC
 Hzag==
X-Gm-Message-State: AOAM531e0QesJdpKInWBI5VhvvaFHucG8yzFOpw20wP55BEMzc8yGC2H
 yTec4M4ubJ4giVQTKelKIRIu6Q==
X-Google-Smtp-Source: ABdhPJxgMSs8Hb55krDHWE0YNeYBdNfP06GrQ3ygVXa0Uf0qpdckUwMWcaGUNtkQaGqf8oBBeN7uDg==
X-Received: by 2002:a17:90a:aa8e:: with SMTP id
 l14mr16681214pjq.67.1597734849208; 
 Tue, 18 Aug 2020 00:14:09 -0700 (PDT)
Received: from localhost ([2401:fa00:8f:203:f693:9fff:fef4:a930])
 by smtp.gmail.com with ESMTPSA id y1sm24718375pfr.207.2020.08.18.00.14.05
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Tue, 18 Aug 2020 00:14:08 -0700 (PDT)
From: David Stevens <stevensd@chromium.org>
To: Gerd Hoffmann <kraxel@redhat.com>
Date: Tue, 18 Aug 2020 16:13:43 +0900
Message-Id: <20200818071343.3461203-4-stevensd@chromium.org>
X-Mailer: git-send-email 2.28.0.220.ged08abb693-goog
In-Reply-To: <20200818071343.3461203-1-stevensd@chromium.org>
References: <20200818071343.3461203-1-stevensd@chromium.org>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: dri-devel@lists.freedesktop.org, virtio-dev@lists.oasis-open.org,
 Thomas Zimmermann <tzimmermann@suse.de>,
 "Michael S . Tsirkin" <mst@redhat.com>, David Airlie <airlied@linux.ie>,
 Jason Wang <jasowang@redhat.com>,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 linux-kernel@vger.kernel.org, Maxime Ripard <mripard@kernel.org>,
 virtualization@lists.linux-foundation.org, linaro-mm-sig@lists.linaro.org,
 David Stevens <stevensd@chromium.org>, Daniel Vetter <daniel@ffwll.ch>,
 linux-media@vger.kernel.org
Subject: [Linaro-mm-sig] [PATCH v7 3/3] drm/virtio: Support virtgpu exported
	resources
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

QWRkIHN1cHBvcnQgZm9yIFVVSUQtYmFzZWQgcmVzb3VyY2Ugc2hhcmluZyBtZWNoYW5pc20gdG8g
dmlydGdwdS4gVGhpcwppbXBsZW1lbnRzIHRoZSBuZXcgdmlydGdwdSBjb21tYW5kcyBhbmQgaG9v
a3MgdGhlbSB1cCB0byBkbWEtYnVmJ3MKZ2V0X3V1aWQgY2FsbGJhY2suCgpTaWduZWQtb2ZmLWJ5
OiBEYXZpZCBTdGV2ZW5zIDxzdGV2ZW5zZEBjaHJvbWl1bS5vcmc+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5jICAgfCAgMyArCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlv
L3ZpcnRncHVfZHJ2LmggICB8IDIxICsrKysrKwogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X2ttcy5jICAgfCAgNCArKwogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ByaW1l
LmMgfCA5NiArKysrKysrKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRp
by92aXJ0Z3B1X3ZxLmMgICAgfCA1NSArKysrKysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdlZCwg
MTc2IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X2Rydi5jCmluZGV4IGFiNGJlZDc4ZTY1Ni4uYjAzOWY0OTNiZGE5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X2Rydi5jCkBAIC0xNjUsNiArMTY1LDcgQEAgc3RhdGljIHVuc2lnbmVk
IGludCBmZWF0dXJlc1tdID0gewogCVZJUlRJT19HUFVfRl9WSVJHTCwKICNlbmRpZgogCVZJUlRJ
T19HUFVfRl9FRElELAorCVZJUlRJT19HUFVfRl9SRVNPVVJDRV9VVUlELAogfTsKIHN0YXRpYyBz
dHJ1Y3QgdmlydGlvX2RyaXZlciB2aXJ0aW9fZ3B1X2RyaXZlciA9IHsKIAkuZmVhdHVyZV90YWJs
ZSA9IGZlYXR1cmVzLApAQCAtMjAyLDYgKzIwMyw4IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZl
ciBkcml2ZXIgPSB7CiAJLnByaW1lX2hhbmRsZV90b19mZCA9IGRybV9nZW1fcHJpbWVfaGFuZGxl
X3RvX2ZkLAogCS5wcmltZV9mZF90b19oYW5kbGUgPSBkcm1fZ2VtX3ByaW1lX2ZkX3RvX2hhbmRs
ZSwKIAkuZ2VtX3ByaW1lX21tYXAgPSBkcm1fZ2VtX3ByaW1lX21tYXAsCisJLmdlbV9wcmltZV9l
eHBvcnQgPSB2aXJ0Z3B1X2dlbV9wcmltZV9leHBvcnQsCisJLmdlbV9wcmltZV9pbXBvcnQgPSB2
aXJ0Z3B1X2dlbV9wcmltZV9pbXBvcnQsCiAJLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUgPSB2
aXJ0Z3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUsCiAKIAkuZ2VtX2NyZWF0ZV9vYmplY3Qg
PSB2aXJ0aW9fZ3B1X2NyZWF0ZV9vYmplY3QsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
dmlydGlvL3ZpcnRncHVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2
LmgKaW5kZXggNDliZWJkZWU2ZDkxLi5jZjU0Yjg5ZDlhYjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlv
L3ZpcnRncHVfZHJ2LmgKQEAgLTQ5LDYgKzQ5LDEwIEBACiAjZGVmaW5lIERSSVZFUl9NSU5PUiAx
CiAjZGVmaW5lIERSSVZFUl9QQVRDSExFVkVMIDAKIAorI2RlZmluZSBVVUlEX0lOSVRJQUxJWklO
RyAwCisjZGVmaW5lIFVVSURfSU5JVElBTElaRUQgMQorI2RlZmluZSBVVUlEX0lOSVRJQUxJWkFU
SU9OX0ZBSUxFRCAyCisKIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9wYXJhbXMgewogCXVpbnQz
Ml90IGZvcm1hdDsKIAl1aW50MzJfdCB3aWR0aDsKQEAgLTcxLDYgKzc1LDkgQEAgc3RydWN0IHZp
cnRpb19ncHVfb2JqZWN0IHsKIAl1aW50MzJfdCBod19yZXNfaGFuZGxlOwogCWJvb2wgZHVtYjsK
IAlib29sIGNyZWF0ZWQ7CisKKwlpbnQgdXVpZF9zdGF0ZTsKKwl1dWlkX3QgdXVpZDsKIH07CiAj
ZGVmaW5lIGdlbV90b192aXJ0aW9fZ3B1X29iaihnb2JqKSBcCiAJY29udGFpbmVyX29mKChnb2Jq
KSwgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0LCBiYXNlLmJhc2UpCkBAIC0yMDAsNiArMjA3LDcg
QEAgc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlIHsKIAlib29sIGhhc192aXJnbF8zZDsKIAlib29s
IGhhc19lZGlkOwogCWJvb2wgaGFzX2luZGlyZWN0OworCWJvb2wgaGFzX3Jlc291cmNlX2Fzc2ln
bl91dWlkOwogCiAJc3RydWN0IHdvcmtfc3RydWN0IGNvbmZpZ19jaGFuZ2VkX3dvcms7CiAKQEAg
LTIxMCw2ICsyMTgsOSBAQCBzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgewogCXN0cnVjdCB2aXJ0
aW9fZ3B1X2Rydl9jYXBzZXQgKmNhcHNldHM7CiAJdWludDMyX3QgbnVtX2NhcHNldHM7CiAJc3Ry
dWN0IGxpc3RfaGVhZCBjYXBfY2FjaGU7CisKKwkvKiBwcm90ZWN0cyByZXNvdXJjZSBzdGF0ZSB3
aGVuIGV4cG9ydGluZyAqLworCXNwaW5sb2NrX3QgcmVzb3VyY2VfZXhwb3J0X2xvY2s7CiB9Owog
CiBzdHJ1Y3QgdmlydGlvX2dwdV9mcHJpdiB7CkBAIC0zMzUsNiArMzQ2LDEwIEBAIHZvaWQgdmly
dGlvX2dwdV9kZXF1ZXVlX2ZlbmNlX2Z1bmMoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKTsKIAog
dm9pZCB2aXJ0aW9fZ3B1X25vdGlmeShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KTsK
IAoraW50Cit2aXJ0aW9fZ3B1X2NtZF9yZXNvdXJjZV9hc3NpZ25fdXVpZChzdHJ1Y3QgdmlydGlv
X2dwdV9kZXZpY2UgKnZnZGV2LAorCQkJCSAgICBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJy
YXkgKm9ianMpOworCiAvKiB2aXJ0Z3B1X2Rpc3BsYXkuYyAqLwogdm9pZCB2aXJ0aW9fZ3B1X21v
ZGVzZXRfaW5pdChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KTsKIHZvaWQgdmlydGlv
X2dwdV9tb2Rlc2V0X2Zpbmkoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rldik7CkBAIC0z
NjYsNiArMzgxLDEyIEBAIGludCB2aXJ0aW9fZ3B1X29iamVjdF9jcmVhdGUoc3RydWN0IHZpcnRp
b19ncHVfZGV2aWNlICp2Z2RldiwKIGJvb2wgdmlydGlvX2dwdV9pc19zaG1lbShzdHJ1Y3Qgdmly
dGlvX2dwdV9vYmplY3QgKmJvKTsKIAogLyogdmlydGdwdV9wcmltZS5jICovCitzdHJ1Y3QgZG1h
X2J1ZiAqdmlydGdwdV9nZW1fcHJpbWVfZXhwb3J0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
LAorCQkJCQkgaW50IGZsYWdzKTsKK3N0cnVjdCBkcm1fZ2VtX29iamVjdCAqdmlydGdwdV9nZW1f
cHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJCQlzdHJ1Y3QgZG1hX2J1
ZiAqYnVmKTsKK2ludCB2aXJ0Z3B1X2dlbV9wcmltZV9nZXRfdXVpZChzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKm9iaiwKKwkJCSAgICAgICB1dWlkX3QgKnV1aWQpOwogc3RydWN0IGRybV9nZW1fb2Jq
ZWN0ICp2aXJ0Z3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoCiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAogCXN0cnVjdCBzZ190
YWJsZSAqc2d0KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9r
bXMuYyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9rbXMuYwppbmRleCAwMjNhMDMw
Y2E3YjkuLjdiY2QwYzc1ZWZmYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9rbXMuYwpA
QCAtMTI1LDYgKzEyNSw3IEBAIGludCB2aXJ0aW9fZ3B1X2luaXQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKIAl2Z2Rldi0+ZGV2ID0gZGV2LT5kZXY7CiAKIAlzcGluX2xvY2tfaW5pdCgmdmdkZXYt
PmRpc3BsYXlfaW5mb19sb2NrKTsKKwlzcGluX2xvY2tfaW5pdCgmdmdkZXYtPnJlc291cmNlX2V4
cG9ydF9sb2NrKTsKIAlpZGFfaW5pdCgmdmdkZXYtPmN0eF9pZF9pZGEpOwogCWlkYV9pbml0KCZ2
Z2Rldi0+cmVzb3VyY2VfaWRhKTsKIAlpbml0X3dhaXRxdWV1ZV9oZWFkKCZ2Z2Rldi0+cmVzcF93
cSk7CkBAIC0xNTMsNiArMTU0LDkgQEAgaW50IHZpcnRpb19ncHVfaW5pdChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KQogCWlmICh2aXJ0aW9faGFzX2ZlYXR1cmUodmdkZXYtPnZkZXYsIFZJUlRJT19S
SU5HX0ZfSU5ESVJFQ1RfREVTQykpIHsKIAkJdmdkZXYtPmhhc19pbmRpcmVjdCA9IHRydWU7CiAJ
fQorCWlmICh2aXJ0aW9faGFzX2ZlYXR1cmUodmdkZXYtPnZkZXYsIFZJUlRJT19HUFVfRl9SRVNP
VVJDRV9VVUlEKSkgeworCQl2Z2Rldi0+aGFzX3Jlc291cmNlX2Fzc2lnbl91dWlkID0gdHJ1ZTsK
Kwl9CiAKIAlEUk1fSU5GTygiZmVhdHVyZXM6ICVjdmlyZ2wgJWNlZGlkXG4iLAogCQkgdmdkZXYt
Pmhhc192aXJnbF8zZCA/ICcrJyA6ICctJywKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9wcmltZS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3By
aW1lLmMKaW5kZXggMDUwZDI0YzM5YThmLi5hY2QxNGVmNzNkNTYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9wcmltZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9wcmltZS5jCkBAIC0yMywxMiArMjMsMTAyIEBACiAgKi8KIAogI2luY2x1
ZGUgPGRybS9kcm1fcHJpbWUuaD4KKyNpbmNsdWRlIDxsaW51eC92aXJ0aW9fZG1hX2J1Zi5oPgog
CiAjaW5jbHVkZSAidmlydGdwdV9kcnYuaCIKIAotLyogRW1wdHkgSW1wbGVtZW50YXRpb25zIGFz
IHRoZXJlIHNob3VsZCBub3QgYmUgYW55IG90aGVyIGRyaXZlciBmb3IgYSB2aXJ0dWFsCi0gKiBk
ZXZpY2UgdGhhdCBtaWdodCBzaGFyZSBidWZmZXJzIHdpdGggdmlydGdwdQotICovCitzdGF0aWMg
aW50IHZpcnRncHVfdmlydGlvX2dldF91dWlkKHN0cnVjdCBkbWFfYnVmICpidWYsCisJCQkJICAg
dXVpZF90ICp1dWlkKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqID0gYnVmLT5wcml2
OworCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoo
b2JqKTsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2ID0gb2JqLT5kZXYtPmRldl9w
cml2YXRlOworCisJd2FpdF9ldmVudCh2Z2Rldi0+cmVzcF93cSwgYm8tPnV1aWRfc3RhdGUgIT0g
VVVJRF9JTklUSUFMSVpJTkcpOworCWlmIChiby0+dXVpZF9zdGF0ZSAhPSBVVUlEX0lOSVRJQUxJ
WkVEKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXV1aWRfY29weSh1dWlkLCAmYm8tPnV1aWQpOwor
CisJcmV0dXJuIDA7Cit9CisKK2NvbnN0IHN0cnVjdCB2aXJ0aW9fZG1hX2J1Zl9vcHMgdmlydGdw
dV9kbWFidWZfb3BzID0gIHsKKwkub3BzID0geworCQkuY2FjaGVfc2d0X21hcHBpbmcgPSB0cnVl
LAorCQkuYXR0YWNoID0gdmlydGlvX2RtYV9idWZfYXR0YWNoLAorCQkuZGV0YWNoID0gZHJtX2dl
bV9tYXBfZGV0YWNoLAorCQkubWFwX2RtYV9idWYgPSBkcm1fZ2VtX21hcF9kbWFfYnVmLAorCQku
dW5tYXBfZG1hX2J1ZiA9IGRybV9nZW1fdW5tYXBfZG1hX2J1ZiwKKwkJLnJlbGVhc2UgPSBkcm1f
Z2VtX2RtYWJ1Zl9yZWxlYXNlLAorCQkubW1hcCA9IGRybV9nZW1fZG1hYnVmX21tYXAsCisJCS52
bWFwID0gZHJtX2dlbV9kbWFidWZfdm1hcCwKKwkJLnZ1bm1hcCA9IGRybV9nZW1fZG1hYnVmX3Z1
bm1hcCwKKwl9LAorCS5kZXZpY2VfYXR0YWNoID0gZHJtX2dlbV9tYXBfYXR0YWNoLAorCS5nZXRf
dXVpZCA9IHZpcnRncHVfdmlydGlvX2dldF91dWlkLAorfTsKKworc3RydWN0IGRtYV9idWYgKnZp
cnRncHVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKKwkJCQkJ
IGludCBmbGFncykKK3sKKwlzdHJ1Y3QgZG1hX2J1ZiAqYnVmOworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBvYmotPmRldjsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2ID0gZGV2
LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3Zp
cnRpb19ncHVfb2JqKG9iaik7CisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpz
OworCWludCByZXQgPSAwOworCURFRklORV9ETUFfQlVGX0VYUE9SVF9JTkZPKGV4cF9pbmZvKTsK
KworCWlmICh2Z2Rldi0+aGFzX3Jlc291cmNlX2Fzc2lnbl91dWlkKSB7CisJCW9ianMgPSB2aXJ0
aW9fZ3B1X2FycmF5X2FsbG9jKDEpOworCQlpZiAoIW9ianMpCisJCQlyZXR1cm4gRVJSX1BUUigt
RU5PTUVNKTsKKwkJdmlydGlvX2dwdV9hcnJheV9hZGRfb2JqKG9ianMsICZiby0+YmFzZS5iYXNl
KTsKKworCQlyZXQgPSB2aXJ0aW9fZ3B1X2NtZF9yZXNvdXJjZV9hc3NpZ25fdXVpZCh2Z2Rldiwg
b2Jqcyk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gRVJSX1BUUihyZXQpOworCQl2aXJ0aW9fZ3B1
X25vdGlmeSh2Z2Rldik7CisJfSBlbHNlIHsKKwkJYm8tPnV1aWRfc3RhdGUgPSBVVUlEX0lOSVRJ
QUxJWkFUSU9OX0ZBSUxFRDsKKwl9CisKKwlleHBfaW5mby5vcHMgPSAmdmlydGdwdV9kbWFidWZf
b3BzLm9wczsKKwlleHBfaW5mby5zaXplID0gb2JqLT5zaXplOworCWV4cF9pbmZvLmZsYWdzID0g
ZmxhZ3M7CisJZXhwX2luZm8ucHJpdiA9IG9iajsKKwlleHBfaW5mby5yZXN2ID0gb2JqLT5yZXN2
OworCisJYnVmID0gdmlydGlvX2RtYV9idWZfZXhwb3J0KCZleHBfaW5mbyk7CisJaWYgKElTX0VS
UihidWYpKQorCQlyZXR1cm4gYnVmOworCisJZHJtX2Rldl9nZXQoZGV2KTsKKwlkcm1fZ2VtX29i
amVjdF9nZXQob2JqKTsKKworCXJldHVybiBidWY7Cit9CisKK3N0cnVjdCBkcm1fZ2VtX29iamVj
dCAqdmlydGdwdV9nZW1fcHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJ
CQlzdHJ1Y3QgZG1hX2J1ZiAqYnVmKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqOwor
CisJaWYgKGJ1Zi0+b3BzID09ICZ2aXJ0Z3B1X2RtYWJ1Zl9vcHMub3BzKSB7CisJCW9iaiA9IGJ1
Zi0+cHJpdjsKKwkJaWYgKG9iai0+ZGV2ID09IGRldikgeworCQkJLyoKKwkJCSAqIEltcG9ydGlu
ZyBkbWFidWYgZXhwb3J0ZWQgZnJvbSBvdXIgb3duIGdlbSBpbmNyZWFzZXMKKwkJCSAqIHJlZmNv
dW50IG9uIGdlbSBpdHNlbGYgaW5zdGVhZCBvZiBmX2NvdW50IG9mIGRtYWJ1Zi4KKwkJCSAqLwor
CQkJZHJtX2dlbV9vYmplY3RfZ2V0KG9iaik7CisJCQlyZXR1cm4gb2JqOworCQl9CisJfQorCisJ
cmV0dXJuIGRybV9nZW1fcHJpbWVfaW1wb3J0KGRldiwgYnVmKTsKK30KIAogc3RydWN0IGRybV9n
ZW1fb2JqZWN0ICp2aXJ0Z3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoCiAJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMgYi9kcml2ZXJzL2dwdS9k
cm0vdmlydGlvL3ZpcnRncHVfdnEuYwppbmRleCA5ZTY2M2E1ZDk5NTIuLjgyMzIyM2IwYmI3NSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKQEAgLTExMDcsMyArMTEwNyw1OCBAQCB2
b2lkIHZpcnRpb19ncHVfY3Vyc29yX3Bpbmcoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rl
diwKIAltZW1jcHkoY3VyX3AsICZvdXRwdXQtPmN1cnNvciwgc2l6ZW9mKG91dHB1dC0+Y3Vyc29y
KSk7CiAJdmlydGlvX2dwdV9xdWV1ZV9jdXJzb3IodmdkZXYsIHZidWYpOwogfQorCitzdGF0aWMg
dm9pZCB2aXJ0aW9fZ3B1X2NtZF9yZXNvdXJjZV91dWlkX2NiKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rl
dmljZSAqdmdkZXYsCisJCQkJCSAgICBzdHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVyICp2YnVmKQor
eworCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqb2JqID0KKwkJZ2VtX3RvX3ZpcnRpb19ncHVf
b2JqKHZidWYtPm9ianMtPm9ianNbMF0pOworCXN0cnVjdCB2aXJ0aW9fZ3B1X3Jlc3BfcmVzb3Vy
Y2VfdXVpZCAqcmVzcCA9CisJCShzdHJ1Y3QgdmlydGlvX2dwdV9yZXNwX3Jlc291cmNlX3V1aWQg
Kil2YnVmLT5yZXNwX2J1ZjsKKwl1aW50MzJfdCByZXNwX3R5cGUgPSBsZTMyX3RvX2NwdShyZXNw
LT5oZHIudHlwZSk7CisKKwlzcGluX2xvY2soJnZnZGV2LT5yZXNvdXJjZV9leHBvcnRfbG9jayk7
CisJV0FSTl9PTihvYmotPnV1aWRfc3RhdGUgIT0gVVVJRF9JTklUSUFMSVpJTkcpOworCisJaWYg
KHJlc3BfdHlwZSA9PSBWSVJUSU9fR1BVX1JFU1BfT0tfUkVTT1VSQ0VfVVVJRCAmJgorCSAgICBv
YmotPnV1aWRfc3RhdGUgPT0gVVVJRF9JTklUSUFMSVpJTkcpIHsKKwkJbWVtY3B5KCZvYmotPnV1
aWQuYiwgcmVzcC0+dXVpZCwgc2l6ZW9mKG9iai0+dXVpZC5iKSk7CisJCW9iai0+dXVpZF9zdGF0
ZSA9IFVVSURfSU5JVElBTElaRUQ7CisJfSBlbHNlIHsKKwkJb2JqLT51dWlkX3N0YXRlID0gVVVJ
RF9JTklUSUFMSVpBVElPTl9GQUlMRUQ7CisJfQorCXNwaW5fdW5sb2NrKCZ2Z2Rldi0+cmVzb3Vy
Y2VfZXhwb3J0X2xvY2spOworCisJd2FrZV91cF9hbGwoJnZnZGV2LT5yZXNwX3dxKTsKK30KKwor
aW50Cit2aXJ0aW9fZ3B1X2NtZF9yZXNvdXJjZV9hc3NpZ25fdXVpZChzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAorCQkJCSAgICBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkg
Km9ianMpCit7CisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibyA9IGdlbV90b192aXJ0aW9f
Z3B1X29iaihvYmpzLT5vYmpzWzBdKTsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9yZXNvdXJjZV9hc3Np
Z25fdXVpZCAqY21kX3A7CisJc3RydWN0IHZpcnRpb19ncHVfdmJ1ZmZlciAqdmJ1ZjsKKwlzdHJ1
Y3QgdmlydGlvX2dwdV9yZXNwX3Jlc291cmNlX3V1aWQgKnJlc3BfYnVmOworCisJcmVzcF9idWYg
PSBremFsbG9jKHNpemVvZigqcmVzcF9idWYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJlc3BfYnVm
KSB7CisJCXNwaW5fbG9jaygmdmdkZXYtPnJlc291cmNlX2V4cG9ydF9sb2NrKTsKKwkJYm8tPnV1
aWRfc3RhdGUgPSBVVUlEX0lOSVRJQUxJWkFUSU9OX0ZBSUxFRDsKKwkJc3Bpbl91bmxvY2soJnZn
ZGV2LT5yZXNvdXJjZV9leHBvcnRfbG9jayk7CisJCXZpcnRpb19ncHVfYXJyYXlfcHV0X2ZyZWUo
b2Jqcyk7CisJCXJldHVybiAtRU5PTUVNOworCX0KKworCWNtZF9wID0gdmlydGlvX2dwdV9hbGxv
Y19jbWRfcmVzcAorCQkodmdkZXYsIHZpcnRpb19ncHVfY21kX3Jlc291cmNlX3V1aWRfY2IsICZ2
YnVmLCBzaXplb2YoKmNtZF9wKSwKKwkJIHNpemVvZihzdHJ1Y3QgdmlydGlvX2dwdV9yZXNwX3Jl
c291cmNlX3V1aWQpLCByZXNwX2J1Zik7CisJbWVtc2V0KGNtZF9wLCAwLCBzaXplb2YoKmNtZF9w
KSk7CisKKwljbWRfcC0+aGRyLnR5cGUgPSBjcHVfdG9fbGUzMihWSVJUSU9fR1BVX0NNRF9SRVNP
VVJDRV9BU1NJR05fVVVJRCk7CisJY21kX3AtPnJlc291cmNlX2lkID0gY3B1X3RvX2xlMzIoYm8t
Pmh3X3Jlc19oYW5kbGUpOworCisJdmJ1Zi0+b2JqcyA9IG9ianM7CisJdmlydGlvX2dwdV9xdWV1
ZV9jdHJsX2J1ZmZlcih2Z2RldiwgdmJ1Zik7CisJcmV0dXJuIDA7Cit9Ci0tIAoyLjI4LjAuMjIw
LmdlZDA4YWJiNjkzLWdvb2cKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0CkxpbmFyby1tbS1zaWdAbGlzdHMu
bGluYXJvLm9yZwpodHRwczovL2xpc3RzLmxpbmFyby5vcmcvbWFpbG1hbi9saXN0aW5mby9saW5h
cm8tbW0tc2lnCg==
