Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id BA1971B6DBA
	for <lists+linaro-mm-sig@lfdr.de>; Fri, 24 Apr 2020 08:01:55 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D41C26601E
	for <lists+linaro-mm-sig@lfdr.de>; Fri, 24 Apr 2020 06:01:54 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id B38A8619EA; Fri, 24 Apr 2020 06:01:54 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-7.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_HI,SPF_HELO_NONE autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 9E4C7665D5;
	Fri, 24 Apr 2020 05:30:14 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id E78C4616DC
 for <linaro-mm-sig@lists.linaro.org>; Tue, 14 Apr 2020 13:14:43 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id DA5BD66048; Tue, 14 Apr 2020 13:14:43 +0000 (UTC)
Received: from bombadil.infradead.org (bombadil.infradead.org
 [198.137.202.133])
 by lists.linaro.org (Postfix) with ESMTPS id B6DF2616DC
 for <linaro-mm-sig@lists.linaro.org>; Tue, 14 Apr 2020 13:14:40 +0000 (UTC)
Received: from [2001:4bb8:180:384b:c70:4a89:bc61:2] (helo=localhost)
 by bombadil.infradead.org with esmtpsa (Exim 4.92.3 #3 (Red Hat Linux))
 id 1jOLOG-0006SH-MB; Tue, 14 Apr 2020 13:14:13 +0000
From: Christoph Hellwig <hch@lst.de>
To: Andrew Morton <akpm@linux-foundation.org>,
 "K. Y. Srinivasan" <kys@microsoft.com>,
 Haiyang Zhang <haiyangz@microsoft.com>,
 Stephen Hemminger <sthemmin@microsoft.com>, Wei Liu <wei.liu@kernel.org>,
 x86@kernel.org, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel@ffwll.ch>, Laura Abbott <labbott@redhat.com>,
 Sumit Semwal <sumit.semwal@linaro.org>,
 Sakari Ailus <sakari.ailus@linux.intel.com>,
 Minchan Kim <minchan@kernel.org>, Nitin Gupta <ngupta@vflare.org>
Date: Tue, 14 Apr 2020 15:13:25 +0200
Message-Id: <20200414131348.444715-7-hch@lst.de>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20200414131348.444715-1-hch@lst.de>
References: <20200414131348.444715-1-hch@lst.de>
MIME-Version: 1.0
X-SRS-Rewrite: SMTP reverse-path rewritten from <hch@infradead.org> by
 bombadil.infradead.org. See http://www.infradead.org/rpr.html
X-Virus-Scanned: ClamAV using ClamSMTP
X-Mailman-Approved-At: Fri, 24 Apr 2020 05:29:38 +0000
Cc: Christophe Leroy <christophe.leroy@c-s.fr>, linux-arch@vger.kernel.org,
 linux-hyperv@vger.kernel.org, linux-s390@vger.kernel.org,
 Peter Zijlstra <peterz@infradead.org>, linuxppc-dev@lists.ozlabs.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linaro-mm-sig@lists.linaro.org, linux-mm@kvack.org,
 iommu@lists.linux-foundation.org, bpf@vger.kernel.org,
 Robin Murphy <robin.murphy@arm.com>, linux-arm-kernel@lists.infradead.org
Subject: [Linaro-mm-sig] [PATCH 06/29] powerpc: add an ioremap_phb helper
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RmFjdG9yIGNvZGUgc2hhcmVkIGJldHdlZW4gcGNpXzY0IGFuZCBlbGVjdHJhX2NmIGludG8gYSBp
b3JlbWFwX3BiaApoZWxwZXIgdGhhdCBmb2xsb3dzIHRoZSBub3JtYWwgaW9yZW1hcCBzZW1hbnRp
Y3MsIGFuZCByZXR1cm5zIGEKdXNlZnVsIF9faW9tZW0gcG9pbnRlci4gIE5vdGUgdGhhdCBpdCBv
cGVuY29kZXMgX19pb3JlbWFwX2F0IGFzCndlIGtub3cgZnJvbSB0aGUgY2FsbGVycyB0aGUgc2xh
YiBpcyBhdmFpbGFibGUuICBTd2l0Y2ggcGNpXzY0CnRvIGFsc28gc3RvcmUgdGhlIHJlc3VsdCBh
cyBfX2lvbWVtIHBvaW50ZXIsIGFuZCB1bm1hcCB0aGUgcmVzdWx0CnVzaW5nIGlvdW5tYXAgaW5z
dGVhZCBvZiBmb3JjZSBjYXN0aW5nIGFuZCB1c2luZyB2bWFsbG9jIEFQSXMuCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpc3RvcGggSGVsbHdpZyA8aGNoQGxzdC5kZT4KQWNrZWQtYnk6IFBldGVyIFppamxz
dHJhIChJbnRlbCkgPHBldGVyekBpbmZyYWRlYWQub3JnPgotLS0KIGFyY2gvcG93ZXJwYy9pbmNs
dWRlL2FzbS9pby5oICAgICAgICAgfCAgMiArCiBhcmNoL3Bvd2VycGMvaW5jbHVkZS9hc20vcGNp
LWJyaWRnZS5oIHwgIDIgKy0KIGFyY2gvcG93ZXJwYy9rZXJuZWwvcGNpXzY0LmMgICAgICAgICAg
fCA1MyArKysrKysrKysrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvcGNtY2lhL2VsZWN0cmFf
Y2YuYyAgICAgICAgICAgfCA0NSArKysrKysrKy0tLS0tLS0tLS0tLS0tLQogNCBmaWxlcyBjaGFu
Z2VkLCA1NCBpbnNlcnRpb25zKCspLCA0OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9hcmNo
L3Bvd2VycGMvaW5jbHVkZS9hc20vaW8uaCBiL2FyY2gvcG93ZXJwYy9pbmNsdWRlL2FzbS9pby5o
CmluZGV4IDYzNTk2OWI1YjU4ZS4uOTEzMjA5ODVkMzNmIDEwMDY0NAotLS0gYS9hcmNoL3Bvd2Vy
cGMvaW5jbHVkZS9hc20vaW8uaAorKysgYi9hcmNoL3Bvd2VycGMvaW5jbHVkZS9hc20vaW8uaApA
QCAtNzE5LDYgKzcxOSw4IEBAIHZvaWQgX19pb21lbSAqaW9yZW1hcF9jb2hlcmVudChwaHlzX2Fk
ZHJfdCBhZGRyZXNzLCB1bnNpZ25lZCBsb25nIHNpemUpOwogCiBleHRlcm4gdm9pZCBpb3VubWFw
KHZvbGF0aWxlIHZvaWQgX19pb21lbSAqYWRkcik7CiAKK3ZvaWQgX19pb21lbSAqaW9yZW1hcF9w
aGIocGh5c19hZGRyX3QgcGFkZHIsIHVuc2lnbmVkIGxvbmcgc2l6ZSk7CisKIGludCBlYXJseV9p
b3JlbWFwX3JhbmdlKHVuc2lnbmVkIGxvbmcgZWEsIHBoeXNfYWRkcl90IHBhLAogCQkJdW5zaWdu
ZWQgbG9uZyBzaXplLCBwZ3Byb3RfdCBwcm90KTsKIHZvaWQgX19pb21lbSAqZG9faW9yZW1hcChw
aHlzX2FkZHJfdCBwYSwgcGh5c19hZGRyX3Qgb2Zmc2V0LCB1bnNpZ25lZCBsb25nIHNpemUsCmRp
ZmYgLS1naXQgYS9hcmNoL3Bvd2VycGMvaW5jbHVkZS9hc20vcGNpLWJyaWRnZS5oIGIvYXJjaC9w
b3dlcnBjL2luY2x1ZGUvYXNtL3BjaS1icmlkZ2UuaAppbmRleCA2OWY0Y2IzYjdjNTYuLmI5MmU4
MWIyNTZlNSAxMDA2NDQKLS0tIGEvYXJjaC9wb3dlcnBjL2luY2x1ZGUvYXNtL3BjaS1icmlkZ2Uu
aAorKysgYi9hcmNoL3Bvd2VycGMvaW5jbHVkZS9hc20vcGNpLWJyaWRnZS5oCkBAIC02Niw3ICs2
Niw3IEBAIHN0cnVjdCBwY2lfY29udHJvbGxlciB7CiAKIAl2b2lkIF9faW9tZW0gKmlvX2Jhc2Vf
dmlydDsKICNpZmRlZiBDT05GSUdfUFBDNjQKLQl2b2lkICppb19iYXNlX2FsbG9jOworCXZvaWQg
X19pb21lbSAqaW9fYmFzZV9hbGxvYzsKICNlbmRpZgogCXJlc291cmNlX3NpemVfdCBpb19iYXNl
X3BoeXM7CiAJcmVzb3VyY2Vfc2l6ZV90IHBjaV9pb19zaXplOwpkaWZmIC0tZ2l0IGEvYXJjaC9w
b3dlcnBjL2tlcm5lbC9wY2lfNjQuYyBiL2FyY2gvcG93ZXJwYy9rZXJuZWwvcGNpXzY0LmMKaW5k
ZXggZjgzZDFmNjliMWRkLi4yYTk3NjMxNGYxNjkgMTAwNjQ0Ci0tLSBhL2FyY2gvcG93ZXJwYy9r
ZXJuZWwvcGNpXzY0LmMKKysrIGIvYXJjaC9wb3dlcnBjL2tlcm5lbC9wY2lfNjQuYwpAQCAtMTA5
LDIzICsxMDksNDYgQEAgaW50IHBjaWJpb3NfdW5tYXBfaW9fc3BhY2Uoc3RydWN0IHBjaV9idXMg
KmJ1cykKIAkvKiBHZXQgdGhlIGhvc3QgYnJpZGdlICovCiAJaG9zZSA9IHBjaV9idXNfdG9faG9z
dChidXMpOwogCi0JLyogQ2hlY2sgaWYgd2UgaGF2ZSBJT3MgYWxsb2NhdGVkICovCi0JaWYgKGhv
c2UtPmlvX2Jhc2VfYWxsb2MgPT0gTlVMTCkKLQkJcmV0dXJuIDA7Ci0KIAlwcl9kZWJ1ZygiSU8g
dW5tYXBwaW5nIGZvciBQSEIgJXBPRlxuIiwgaG9zZS0+ZG4pOwogCXByX2RlYnVnKCIgIGFsbG9j
PTB4JXBcbiIsIGhvc2UtPmlvX2Jhc2VfYWxsb2MpOwogCi0JLyogVGhpcyBpcyBhIFBIQiwgd2Ug
ZnVsbHkgdW5tYXAgdGhlIElPIGFyZWEgKi8KLQl2dW5tYXAoaG9zZS0+aW9fYmFzZV9hbGxvYyk7
Ci0KKwlpb3VubWFwKGhvc2UtPmlvX2Jhc2VfYWxsb2MpOwogCXJldHVybiAwOwogfQogRVhQT1JU
X1NZTUJPTF9HUEwocGNpYmlvc191bm1hcF9pb19zcGFjZSk7CiAKLXN0YXRpYyBpbnQgcGNpYmlv
c19tYXBfcGhiX2lvX3NwYWNlKHN0cnVjdCBwY2lfY29udHJvbGxlciAqaG9zZSkKK3ZvaWQgX19p
b21lbSAqaW9yZW1hcF9waGIocGh5c19hZGRyX3QgcGFkZHIsIHVuc2lnbmVkIGxvbmcgc2l6ZSkK
IHsKIAlzdHJ1Y3Qgdm1fc3RydWN0ICphcmVhOworCXVuc2lnbmVkIGxvbmcgYWRkcjsKKworCVdB
Uk5fT05fT05DRShwYWRkciAmIH5QQUdFX01BU0spOworCVdBUk5fT05fT05DRShzaXplICYgflBB
R0VfTUFTSyk7CisKKwkvKgorCSAqIExldCdzIGFsbG9jYXRlIHNvbWUgSU8gc3BhY2UgZm9yIHRo
YXQgZ3V5LiBXZSBkb24ndCBwYXNzIFZNX0lPUkVNQVAKKwkgKiBiZWNhdXNlIHdlIGRvbid0IGNh
cmUgYWJvdXQgYWxpZ25tZW50IHRyaWNrcyB0aGF0IHRoZSBjb3JlIGRvZXMgaW4KKwkgKiB0aGF0
IGNhc2UuICBNYXliZSB3ZSBzaG91bGQgZHVlIHRvIHN0dXBpZCBjYXJkIHdpdGggaW5jb21wbGV0
ZQorCSAqIGFkZHJlc3MgZGVjb2RpbmcgYnV0IEknZCByYXRoZXIgbm90IGRlYWwgd2l0aCB0aG9z
ZSBvdXRzaWRlIG9mIHRoZQorCSAqIHJlc2VydmVkIDY0SyBsZWdhY3kgcmVnaW9uLgorCSAqLwor
CWFyZWEgPSBfX2dldF92bV9hcmVhKHNpemUsIDAsIFBIQl9JT19CQVNFLCBQSEJfSU9fRU5EKTsK
KwlpZiAoIWFyZWEpCisJCXJldHVybiBOVUxMOworCisJYWRkciA9ICh1bnNpZ25lZCBsb25nKWFy
ZWEtPmFkZHI7CisJaWYgKGlvcmVtYXBfcGFnZV9yYW5nZShhZGRyLCBhZGRyICsgc2l6ZSwgcGFk
ZHIsCisJCQlwZ3Byb3Rfbm9uY2FjaGVkKFBBR0VfS0VSTkVMKSkpIHsKKwkJdW5tYXBfa2VybmVs
X3JhbmdlKGFkZHIsIHNpemUpOworCQlyZXR1cm4gTlVMTDsKKwl9CisKKwlyZXR1cm4gKHZvaWQg
X19pb21lbSAqKWFkZHI7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChpb3JlbWFwX3BoYik7CisKK3N0
YXRpYyBpbnQgcGNpYmlvc19tYXBfcGhiX2lvX3NwYWNlKHN0cnVjdCBwY2lfY29udHJvbGxlciAq
aG9zZSkKK3sKIAl1bnNpZ25lZCBsb25nIHBoeXNfcGFnZTsKIAl1bnNpZ25lZCBsb25nIHNpemVf
cGFnZTsKIAl1bnNpZ25lZCBsb25nIGlvX3ZpcnRfb2Zmc2V0OwpAQCAtMTQ2LDEyICsxNjksMTEg
QEAgc3RhdGljIGludCBwY2liaW9zX21hcF9waGJfaW9fc3BhY2Uoc3RydWN0IHBjaV9jb250cm9s
bGVyICpob3NlKQogCSAqIHdpdGggaW5jb21wbGV0ZSBhZGRyZXNzIGRlY29kaW5nIGJ1dCBJJ2Qg
cmF0aGVyIG5vdCBkZWFsIHdpdGgKIAkgKiB0aG9zZSBvdXRzaWRlIG9mIHRoZSByZXNlcnZlZCA2
NEsgbGVnYWN5IHJlZ2lvbi4KIAkgKi8KLQlhcmVhID0gX19nZXRfdm1fYXJlYShzaXplX3BhZ2Us
IDAsIFBIQl9JT19CQVNFLCBQSEJfSU9fRU5EKTsKLQlpZiAoYXJlYSA9PSBOVUxMKQorCWhvc2Ut
PmlvX2Jhc2VfYWxsb2MgPSBpb3JlbWFwX3BoYihwaHlzX3BhZ2UsIHNpemVfcGFnZSk7CisJaWYg
KCFob3NlLT5pb19iYXNlX2FsbG9jKQogCQlyZXR1cm4gLUVOT01FTTsKLQlob3NlLT5pb19iYXNl
X2FsbG9jID0gYXJlYS0+YWRkcjsKLQlob3NlLT5pb19iYXNlX3ZpcnQgPSAodm9pZCBfX2lvbWVt
ICopKGFyZWEtPmFkZHIgKwotCQkJCQkgICAgICBob3NlLT5pb19iYXNlX3BoeXMgLSBwaHlzX3Bh
Z2UpOworCWhvc2UtPmlvX2Jhc2VfdmlydCA9IGhvc2UtPmlvX2Jhc2VfYWxsb2MgKworCQkJCWhv
c2UtPmlvX2Jhc2VfcGh5cyAtIHBoeXNfcGFnZTsKIAogCXByX2RlYnVnKCJJTyBtYXBwaW5nIGZv
ciBQSEIgJXBPRlxuIiwgaG9zZS0+ZG4pOwogCXByX2RlYnVnKCIgIHBoeXM9MHglMDE2bGx4LCB2
aXJ0PTB4JXAgKGFsbG9jPTB4JXApXG4iLApAQCAtMTU5LDExICsxODEsNiBAQCBzdGF0aWMgaW50
IHBjaWJpb3NfbWFwX3BoYl9pb19zcGFjZShzdHJ1Y3QgcGNpX2NvbnRyb2xsZXIgKmhvc2UpCiAJ
cHJfZGVidWcoIiAgc2l6ZT0weCUwMTZsbHggKGFsbG9jPTB4JTAxNmx4KVxuIiwKIAkJIGhvc2Ut
PnBjaV9pb19zaXplLCBzaXplX3BhZ2UpOwogCi0JLyogRXN0YWJsaXNoIHRoZSBtYXBwaW5nICov
Ci0JaWYgKF9faW9yZW1hcF9hdChwaHlzX3BhZ2UsIGFyZWEtPmFkZHIsIHNpemVfcGFnZSwKLQkJ
CSBwZ3Byb3Rfbm9uY2FjaGVkKFBBR0VfS0VSTkVMKSkgPT0gTlVMTCkKLQkJcmV0dXJuIC1FTk9N
RU07Ci0KIAkvKiBGaXh1cCBob3NlIElPIHJlc291cmNlICovCiAJaW9fdmlydF9vZmZzZXQgPSBw
Y2liaW9zX2lvX3NwYWNlX29mZnNldChob3NlKTsKIAlob3NlLT5pb19yZXNvdXJjZS5zdGFydCAr
PSBpb192aXJ0X29mZnNldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvcGNtY2lhL2VsZWN0cmFfY2Yu
YyBiL2RyaXZlcnMvcGNtY2lhL2VsZWN0cmFfY2YuYwppbmRleCBmMjc0MWMwNDI4OWQuLjM1MTU4
Y2ZkOWMxYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9wY21jaWEvZWxlY3RyYV9jZi5jCisrKyBiL2Ry
aXZlcnMvcGNtY2lhL2VsZWN0cmFfY2YuYwpAQCAtMTc4LDEwICsxNzgsOSBAQCBzdGF0aWMgaW50
IGVsZWN0cmFfY2ZfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqb2ZkZXYpCiAJc3RydWN0
IGRldmljZV9ub2RlICpucCA9IG9mZGV2LT5kZXYub2Zfbm9kZTsKIAlzdHJ1Y3QgZWxlY3RyYV9j
Zl9zb2NrZXQgICAqY2Y7CiAJc3RydWN0IHJlc291cmNlIG1lbSwgaW87Ci0JaW50IHN0YXR1czsK
KwlpbnQgc3RhdHVzID0gLUVOT01FTTsKIAljb25zdCB1bnNpZ25lZCBpbnQgKnByb3A7CiAJaW50
IGVycjsKLQlzdHJ1Y3Qgdm1fc3RydWN0ICphcmVhOwogCiAJZXJyID0gb2ZfYWRkcmVzc190b19y
ZXNvdXJjZShucCwgMCwgJm1lbSk7CiAJaWYgKGVycikKQEAgLTIwMiwzMCArMjAxLDE5IEBAIHN0
YXRpYyBpbnQgZWxlY3RyYV9jZl9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpvZmRldikK
IAljZi0+bWVtX3BoeXMgPSBtZW0uc3RhcnQ7CiAJY2YtPm1lbV9zaXplID0gUEFHRV9BTElHTihy
ZXNvdXJjZV9zaXplKCZtZW0pKTsKIAljZi0+bWVtX2Jhc2UgPSBpb3JlbWFwKGNmLT5tZW1fcGh5
cywgY2YtPm1lbV9zaXplKTsKKwlpZiAoIWNmLT5tZW1fYmFzZSkKKwkJZ290byBvdXRfZnJlZV9j
ZjsKIAljZi0+aW9fc2l6ZSA9IFBBR0VfQUxJR04ocmVzb3VyY2Vfc2l6ZSgmaW8pKTsKLQotCWFy
ZWEgPSBfX2dldF92bV9hcmVhKGNmLT5pb19zaXplLCAwLCBQSEJfSU9fQkFTRSwgUEhCX0lPX0VO
RCk7Ci0JaWYgKGFyZWEgPT0gTlVMTCkgewotCQlzdGF0dXMgPSAtRU5PTUVNOwotCQlnb3RvIGZh
aWwxOwotCX0KLQotCWNmLT5pb192aXJ0ID0gKHZvaWQgX19pb21lbSAqKShhcmVhLT5hZGRyKTsK
KwljZi0+aW9fdmlydCA9IGlvcmVtYXBfcGhiKGlvLnN0YXJ0LCBjZi0+aW9fc2l6ZSk7CisJaWYg
KCFjZi0+aW9fdmlydCkKKwkJZ290byBvdXRfdW5tYXBfbWVtOwogCiAJY2YtPmdwaW9fYmFzZSA9
IGlvcmVtYXAoMHhmYzEwMzAwMCwgMHgxMDAwKTsKKwlpZiAoIWNmLT5ncGlvX2Jhc2UpCisJCWdv
dG8gb3V0X3VubWFwX3ZpcnQ7CiAJZGV2X3NldF9kcnZkYXRhKGRldmljZSwgY2YpOwogCi0JaWYg
KCFjZi0+bWVtX2Jhc2UgfHwgIWNmLT5pb192aXJ0IHx8ICFjZi0+Z3Bpb19iYXNlIHx8Ci0JICAg
IChfX2lvcmVtYXBfYXQoaW8uc3RhcnQsIGNmLT5pb192aXJ0LCBjZi0+aW9fc2l6ZSwKLQkJCSAg
cGdwcm90X25vbmNhY2hlZChQQUdFX0tFUk5FTCkpID09IE5VTEwpKSB7Ci0JCWRldl9lcnIoZGV2
aWNlLCAiY2FuJ3QgaW9yZW1hcCByYW5nZXNcbiIpOwotCQlzdGF0dXMgPSAtRU5PTUVNOwotCQln
b3RvIGZhaWwxOwotCX0KLQotCiAJY2YtPmlvX2Jhc2UgPSAodW5zaWduZWQgbG9uZyljZi0+aW9f
dmlydCAtIFZNQUxMT0NfRU5EOwotCiAJY2YtPmlvbWVtLnN0YXJ0ID0gKHVuc2lnbmVkIGxvbmcp
Y2YtPm1lbV9iYXNlOwogCWNmLT5pb21lbS5lbmQgPSAodW5zaWduZWQgbG9uZyljZi0+bWVtX2Jh
c2UgKyAobWVtLmVuZCAtIG1lbS5zdGFydCk7CiAJY2YtPmlvbWVtLmZsYWdzID0gSU9SRVNPVVJD
RV9NRU07CkBAIC0zMDUsMTQgKzI5MywxMyBAQCBzdGF0aWMgaW50IGVsZWN0cmFfY2ZfcHJvYmUo
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqb2ZkZXYpCiAJaWYgKGNmLT5pcnEpCiAJCWZyZWVfaXJx
KGNmLT5pcnEsIGNmKTsKIAotCWlmIChjZi0+aW9fdmlydCkKLQkJX19pb3VubWFwX2F0KGNmLT5p
b192aXJ0LCBjZi0+aW9fc2l6ZSk7Ci0JaWYgKGNmLT5tZW1fYmFzZSkKLQkJaW91bm1hcChjZi0+
bWVtX2Jhc2UpOwotCWlmIChjZi0+Z3Bpb19iYXNlKQotCQlpb3VubWFwKGNmLT5ncGlvX2Jhc2Up
OwotCWlmIChhcmVhKQotCQlkZXZpY2VfaW5pdF93YWtldXAoJm9mZGV2LT5kZXYsIDApOworCWlv
dW5tYXAoY2YtPmdwaW9fYmFzZSk7CitvdXRfdW5tYXBfdmlydDoKKwlkZXZpY2VfaW5pdF93YWtl
dXAoJm9mZGV2LT5kZXYsIDApOworCWlvdW5tYXAoY2YtPmlvX3ZpcnQpOworb3V0X3VubWFwX21l
bToKKwlpb3VubWFwKGNmLT5tZW1fYmFzZSk7CitvdXRfZnJlZV9jZjoKIAlrZnJlZShjZik7CiAJ
cmV0dXJuIHN0YXR1czsKIApAQCAtMzMwLDcgKzMxNyw3IEBAIHN0YXRpYyBpbnQgZWxlY3RyYV9j
Zl9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqb2ZkZXYpCiAJZnJlZV9pcnEoY2YtPmly
cSwgY2YpOwogCWRlbF90aW1lcl9zeW5jKCZjZi0+dGltZXIpOwogCi0JX19pb3VubWFwX2F0KGNm
LT5pb192aXJ0LCBjZi0+aW9fc2l6ZSk7CisJaW91bm1hcChjZi0+aW9fdmlydCk7CiAJaW91bm1h
cChjZi0+bWVtX2Jhc2UpOwogCWlvdW5tYXAoY2YtPmdwaW9fYmFzZSk7CiAJcmVsZWFzZV9tZW1f
cmVnaW9uKGNmLT5tZW1fcGh5cywgY2YtPm1lbV9zaXplKTsKLS0gCjIuMjUuMQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTGluYXJvLW1tLXNpZyBtYWls
aW5nIGxpc3QKTGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3JnCmh0dHBzOi8vbGlzdHMubGlu
YXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2xpbmFyby1tbS1zaWcK
