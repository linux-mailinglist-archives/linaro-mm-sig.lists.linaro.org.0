Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id E5A22382F41
	for <lists+linaro-mm-sig@lfdr.de>; Mon, 17 May 2021 16:13:58 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id E859061189
	for <lists+linaro-mm-sig@lfdr.de>; Mon, 17 May 2021 14:13:54 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id BC29A6114F; Mon, 17 May 2021 14:13:47 +0000 (UTC)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id ABB2560B8D;
	Mon, 17 May 2021 14:13:41 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id EB91E608ED
 for <linaro-mm-sig@lists.linaro.org>; Mon, 17 May 2021 14:11:40 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id E657160B35; Mon, 17 May 2021 14:11:40 +0000 (UTC)
Received: from mail-ed1-f51.google.com (mail-ed1-f51.google.com
 [209.85.208.51])
 by lists.linaro.org (Postfix) with ESMTPS id B257B60B82
 for <linaro-mm-sig@lists.linaro.org>; Mon, 17 May 2021 14:11:38 +0000 (UTC)
Received: by mail-ed1-f51.google.com with SMTP id b17so7127614ede.0
 for <linaro-mm-sig@lists.linaro.org>; Mon, 17 May 2021 07:11:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=M4hl9LkBgTDZNkghancY8GMhZ7O5I9+El9vsdiOcuPs=;
 b=fQYGVX27EksNkiUL50HJSzt8F8u/lV9cFzhRPdpd5WR+9YpLf14V14Yg8PaBENLd1P
 pZarVPKO5mUrblTT0gaA1JM9KrL6xbHyeIG8NeHvWN85qmUYyR83xug4NrLxK8bIFZN6
 oSdL9hSMrNIkUEFtdhu52rTM3qt1Q7tYDsF0HAeUYzxuEb8f4cB+zih720g3m9UjLu9A
 vkZsd0PHYL+EByTXUxtYoOLpaoQe+++VT0/eabIaFWHlNTFA0croe8msRC94XJqK4Ldl
 Qb0vU4fkohFG7kwj4AMHG3YFOflfyvjIAHogoWuS6s+twzFp4ObDQMIAoo0QXwG8OtYQ
 1ZDw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=M4hl9LkBgTDZNkghancY8GMhZ7O5I9+El9vsdiOcuPs=;
 b=HAU5v88peeKN04nmmCiXc3oQa4EBEl64DCcHNZ4fZ9W5gRJsclAmkx1zXN0TmI4q9Y
 Dw3Bzbclvgs8ffGM6b2yylMXWTsvtkgHxm2duLS07V967zYvQa11QVZ16aDI2JQlIlRz
 ZrVxfo/JQ1lnsXge8iz7Zc4CXEcFnMAUULBHbtaaZiVYg8jhaxtuvvc9FDDZkUaYXKGF
 6IJeAPO5aQRNrjEJS62u1QGOY04SZFk9PoLMnI0Di7cdhLRIW1RRG7Hn+QDCJpTu+9LF
 +mDcy0nMFOUJnCxnwUlVnJ0It/Nl4ws4KxAvH30bPyqrQdhnwFCyiB7vGeg3hbzQrWH9
 NRfg==
X-Gm-Message-State: AOAM531G2GnqTNxwVQtLXMlZakCG/aD5XtL6i0SzYB/Zk1MttOhecVrc
 LIxrXpAC3c7as87n5uE2R4A=
X-Google-Smtp-Source: ABdhPJwJxRiQ2VXhLfy1TnjKY0TKGbkjj5BbUI0wCivWgnx6HJdVqJ10imCzJ/2CcwMzRlk/cITgGA==
X-Received: by 2002:aa7:d9c8:: with SMTP id v8mr272876eds.186.1621260697774;
 Mon, 17 May 2021 07:11:37 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:1df4:c5b6:b8fd:3c4b])
 by smtp.gmail.com with ESMTPSA id b9sm2419624edt.71.2021.05.17.07.11.37
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 17 May 2021 07:11:37 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org,
	linaro-mm-sig@lists.linaro.org
Date: Mon, 17 May 2021 16:11:25 +0200
Message-Id: <20210517141129.2225-8-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210517141129.2225-1-christian.koenig@amd.com>
References: <20210517141129.2225-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Subject: [Linaro-mm-sig] [PATCH 07/11] dma-buf: add dma_resv_replace_shared
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Cc: daniel@ffwll.ch
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

VGhpcyBmdW5jdGlvbiBhbGxvd3MgdG8gcmVwbGFjZSBmZW5jZXMgZnJvbSB0aGUgc2hhcmVkIGZl
bmNlIGxpc3Qgd2hlbgp3ZSBjYW4gZ3VyYW50ZWUgdGhhdCB0aGUgb3BlcmF0aW9uIHJlcHJlc2Vu
dGVkIGJ5IHRoZSBvcmlnaW5hbCBmZW5jZSBoYXMKZmluaXNoZWQgb3Igbm8gYWNjZXNzZXMgdG8g
dGhlIHJlc291cmNlcyBwcm90ZWN0ZWQgYnkgdGhlIGRtYV9yZXN2Cm9iamVjdCBhbnkgbW9yZSB3
aGVuIHRoZSBuZXcgZmVuY2UgZmluaXNoZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2
bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9kbWEtYnVmL2RtYS1y
ZXN2LmMgICAgICAgICAgICAgICAgICAgIHwgMzggKysrKysrKysrKysrKysrCiAuLi4vZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAgfCA0NyArKy0tLS0tLS0tLS0tLS0t
LS0tCiBpbmNsdWRlL2xpbnV4L2RtYS1yZXN2LmggICAgICAgICAgICAgICAgICAgICAgfCAgMiAr
CiAzIGZpbGVzIGNoYW5nZWQsIDQ0IGluc2VydGlvbnMoKyksIDQzIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jIGIvZHJpdmVycy9kbWEtYnVmL2Rt
YS1yZXN2LmMKaW5kZXggNDlmM2MxMDA5ODIxLi41NzAzZTMyOGI4YWMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5j
CkBAIC0yODEsNiArMjgxLDQ0IEBAIHZvaWQgZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShzdHJ1
Y3QgZG1hX3Jlc3YgKm9iaiwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB9CiBFWFBPUlRfU1lN
Qk9MKGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2UpOwogCisvKioKKyAqIGRtYV9yZXN2X3JlcGxh
Y2Vfc2hhcmVkIC0gcmVwbGFjZSBzaGFyZWQgZmVuY2VzCisgKiBAb2JqOiB0aGUgcmVzZXJ2YXRp
b24gb2JqZWN0CisgKiBAY29udGV4dDogdGhlIGNvbnRleHQgb2YgdGhlIGZlbmNlcyB0byByZXBs
YWNlCisgKiBAZmVuY2U6IHRoZSBuZXcgZmVuY2UgdG8gdXNlIGluc3RlYWQKKyAqCisgKiBSZXBs
YWNlIGZlbmNlcyB3aXRoIGEgc3BlY2lmaWVkIGNvbnRleHQgd2l0aCBhIG5ldyBmZW5jZS4gT25s
eSB2YWxpZCBpZiB0aGUKKyAqIG9wZXJhdGlvbiByZXByZXNlbnRlZCBieSB0aGUgb3JpZ2luYWwg
ZmVuY2VzIGlzIGNvbXBsZXRlZCBvciBoYXMgbm8gbG9uZ2VyCisgKiBhY2Nlc3MgdG8gdGhlIHJl
c291cmNlcyBwcm90ZWN0ZWQgYnkgdGhlIGRtYV9yZXN2IG9iamVjdCB3aGVuIHRoZSBuZXcgZmVu
Y2UKKyAqIGNvbXBsZXRlcy4gVGFrZXMgdGhlIHJlZmVyZW5jZSB0byB0aGUgbmV3IGZlbmNlLgor
ICovCit2b2lkIGRtYV9yZXN2X3JlcGxhY2Vfc2hhcmVkKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCB1
aW50NjRfdCBjb250ZXh0LAorCQkJICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlz
dHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqbGlzdDsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWxpc3QgPSBk
bWFfcmVzdl9zaGFyZWQob2JqKTsKKwlpZiAoIWxpc3QpIHsKKwkJZG1hX2ZlbmNlX3B1dChmZW5j
ZSk7CisJCXJldHVybjsKKwl9CisKKwl3cml0ZV9zZXFjb3VudF9iZWdpbigmb2JqLT5zZXEpOwor
CWZvciAoaSA9IDA7IGkgPCBsaXN0LT5zaGFyZWRfY291bnQ7ICsraSkgeworCQlzdHJ1Y3QgZG1h
X2ZlbmNlICpvbGQgPSBkbWFfcmVzdl9saXN0X2ZlbmNlKG9iaiwgbGlzdCwgaSk7CisKKwkJaWYg
KG9sZC0+Y29udGV4dCAhPSBjb250ZXh0KQorCQkJY29udGludWU7CisKKwkJcmN1X2Fzc2lnbl9w
b2ludGVyKGxpc3QtPnNoYXJlZFtpXSwgZG1hX2ZlbmNlX2dldChmZW5jZSkpOworCQlkbWFfZmVu
Y2VfcHV0KG9sZCk7CisJfQorCXdyaXRlX3NlcWNvdW50X2VuZCgmb2JqLT5zZXEpOworCWRtYV9m
ZW5jZV9wdXQoZmVuY2UpOworfQorRVhQT1JUX1NZTUJPTChkbWFfcmVzdl9yZXBsYWNlX3NoYXJl
ZCk7CisKIC8qKgogICogZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UgLSBBZGQgYW4gZXhjbHVzaXZl
IGZlbmNlLgogICogQG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCmluZGV4IDg4ZGEwZTQwMDQw
Ni4uM2U1YTY4MWE1NDgyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9ncHV2bS5jCkBAIC0yMzgsNTMgKzIzOCwxNCBAQCB2b2lkIGFtZGdwdV9hbWRr
ZmRfdW5yZXNlcnZlX21lbW9yeV9saW1pdChzdHJ1Y3QgYW1kZ3B1X2JvICpibykKIHN0YXRpYyBp
bnQgYW1kZ3B1X2FtZGtmZF9yZW1vdmVfZXZpY3Rpb25fZmVuY2Uoc3RydWN0IGFtZGdwdV9ibyAq
Ym8sCiAJCQkJCXN0cnVjdCBhbWRncHVfYW1ka2ZkX2ZlbmNlICplZikKIHsKLQlzdHJ1Y3QgZG1h
X3Jlc3YgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAq
b2xkLCAqbmV3OwotCXVuc2lnbmVkIGludCBpLCBqLCBrOwotCiAJaWYgKCFlZikKIAkJcmV0dXJu
IC1FSU5WQUw7CiAKLQlvbGQgPSBkbWFfcmVzdl9zaGFyZWQocmVzdik7Ci0JaWYgKCFvbGQpCi0J
CXJldHVybiAwOwotCi0JbmV3ID0ga21hbGxvYyhzdHJ1Y3Rfc2l6ZShuZXcsIHNoYXJlZCwgb2xk
LT5zaGFyZWRfbWF4KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFuZXcpCi0JCXJldHVybiAtRU5PTUVN
OwotCi0JLyogR28gdGhyb3VnaCBhbGwgdGhlIHNoYXJlZCBmZW5jZXMgaW4gdGhlIHJlc2V2YXRp
b24gb2JqZWN0IGFuZCBzb3J0Ci0JICogdGhlIGludGVyZXN0aW5nIG9uZXMgdG8gdGhlIGVuZCBv
ZiB0aGUgbGlzdC4KKwkvKiBUT0RPOiBJbnN0ZWFkIG9mIGJsb2NrIGJlZm9yZSB3ZSBzaG91bGQg
dXNlIHRoZSBmZW5jZSBvZiB0aGUgcGFnZQorCSAqIHRhYmxlIHVwZGF0ZSBhbmQgVExCIGZsdXNo
IGhlcmUgZGlyZWN0bHkuCiAJICovCi0JZm9yIChpID0gMCwgaiA9IG9sZC0+c2hhcmVkX2NvdW50
LCBrID0gMDsgaSA8IG9sZC0+c2hhcmVkX2NvdW50OyArK2kpIHsKLQkJc3RydWN0IGRtYV9mZW5j
ZSAqZjsKLQotCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChvbGQtPnNoYXJlZFtpXSwK
LQkJCQkJICAgICAgZG1hX3Jlc3ZfaGVsZChyZXN2KSk7Ci0KLQkJaWYgKGYtPmNvbnRleHQgPT0g
ZWYtPmJhc2UuY29udGV4dCkKLQkJCVJDVV9JTklUX1BPSU5URVIobmV3LT5zaGFyZWRbLS1qXSwg
Zik7Ci0JCWVsc2UKLQkJCVJDVV9JTklUX1BPSU5URVIobmV3LT5zaGFyZWRbaysrXSwgZik7Ci0J
fQotCW5ldy0+c2hhcmVkX21heCA9IG9sZC0+c2hhcmVkX21heDsKLQluZXctPnNoYXJlZF9jb3Vu
dCA9IGs7Ci0KLQkvKiBJbnN0YWxsIHRoZSBuZXcgZmVuY2UgbGlzdCwgc2VxY291bnQgcHJvdmlk
ZXMgdGhlIGJhcnJpZXJzICovCi0Jd3JpdGVfc2VxY291bnRfYmVnaW4oJnJlc3YtPnNlcSk7Ci0J
UkNVX0lOSVRfUE9JTlRFUihyZXN2LT5mZW5jZSwgbmV3KTsKLQl3cml0ZV9zZXFjb3VudF9lbmQo
JnJlc3YtPnNlcSk7Ci0KLQkvKiBEcm9wIHRoZSByZWZlcmVuY2VzIHRvIHRoZSByZW1vdmVkIGZl
bmNlcyBvciBtb3ZlIHRoZW0gdG8gZWZfbGlzdCAqLwotCWZvciAoaSA9IGosIGsgPSAwOyBpIDwg
b2xkLT5zaGFyZWRfY291bnQ7ICsraSkgewotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmOwotCi0JCWYg
PSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG5ldy0+c2hhcmVkW2ldLAotCQkJCQkgICAgICBk
bWFfcmVzdl9oZWxkKHJlc3YpKTsKLQkJZG1hX2ZlbmNlX3B1dChmKTsKLQl9Ci0Ja2ZyZWVfcmN1
KG9sZCwgcmN1KTsKLQorCWRtYV9yZXN2X3JlcGxhY2Vfc2hhcmVkKGJvLT50Ym8uYmFzZS5yZXN2
LCBlZi0+YmFzZS5jb250ZXh0LAorCQkJCWRtYV9mZW5jZV9nZXRfc3R1YigpKTsKIAlyZXR1cm4g
MDsKIH0KIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9kbWEtcmVzdi5oIGIvaW5jbHVkZS9s
aW51eC9kbWEtcmVzdi5oCmluZGV4IDk4YWM2NmZlY2I3MS4uNzRiMjE3YjgyZjM5IDEwMDY0NAot
LS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1yZXN2LmgKKysrIGIvaW5jbHVkZS9saW51eC9kbWEtcmVz
di5oCkBAIC0yNjgsNiArMjY4LDggQEAgdm9pZCBkbWFfcmVzdl9pbml0KHN0cnVjdCBkbWFfcmVz
diAqb2JqKTsKIHZvaWQgZG1hX3Jlc3ZfZmluaShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaik7CiBpbnQg
ZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQoc3RydWN0IGRtYV9yZXN2ICpvYmosIHVuc2lnbmVkIGlu
dCBudW1fZmVuY2VzKTsKIHZvaWQgZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShzdHJ1Y3QgZG1h
X3Jlc3YgKm9iaiwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwordm9pZCBkbWFfcmVzdl9yZXBs
YWNlX3NoYXJlZChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgdWludDY0X3QgY29udGV4dCwKKwkJCSAg
ICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwogCiB2b2lkIGRtYV9yZXN2X2FkZF9leGNsX2Zl
bmNlKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKLS0g
CjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
TGluYXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QKTGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3Jn
Cmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2xpbmFyby1tbS1zaWcK
