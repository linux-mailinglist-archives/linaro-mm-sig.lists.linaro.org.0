Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id BF4CB5A69AA
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 30 Aug 2022 19:21:57 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 056313F5F3
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 30 Aug 2022 17:21:57 +0000 (UTC)
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
	by lists.linaro.org (Postfix) with ESMTPS id 654D13ED3D
	for <linaro-mm-sig@lists.linaro.org>; Tue, 30 Aug 2022 17:21:52 +0000 (UTC)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ams.source.kernel.org (Postfix) with ESMTPS id 832A7B81D18;
	Tue, 30 Aug 2022 17:21:51 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 5E494C433B5;
	Tue, 30 Aug 2022 17:21:48 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1661880109;
	bh=rWYNn6AX8qGZFR6CUEwmBFpxhkx5iTNWaMTbeQLzUWA=;
	h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
	b=TmwJY3CEBr0TAdiFuj9FsmLqyyRmgLYX24DLUTLkSgtzNDZhCq/pc95od/VYXSfYk
	 EFlweBeE0LD78dl6va4c9CDpqxtHt1c93tUXHwT3BoMFU6xIm5pkowkcDrSpG7ARDR
	 WrFfXPTX1a4zOYYK38sdWbO8drSYzGjrETuzEWGq3MYL98dlIil4zCjEgJX6R6xmJ7
	 MdsMfZr2ISK0IVIhb6v66Lv4EPU0UeGum6WXOajeQ+kbPzTPN2owB3bpVRBhPi47lG
	 ht1ZilOvGriiP2v0HAkxnexGUCuIoQbM9wT+J37ZunuFhEJccEc+n2Jw2di+AuReN1
	 hn21SPY/G/oYA==
From: Sasha Levin <sashal@kernel.org>
To: linux-kernel@vger.kernel.org,
	stable@vger.kernel.org
Date: Tue, 30 Aug 2022 13:21:21 -0400
Message-Id: <20220830172141.581086-4-sashal@kernel.org>
X-Mailer: git-send-email 2.35.1
In-Reply-To: <20220830172141.581086-1-sashal@kernel.org>
References: <20220830172141.581086-1-sashal@kernel.org>
MIME-Version: 1.0
X-stable: review
X-Patchwork-Hint: Ignore
Message-ID-Hash: QLBWGTMX7K2YCY3DWEJYH6VLM5HVSP2W
X-Message-ID-Hash: QLBWGTMX7K2YCY3DWEJYH6VLM5HVSP2W
X-MailFrom: sashal@kernel.org
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: Jeffy Chen <jeffy.chen@rock-chips.com>, =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>, Sasha Levin <sashal@kernel.org>, maarten.lankhorst@linux.intel.com, mripard@kernel.org, tzimmermann@suse.de, airlied@linux.ie, daniel@ffwll.ch, sumit.semwal@linaro.org, dri-devel@lists.freedesktop.org, linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH AUTOSEL 5.15 04/23] drm/gem: Fix GEM handle release errors
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/QLBWGTMX7K2YCY3DWEJYH6VLM5HVSP2W/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

RnJvbTogSmVmZnkgQ2hlbiA8amVmZnkuY2hlbkByb2NrLWNoaXBzLmNvbT4NCg0KWyBVcHN0cmVh
bSBjb21taXQgZWEyYWE5N2NhMzdhOTA0NGFkZTAwMWFlZjcxZGJjMDYzMThlOGQ0NCBdDQoNCkN1
cnJlbnRseSB3ZSBhcmUgYXNzdW1pbmcgYSBvbmUgdG8gb25lIG1hcHBpbmcgYmV0d2VlbiBkbWFi
dWYgYW5kDQpHRU0gaGFuZGxlIHdoZW4gcmVsZWFzaW5nIEdFTSBoYW5kbGVzLg0KDQpCdXQgdGhh
dCBpcyBub3QgYWx3YXlzIHRydWUsIHNpbmNlIHdlIHdvdWxkIGNyZWF0ZSBleHRyYSBoYW5kbGVz
IGZvciB0aGUNCkdFTSBvYmogaW4gY2FzZXMgbGlrZSBnZW1fb3BlbigpIGFuZCBnZXRmYnssMn0o
KS4NCg0KQSBzaW1pbGFyIGlzc3VlIHdhcyByZXBvcnRlZCBhdDoNCmh0dHBzOi8vbG9yZS5rZXJu
ZWwub3JnL2FsbC8yMDIxMTEwNTA4MzMwOC4zOTIxNTYtMS1qYXkueHVAcm9jay1jaGlwcy5jb20v
DQoNCkFub3RoZXIgcHJvYmxlbSBpcyB0aGF0IHRoZSBpbXBvcnRlZCBkbWFidWYgbWlnaHQgbm90
IGFsd2F5cyBoYXZlDQpnZW1fb2JqLT5kbWFfYnVmIHNldCwgd2hpY2ggd291bGQgY2F1c2UgbGVh
a3MgaW4NCmRybV9nZW1fcmVtb3ZlX3ByaW1lX2hhbmRsZXMoKS4NCg0KTGV0J3MgZml4IHRoZXNl
IGZvciBub3cgYnkgdXNpbmcgaGFuZGxlIHRvIGZpbmQgdGhlIGV4YWN0IG1hcCB0byByZW1vdmUu
DQoNClNpZ25lZC1vZmYtYnk6IEplZmZ5IENoZW4gPGplZmZ5LmNoZW5Acm9jay1jaGlwcy5jb20+
DQpSZXZpZXdlZC1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29t
Pg0KU2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQu
Y29tPg0KTGluazogaHR0cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lk
LzIwMjIwODE5MDcyODM0LjE3ODg4LTEtamVmZnkuY2hlbkByb2NrLWNoaXBzLmNvbQ0KU2lnbmVk
LW9mZi1ieTogU2FzaGEgTGV2aW4gPHNhc2hhbEBrZXJuZWwub3JnPg0KLS0tDQogZHJpdmVycy9n
cHUvZHJtL2RybV9nZW0uYyAgICAgIHwgMTcgKy0tLS0tLS0tLS0tLS0tLS0NCiBkcml2ZXJzL2dw
dS9kcm0vZHJtX2ludGVybmFsLmggfCAgNCArKy0tDQogZHJpdmVycy9ncHUvZHJtL2RybV9wcmlt
ZS5jICAgIHwgMjAgKysrKysrKysrKysrLS0tLS0tLS0NCiAzIGZpbGVzIGNoYW5nZWQsIDE1IGlu
c2VydGlvbnMoKyksIDI2IGRlbGV0aW9ucygtKQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMNCmluZGV4IDY0MTA1NjNh
OWNiNmYuLmRiZDE5YTM0YjUxN2IgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dl
bS5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jDQpAQCAtMTY3LDIxICsxNjcsNiBA
QCB2b2lkIGRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LA0KIH0NCiBFWFBPUlRfU1lNQk9MKGRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdCk7DQogDQot
c3RhdGljIHZvaWQNCi1kcm1fZ2VtX3JlbW92ZV9wcmltZV9oYW5kbGVzKHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbHApDQotew0KLQkvKg0KLQkgKiBOb3Rl
OiBvYmotPmRtYV9idWYgY2FuJ3QgZGlzYXBwZWFyIGFzIGxvbmcgYXMgd2Ugc3RpbGwgaG9sZCBh
DQotCSAqIGhhbmRsZSByZWZlcmVuY2UgaW4gb2JqLT5oYW5kbGVfY291bnQuDQotCSAqLw0KLQlt
dXRleF9sb2NrKCZmaWxwLT5wcmltZS5sb2NrKTsNCi0JaWYgKG9iai0+ZG1hX2J1Zikgew0KLQkJ
ZHJtX3ByaW1lX3JlbW92ZV9idWZfaGFuZGxlX2xvY2tlZCgmZmlscC0+cHJpbWUsDQotCQkJCQkJ
ICAgb2JqLT5kbWFfYnVmKTsNCi0JfQ0KLQltdXRleF91bmxvY2soJmZpbHAtPnByaW1lLmxvY2sp
Ow0KLX0NCi0NCiAvKioNCiAgKiBkcm1fZ2VtX29iamVjdF9oYW5kbGVfZnJlZSAtIHJlbGVhc2Ug
cmVzb3VyY2VzIGJvdW5kIHRvIHVzZXJzcGFjZSBoYW5kbGVzDQogICogQG9iajogR0VNIG9iamVj
dCB0byBjbGVhbiB1cC4NCkBAIC0yNTIsNyArMjM3LDcgQEAgZHJtX2dlbV9vYmplY3RfcmVsZWFz
ZV9oYW5kbGUoaW50IGlkLCB2b2lkICpwdHIsIHZvaWQgKmRhdGEpDQogCWlmIChvYmotPmZ1bmNz
LT5jbG9zZSkNCiAJCW9iai0+ZnVuY3MtPmNsb3NlKG9iaiwgZmlsZV9wcml2KTsNCiANCi0JZHJt
X2dlbV9yZW1vdmVfcHJpbWVfaGFuZGxlcyhvYmosIGZpbGVfcHJpdik7DQorCWRybV9wcmltZV9y
ZW1vdmVfYnVmX2hhbmRsZSgmZmlsZV9wcml2LT5wcmltZSwgaWQpOw0KIAlkcm1fdm1hX25vZGVf
cmV2b2tlKCZvYmotPnZtYV9ub2RlLCBmaWxlX3ByaXYpOw0KIA0KIAlkcm1fZ2VtX29iamVjdF9o
YW5kbGVfcHV0X3VubG9ja2VkKG9iaik7DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9pbnRlcm5hbC5oIGIvZHJpdmVycy9ncHUvZHJtL2RybV9pbnRlcm5hbC5oDQppbmRleCAxN2Yz
NTQ4YzhlZDI1Li5kMDVlNmE1YjY2ODczIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9pbnRlcm5hbC5oDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFsLmgNCkBAIC03
NCw4ICs3NCw4IEBAIGludCBkcm1fcHJpbWVfZmRfdG9faGFuZGxlX2lvY3RsKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsDQogDQogdm9pZCBkcm1fcHJpbWVfaW5pdF9maWxlX3By
aXZhdGUoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgKnByaW1lX2Zwcml2KTsNCiB2b2lk
IGRybV9wcmltZV9kZXN0cm95X2ZpbGVfcHJpdmF0ZShzdHJ1Y3QgZHJtX3ByaW1lX2ZpbGVfcHJp
dmF0ZSAqcHJpbWVfZnByaXYpOw0KLXZvaWQgZHJtX3ByaW1lX3JlbW92ZV9idWZfaGFuZGxlX2xv
Y2tlZChzdHJ1Y3QgZHJtX3ByaW1lX2ZpbGVfcHJpdmF0ZSAqcHJpbWVfZnByaXYsDQotCQkJCQlz
dHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1Zik7DQordm9pZCBkcm1fcHJpbWVfcmVtb3ZlX2J1Zl9oYW5k
bGUoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgKnByaW1lX2Zwcml2LA0KKwkJCQkgdWlu
dDMyX3QgaGFuZGxlKTsNCiANCiAvKiBkcm1fZHJ2LmMgKi8NCiBzdHJ1Y3QgZHJtX21pbm9yICpk
cm1fbWlub3JfYWNxdWlyZSh1bnNpZ25lZCBpbnQgbWlub3JfaWQpOw0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fcHJpbWUuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJpbWUuYw0K
aW5kZXggZDZjN2Y0ZjlhN2EyOS4uYTM1MDMxMGI2NWQ4OSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fcHJpbWUuYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9wcmltZS5jDQpA
QCAtMTg3LDI5ICsxODcsMzMgQEAgc3RhdGljIGludCBkcm1fcHJpbWVfbG9va3VwX2J1Zl9oYW5k
bGUoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgKnByaW1lX2ZwcmkNCiAJcmV0dXJuIC1F
Tk9FTlQ7DQogfQ0KIA0KLXZvaWQgZHJtX3ByaW1lX3JlbW92ZV9idWZfaGFuZGxlX2xvY2tlZChz
dHJ1Y3QgZHJtX3ByaW1lX2ZpbGVfcHJpdmF0ZSAqcHJpbWVfZnByaXYsDQotCQkJCQlzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hX2J1ZikNCit2b2lkIGRybV9wcmltZV9yZW1vdmVfYnVmX2hhbmRsZShzdHJ1
Y3QgZHJtX3ByaW1lX2ZpbGVfcHJpdmF0ZSAqcHJpbWVfZnByaXYsDQorCQkJCSB1aW50MzJfdCBo
YW5kbGUpDQogew0KIAlzdHJ1Y3QgcmJfbm9kZSAqcmI7DQogDQotCXJiID0gcHJpbWVfZnByaXYt
PmRtYWJ1ZnMucmJfbm9kZTsNCisJbXV0ZXhfbG9jaygmcHJpbWVfZnByaXYtPmxvY2spOw0KKw0K
KwlyYiA9IHByaW1lX2Zwcml2LT5oYW5kbGVzLnJiX25vZGU7DQogCXdoaWxlIChyYikgew0KIAkJ
c3RydWN0IGRybV9wcmltZV9tZW1iZXIgKm1lbWJlcjsNCiANCi0JCW1lbWJlciA9IHJiX2VudHJ5
KHJiLCBzdHJ1Y3QgZHJtX3ByaW1lX21lbWJlciwgZG1hYnVmX3JiKTsNCi0JCWlmIChtZW1iZXIt
PmRtYV9idWYgPT0gZG1hX2J1Zikgew0KKwkJbWVtYmVyID0gcmJfZW50cnkocmIsIHN0cnVjdCBk
cm1fcHJpbWVfbWVtYmVyLCBoYW5kbGVfcmIpOw0KKwkJaWYgKG1lbWJlci0+aGFuZGxlID09IGhh
bmRsZSkgew0KIAkJCXJiX2VyYXNlKCZtZW1iZXItPmhhbmRsZV9yYiwgJnByaW1lX2Zwcml2LT5o
YW5kbGVzKTsNCiAJCQlyYl9lcmFzZSgmbWVtYmVyLT5kbWFidWZfcmIsICZwcmltZV9mcHJpdi0+
ZG1hYnVmcyk7DQogDQotCQkJZG1hX2J1Zl9wdXQoZG1hX2J1Zik7DQorCQkJZG1hX2J1Zl9wdXQo
bWVtYmVyLT5kbWFfYnVmKTsNCiAJCQlrZnJlZShtZW1iZXIpOw0KLQkJCXJldHVybjsNCi0JCX0g
ZWxzZSBpZiAobWVtYmVyLT5kbWFfYnVmIDwgZG1hX2J1Zikgew0KKwkJCWJyZWFrOw0KKwkJfSBl
bHNlIGlmIChtZW1iZXItPmhhbmRsZSA8IGhhbmRsZSkgew0KIAkJCXJiID0gcmItPnJiX3JpZ2h0
Ow0KIAkJfSBlbHNlIHsNCiAJCQlyYiA9IHJiLT5yYl9sZWZ0Ow0KIAkJfQ0KIAl9DQorDQorCW11
dGV4X3VubG9jaygmcHJpbWVfZnByaXYtPmxvY2spOw0KIH0NCiANCiB2b2lkIGRybV9wcmltZV9p
bml0X2ZpbGVfcHJpdmF0ZShzdHJ1Y3QgZHJtX3ByaW1lX2ZpbGVfcHJpdmF0ZSAqcHJpbWVfZnBy
aXYpDQotLSANCjIuMzUuMQ0KDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpMaW5hcm8tbW0tc2lnIG1haWxpbmcgbGlzdCAtLSBsaW5hcm8tbW0tc2lnQGxp
c3RzLmxpbmFyby5vcmcKVG8gdW5zdWJzY3JpYmUgc2VuZCBhbiBlbWFpbCB0byBsaW5hcm8tbW0t
c2lnLWxlYXZlQGxpc3RzLmxpbmFyby5vcmcK
