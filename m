Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id BD47751747B
	for <lists+linaro-mm-sig@lfdr.de>; Mon,  2 May 2022 18:37:46 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D143448061
	for <lists+linaro-mm-sig@lfdr.de>; Mon,  2 May 2022 16:37:45 +0000 (UTC)
Received: from mail-wr1-f43.google.com (mail-wr1-f43.google.com [209.85.221.43])
	by lists.linaro.org (Postfix) with ESMTPS id 71EF73EE95
	for <linaro-mm-sig@lists.linaro.org>; Mon,  2 May 2022 16:37:31 +0000 (UTC)
Received: by mail-wr1-f43.google.com with SMTP id u3so20260293wrg.3
        for <linaro-mm-sig@lists.linaro.org>; Mon, 02 May 2022 09:37:31 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=IWKemcOrL+b0gDAZZafa8ch1M5o7lnyn/o46hmmWygU=;
        b=R03rLumujGEAhM8SwniCLQoHPy6kFAqVrw+ARLriiv2g9paPKv1HJ+UXOxaEV6Rmya
         IryHyZomNBs+p6BJAqENBZ6yG2HnabhAsecgLf4OBThsEKurj0EnP+v6ax9tjg6zbCDH
         /RFB4DiUPMaj7jS9K9VUN9mN79W5bEcNxBIzk13pjkyHGhT5dvm6oTg1kVYLioM6aPTP
         C9jPXj5uX5mAaxIzWIcLGHzK2OEuA8hSe9u2oSp3J5I4xEXnKCh9DV7IUFhJ3u4pbwPu
         lPZ8N8EApdAw+tvjkVgX3a/YY+EILJdse1eiuD/pNi0Etd6+jZ7NAe6IkF1ftEPAnrLD
         LBmQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=IWKemcOrL+b0gDAZZafa8ch1M5o7lnyn/o46hmmWygU=;
        b=PGq4KZ5W/jIWSbnMGjmc8PFje7cWYj/aObllPaBvJ3tBSXcxt9yg6l6U+CtZ5BrM++
         khLA/KqIlYROFQgE1xxKjMocLnzMzSMSAi4txpuMkniGoRyht2aSQNBk5a6TM+C3y2y2
         oqU2qoPIX8km6oZRP+j79s3YKYOqC7BZLM89RAX22mHKaegxU+oSR//hYhZatohOFZKH
         7r+YZFXlEuakGM5r4LN1I3KeZp/NvV0fPPwqSnE1E3GlPd27JbxFhRHF+3JlNrdpBdqW
         vOPaW2jE3QMBTCg70etYxzlaXpH6rhGXEGambtMkWZwhewJC/QYJUY14S/M3mY/nOcQv
         pu0g==
X-Gm-Message-State: AOAM530wFkfesxhwLldgoYD6tsCVYRfab0IQBUzjoIw6db3j+hnWH5Ho
	He8/TblsKgkzyIqgvh349NI=
X-Google-Smtp-Source: ABdhPJysH2Ctla10lLPUFGhMcYiY1T7Y2hl8wvbRHgqL7XSe78IEd9IooYntpUrILEjkqAF5FaqAlw==
X-Received: by 2002:a5d:4989:0:b0:20a:c907:2110 with SMTP id r9-20020a5d4989000000b0020ac9072110mr9936120wrq.476.1651509450429;
        Mon, 02 May 2022 09:37:30 -0700 (PDT)
Received: from able.fritz.box (p57b0b9e1.dip0.t-ipconnect.de. [87.176.185.225])
        by smtp.gmail.com with ESMTPSA id p14-20020adfaa0e000000b0020c5253d8f6sm7294694wrd.66.2022.05.02.09.37.29
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Mon, 02 May 2022 09:37:29 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
To: daniel@ffwll.ch,
	jason@jlekstrand.net,
	daniels@collabora.com,
	skhawaja@google.com,
	maad.aldabagh@amd.com,
	sergemetral@google.com,
	sumit.semwal@linaro.org,
	gustavo@padovan.org,
	Felix.Kuehling@amd.com,
	alexander.deucher@amd.com,
	tzimmermann@suse.de,
	tvrtko.ursulin@linux.intel.com,
	linux-media@vger.kernel.org,
	dri-devel@lists.freedesktop.org,
	linaro-mm-sig@lists.linaro.org
Date: Mon,  2 May 2022 18:37:09 +0200
Message-Id: <20220502163722.3957-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220502163722.3957-1-christian.koenig@amd.com>
References: <20220502163722.3957-1-christian.koenig@amd.com>
MIME-Version: 1.0
Message-ID-Hash: W6UWCSGGZAW5FL2AKO3KXFXFR2HLCNUT
X-Message-ID-Hash: W6UWCSGGZAW5FL2AKO3KXFXFR2HLCNUT
X-MailFrom: ckoenig.leichtzumerken@gmail.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH 02/15] dma-buf: introduce user fence support
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/W6UWCSGGZAW5FL2AKO3KXFXFR2HLCNUT/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

U3RhcnQgaW50cm9kdWNpbmcgYSBuZXcgcGFydCBvZiB0aGUgZnJhbWV3b3JrIGZvciBoYW5kbGlu
ZyB1c2VyIGZlbmNlcy4NCg0KSW4gc3RyaWN0IG9wcG9zaXRpb24gdG8gbm9ybWFsIGZlbmNlcyB1
c2VyIGZlbmNlcyBkb24ndCByZWxpYWJsZSBmaW5pc2ggaW4NCmEgZml4ZWQgYW1vdW50IG9mIHRp
bWUgYW5kIHRoZXJlZm9yZSBjYW4ndCBiZSB1c2VkIGFzIGRlcGVuZGVuY3kgaW4gbWVtb3J5DQpt
YW5hZ2VtZW50Lg0KDQpCZWNhdXNlIG9mIHRoaXMgdXNlciBmZW5jZXMgYXJlIG1hcmtlZCB3aXRo
IERNQV9GRU5DRV9GTEFHX1VTRVIuIExvY2tkZXANCmlzIGNoZWNrZWQgdGhhdCB3ZSBjYW4gYXQg
bGVhc3QgZmF1bHQgdXNlciBwYWdlcyB3aGVuIHdlIGNoZWNrIHRoZW0gZm9yDQpzaWduYWxpbmcu
DQoNClRoaXMgcGF0Y2ggYWxzbyBhZGRzIGEgZmxhZyB0byBkbWFfZmVuY2VfZ2V0X3N0dWIoKSBz
byB0aGF0IHdlIGNhbg0KcmV0cmlldmUgYSBzaWduYWxlZCB1c2VyIGZlbmNlLiBUaGlzIGNhbiBi
ZSB1c2VkIHRvZ2V0aGVyIHdpdGggbG9ja2RlcCB0bw0KdGVzdCB0aGUgaGFuZGxpbmcgaW4gY29k
ZSBwYXRoIHN1cHBvcnRpbmcgdXNlciBmZW5jZXMuDQoNClNpZ25lZC1vZmYtYnk6IENocmlzdGlh
biBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4NCi0tLQ0KIGRyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UtdW53cmFwLmMgICAgICAgICAgICB8ICA0ICstLQ0KIGRyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UuYyAgICAgICAgICAgICAgICAgICB8IDMxICsrKysrKysrKysrKy0tLS0tLS0N
CiBkcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLmMgICAgICAgICAgICAgICAgfCAgMiArLQ0K
IC4uLi9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jICB8ICAyICstDQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgICAgIHwgIDIgKy0NCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmluZy5jICAgICAgfCAgMiArLQ0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgICB8ICA0ICstLQ0KIGRy
aXZlcnMvZ3B1L2RybS9kcm1fc3luY29iai5jICAgICAgICAgICAgICAgICB8IDEwICsrKy0tLQ0K
IGluY2x1ZGUvbGludXgvZG1hLWZlbmNlLmggICAgICAgICAgICAgICAgICAgICB8IDE3ICsrKysr
KysrKy0NCiA5IGZpbGVzIGNoYW5nZWQsIDQ5IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygt
KQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS11bndyYXAuYyBiL2Ry
aXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UtdW53cmFwLmMNCmluZGV4IGM5YmVjYzc0ODk2ZC4uODdl
ZTJlZmNlZDEwIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS11bndyYXAu
Yw0KKysrIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS11bndyYXAuYw0KQEAgLTc2LDcgKzc2
LDcgQEAgc3RydWN0IGRtYV9mZW5jZSAqX19kbWFfZmVuY2VfbWVyZ2UodW5zaWduZWQgaW50IG51
bV9mZW5jZXMsDQogCX0NCiANCiAJaWYgKGNvdW50ID09IDApDQotCQlyZXR1cm4gZG1hX2ZlbmNl
X2dldF9zdHViKCk7DQorCQlyZXR1cm4gZG1hX2ZlbmNlX2dldF9zdHViKGZhbHNlKTsNCiANCiAJ
aWYgKGNvdW50ID4gSU5UX01BWCkNCiAJCXJldHVybiBOVUxMOw0KQEAgLTEyOSw3ICsxMjksNyBA
QCBzdHJ1Y3QgZG1hX2ZlbmNlICpfX2RtYV9mZW5jZV9tZXJnZSh1bnNpZ25lZCBpbnQgbnVtX2Zl
bmNlcywNCiAJfSB3aGlsZSAodG1wKTsNCiANCiAJaWYgKGNvdW50ID09IDApIHsNCi0JCXRtcCA9
IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJdG1wID0gZG1hX2ZlbmNlX2dldF9zdHViKGZhbHNl
KTsNCiAJCWdvdG8gcmV0dXJuX3RtcDsNCiAJfQ0KIA0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1h
LWJ1Zi9kbWEtZmVuY2UuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYw0KaW5kZXggMDY2
NDAwZWQ4ODQxLi41Mjg3M2Y1ZWFlYmEgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1h
LWZlbmNlLmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYw0KQEAgLTI2LDYgKzI2
LDcgQEAgRVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9zaWduYWxlZCk7DQogDQog
c3RhdGljIERFRklORV9TUElOTE9DSyhkbWFfZmVuY2Vfc3R1Yl9sb2NrKTsNCiBzdGF0aWMgc3Ry
dWN0IGRtYV9mZW5jZSBkbWFfZmVuY2Vfc3R1YjsNCitzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSBk
bWFfZmVuY2VfdXNlcl9zdHViOw0KIA0KIC8qDQogICogZmVuY2UgY29udGV4dCBjb3VudGVyOiBl
YWNoIGV4ZWN1dGlvbiBjb250ZXh0IHNob3VsZCBoYXZlIGl0cyBvd24NCkBAIC0xMjMsMjQgKzEy
NCwyOCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMgZG1hX2ZlbmNlX3N0dWJf
b3BzID0gew0KIA0KIC8qKg0KICAqIGRtYV9mZW5jZV9nZXRfc3R1YiAtIHJldHVybiBhIHNpZ25h
bGVkIGZlbmNlDQorICogQHVzZXI6IGlmIHRydWUgdGhlIHJldHVybmVkIGZlbmNlIGlzIGFuIHVz
ZXIgZmVuY2UNCiAgKg0KLSAqIFJldHVybiBhIHN0dWIgZmVuY2Ugd2hpY2ggaXMgYWxyZWFkeSBz
aWduYWxlZC4gVGhlIGZlbmNlJ3MNCi0gKiB0aW1lc3RhbXAgY29ycmVzcG9uZHMgdG8gdGhlIGZp
cnN0IHRpbWUgYWZ0ZXIgYm9vdCB0aGlzDQotICogZnVuY3Rpb24gaXMgY2FsbGVkLg0KKyAqIFJl
dHVybiBhIHN0dWIgZmVuY2Ugd2hpY2ggaXMgYWxyZWFkeSBzaWduYWxlZC4gVGhlIGZlbmNlJ3Mg
dGltZXN0YW1wDQorICogY29ycmVzcG9uZHMgdG8gdGhlIGZpcnN0IHRpbWUgYWZ0ZXIgYm9vdCB0
aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZC4gSWYgQHVzZXIgaXMNCisgKiB0cnVlIGFuIHVzZXIgZmVu
Y2UgaXMgcmV0dXJuZWQgd2hpY2ggY2FuIGJlIHVzZWQgd2l0aCBsb2NrZGVwIHRvIHRlc3QgdXNl
cg0KKyAqIGZlbmNlIHNhdmVuZXNzIGluIGEgY29kZSBwYXRoLg0KICAqLw0KLXN0cnVjdCBkbWFf
ZmVuY2UgKmRtYV9mZW5jZV9nZXRfc3R1Yih2b2lkKQ0KK3N0cnVjdCBkbWFfZmVuY2UgKmRtYV9m
ZW5jZV9nZXRfc3R1Yihib29sIHVzZXIpDQogew0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9
IHVzZXIgPyAmZG1hX2ZlbmNlX3N0dWIgOiAmZG1hX2ZlbmNlX3VzZXJfc3R1YjsNCisNCiAJc3Bp
bl9sb2NrKCZkbWFfZmVuY2Vfc3R1Yl9sb2NrKTsNCi0JaWYgKCFkbWFfZmVuY2Vfc3R1Yi5vcHMp
IHsNCi0JCWRtYV9mZW5jZV9pbml0KCZkbWFfZmVuY2Vfc3R1YiwNCi0JCQkgICAgICAgJmRtYV9m
ZW5jZV9zdHViX29wcywNCi0JCQkgICAgICAgJmRtYV9mZW5jZV9zdHViX2xvY2ssDQorCWlmICgh
ZmVuY2UtPm9wcykgew0KKwkJZG1hX2ZlbmNlX2luaXQoZmVuY2UsICZkbWFfZmVuY2Vfc3R1Yl9v
cHMsICZkbWFfZmVuY2Vfc3R1Yl9sb2NrLA0KIAkJCSAgICAgICAwLCAwKTsNCi0JCWRtYV9mZW5j
ZV9zaWduYWxfbG9ja2VkKCZkbWFfZmVuY2Vfc3R1Yik7DQorCQlpZiAodXNlcikNCisJCQlzZXRf
Yml0KERNQV9GRU5DRV9GTEFHX1VTRVIsICZmZW5jZS0+ZmxhZ3MpOw0KKwkJZG1hX2ZlbmNlX3Np
Z25hbF9sb2NrZWQoZmVuY2UpOw0KIAl9DQogCXNwaW5fdW5sb2NrKCZkbWFfZmVuY2Vfc3R1Yl9s
b2NrKTsNCiANCi0JcmV0dXJuIGRtYV9mZW5jZV9nZXQoJmRtYV9mZW5jZV9zdHViKTsNCisJcmV0
dXJuIGRtYV9mZW5jZV9nZXQoZmVuY2UpOw0KIH0NCiBFWFBPUlRfU1lNQk9MKGRtYV9mZW5jZV9n
ZXRfc3R1Yik7DQogDQpAQCAtNDk3LDggKzUwMiw5IEBAIGRtYV9mZW5jZV93YWl0X3RpbWVvdXQo
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIGJvb2wgaW50ciwgc2lnbmVkIGxvbmcgdGltZW91dCkN
CiAJCXJldHVybiAtRUlOVkFMOw0KIA0KIAltaWdodF9zbGVlcCgpOw0KLQ0KIAlfX2RtYV9mZW5j
ZV9taWdodF93YWl0KCk7DQorCWlmICh0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19VU0VSLCAmZmVu
Y2UtPmZsYWdzKSkNCisJCW1pZ2h0X2ZhdWx0KCk7DQogDQogCXRyYWNlX2RtYV9mZW5jZV93YWl0
X3N0YXJ0KGZlbmNlKTsNCiAJaWYgKGZlbmNlLT5vcHMtPndhaXQpDQpAQCAtODcwLDYgKzg3Niw5
IEBAIGRtYV9mZW5jZV93YWl0X2FueV90aW1lb3V0KHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZXMs
IHVpbnQzMl90IGNvdW50LA0KIAlmb3IgKGkgPSAwOyBpIDwgY291bnQ7ICsraSkgew0KIAkJc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBmZW5jZXNbaV07DQogDQorCQlpZiAodGVzdF9iaXQoRE1B
X0ZFTkNFX0ZMQUdfVVNFUiwgJmZlbmNlLT5mbGFncykpDQorCQkJbWlnaHRfZmF1bHQoKTsNCisN
CiAJCWNiW2ldLnRhc2sgPSBjdXJyZW50Ow0KIAkJaWYgKGRtYV9mZW5jZV9hZGRfY2FsbGJhY2so
ZmVuY2UsICZjYltpXS5iYXNlLA0KIAkJCQkJICAgZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdF9jYikp
IHsNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLmMgYi9kcml2ZXJz
L2RtYS1idWYvc3QtZG1hLWZlbmNlLmMNCmluZGV4IGM4YTEyZDdhZDcxYS4uNTBmNzU3Zjc1NjQ1
IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS5jDQorKysgYi9kcml2
ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLmMNCkBAIC00MTIsNyArNDEyLDcgQEAgc3RhdGljIGlu
dCB0ZXN0X3N0dWIodm9pZCAqYXJnKQ0KIAlpbnQgaTsNCiANCiAJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoZik7IGkrKykgew0KLQkJZltpXSA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJ
ZltpXSA9IGRtYV9mZW5jZV9nZXRfc3R1YigoaSAlIDIpID09IDEpOw0KIAkJaWYgKCFkbWFfZmVu
Y2VfaXNfc2lnbmFsZWQoZltpXSkpIHsNCiAJCQlwcl9lcnIoIk9idGFpbmVkIHVuc2lnbmFsZWQg
c3R1YiBmZW5jZSFcbiIpOw0KIAkJCWdvdG8gZXJyOw0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYw0KaW5kZXggNjRhYzRmOGY0OWJlLi41NDFj
NTk2MzVjMzQgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
YW1ka2ZkX2dwdXZtLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9h
bWRrZmRfZ3B1dm0uYw0KQEAgLTI2Myw3ICsyNjMsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9hbWRr
ZmRfcmVtb3ZlX2V2aWN0aW9uX2ZlbmNlKHN0cnVjdCBhbWRncHVfYm8gKmJvLA0KIAkvKiBUT0RP
OiBJbnN0ZWFkIG9mIGJsb2NrIGJlZm9yZSB3ZSBzaG91bGQgdXNlIHRoZSBmZW5jZSBvZiB0aGUg
cGFnZQ0KIAkgKiB0YWJsZSB1cGRhdGUgYW5kIFRMQiBmbHVzaCBoZXJlIGRpcmVjdGx5Lg0KIAkg
Ki8NCi0JcmVwbGFjZW1lbnQgPSBkbWFfZmVuY2VfZ2V0X3N0dWIoKTsNCisJcmVwbGFjZW1lbnQg
PSBkbWFfZmVuY2VfZ2V0X3N0dWIoZmFsc2UpOw0KIAlkbWFfcmVzdl9yZXBsYWNlX2ZlbmNlcyhi
by0+dGJvLmJhc2UucmVzdiwgZWYtPmJhc2UuY29udGV4dCwNCiAJCQkJcmVwbGFjZW1lbnQsIERN
QV9SRVNWX1VTQUdFX1JFQUQpOw0KIAlkbWFfZmVuY2VfcHV0KHJlcGxhY2VtZW50KTsNCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jDQppbmRleCBhMjhiNzk0N2EwMzQuLjk1ZWVh
YjUyN2NhOSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9j
cy5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYw0KQEAgLTEz
OTksNyArMTM5OSw3IEBAIGludCBhbWRncHVfY3NfZmVuY2VfdG9faGFuZGxlX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsDQogCQlyZXR1cm4gUFRSX0VSUihmZW5jZSk7
DQogDQogCWlmICghZmVuY2UpDQotCQlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJ
ZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3N0dWIoZmFsc2UpOw0KIA0KIAlzd2l0Y2ggKGluZm8tPmlu
LndoYXQpIHsNCiAJY2FzZSBBTURHUFVfRkVOQ0VfVE9fSEFORExFX0dFVF9TWU5DT0JKOg0KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yaW5nLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmluZy5jDQppbmRleCA3ZjMzYWU4N2NiNDEu
LjczMTY1ZjM4N2YzYiAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9yaW5nLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yaW5n
LmMNCkBAIC0xOTMsNyArMTkzLDcgQEAgaW50IGFtZGdwdV9yaW5nX2luaXQoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCiAJCWFkZXYtPnJpbmdz
W3JpbmctPmlkeF0gPSByaW5nOw0KIAkJcmluZy0+bnVtX2h3X3N1Ym1pc3Npb24gPSBzY2hlZF9o
d19zdWJtaXNzaW9uOw0KIAkJcmluZy0+c2NoZWRfc2NvcmUgPSBzY2hlZF9zY29yZTsNCi0JCXJp
bmctPnZtaWRfd2FpdCA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJcmluZy0+dm1pZF93YWl0
ID0gZG1hX2ZlbmNlX2dldF9zdHViKGZhbHNlKTsNCiAJCXIgPSBhbWRncHVfZmVuY2VfZHJpdmVy
X2luaXRfcmluZyhyaW5nKTsNCiAJCWlmIChyKQ0KIAkJCXJldHVybiByOw0KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMNCmluZGV4IDdlNWNjODMyMzMyOS4uZTVjOGU3MmE5NDg1
IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMNCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jDQpAQCAtMTY4OSw3ICsx
Njg5LDcgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGVfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwNCiAJfQ0KIA0KIAlpZiAoIXVubG9ja2VkICYmICFkbWFfZmVuY2VfaXNfc2ln
bmFsZWQodm0tPmxhc3RfdW5sb2NrZWQpKSB7DQotCQlzdHJ1Y3QgZG1hX2ZlbmNlICp0bXAgPSBk
bWFfZmVuY2VfZ2V0X3N0dWIoKTsNCisJCXN0cnVjdCBkbWFfZmVuY2UgKnRtcCA9IGRtYV9mZW5j
ZV9nZXRfc3R1YihmYWxzZSk7DQogDQogCQlhbWRncHVfYm9fZmVuY2Uodm0tPnJvb3QuYm8sIHZt
LT5sYXN0X3VubG9ja2VkLCB0cnVlKTsNCiAJCXN3YXAodm0tPmxhc3RfdW5sb2NrZWQsIHRtcCk7
DQpAQCAtMjkwNSw3ICsyOTA1LDcgQEAgaW50IGFtZGdwdV92bV9pbml0KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSkNCiAJZWxzZQ0KIAkJdm0tPnVwZGF0
ZV9mdW5jcyA9ICZhbWRncHVfdm1fc2RtYV9mdW5jczsNCiAJdm0tPmxhc3RfdXBkYXRlID0gTlVM
TDsNCi0Jdm0tPmxhc3RfdW5sb2NrZWQgPSBkbWFfZmVuY2VfZ2V0X3N0dWIoKTsNCisJdm0tPmxh
c3RfdW5sb2NrZWQgPSBkbWFfZmVuY2VfZ2V0X3N0dWIoZmFsc2UpOw0KIA0KIAltdXRleF9pbml0
KCZ2bS0+ZXZpY3Rpb25fbG9jayk7DQogCXZtLT5ldmljdGluZyA9IGZhbHNlOw0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fc3luY29iai5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9z
eW5jb2JqLmMNCmluZGV4IDdlNDhkY2QxYmVlNC4uNWE5NjFlYTkwYTM1IDEwMDY0NA0KLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2RybV9zeW5jb2JqLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1f
c3luY29iai5jDQpAQCAtMjU1LDcgKzI1NSw3IEBAIHN0YXRpYyB2b2lkIGRybV9zeW5jb2JqX2Zl
bmNlX2FkZF93YWl0KHN0cnVjdCBkcm1fc3luY29iaiAqc3luY29iaiwNCiAJCWRtYV9mZW5jZV9w
dXQoZmVuY2UpOw0KIAkJbGlzdF9hZGRfdGFpbCgmd2FpdC0+bm9kZSwgJnN5bmNvYmotPmNiX2xp
c3QpOw0KIAl9IGVsc2UgaWYgKCFmZW5jZSkgew0KLQkJd2FpdC0+ZmVuY2UgPSBkbWFfZmVuY2Vf
Z2V0X3N0dWIoKTsNCisJCXdhaXQtPmZlbmNlID0gZG1hX2ZlbmNlX2dldF9zdHViKGZhbHNlKTsN
CiAJfSBlbHNlIHsNCiAJCXdhaXQtPmZlbmNlID0gZmVuY2U7DQogCX0NCkBAIC00MTEsNyArNDEx
LDcgQEAgaW50IGRybV9zeW5jb2JqX2ZpbmRfZmVuY2Uoc3RydWN0IGRybV9maWxlICpmaWxlX3By
aXZhdGUsDQogCQkJICogc2lnbmFsbGVkLCB1c2UgYSBuZXcgZmVuY2UgaW5zdGVhZC4NCiAJCQkg
Ki8NCiAJCQlpZiAoISpmZW5jZSkNCi0JCQkJKmZlbmNlID0gZG1hX2ZlbmNlX2dldF9zdHViKCk7
DQorCQkJCSpmZW5jZSA9IGRtYV9mZW5jZV9nZXRfc3R1YihmYWxzZSk7DQogDQogCQkJZ290byBv
dXQ7DQogCQl9DQpAQCAtMTAwMCw3ICsxMDAwLDcgQEAgc3RhdGljIHZvaWQgc3luY29ial93YWl0
X3N5bmNvYmpfZnVuYyhzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5bmNvYmosDQogCQlkbWFfZmVuY2Vf
cHV0KGZlbmNlKTsNCiAJCXJldHVybjsNCiAJfSBlbHNlIGlmICghZmVuY2UpIHsNCi0JCXdhaXQt
PmZlbmNlID0gZG1hX2ZlbmNlX2dldF9zdHViKCk7DQorCQl3YWl0LT5mZW5jZSA9IGRtYV9mZW5j
ZV9nZXRfc3R1YihmYWxzZSk7DQogCX0gZWxzZSB7DQogCQl3YWl0LT5mZW5jZSA9IGZlbmNlOw0K
IAl9DQpAQCAtMTA2Nyw3ICsxMDY3LDcgQEAgc3RhdGljIHNpZ25lZCBsb25nIGRybV9zeW5jb2Jq
X2FycmF5X3dhaXRfdGltZW91dChzdHJ1Y3QgZHJtX3N5bmNvYmogKipzeW5jb2JqcywNCiAJCWlm
IChmZW5jZSkNCiAJCQllbnRyaWVzW2ldLmZlbmNlID0gZmVuY2U7DQogCQllbHNlDQotCQkJZW50
cmllc1tpXS5mZW5jZSA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJCWVudHJpZXNbaV0uZmVu
Y2UgPSBkbWFfZmVuY2VfZ2V0X3N0dWIoZmFsc2UpOw0KIA0KIAkJaWYgKChmbGFncyAmIERSTV9T
WU5DT0JKX1dBSVRfRkxBR1NfV0FJVF9BVkFJTEFCTEUpIHx8DQogCQkgICAgZG1hX2ZlbmNlX2lz
X3NpZ25hbGVkKGVudHJpZXNbaV0uZmVuY2UpKSB7DQpAQCAtMTQ3Miw3ICsxNDcyLDcgQEAgZHJt
X3N5bmNvYmpfdGltZWxpbmVfc2lnbmFsX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsDQogCX0NCiANCiAJZm9yIChpID0gMDsgaSA8IGFyZ3MtPmNvdW50X2hhbmRsZXM7
IGkrKykgew0KLQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3N0dWIo
KTsNCisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gZG1hX2ZlbmNlX2dldF9zdHViKGZhbHNl
KTsNCiANCiAJCWRybV9zeW5jb2JqX2FkZF9wb2ludChzeW5jb2Jqc1tpXSwgY2hhaW5zW2ldLA0K
IAkJCQkgICAgICBmZW5jZSwgcG9pbnRzW2ldKTsNCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4
L2RtYS1mZW5jZS5oIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaA0KaW5kZXggYWZlYTgyZWM1
OTQ2Li5iZTk2Njg3ZDMxZDggMTAwNjQ0DQotLS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS5o
DQorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS5oDQpAQCAtOTksNiArOTksMTYgQEAgZW51
bSBkbWFfZmVuY2VfZmxhZ19iaXRzIHsNCiAJRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULA0K
IAlETUFfRkVOQ0VfRkxBR19USU1FU1RBTVBfQklULA0KIAlETUFfRkVOQ0VfRkxBR19FTkFCTEVf
U0lHTkFMX0JJVCwNCisNCisJLyoqDQorCSAqIEBETUFfRkVOQ0VfRkxBR19VU0VSOg0KKwkgKg0K
KwkgKiBJbmRpY2F0ZXMgYW4gdXNlciBmZW5jZS4gVXNlciBmZW5jZXMgYXJlIG5vdCBndWFyYW50
ZWVkIHRvIHNpZ25hbCBpbg0KKwkgKiBhIGZpbml0ZSBhbW91bnQgb2YgdGltZS4gQmVjYXVzZSBv
ZiB0aGlzIGl0IGlzIG5vdCBhbGxvd2VkIHRvIHdhaXQgZm9yIHVzZXINCisJICogZmVuY2VzIHdp
dGggYW55IGxvY2sgaGVsZCBub3IgZGVwZW5kIHRoZSBzaWduYWxpbmcgb2Ygbm9uZSB1c2VyDQor
CSAqIGZlbmNlcyBvbiB0aGVtLg0KKwkgKi8NCisJRE1BX0ZFTkNFX0ZMQUdfVVNFUiwNCiAJRE1B
X0ZFTkNFX0ZMQUdfRFJJVkVSLCAvKiBtdXN0IGFsd2F5cyBiZSBsYXN0IG1lbWJlciAqLw0KIH07
DQogDQpAQCAtMzk4LDYgKzQwOCw4IEBAIHZvaWQgZG1hX2ZlbmNlX2VuYWJsZV9zd19zaWduYWxp
bmcoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOw0KIHN0YXRpYyBpbmxpbmUgYm9vbA0KIGRtYV9m
ZW5jZV9pc19zaWduYWxlZF9sb2NrZWQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpDQogew0KKwlX
QVJOX09OKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1VTRVIsICZmZW5jZS0+ZmxhZ3MpKTsNCisN
CiAJaWYgKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFn
cykpDQogCQlyZXR1cm4gdHJ1ZTsNCiANCkBAIC00MjgsNiArNDQwLDkgQEAgZG1hX2ZlbmNlX2lz
X3NpZ25hbGVkX2xvY2tlZChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkNCiBzdGF0aWMgaW5saW5l
IGJvb2wNCiBkbWFfZmVuY2VfaXNfc2lnbmFsZWQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpDQog
ew0KKwlpZiAodGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfVVNFUiwgJmZlbmNlLT5mbGFncykpDQor
CQltaWdodF9mYXVsdCgpOw0KKw0KIAlpZiAodGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFM
RURfQklULCAmZmVuY2UtPmZsYWdzKSkNCiAJCXJldHVybiB0cnVlOw0KIA0KQEAgLTU4Myw3ICs1
OTgsNyBAQCBzdGF0aWMgaW5saW5lIHNpZ25lZCBsb25nIGRtYV9mZW5jZV93YWl0KHN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlLCBib29sIGludHIpDQogCXJldHVybiByZXQgPCAwID8gcmV0IDogMDsN
CiB9DQogDQotc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX2dldF9zdHViKHZvaWQpOw0KK3N0
cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV9nZXRfc3R1Yihib29sIHVzZXIpOw0KIHN0cnVjdCBk
bWFfZmVuY2UgKmRtYV9mZW5jZV9hbGxvY2F0ZV9wcml2YXRlX3N0dWIodm9pZCk7DQogdTY0IGRt
YV9mZW5jZV9jb250ZXh0X2FsbG9jKHVuc2lnbmVkIG51bSk7DQogDQotLSANCjIuMjUuMQ0KDQpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpMaW5hcm8tbW0t
c2lnIG1haWxpbmcgbGlzdCAtLSBsaW5hcm8tbW0tc2lnQGxpc3RzLmxpbmFyby5vcmcKVG8gdW5z
dWJzY3JpYmUgc2VuZCBhbiBlbWFpbCB0byBsaW5hcm8tbW0tc2lnLWxlYXZlQGxpc3RzLmxpbmFy
by5vcmcK
