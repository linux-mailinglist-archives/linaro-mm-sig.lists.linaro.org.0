Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A5622CAA3D
	for <lists+linaro-mm-sig@lfdr.de>; Tue,  1 Dec 2020 18:54:17 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 5801E6653E
	for <lists+linaro-mm-sig@lfdr.de>; Tue,  1 Dec 2020 17:54:16 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id 4A48B6654F; Tue,  1 Dec 2020 17:54:16 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 9948666597;
	Tue,  1 Dec 2020 17:52:08 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 5702360BE0
 for <linaro-mm-sig@lists.linaro.org>; Tue,  1 Dec 2020 17:51:58 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 48F7166015; Tue,  1 Dec 2020 17:51:58 +0000 (UTC)
Received: from mail-pj1-f66.google.com (mail-pj1-f66.google.com
 [209.85.216.66])
 by lists.linaro.org (Postfix) with ESMTPS id 4641F60BE0
 for <linaro-mm-sig@lists.linaro.org>; Tue,  1 Dec 2020 17:51:55 +0000 (UTC)
Received: by mail-pj1-f66.google.com with SMTP id iq13so1678244pjb.3
 for <linaro-mm-sig@lists.linaro.org>; Tue, 01 Dec 2020 09:51:55 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=3unagI/0BHWWOJ0Y3ZMT8ueBfxzXn5Uqgna//GYokw0=;
 b=h/2himCB02sxSH2RbbSeYbcznYJkiWtPHTbqD2uh5aW/RB/i7fUWyF88h4O/9zllYe
 612qZeEdf76kWAv3XVsbhgCJ2vnPgmGSPGXkn3SIvIODvFcZr6j35DBteP2R2IyPNJDO
 j0Qcn/BTjouiIRbPPP/sX+k1nBBkUYK5boTS5RjGEBu3jLFYA4tz63Lvvfw76ELJAAIy
 jFMpzjbkXA4NPSBiNMbuqU7Dq0h1B8r5x+Md3/JGPIQB1mGeNon8GHlCWIv75MWW6Kpr
 isQmMigkywbwmKoEgqXLvLnLVOTVs8LMLMIdUs0Ska1Xy130Lx4P5/Muf7VtvjwLspiW
 Hmgg==
X-Gm-Message-State: AOAM5331shDr3/xk2efq9TQE31Dc/jVgHA4i+7RRuq0v5V3KtwR34C+E
 uCpHdDHQMSKbSDysP9ffHhA=
X-Google-Smtp-Source: ABdhPJxqGmkYiOGzCY2ozTIIBsCp1TH4bT3wdVU7dS7WQ+pQKlms2XBDjLXG6YKwvQKLj7CUH27h/Q==
X-Received: by 2002:a17:902:b905:b029:d8:ad03:8c93 with SMTP id
 bf5-20020a170902b905b02900d8ad038c93mr3958549plb.15.1606845114421; 
 Tue, 01 Dec 2020 09:51:54 -0800 (PST)
Received: from bbox-1.mtv.corp.google.com
 ([2620:15c:211:201:7220:84ff:fe09:5e58])
 by smtp.gmail.com with ESMTPSA id q23sm390082pfg.192.2020.12.01.09.51.52
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 01 Dec 2020 09:51:53 -0800 (PST)
From: Minchan Kim <minchan@kernel.org>
To: Andrew Morton <akpm@linux-foundation.org>
Date: Tue,  1 Dec 2020 09:51:42 -0800
Message-Id: <20201201175144.3996569-3-minchan@kernel.org>
X-Mailer: git-send-email 2.29.2.454.gaff20da3a2-goog
In-Reply-To: <20201201175144.3996569-1-minchan@kernel.org>
References: <20201201175144.3996569-1-minchan@kernel.org>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: robh@kernel.org, devicetree@vger.kernel.org, linux-media@vger.kernel.org,
 david@redhat.com, Minchan Kim <minchan@kernel.org>,
 LKML <linux-kernel@vger.kernel.org>, willy@infradead.org,
 Brian.Starkey@arm.com, linaro-mm-sig@lists.linaro.org,
 linux-mm <linux-mm@kvack.org>, john.stultz@linaro.org,
 christian.koenig@amd.com, joaodias@google.com, hridya@google.com,
 iamjoonsoo.kim@lge.com, pullip.cho@samsung.com, surenb@google.com,
 vbabka@suse.cz, hyesoo.yu@samsung.com
Subject: [Linaro-mm-sig] [PATCH v2 2/4] mm: introduce cma_alloc_bulk API
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

VGhlcmUgaXMgYSBuZWVkIGZvciBzcGVjaWFsIEhXIHRvIHJlcXVpcmUgYnVsayBhbGxvY2F0aW9u
IG9mCmhpZ2gtb3JkZXIgcGFnZXMuIEZvciBleGFtcGxlLCA0ODAwICogb3JkZXItNCBwYWdlcywg
d2hpY2gKd291bGQgYmUgbWluaW11bSwgc29tZXRpbWVzLCBpdCByZXF1aXJlcyBtb3JlLgoKVG8g
bWVldCB0aGUgcmVxdWlyZW1lbnQsIGEgb3B0aW9uIHJlc2VydmVzIDMwME0gQ01BIGFyZWEgYW5k
CnJlcXVlc3RzIHRoZSB3aG9sZSAzMDBNIGNvbnRpZ3VvdXMgbWVtb3J5LiBIb3dldmVyLCBpdCBk
b2Vzbid0CndvcmsgaWYgZXZlbiBvbmUgb2YgdGhvc2UgcGFnZXMgaW4gdGhlIHJhbmdlIGlzIGxv
bmctdGVybSBwaW5uZWQKZGlyZWN0bHkgb3IgaW5kaXJlY3RseS4gVGhlIG90aGVyIG9wdGlvbiBp
cyB0byBhc2sgaGlnaGVyLW9yZGVyCnNpemUgKGUuZy4sIDJNKSB0aGFuIHJlcXVlc3RlZCBvcmRl
cig2NEspIHJlcGVhdGVkbHkgdW50aWwgZHJpdmVyCmNvdWxkIGdhdGhlciBuZWNlc3NhcnkgYW1v
dW50IG9mIG1lbW9yeS4gQmFzaWNhbGx5LCB0aGlzIGFwcHJvYWNoCm1ha2VzIHRoZSBhbGxvY2F0
aW9uIHZlcnkgc2xvdyBkdWUgdG8gY21hX2FsbG9jJ3MgZnVuY3Rpb24Kc2xvd25lc3MgYW5kIGl0
IGNvdWxkIGJlIHN0dWNrIG9uIG9uZSBvZiB0aGUgcGFnZWJsb2NrcyBpZiBpdAplbmNvdW50ZXJz
IHVubWlncmF0YWJsZSBwYWdlLgoKVG8gc29sdmUgdGhlIGlzc3VlLCB0aGlzIHBhdGNoIGludHJv
ZHVjZXMgY21hX2FsbG9jX2J1bGsuCgoJaW50IGNtYV9hbGxvY19idWxrKHN0cnVjdCBjbWEgKmNt
YSwgdW5zaWduZWQgaW50IGFsaWduLAoJCWJvb2wgZmFzdCwgdW5zaWduZWQgaW50IG9yZGVyLCBz
aXplX3QgbnJfcmVxdWVzdHMsCgkJc3RydWN0IHBhZ2UgKipwYWdlX2FycmF5LCBzaXplX3QgKm5y
X2FsbG9jYXRlZCk7CgpNb3N0IHBhcmFtZXRlcnMgYXJlIHNhbWUgd2l0aCBjbWFfYWxsb2MgYnV0
IGl0IGFkZGl0aW9uYWxseSBwYXNzZXMKdmVjdG9yIGFycmF5IHRvIHN0b3JlIGFsbG9jYXRlZCBt
ZW1vcnkuIFdoYXQncyBkaWZmZXJlbnQgd2l0aCBjbWFfYWxsb2MKaXMgaXQgd2lsbCBza2lwIHBh
Z2VibG9ja3Mgd2l0aG91dCB3YWl0aW5nL3N0b3BwaW5nIGlmIGl0IGhhcyB1bm1vdmFibGUKcGFn
ZSBzbyB0aGF0IEFQSSBjb250aW51ZXMgdG8gc2NhbiBvdGhlciBwYWdlYmxvY2tzIHRvIGZpbmQg
cmVxdWVzdGVkCm9yZGVyIHBhZ2UuCgpjbWFfYWxsb2NfYnVsayBpcyBiZXN0IGVmZm9ydCBhcHBy
b2FjaCBpbiB0aGF0IGl0IHNraXBzIHNvbWUgcGFnZWJsb2NrcwppZiB0aGV5IGhhdmUgdW5tb3Zh
YmxlIHBhZ2VzIHVubGlrZSBjbWFfYWxsb2MuIEl0IGRvZXNuJ3QgbmVlZCB0byBiZQpwZXJmZWN0
IGZyb20gdGhlIGJlZ2lubmluZyBhdCB0aGUgY29zdCBvZiBwZXJmb3JtYW5jZS4gVGh1cywgdGhl
IEFQSQp0YWtlcyAiYm9vbCBmYXN0IHBhcmFtZXRlciIgd2hpY2ggaXMgcHJvcGFnYXRlZCBpbnRv
IGFsbG9jX2NvbnRpZ19yYW5nZSB0bwphdm9pZCBzaWduaWZpY2F0IG92ZXJoZWFkIGZ1bmN0aW9u
cyB0byBpbnJlY2FzZSBDTUEgYWxsb2NhdGlvbiBzdWNjZXNzCnJhdGlvKGUuZy4sIG1pZ3JhdGlv
biByZXRyaWFsLCBQQ1AsIExSVSBkcmFpbmluZyBwZXIgcGFnZWJsb2NrKQphdCB0aGUgY29zdCBv
ZiBsZXNzIGFsbG9jYXRpb24gc3VjY2VzcyByYXRpby4gSWYgdGhlIGNhbGxlciBjb3VsZG4ndAph
bGxvY2F0ZSBlbm91Z2gsIHRoZXkgY291bGQgY2FsbCBpdCB3aXRoICJmYWxzZSIgdG8gaW5jcmVh
c2Ugc3VjY2VzcyByYXRpbwppZiB0aGV5IGFyZSBva2F5IHRvIGV4cGVuc2UgdGhlIG92ZXJoZWFk
IGZvciB0aGUgc3VjY2VzcyByYXRpby4KClNpZ25lZC1vZmYtYnk6IE1pbmNoYW4gS2ltIDxtaW5j
aGFuQGtlcm5lbC5vcmc+Ci0tLQogaW5jbHVkZS9saW51eC9jbWEuaCB8ICAgNSArKwogaW5jbHVk
ZS9saW51eC9nZnAuaCB8ICAgMiArCiBtbS9jbWEuYyAgICAgICAgICAgIHwgMTI2ICsrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tCiBtbS9wYWdlX2FsbG9jLmMgICAg
IHwgIDE5ICsrKystLS0KIDQgZmlsZXMgY2hhbmdlZCwgMTQwIGluc2VydGlvbnMoKyksIDEyIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvY21hLmggYi9pbmNsdWRlL2xp
bnV4L2NtYS5oCmluZGV4IDIxNzk5OWM4YTc2Mi4uNzM3NWQzMTMxODA0IDEwMDY0NAotLS0gYS9p
bmNsdWRlL2xpbnV4L2NtYS5oCisrKyBiL2luY2x1ZGUvbGludXgvY21hLmgKQEAgLTQ2LDYgKzQ2
LDExIEBAIGV4dGVybiBpbnQgY21hX2luaXRfcmVzZXJ2ZWRfbWVtKHBoeXNfYWRkcl90IGJhc2Us
IHBoeXNfYWRkcl90IHNpemUsCiAJCQkJCXN0cnVjdCBjbWEgKipyZXNfY21hKTsKIGV4dGVybiBz
dHJ1Y3QgcGFnZSAqY21hX2FsbG9jKHN0cnVjdCBjbWEgKmNtYSwgc2l6ZV90IGNvdW50LCB1bnNp
Z25lZCBpbnQgYWxpZ24sCiAJCQkgICAgICBib29sIG5vX3dhcm4pOworCitleHRlcm4gaW50IGNt
YV9hbGxvY19idWxrKHN0cnVjdCBjbWEgKmNtYSwgdW5zaWduZWQgaW50IGFsaWduLCBib29sIGZh
c3QsCisJCQl1bnNpZ25lZCBpbnQgb3JkZXIsIHNpemVfdCBucl9yZXF1ZXN0cywKKwkJCXN0cnVj
dCBwYWdlICoqcGFnZV9hcnJheSwgc2l6ZV90ICpucl9hbGxvY2F0ZWQpOworCiBleHRlcm4gYm9v
bCBjbWFfcmVsZWFzZShzdHJ1Y3QgY21hICpjbWEsIGNvbnN0IHN0cnVjdCBwYWdlICpwYWdlcywg
dW5zaWduZWQgaW50IGNvdW50KTsKIAogZXh0ZXJuIGludCBjbWFfZm9yX2VhY2hfYXJlYShpbnQg
KCppdCkoc3RydWN0IGNtYSAqY21hLCB2b2lkICpkYXRhKSwgdm9pZCAqZGF0YSk7CmRpZmYgLS1n
aXQgYS9pbmNsdWRlL2xpbnV4L2dmcC5oIGIvaW5jbHVkZS9saW51eC9nZnAuaAppbmRleCBhZDU4
NzI2OTk2OTIuLjc1YmZiNjczZDc1YiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9nZnAuaAor
KysgYi9pbmNsdWRlL2xpbnV4L2dmcC5oCkBAIC02MjcsNiArNjI3LDggQEAgc3RhdGljIGlubGlu
ZSBib29sIHBtX3N1c3BlbmRlZF9zdG9yYWdlKHZvaWQpCiBlbnVtIGFsbG9jX2NvbnRpZ19tb2Rl
IHsKIAkvKiB0cnkgc2V2ZXJhbCB3YXlzIHRvIGluY3JlYXNlIHN1Y2Nlc3MgcmF0aW8gb2YgbWVt
b3J5IGFsbG9jYXRpb24gKi8KIAlBTExPQ19DT05USUdfTk9STUFMLAorCS8qIGF2b2lkIGNvc3Rs
eSBmdW5jdGlvbnMgdG8gbWFrZSB0aGUgY2FsbCBmYXN0ICovCisJQUxMT0NfQ09OVElHX0ZBU1Qs
CiB9OwogCiAvKiBUaGUgYmVsb3cgZnVuY3Rpb25zIG11c3QgYmUgcnVuIG9uIGEgcmFuZ2UgZnJv
bSBhIHNpbmdsZSB6b25lLiAqLwpkaWZmIC0tZ2l0IGEvbW0vY21hLmMgYi9tbS9jbWEuYwppbmRl
eCA4MDEwYzFiYTA0YjAuLjQ0NTkwNDVmYTcxNyAxMDA2NDQKLS0tIGEvbW0vY21hLmMKKysrIGIv
bW0vY21hLmMKQEAgLTMyLDYgKzMyLDcgQEAKICNpbmNsdWRlIDxsaW51eC9oaWdobWVtLmg+CiAj
aW5jbHVkZSA8bGludXgvaW8uaD4KICNpbmNsdWRlIDxsaW51eC9rbWVtbGVhay5oPgorI2luY2x1
ZGUgPGxpbnV4L3N3YXAuaD4KICNpbmNsdWRlIDx0cmFjZS9ldmVudHMvY21hLmg+CiAKICNpbmNs
dWRlICJjbWEuaCIKQEAgLTM5Nyw2ICszOTgsMTQgQEAgc3RhdGljIHZvaWQgY21hX2RlYnVnX3No
b3dfYXJlYXMoc3RydWN0IGNtYSAqY21hKQogc3RhdGljIGlubGluZSB2b2lkIGNtYV9kZWJ1Z19z
aG93X2FyZWFzKHN0cnVjdCBjbWEgKmNtYSkgeyB9CiAjZW5kaWYKIAorc3RhdGljIHZvaWQgcmVz
ZXRfcGFnZV9rYXNhbl90YWcoc3RydWN0IHBhZ2UgKnBhZ2UsIGludCBjb3VudCkKK3sKKwlpbnQg
aTsKKworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKQorCQlwYWdlX2thc2FuX3RhZ19yZXNl
dChwYWdlICsgaSk7Cit9CisKIC8qKgogICogY21hX2FsbG9jKCkgLSBhbGxvY2F0ZSBwYWdlcyBm
cm9tIGNvbnRpZ3VvdXMgYXJlYQogICogQGNtYTogICBDb250aWd1b3VzIG1lbW9yeSByZWdpb24g
Zm9yIHdoaWNoIHRoZSBhbGxvY2F0aW9uIGlzIHBlcmZvcm1lZC4KQEAgLTQxNCw3ICs0MjMsNiBA
QCBzdHJ1Y3QgcGFnZSAqY21hX2FsbG9jKHN0cnVjdCBjbWEgKmNtYSwgc2l6ZV90IGNvdW50LCB1
bnNpZ25lZCBpbnQgYWxpZ24sCiAJdW5zaWduZWQgbG9uZyBwZm4gPSAtMTsKIAl1bnNpZ25lZCBs
b25nIHN0YXJ0ID0gMDsKIAl1bnNpZ25lZCBsb25nIGJpdG1hcF9tYXhubywgYml0bWFwX25vLCBi
aXRtYXBfY291bnQ7Ci0Jc2l6ZV90IGk7CiAJc3RydWN0IHBhZ2UgKnBhZ2UgPSBOVUxMOwogCWlu
dCByZXQgPSAtRU5PTUVNOwogCkBAIC00NzksMTAgKzQ4Nyw4IEBAIHN0cnVjdCBwYWdlICpjbWFf
YWxsb2Moc3RydWN0IGNtYSAqY21hLCBzaXplX3QgY291bnQsIHVuc2lnbmVkIGludCBhbGlnbiwK
IAkgKiBibG9ja3MgYmVpbmcgbWFya2VkIHdpdGggZGlmZmVyZW50IHRhZ3MuIFJlc2V0IHRoZSB0
YWdzIHRvIGlnbm9yZQogCSAqIHRob3NlIHBhZ2UgYmxvY2tzLgogCSAqLwotCWlmIChwYWdlKSB7
Ci0JCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKQotCQkJcGFnZV9rYXNhbl90YWdfcmVzZXQo
cGFnZSArIGkpOwotCX0KKwlpZiAocGFnZSkKKwkJcmVzZXRfcGFnZV9rYXNhbl90YWcocGFnZSwg
Y291bnQpOwogCiAJaWYgKHJldCAmJiAhbm9fd2FybikgewogCQlwcl9lcnIoIiVzOiBhbGxvYyBm
YWlsZWQsIHJlcS1zaXplOiAlenUgcGFnZXMsIHJldDogJWRcbiIsCkBAIC00OTQsNiArNTAwLDEx
NiBAQCBzdHJ1Y3QgcGFnZSAqY21hX2FsbG9jKHN0cnVjdCBjbWEgKmNtYSwgc2l6ZV90IGNvdW50
LCB1bnNpZ25lZCBpbnQgYWxpZ24sCiAJcmV0dXJuIHBhZ2U7CiB9CiAKKy8qCisgKiBjbWFfYWxs
b2NfYnVsaygpIC0gYWxsb2NhdGUgaGlnaCBvcmRlciBidWxrIHBhZ2VzIGZyb20gY29udGlndW91
cyBhcmVhIHdpdGgKKyAqIAkJYmVzdCBlZmZvcnQuIEl0IHdpbGwgdXN1YWxseSBiZSB1c2VkIGZv
ciBwcml2YXRlIEBjbWEKKyAqCisgKiBAY21hOgljb250aWd1b3VzIG1lbW9yeSByZWdpb24gZm9y
IHdoaWNoIHRoZSBhbGxvY2F0aW9uIGlzIHBlcmZvcm1lZC4KKyAqIEBhbGlnbjoJcmVxdWVzdGVk
IGFsaWdubWVudCBvZiBwYWdlcyAoaW4gUEFHRV9TSVpFIG9yZGVyKS4KKyAqIEBmYXN0Ogl3aWxs
IHNraXAgY29zdGx5IG9wZWFydGlvbnMgaWYgaXQncyB0cnVlLgorICogQG9yZGVyOglyZXF1ZXN0
ZWQgcGFnZSBvcmRlcgorICogQG5yX3JlcXVlc3RzOiB0aGUgbnVtYmVyIG9mIDJeb3JkZXIgcGFn
ZXMgcmVxdWVzdGVkIHRvIGJlIGFsbG9jYXRlZCBhcyBpbnB1dCwKKyAqIEBwYWdlX2FycmF5Oglw
YWdlX2FycmF5IHBvaW50ZXIgdG8gc3RvcmUgYWxsb2NhdGVkIHBhZ2VzIChtdXN0IGhhdmUgc3Bh
Y2UKKyAqCQlmb3IgYXQgbGVhc3QgbnJfcmVxdWVzdHMpCisgKiBAbnJfYWxsb2NhdGVkOiB0aGUg
bnVtYmVyIG9mIDJeb3JkZXIgcGFnZXMgYWxsb2NhdGVkIGFzIG91dHB1dAorICoKKyAqIFRoaXMg
ZnVuY3Rpb24gdHJpZXMgdG8gYWxsb2NhdGUgdXAgdG8gQG5yX3JlcXVlc3RzIEBvcmRlciBwYWdl
cyBvbiBzcGVjaWZpYworICogY29udGlndW91cyBtZW1vcnkgYXJlYS4gSWYgQGZhc3QgaGFzIHRy
dWUsIGl0IHdpbGwgYXZvaWQgY29zdGx5IGZ1bmN0aW9ucworICogdG8gaW5jcmVhc2UgYWxsb2Nh
dGlvbiBzdWNjZXNzIHJhdGlvIHNvIGl0IHdpbGwgYmUgZmFzdGVyIGJ1dCBtaWdodCByZXR1cm4K
KyAqIGxlc3MgdGhhbiByZXF1ZXN0ZWQgbnVtYmVyIG9mIHBhZ2VzLiBVc2VyIGNvdWxkIHJldHJ5
IGl0IHdpdGggdHJ1ZSBpZiBpdCBpcworICogbmVlZGVkLgorICoKKyAqIFJldHVybjogaXQgd2ls
bCByZXR1cm4gMCBvbmx5IGlmIGFsbCBwYWdlcyByZXF1ZXN0ZWQgYnkgQG5yX3JlcXVlc3RzZWQg
YXJlCisgKiBhbGxvY2F0ZWQuIE90aGVyd2lzZSwgaXQgcmV0dXJucyBuZWdhdGl2ZSBlcnJvciBj
b2RlLgorICoKKyAqIE5vdGU6IFJlZ2FyZGxlc3Mgb2Ygc3VjY2Vzcy9mYWlsdXJlLCB1c2VyIHNo
b3VsZCBjaGVjayBAbnJfYWxsb2NhdGVkIHRvIHNlZQorICogaG93IG1hbnkgQG9yZGVyIHBhZ2Vz
IGFyZSBhbGxvY2F0ZWQgYW5kIGZyZWUgdGhvc2UgcGFnZXMgd2hlbiB0aGV5IGFyZSBub3QKKyAq
IG5lZWRlZC4KKyAqLworaW50IGNtYV9hbGxvY19idWxrKHN0cnVjdCBjbWEgKmNtYSwgdW5zaWdu
ZWQgaW50IGFsaWduLCBib29sIGZhc3QsCisJCQl1bnNpZ25lZCBpbnQgb3JkZXIsIHNpemVfdCBu
cl9yZXF1ZXN0cywKKwkJCXN0cnVjdCBwYWdlICoqcGFnZV9hcnJheSwgc2l6ZV90ICpucl9hbGxv
Y2F0ZWQpCit7CisJaW50IHJldCA9IDA7CisJc2l6ZV90IGkgPSAwOworCXVuc2lnbmVkIGxvbmcg
bnJfcGFnZXNfbmVlZGVkID0gbnJfcmVxdWVzdHMgKiAoMSA8PCBvcmRlcik7CisJdW5zaWduZWQg
bG9uZyBucl9jaHVua19wYWdlcywgbnJfcGFnZXM7CisJdW5zaWduZWQgbG9uZyBtYXNrLCBvZmZz
ZXQ7CisJdW5zaWduZWQgbG9uZyBwZm4gPSAtMTsKKwl1bnNpZ25lZCBsb25nIHN0YXJ0ID0gMDsK
Kwl1bnNpZ25lZCBsb25nIGJpdG1hcF9tYXhubywgYml0bWFwX25vLCBiaXRtYXBfY291bnQ7CisJ
c3RydWN0IHBhZ2UgKnBhZ2UgPSBOVUxMOworCWVudW0gYWxsb2NfY29udGlnX21vZGUgbW9kZSA9
IGZhc3QgPyBBTExPQ19DT05USUdfRkFTVCA6CisJCQkJCQlBTExPQ19DT05USUdfTk9STUFMOwor
CSpucl9hbGxvY2F0ZWQgPSAwOworCWlmICghY21hIHx8ICFjbWEtPmNvdW50IHx8ICFjbWEtPmJp
dG1hcCB8fCAhcGFnZV9hcnJheSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoIW5yX3BhZ2Vz
X25lZWRlZCkKKwkJcmV0dXJuIDA7CisKKwlucl9jaHVua19wYWdlcyA9IDEgPDwgbWF4X3QodW5z
aWduZWQgaW50LCBvcmRlciwgcGFnZWJsb2NrX29yZGVyKTsKKworCW1hc2sgPSBjbWFfYml0bWFw
X2FsaWduZWRfbWFzayhjbWEsIGFsaWduKTsKKwlvZmZzZXQgPSBjbWFfYml0bWFwX2FsaWduZWRf
b2Zmc2V0KGNtYSwgYWxpZ24pOworCWJpdG1hcF9tYXhubyA9IGNtYV9iaXRtYXBfbWF4bm8oY21h
KTsKKworCWxydV9hZGRfZHJhaW5fYWxsKCk7CisJZHJhaW5fYWxsX3BhZ2VzKE5VTEwpOworCisJ
d2hpbGUgKG5yX3BhZ2VzX25lZWRlZCkgeworCQlucl9wYWdlcyA9IG1pbihucl9jaHVua19wYWdl
cywgbnJfcGFnZXNfbmVlZGVkKTsKKworCQliaXRtYXBfY291bnQgPSBjbWFfYml0bWFwX3BhZ2Vz
X3RvX2JpdHMoY21hLCBucl9wYWdlcyk7CisJCW11dGV4X2xvY2soJmNtYS0+bG9jayk7CisJCWJp
dG1hcF9ubyA9IGJpdG1hcF9maW5kX25leHRfemVyb19hcmVhX29mZihjbWEtPmJpdG1hcCwKKwkJ
CQliaXRtYXBfbWF4bm8sIHN0YXJ0LCBiaXRtYXBfY291bnQsIG1hc2ssCisJCQkJb2Zmc2V0KTsK
KwkJaWYgKGJpdG1hcF9ubyA+PSBiaXRtYXBfbWF4bm8pIHsKKwkJCW11dGV4X3VubG9jaygmY21h
LT5sb2NrKTsKKwkJCWJyZWFrOworCQl9CisJCWJpdG1hcF9zZXQoY21hLT5iaXRtYXAsIGJpdG1h
cF9ubywgYml0bWFwX2NvdW50KTsKKwkJLyoKKwkJICogSXQncyBzYWZlIHRvIGRyb3AgdGhlIGxv
Y2sgaGVyZS4gSWYgdGhlIG1pZ3JhdGlvbiBmYWlscworCQkgKiBjbWFfY2xlYXJfYml0bWFwIHdp
bGwgdGFrZSB0aGUgbG9jayBhZ2FpbiBhbmQgdW5tYXJrIGl0LgorCQkgKi8KKwkJbXV0ZXhfdW5s
b2NrKCZjbWEtPmxvY2spOworCisJCXBmbiA9IGNtYS0+YmFzZV9wZm4gKyAoYml0bWFwX25vIDw8
IGNtYS0+b3JkZXJfcGVyX2JpdCk7CisJCXJldCA9IGFsbG9jX2NvbnRpZ19yYW5nZShwZm4sIHBm
biArIG5yX3BhZ2VzLCBNSUdSQVRFX0NNQSwKKwkJCQkJCUdGUF9LRVJORUx8X19HRlBfTk9XQVJO
LCBtb2RlKTsKKwkJaWYgKHJldCkgeworCQkJY21hX2NsZWFyX2JpdG1hcChjbWEsIHBmbiwgbnJf
cGFnZXMpOworCQkJaWYgKHJldCAhPSAtRUJVU1kpCisJCQkJYnJlYWs7CisKKwkJCS8qIGNvbnRp
bnVlIHRvIHNlYXJjaCBuZXh0IGJsb2NrICovCisJCQlzdGFydCA9IChwZm4gKyBucl9wYWdlcyAt
IGNtYS0+YmFzZV9wZm4pID4+CisJCQkJCQljbWEtPm9yZGVyX3Blcl9iaXQ7CisJCQljb250aW51
ZTsKKwkJfQorCisJCXBhZ2UgPSBwZm5fdG9fcGFnZShwZm4pOworCQl3aGlsZSAobnJfcGFnZXMp
IHsKKwkJCXBhZ2VfYXJyYXlbaSsrXSA9IHBhZ2U7CisJCQlyZXNldF9wYWdlX2thc2FuX3RhZyhw
YWdlLCAxIDw8IG9yZGVyKTsKKwkJCXBhZ2UgKz0gMSA8PCBvcmRlcjsKKwkJCW5yX3BhZ2VzIC09
IDEgPDwgb3JkZXI7CisJCQlucl9wYWdlc19uZWVkZWQgLT0gMSA8PCBvcmRlcjsKKwkJfQorCisJ
CXN0YXJ0ID0gYml0bWFwX25vICsgYml0bWFwX2NvdW50OworCX0KKworCSpucl9hbGxvY2F0ZWQg
PSBpOworCisJaWYgKCFyZXQgJiYgbnJfcGFnZXNfbmVlZGVkKQorCQlyZXQgPSAtRUJVU1k7CisK
KwlyZXR1cm4gcmV0OworfQorCiAvKioKICAqIGNtYV9yZWxlYXNlKCkgLSByZWxlYXNlIGFsbG9j
YXRlZCBwYWdlcwogICogQGNtYTogICBDb250aWd1b3VzIG1lbW9yeSByZWdpb24gZm9yIHdoaWNo
IHRoZSBhbGxvY2F0aW9uIGlzIHBlcmZvcm1lZC4KZGlmZiAtLWdpdCBhL21tL3BhZ2VfYWxsb2Mu
YyBiL21tL3BhZ2VfYWxsb2MuYwppbmRleCBhZGZiZmQ5NWZiYzMuLjJhMTc5OWZmMTRmYyAxMDA2
NDQKLS0tIGEvbW0vcGFnZV9hbGxvYy5jCisrKyBiL21tL3BhZ2VfYWxsb2MuYwpAQCAtODQ2Myw3
ICs4NDYzLDggQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgcGZuX21heF9hbGlnbl91cCh1bnNpZ25l
ZCBsb25nIHBmbikKIAogLyogW3N0YXJ0LCBlbmQpIG11c3QgYmVsb25nIHRvIGEgc2luZ2xlIHpv
bmUuICovCiBzdGF0aWMgaW50IF9fYWxsb2NfY29udGlnX21pZ3JhdGVfcmFuZ2Uoc3RydWN0IGNv
bXBhY3RfY29udHJvbCAqY2MsCi0JCQkJCXVuc2lnbmVkIGxvbmcgc3RhcnQsIHVuc2lnbmVkIGxv
bmcgZW5kKQorCQkJCQl1bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGVuZCwKKwkJ
CQkJdW5zaWduZWQgaW50IG1heF90cmllcykKIHsKIAkvKiBUaGlzIGZ1bmN0aW9uIGlzIGJhc2Vk
IG9uIGNvbXBhY3Rfem9uZSgpIGZyb20gY29tcGFjdGlvbi5jLiAqLwogCXVuc2lnbmVkIGludCBu
cl9yZWNsYWltZWQ7CkBAIC04NDkxLDcgKzg0OTIsNyBAQCBzdGF0aWMgaW50IF9fYWxsb2NfY29u
dGlnX21pZ3JhdGVfcmFuZ2Uoc3RydWN0IGNvbXBhY3RfY29udHJvbCAqY2MsCiAJCQkJYnJlYWs7
CiAJCQl9CiAJCQl0cmllcyA9IDA7Ci0JCX0gZWxzZSBpZiAoKyt0cmllcyA9PSA1KSB7CisJCX0g
ZWxzZSBpZiAoKyt0cmllcyA9PSBtYXhfdHJpZXMpIHsKIAkJCXJldCA9IHJldCA8IDAgPyByZXQg
OiAtRUJVU1k7CiAJCQlicmVhazsKIAkJfQpAQCAtODU1Myw2ICs4NTU0LDcgQEAgaW50IGFsbG9j
X2NvbnRpZ19yYW5nZSh1bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGVuZCwKIAl1
bnNpZ25lZCBsb25nIG91dGVyX3N0YXJ0LCBvdXRlcl9lbmQ7CiAJdW5zaWduZWQgaW50IG9yZGVy
OwogCWludCByZXQgPSAwOworCWJvb2wgZmFzdF9tb2RlID0gbW9kZSA9PSBBTExPQ19DT05USUdf
RkFTVDsKIAogCXN0cnVjdCBjb21wYWN0X2NvbnRyb2wgY2MgPSB7CiAJCS5ucl9taWdyYXRlcGFn
ZXMgPSAwLApAQCAtODU5NSw3ICs4NTk3LDggQEAgaW50IGFsbG9jX2NvbnRpZ19yYW5nZSh1bnNp
Z25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGVuZCwKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCi0JZHJhaW5fYWxsX3BhZ2VzKGNjLnpvbmUpOworCWlmICghZmFzdF9tb2RlKQorCQlk
cmFpbl9hbGxfcGFnZXMoY2Muem9uZSk7CiAKIAkvKgogCSAqIEluIGNhc2Ugb2YgLUVCVVNZLCB3
ZSdkIGxpa2UgdG8ga25vdyB3aGljaCBwYWdlIGNhdXNlcyBwcm9ibGVtLgpAQCAtODYwNyw3ICs4
NjEwLDcgQEAgaW50IGFsbG9jX2NvbnRpZ19yYW5nZSh1bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNp
Z25lZCBsb25nIGVuZCwKIAkgKiBhbGxvY2F0ZWQuICBTbywgaWYgd2UgZmFsbCB0aHJvdWdoIGJl
IHN1cmUgdG8gY2xlYXIgcmV0IHNvIHRoYXQKIAkgKiAtRUJVU1kgaXMgbm90IGFjY2lkZW50YWxs
eSB1c2VkIG9yIHJldHVybmVkIHRvIGNhbGxlci4KIAkgKi8KLQlyZXQgPSBfX2FsbG9jX2NvbnRp
Z19taWdyYXRlX3JhbmdlKCZjYywgc3RhcnQsIGVuZCk7CisJcmV0ID0gX19hbGxvY19jb250aWdf
bWlncmF0ZV9yYW5nZSgmY2MsIHN0YXJ0LCBlbmQsIGZhc3RfbW9kZSA/IDEgOiA1KTsKIAlpZiAo
cmV0ICYmIHJldCAhPSAtRUJVU1kpCiAJCWdvdG8gZG9uZTsKIAlyZXQgPTA7CkBAIC04NjI5LDcg
Kzg2MzIsOCBAQCBpbnQgYWxsb2NfY29udGlnX3JhbmdlKHVuc2lnbmVkIGxvbmcgc3RhcnQsIHVu
c2lnbmVkIGxvbmcgZW5kLAogCSAqIGlzb2xhdGVkIHRodXMgdGhleSB3b24ndCBnZXQgcmVtb3Zl
ZCBmcm9tIGJ1ZGR5LgogCSAqLwogCi0JbHJ1X2FkZF9kcmFpbl9hbGwoKTsKKwlpZiAoIWZhc3Rf
bW9kZSkKKwkJbHJ1X2FkZF9kcmFpbl9hbGwoKTsKIAogCW9yZGVyID0gMDsKIAlvdXRlcl9zdGFy
dCA9IHN0YXJ0OwpAQCAtODY1Niw4ICs4NjYwLDkgQEAgaW50IGFsbG9jX2NvbnRpZ19yYW5nZSh1
bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGVuZCwKIAogCS8qIE1ha2Ugc3VyZSB0
aGUgcmFuZ2UgaXMgcmVhbGx5IGlzb2xhdGVkLiAqLwogCWlmICh0ZXN0X3BhZ2VzX2lzb2xhdGVk
KG91dGVyX3N0YXJ0LCBlbmQsIDApKSB7Ci0JCXByX2luZm9fcmF0ZWxpbWl0ZWQoIiVzOiBbJWx4
LCAlbHgpIFBGTnMgYnVzeVxuIiwKLQkJCV9fZnVuY19fLCBvdXRlcl9zdGFydCwgZW5kKTsKKwkJ
aWYgKCFmYXN0X21vZGUpCisJCQlwcl9pbmZvX3JhdGVsaW1pdGVkKCIlczogWyVseCwgJWx4KSBQ
Rk5zIGJ1c3lcbiIsCisJCQkJX19mdW5jX18sIG91dGVyX3N0YXJ0LCBlbmQpOwogCQlyZXQgPSAt
RUJVU1k7CiAJCWdvdG8gZG9uZTsKIAl9Ci0tIAoyLjI5LjIuNDU0LmdhZmYyMGRhM2EyLWdvb2cK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkxpbmFyby1t
bS1zaWcgbWFpbGluZyBsaXN0CkxpbmFyby1tbS1zaWdAbGlzdHMubGluYXJvLm9yZwpodHRwczov
L2xpc3RzLmxpbmFyby5vcmcvbWFpbG1hbi9saXN0aW5mby9saW5hcm8tbW0tc2lnCg==
