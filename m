Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 6068B4EC490
	for <lists+linaro-mm-sig@lfdr.de>; Wed, 30 Mar 2022 14:40:53 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 90B933EC4B
	for <lists+linaro-mm-sig@lfdr.de>; Wed, 30 Mar 2022 12:40:52 +0000 (UTC)
Received: from mail-yb1-f201.google.com (mail-yb1-f201.google.com [209.85.219.201])
	by lists.linaro.org (Postfix) with ESMTPS id 370F23EA54
	for <linaro-mm-sig@lists.linaro.org>; Mon, 28 Mar 2022 04:00:12 +0000 (UTC)
Received: by mail-yb1-f201.google.com with SMTP id y10-20020a5b0d0a000000b00633b9765410so9993936ybp.18
        for <linaro-mm-sig@lists.linaro.org>; Sun, 27 Mar 2022 21:00:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=google.com; s=20210112;
        h=date:in-reply-to:message-id:mime-version:references:subject:from:to
         :cc:content-transfer-encoding;
        bh=gHJvarCfp4ST6T1lM9CDothUo5XPZ3G7QA7kcqYT4UM=;
        b=rk7Aw20EbcDIa69NL5ydL8E8TGDtoB37mocxbMh5cM0dpkp5zMFrZrXTdSQO8bain0
         qEqEz+noYjXXMXqMhPh3vXla3wNJb2iDucR4F40tEw2zYNiP+fkOInbx+h1Uww4YxJUg
         jE7gK7iBAfvfre7Xwu9cw8ZKPDj0yoDCy2XJpnC1y/kQ0LtiRxdcYKYVlqxQeBv1Qz5s
         l9kcMdp84H8INqnApIC1mSNJyZ9QgS4y2eDXIZuTriD0Tou4ermKhfdxVEUpcRXAUg0q
         d6US+J1fYIJRIRD4iiaWtvVnQgMkNGh66HLN6QFNyNmkEjr8K7J/+IW0uWfHmLsX8rMO
         /QCQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:date:in-reply-to:message-id:mime-version
         :references:subject:from:to:cc:content-transfer-encoding;
        bh=gHJvarCfp4ST6T1lM9CDothUo5XPZ3G7QA7kcqYT4UM=;
        b=C/wVaZOuH+lODOur5G8OiFB2urcl3VDaMrivjTdNZdRNJffjV1MgU5Zq/XFlrJJyg2
         7GvL77eggry/BNNytBQ1yrYGVf9oBnYi7Rg7tpi1LK3Cyvrm0wB+/OQA123WiBTz1iBp
         6UvSOi0iAb55t+Th749/8f+Gc4NefJDIKTnXTvpdfjSPM2CTsEfslYLDF+vEGf2jaiJM
         +SBKAP6oWhACZuyI4r0hHQT4C1gc0rvhyHlWcdD3EQazKO3HHueouNeDr2pERIizNvx4
         3IC8JIK41J+3IPNAGS/1CtsdZbppDdQ3/G6VfmdH34UsbXczrEotk4SJv/QoEYjdR0lE
         FF4g==
X-Gm-Message-State: AOAM533ZH4DHaHWl/KErppOgmBtus8P7NvesYlgX0sMA4qpsPBRCbqQb
	7aoWxI+gMI1hK/MgsgIRQUZUPMkR0rU2fD4=
X-Google-Smtp-Source: ABdhPJz+EpQpQ5sgGGlfLlv7TaYkgUMInl07aYgCXBfnJIUTEvZlVfooINmL6H3ETtCw093EcBxaIowsGvRw1ME=
X-Received: from tj2.c.googlers.com ([fda3:e722:ac3:cc00:20:ed76:c0a8:187])
 (user=tjmercier job=sendgmr) by 2002:a25:4dd7:0:b0:621:a740:3988 with SMTP id
 a206-20020a254dd7000000b00621a7403988mr20517183ybb.58.1648440011816; Sun, 27
 Mar 2022 21:00:11 -0700 (PDT)
Date: Mon, 28 Mar 2022 03:59:44 +0000
In-Reply-To: <20220328035951.1817417-1-tjmercier@google.com>
Message-Id: <20220328035951.1817417-6-tjmercier@google.com>
Mime-Version: 1.0
References: <20220328035951.1817417-1-tjmercier@google.com>
X-Mailer: git-send-email 2.35.1.1021.g381101b075-goog
From: "T.J. Mercier" <tjmercier@google.com>
To: tjmercier@google.com, David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
	Maarten Lankhorst <maarten.lankhorst@linux.intel.com>, Maxime Ripard <mripard@kernel.org>,
	Thomas Zimmermann <tzimmermann@suse.de>, Jonathan Corbet <corbet@lwn.net>,
	Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
	"=?UTF-8?q?Arve=20Hj=C3=B8nnev=C3=A5g?=" <arve@android.com>, Todd Kjos <tkjos@android.com>, Martijn Coenen <maco@android.com>,
	Joel Fernandes <joel@joelfernandes.org>, Christian Brauner <brauner@kernel.org>,
	Hridya Valsaraju <hridya@google.com>, Suren Baghdasaryan <surenb@google.com>,
	Sumit Semwal <sumit.semwal@linaro.org>,
	"=?UTF-8?q?Christian=20K=C3=B6nig?=" <christian.koenig@amd.com>, Benjamin Gaignard <benjamin.gaignard@linaro.org>,
	Liam Mark <lmark@codeaurora.org>, Laura Abbott <labbott@redhat.com>,
	Brian Starkey <Brian.Starkey@arm.com>, John Stultz <john.stultz@linaro.org>,
	Tejun Heo <tj@kernel.org>, Zefan Li <lizefan.x@bytedance.com>,
	Johannes Weiner <hannes@cmpxchg.org>, Shuah Khan <shuah@kernel.org>
X-MailFrom: 3yzJBYgkKDU49z2u7syu7w44w1u.s421y3q74-22-8yw1y898.1y3q74.47w@flex--tjmercier.bounces.google.com
X-Mailman-Rule-Hits: nonmember-moderation
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation
Message-ID-Hash: UKUF55CK3EPLK2KW4JK3L6F26O47TX53
X-Message-ID-Hash: UKUF55CK3EPLK2KW4JK3L6F26O47TX53
X-Mailman-Approved-At: Wed, 30 Mar 2022 12:40:21 +0000
CC: kaleshsingh@google.com, Kenny.Ho@amd.com, mkoutny@suse.com, skhan@linuxfoundation.org, dri-devel@lists.freedesktop.org, linux-doc@vger.kernel.org, linux-kernel@vger.kernel.org, linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org, cgroups@vger.kernel.org, linux-kselftest@vger.kernel.org
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [RFC v4 5/8] dmabuf: Add gpu cgroup charge transfer function
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/UKUF55CK3EPLK2KW4JK3L6F26O47TX53/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

RnJvbTogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlhQGdvb2dsZS5jb20+DQoNClRoZSBkbWFfYnVm
X2NoYXJnZV90cmFuc2ZlciBmdW5jdGlvbiBwcm92aWRlcyBhIHdheSBmb3IgcHJvY2Vzc2VzIHRv
DQp0cmFuc2ZlciBjaGFyZ2Ugb2YgYSBidWZmZXIgdG8gYSBkaWZmZXJlbnQgcHJvY2Vzcy4gVGhp
cyBpcyBlc3NlbnRpYWwNCmZvciB0aGUgY2FzZXMgd2hlcmUgYSBjZW50cmFsIGFsbG9jYXRvciBw
cm9jZXNzIGRvZXMgYWxsb2NhdGlvbnMgZm9yDQp2YXJpb3VzIHN1YnN5c3RlbXMsIGhhbmRzIG92
ZXIgdGhlIGZkIHRvIHRoZSBjbGllbnQgd2hvIHJlcXVlc3RlZCB0aGUNCm1lbW9yeSBhbmQgZHJv
cHMgYWxsIHJlZmVyZW5jZXMgdG8gdGhlIGFsbG9jYXRlZCBtZW1vcnkuDQoNClNpZ25lZC1vZmYt
Ynk6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPg0KU2lnbmVkLW9mZi1ieTog
VC5KLiBNZXJjaWVyIDx0am1lcmNpZXJAZ29vZ2xlLmNvbT4NCg0KLS0tDQp2NCBjaGFuZ2VzDQpB
ZGp1c3Qgb3JkZXJpbmcgb2YgY2hhcmdlL3VuY2hhcmdlIGR1cmluZyB0cmFuc2ZlciB0byBhdm9p
ZCBwb3RlbnRpYWxseQ0KaGl0dGluZyBjZ3JvdXAgbGltaXQgcGVyIE1pY2hhbCBLb3V0bsO9Lg0K
DQp2MyBjaGFuZ2VzDQpVc2UgbW9yZSBjb21tb24gZHVhbCBhdXRob3IgY29tbWl0IG1lc3NhZ2Ug
Zm9ybWF0IHBlciBKb2huIFN0dWx0ei4NCg0KdjIgY2hhbmdlcw0KTW92ZSBkbWEtYnVmIGNncm91
cCBjaGFyZ2UgdHJhbnNmZXIgZnJvbSBhIGRtYV9idWZfb3AgZGVmaW5lZCBieSBldmVyeQ0KaGVh
cCB0byBhIHNpbmdsZSBkbWEtYnVmIGZ1bmN0aW9uIGZvciBhbGwgaGVhcHMgcGVyIERhbmllbCBW
ZXR0ZXIgYW5kDQpDaHJpc3RpYW4gS8O2bmlnLg0KLS0tDQogZHJpdmVycy9kbWEtYnVmL2RtYS1i
dWYuYyAgfCA0OSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrDQogaW5jbHVkZS9saW51
eC9jZ3JvdXBfZ3B1LmggfCAxMiArKysrKysrKw0KIGluY2x1ZGUvbGludXgvZG1hLWJ1Zi5oICAg
IHwgIDIgKysNCiBrZXJuZWwvY2dyb3VwL2dwdS5jICAgICAgICB8IDU5ICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrDQogNCBmaWxlcyBjaGFuZ2VkLCAxMjIgaW5zZXJ0aW9u
cygrKQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYyBiL2RyaXZlcnMv
ZG1hLWJ1Zi9kbWEtYnVmLmMNCmluZGV4IDFlZTVjNjBkM2Q2ZC4uNzc0OGMzNDUzYjkxIDEwMDY0
NA0KLS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYw0KKysrIGIvZHJpdmVycy9kbWEtYnVm
L2RtYS1idWYuYw0KQEAgLTEzODAsNiArMTM4MCw1NSBAQCB2b2lkIGRtYV9idWZfdnVubWFwKHN0
cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQ0KIH0NCiBFWFBP
UlRfU1lNQk9MX05TX0dQTChkbWFfYnVmX3Z1bm1hcCwgRE1BX0JVRik7DQogDQorLyoqDQorICog
ZG1hX2J1Zl90cmFuc2Zlcl9jaGFyZ2UgLSBDaGFuZ2UgdGhlIEdQVSBjZ3JvdXAgdG8gd2hpY2gg
dGhlIHByb3ZpZGVkIGRtYV9idWYgaXMgY2hhcmdlZC4NCisgKiBAZG1hYnVmOglbaW5dCWJ1ZmZl
ciB3aG9zZSBjaGFyZ2Ugd2lsbCBiZSBtaWdyYXRlZCB0byBhIGRpZmZlcmVudCBHUFUgY2dyb3Vw
DQorICogQGdwdWNnOglbaW5dCXRoZSBkZXN0aW5hdGlvbiBHUFUgY2dyb3VwIGZvciBkbWFidWYn
cyBjaGFyZ2UNCisgKg0KKyAqIE9ubHkgdGFza3MgdGhhdCBiZWxvbmcgdG8gdGhlIHNhbWUgY2dy
b3VwIHRoZSBidWZmZXIgaXMgY3VycmVudGx5IGNoYXJnZWQgdG8NCisgKiBtYXkgY2FsbCB0aGlz
IGZ1bmN0aW9uLCBvdGhlcndpc2UgaXQgd2lsbCByZXR1cm4gLUVQRVJNLg0KKyAqDQorICogUmV0
dXJucyAwIG9uIHN1Y2Nlc3MsIG9yIGEgbmVnYXRpdmUgZXJybm8gY29kZSBvdGhlcndpc2UuDQor
ICovDQoraW50IGRtYV9idWZfdHJhbnNmZXJfY2hhcmdlKHN0cnVjdCBkbWFfYnVmICpkbWFidWYs
IHN0cnVjdCBncHVjZyAqZ3B1Y2cpDQorew0KKyNpZmRlZiBDT05GSUdfQ0dST1VQX0dQVQ0KKwlz
dHJ1Y3QgZ3B1Y2cgKmN1cnJlbnRfZ3B1Y2c7DQorCWludCByZXQ7DQorDQorCS8qIElmIHRoZSBz
b3VyY2UgYW5kIGRlc3RpbmF0aW9uIGNncm91cHMgYXJlIHRoZSBzYW1lLCBkb24ndCBkbyBhbnl0
aGluZy4gKi8NCisJY3VycmVudF9ncHVjZyA9IGdwdWNnX2dldChjdXJyZW50KTsNCisJaWYgKGN1
cnJlbnRfZ3B1Y2cgPT0gZ3B1Y2cpIHsNCisJCXJldCA9IDA7DQorCQlnb3RvIHNraXBfdHJhbnNm
ZXI7DQorCX0NCisNCisJLyoNCisJICogVmVyaWZ5IHRoYXQgdGhlIGNncm91cCBvZiB0aGUgcHJv
Y2VzcyByZXF1ZXN0aW5nIHRoZSB0cmFuc2ZlciBpcyB0aGUNCisJICogc2FtZSBhcyB0aGUgb25l
IHRoZSBidWZmZXIgaXMgY3VycmVudGx5IGNoYXJnZWQgdG8uDQorCSAqLw0KKwljdXJyZW50X2dw
dWNnID0gZ3B1Y2dfZ2V0KGN1cnJlbnQpOw0KKwltdXRleF9sb2NrKCZkbWFidWYtPmxvY2spOw0K
KwlpZiAoY3VycmVudF9ncHVjZyAhPSBkbWFidWYtPmdwdWNnKSB7DQorCQlyZXQgPSAtRVBFUk07
DQorCQlnb3RvIGVycjsNCisJfQ0KKw0KKwlyZXQgPSBncHVjZ190cmFuc2Zlcl9jaGFyZ2UoY3Vy
cmVudF9ncHVjZywgZ3B1Y2csIGRtYWJ1Zi0+Z3B1Y2dfZGV2LCBkbWFidWYtPnNpemUpOw0KKwlp
ZiAocmV0KQ0KKwkJZ290byBlcnI7DQorCWRtYWJ1Zi0+Z3B1Y2cgPSBncHVjZzsNCitlcnI6DQor
CW11dGV4X3VubG9jaygmZG1hYnVmLT5sb2NrKTsNCitza2lwX3RyYW5zZmVyOg0KKwlncHVjZ19w
dXQoY3VycmVudF9ncHVjZyk7DQorCXJldHVybiByZXQ7DQorI2Vsc2UNCisJcmV0dXJuIDA7DQor
I2VuZGlmIC8qIENPTkZJR19DR1JPVVBfR1BVICovDQorfQ0KK0VYUE9SVF9TWU1CT0xfTlNfR1BM
KGRtYV9idWZfdHJhbnNmZXJfY2hhcmdlLCBETUFfQlVGKTsNCisNCiAjaWZkZWYgQ09ORklHX0RF
QlVHX0ZTDQogc3RhdGljIGludCBkbWFfYnVmX2RlYnVnX3Nob3coc3RydWN0IHNlcV9maWxlICpz
LCB2b2lkICp1bnVzZWQpDQogew0KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvY2dyb3VwX2dw
dS5oIGIvaW5jbHVkZS9saW51eC9jZ3JvdXBfZ3B1LmgNCmluZGV4IGM5MDA2OTcxOTAyMi4uZTMw
ZjE1ZDVlOWJlIDEwMDY0NA0KLS0tIGEvaW5jbHVkZS9saW51eC9jZ3JvdXBfZ3B1LmgNCisrKyBi
L2luY2x1ZGUvbGludXgvY2dyb3VwX2dwdS5oDQpAQCAtODcsNiArODcsMTAgQEAgc3RhdGljIGlu
bGluZSBzdHJ1Y3QgZ3B1Y2cgKmdwdWNnX3BhcmVudChzdHJ1Y3QgZ3B1Y2cgKmNnKQ0KIA0KIGlu
dCBncHVjZ190cnlfY2hhcmdlKHN0cnVjdCBncHVjZyAqZ3B1Y2csIHN0cnVjdCBncHVjZ19kZXZp
Y2UgKmRldmljZSwgdTY0IHVzYWdlKTsNCiB2b2lkIGdwdWNnX3VuY2hhcmdlKHN0cnVjdCBncHVj
ZyAqZ3B1Y2csIHN0cnVjdCBncHVjZ19kZXZpY2UgKmRldmljZSwgdTY0IHVzYWdlKTsNCitpbnQg
Z3B1Y2dfdHJhbnNmZXJfY2hhcmdlKHN0cnVjdCBncHVjZyAqc291cmNlLA0KKwkJCSAgc3RydWN0
IGdwdWNnICpkZXN0LA0KKwkJCSAgc3RydWN0IGdwdWNnX2RldmljZSAqZGV2aWNlLA0KKwkJCSAg
dTY0IHVzYWdlKTsNCiB2b2lkIGdwdWNnX3JlZ2lzdGVyX2RldmljZShzdHJ1Y3QgZ3B1Y2dfZGV2
aWNlICpncHVjZ19kZXYsIGNvbnN0IGNoYXIgKm5hbWUpOw0KICNlbHNlIC8qIENPTkZJR19DR1JP
VVBfR1BVICovDQogDQpAQCAtMTIxLDYgKzEyNSwxNCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgZ3B1
Y2dfdW5jaGFyZ2Uoc3RydWN0IGdwdWNnICpncHVjZywNCiAJCQkJICBzdHJ1Y3QgZ3B1Y2dfZGV2
aWNlICpkZXZpY2UsDQogCQkJCSAgdTY0IHVzYWdlKSB7fQ0KIA0KK3N0YXRpYyBpbmxpbmUgaW50
IGdwdWNnX3RyYW5zZmVyX2NoYXJnZShzdHJ1Y3QgZ3B1Y2cgKnNvdXJjZSwNCisJCQkJCXN0cnVj
dCBncHVjZyAqZGVzdCwNCisJCQkJCXN0cnVjdCBncHVjZ19kZXZpY2UgKmRldmljZSwNCisJCQkJ
CXU2NCB1c2FnZSkNCit7DQorCXJldHVybiAwOw0KK30NCisNCiBzdGF0aWMgaW5saW5lIHZvaWQg
Z3B1Y2dfcmVnaXN0ZXJfZGV2aWNlKHN0cnVjdCBncHVjZ19kZXZpY2UgKmdwdWNnX2RldiwNCiAJ
CQkJCSBjb25zdCBjaGFyICpuYW1lKSB7fQ0KICNlbmRpZiAvKiBDT05GSUdfQ0dST1VQX0dQVSAq
Lw0KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5oIGIvaW5jbHVkZS9saW51eC9k
bWEtYnVmLmgNCmluZGV4IDc0MmYyOWMzZGFhZi4uNjQ2ODI3MTU2MjEzIDEwMDY0NA0KLS0tIGEv
aW5jbHVkZS9saW51eC9kbWEtYnVmLmgNCisrKyBiL2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5oDQpA
QCAtNjQ2LDQgKzY0Niw2IEBAIGludCBkbWFfYnVmX21tYXAoc3RydWN0IGRtYV9idWYgKiwgc3Ry
dWN0IHZtX2FyZWFfc3RydWN0ICosDQogCQkgdW5zaWduZWQgbG9uZyk7DQogaW50IGRtYV9idWZf
dm1hcChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3QgZG1hX2J1Zl9tYXAgKm1hcCk7DQog
dm9pZCBkbWFfYnVmX3Z1bm1hcChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3QgZG1hX2J1
Zl9tYXAgKm1hcCk7DQorDQoraW50IGRtYV9idWZfdHJhbnNmZXJfY2hhcmdlKHN0cnVjdCBkbWFf
YnVmICpkbWFidWYsIHN0cnVjdCBncHVjZyAqZ3B1Y2cpOw0KICNlbmRpZiAvKiBfX0RNQV9CVUZf
SF9fICovDQpkaWZmIC0tZ2l0IGEva2VybmVsL2Nncm91cC9ncHUuYyBiL2tlcm5lbC9jZ3JvdXAv
Z3B1LmMNCmluZGV4IGFjNGM0NzA5MTRiNS4uNDA1MzEzMjNkNmRhIDEwMDY0NA0KLS0tIGEva2Vy
bmVsL2Nncm91cC9ncHUuYw0KKysrIGIva2VybmVsL2Nncm91cC9ncHUuYw0KQEAgLTI0Nyw2ICsy
NDcsNjUgQEAgdm9pZCBncHVjZ191bmNoYXJnZShzdHJ1Y3QgZ3B1Y2cgKmdwdWNnLCBzdHJ1Y3Qg
Z3B1Y2dfZGV2aWNlICpkZXZpY2UsIHU2NCB1c2FnZSkNCiAJY3NzX3B1dF9tYW55KCZncHVjZy0+
Y3NzLCBucl9wYWdlcyk7DQogfQ0KIA0KKy8qKg0KKyAqIGdwdWNnX3RyYW5zZmVyX2NoYXJnZSAt
IFRyYW5zZmVyIGEgR1BVIGNoYXJnZSBmcm9tIG9uZSBjZ3JvdXAgdG8gYW5vdGhlci4NCisgKiBA
c291cmNlOglbaW5dCVRoZSBHUFUgY2dyb3VwIHRoZSBjaGFyZ2Ugd2lsbCBiZSB0cmFuc2ZlcnJl
ZCBmcm9tLg0KKyAqIEBkZXN0OglbaW5dCVRoZSBHUFUgY2dyb3VwIHRoZSBjaGFyZ2Ugd2lsbCBi
ZSB0cmFuc2ZlcnJlZCB0by4NCisgKiBAZGV2aWNlOglbaW5dCVRoZSBHUFUgY2dyb3VwIGRldmlj
ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBjaGFyZ2UuDQorICogQHVzYWdlOglbaW5dCVRoZSBzaXpl
IG9mIHRoZSBtZW1vcnkgaW4gYnl0ZXMuDQorICoNCisgKiBSZXR1cm5zIDAgb24gc3VjY2Vzcywg
b3IgYSBuZWdhdGl2ZSBlcnJubyBjb2RlIG90aGVyd2lzZS4NCisgKi8NCitpbnQgZ3B1Y2dfdHJh
bnNmZXJfY2hhcmdlKHN0cnVjdCBncHVjZyAqc291cmNlLA0KKwkJCSAgc3RydWN0IGdwdWNnICpk
ZXN0LA0KKwkJCSAgc3RydWN0IGdwdWNnX2RldmljZSAqZGV2aWNlLA0KKwkJCSAgdTY0IHVzYWdl
KQ0KK3sNCisJc3RydWN0IHBhZ2VfY291bnRlciAqY291bnRlcjsNCisJdTY0IG5yX3BhZ2VzOw0K
KwlzdHJ1Y3QgZ3B1Y2dfcmVzb3VyY2VfcG9vbCAqcnBfc291cmNlLCAqcnBfZGVzdDsNCisJaW50
IHJldCA9IDA7DQorDQorCW5yX3BhZ2VzID0gUEFHRV9BTElHTih1c2FnZSkgPj4gUEFHRV9TSElG
VDsNCisNCisJbXV0ZXhfbG9jaygmZ3B1Y2dfbXV0ZXgpOw0KKwlycF9zb3VyY2UgPSBmaW5kX2Nn
X3Jwb29sX2xvY2tlZChzb3VyY2UsIGRldmljZSk7DQorCWlmICh1bmxpa2VseSghcnBfc291cmNl
KSkgew0KKwkJcmV0ID0gLUVOT0VOVDsNCisJCWdvdG8gZXhpdF9lYXJseTsNCisJfQ0KKw0KKwly
cF9kZXN0ID0gZ2V0X2NnX3Jwb29sX2xvY2tlZChkZXN0LCBkZXZpY2UpOw0KKwlpZiAoSVNfRVJS
KHJwX2Rlc3QpKSB7DQorCQlyZXQgPSBQVFJfRVJSKHJwX2Rlc3QpOw0KKwkJZ290byBleGl0X2Vh
cmx5Ow0KKwl9DQorDQorCS8qDQorCSAqIEZpcnN0IHVuY2hhcmdlIGZyb20gdGhlIHBvb2wgaXQn
cyBjdXJyZW50bHkgY2hhcmdlZCB0by4gVGhpcyBvcmRlcmluZyBhdm9pZHMgZG91YmxlDQorCSAq
IGNoYXJnaW5nIHdoaWxlIHRoZSB0cmFuc2ZlciBpcyBpbiBwcm9ncmVzcywgd2hpY2ggY291bGQg
Y2F1c2UgdXMgdG8gaGl0IGEgbGltaXQuDQorCSAqIElmIHRoZSB0cnlfY2hhcmdlIGZhaWxzIGZv
ciB0aGlzIHRyYW5zZmVyLCB3ZSBuZWVkIHRvIGJlIGFibGUgdG8gcmV2ZXJzZSB0aGlzIHVuY2hh
cmdlLA0KKwkgKiBzbyB3ZSBjb250aW51ZSB0byBob2xkIHRoZSBncHVjZ19tdXRleCBoZXJlLg0K
KwkgKi8NCisJcGFnZV9jb3VudGVyX3VuY2hhcmdlKCZycF9zb3VyY2UtPnRvdGFsLCBucl9wYWdl
cyk7DQorCWNzc19wdXRfbWFueSgmc291cmNlLT5jc3MsIG5yX3BhZ2VzKTsNCisNCisJLyogTm93
IGF0dGVtcHQgdGhlIG5ldyBjaGFyZ2UgKi8NCisJaWYgKHBhZ2VfY291bnRlcl90cnlfY2hhcmdl
KCZycF9kZXN0LT50b3RhbCwgbnJfcGFnZXMsICZjb3VudGVyKSkgew0KKwkJY3NzX2dldF9tYW55
KCZkZXN0LT5jc3MsIG5yX3BhZ2VzKTsNCisJfSBlbHNlIHsNCisJCS8qDQorCQkgKiBUaGUgbmV3
IGNoYXJnZSBmYWlsZWQsIHNvIHJldmVyc2UgdGhlIHVuY2hhcmdlIGZyb20gYWJvdmUuIFRoaXMg
c2hvdWxkIGFsd2F5cw0KKwkJICogc3VjY2VlZCBzaW5jZSBjaGFyZ2VzIG9uIHNvdXJjZSBhcmUg
YmxvY2tlZCBieSBncHVjZ19tdXRleC4NCisJCSAqLw0KKwkJV0FSTl9PTighcGFnZV9jb3VudGVy
X3RyeV9jaGFyZ2UoJnJwX3NvdXJjZS0+dG90YWwsIG5yX3BhZ2VzLCAmY291bnRlcikpOw0KKwkJ
Y3NzX2dldF9tYW55KCZzb3VyY2UtPmNzcywgbnJfcGFnZXMpOw0KKwl9DQorZXhpdF9lYXJseToN
CisJbXV0ZXhfdW5sb2NrKCZncHVjZ19tdXRleCk7DQorCXJldHVybiByZXQ7DQorfQ0KKw0KIC8q
Kg0KICAqIGdwdWNnX3JlZ2lzdGVyX2RldmljZSAtIFJlZ2lzdGVycyBhIGRldmljZSBmb3IgbWVt
b3J5IGFjY291bnRpbmcgdXNpbmcgdGhlDQogICogR1BVIGNncm91cCBjb250cm9sbGVyLg0KLS0g
DQoyLjM1LjEuMTAyMS5nMzgxMTAxYjA3NS1nb29nDQoNCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0IC0tIGxp
bmFyby1tbS1zaWdAbGlzdHMubGluYXJvLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVtYWls
IHRvIGxpbmFyby1tbS1zaWctbGVhdmVAbGlzdHMubGluYXJvLm9yZwo=
