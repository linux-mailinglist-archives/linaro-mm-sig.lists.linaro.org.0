Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 9EF2551DA1B
	for <lists+linaro-mm-sig@lfdr.de>; Fri,  6 May 2022 16:10:32 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D1D1B480B1
	for <lists+linaro-mm-sig@lfdr.de>; Fri,  6 May 2022 14:10:31 +0000 (UTC)
Received: from mail-ed1-f44.google.com (mail-ed1-f44.google.com [209.85.208.44])
	by lists.linaro.org (Postfix) with ESMTPS id CAD39480B5
	for <linaro-mm-sig@lists.linaro.org>; Fri,  6 May 2022 14:10:15 +0000 (UTC)
Received: by mail-ed1-f44.google.com with SMTP id z19so8846361edx.9
        for <linaro-mm-sig@lists.linaro.org>; Fri, 06 May 2022 07:10:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=vefTnLmZ1hRjfFT+wM4LObjotAMbQOwWtxRJQRE0yXw=;
        b=j8KVGH2GHcMJ1ywj+cjz7pamBQLXExx8mmlGN6PbeSlm/kg++H2qKPy19AUZrDjN0Z
         o8FHJEp9fS1xdrFOQhSl9cXB2IJU4D7vQlMOewun/H7B6oHQ11No5Scm2xOpkcxDdT7H
         1TECQagWPIl96unP5+2bTbHhUnBnRS8y3kLYliVxg05CyWXc1xqSMVIBefKaUQMGvI8B
         4YYizgE1ioczKXABvNTntR0tKAty5FnafWl08Aw1pDKl3Wc6q3ZJjsBZHhA46HU8sflS
         TMcKOlIP0TG4W2/GqjtjLxHsjwvXYlmG4ZhVmO/TKJjur5dp/UnDEv2B/+zc40e/yr4p
         h7gw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=vefTnLmZ1hRjfFT+wM4LObjotAMbQOwWtxRJQRE0yXw=;
        b=msIiXvlhxDbSNViu+TrtpxEs269Tve/rF5xTNQ7LezcsFvvDx/NMdWdIdnE5aVX+fL
         Kd9BMru2eqlBYhCQGmy3Zvc4Q7+cu+Uh47rlK7liD+dYvMAGw4/4BBpVzFRYthv5+gn6
         Ctzg2Xi2K6y44I4cH2nTlbqyU+8/i64SdzE4cyZCp/YJ2mPn1wGw9eYrgCUDo58AIXbg
         6quIzH+Nt6d+zrHvcNg2RK2gMJK8HA9GL73MOVI270PGz3cGqTVSGTSoiaTKmOAYH2X5
         AKjfrkzRCB7tx2abUErMNN0GSkCqEb/k9RYP9nnV9LfcwLrt6vQcMqDEewKTWeaienvO
         q0KQ==
X-Gm-Message-State: AOAM532QMCpD7iO83fjksdlRPRL9YiO69Ky2/mQa2sgAdJGXB7+kPFTu
	hc0i8m22KlVAtrLYCWWbnONmdd51Z7U=
X-Google-Smtp-Source: ABdhPJwxAnRnqAaKfldxjBs/gMSK370De63PnkL12J/y9NEBXjJENsVHF+C8jsEr0H/sNCoxeRjgGw==
X-Received: by 2002:a50:ed13:0:b0:426:4939:45a9 with SMTP id j19-20020a50ed13000000b00426493945a9mr3701112eds.303.1651846214835;
        Fri, 06 May 2022 07:10:14 -0700 (PDT)
Received: from able.fritz.box (p57b0b3fd.dip0.t-ipconnect.de. [87.176.179.253])
        by smtp.gmail.com with ESMTPSA id jx3-20020a170907760300b006f3ef214e22sm1915415ejc.136.2022.05.06.07.10.13
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 06 May 2022 07:10:14 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
To: daniel@ffwll.ch,
	linaro-mm-sig@lists.linaro.org,
	dri-devel@lists.freedesktop.org,
	linux-media@vger.kernel.org
Date: Fri,  6 May 2022 16:10:08 +0200
Message-Id: <20220506141009.18047-4-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220506141009.18047-1-christian.koenig@amd.com>
References: <20220506141009.18047-1-christian.koenig@amd.com>
MIME-Version: 1.0
Message-ID-Hash: N7Q4QLANZRXZHFVSHCMU6HGXQFLN3H4K
X-Message-ID-Hash: N7Q4QLANZRXZHFVSHCMU6HGXQFLN3H4K
X-MailFrom: ckoenig.leichtzumerken@gmail.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH 4/5] dma-buf: generalize dma_fence unwrap & merging v2
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/N7Q4QLANZRXZHFVSHCMU6HGXQFLN3H4K/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

SW50cm9kdWNlIGEgZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSgpIG1hY3JvIHdoaWNoIGFsbG93cyB0
byB1bndyYXAgZmVuY2VzDQp3aGljaCBwb3RlbnRpYWxseSBjYW4gYmUgY29udGFpbmVycyBhcyB3
ZWxsIGFuZCB0aGVuIG1lcmdlIHRoZW0gYmFjaw0KdG9nZXRoZXIgaW50byBhIGZsYXQgZG1hX2Zl
bmNlX2FycmF5Lg0KDQp2MjogcmVuYW1lIHRoZSBmdW5jdGlvbiwgYWRkIHNvbWUgbW9yZSBjb21t
ZW50cyBhYm91dCBob3cgdGhlIHdyYXBwZXIgaXMNCiAgICB1c2VkLCBtb3ZlIGZpbHRlcmluZyBv
ZiBzaWduYWxlZCBmZW5jZXMgaW50byB0aGUgdW53cmFwIGl0ZXJhdG9yLA0KICAgIGFkZCBjb21w
bGV4IHNlbGZ0ZXN0IHdoaWNoIGNvdmVycyBtb3JlIGNhc2VzLg0KDQpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+DQpSZXZpZXdlZC1ieTog
RGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4NCi0tLQ0KIGRyaXZlcnMvZG1h
LWJ1Zi9kbWEtZmVuY2UtdW53cmFwLmMgICAgfCAgOTkgKysrKysrKysrKysrKysrKysrKysrDQog
ZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS11bndyYXAuYyB8IDEwOSArKysrKysrKysrKysr
KysrKysrKysrKw0KIGRyaXZlcnMvZG1hLWJ1Zi9zeW5jX2ZpbGUuYyAgICAgICAgICAgfCAxMTkg
KystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiBpbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS11bndy
YXAuaCAgICAgIHwgIDI0ICsrKysrKw0KIDQgZmlsZXMgY2hhbmdlZCwgMjM4IGluc2VydGlvbnMo
KyksIDExMyBkZWxldGlvbnMoLSkNCg0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEt
ZmVuY2UtdW53cmFwLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLXVud3JhcC5jDQppbmRl
eCA3MTFiZTEyNTQyOGMuLjBlNTE1NDdiYmFiZCAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UtdW53cmFwLmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UtdW53
cmFwLmMNCkBAIC0xMSw2ICsxMSw3IEBADQogI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJh
eS5oPg0KICNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UtY2hhaW4uaD4NCiAjaW5jbHVkZSA8bGlu
dXgvZG1hLWZlbmNlLXVud3JhcC5oPg0KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+DQogDQogLyog
SW50ZXJuYWwgaGVscGVyIHRvIHN0YXJ0IG5ldyBhcnJheSBpdGVyYXRpb24sIGRvbid0IHVzZSBk
aXJlY3RseSAqLw0KIHN0YXRpYyBzdHJ1Y3QgZG1hX2ZlbmNlICoNCkBAIC01NywzICs1OCwxMDEg
QEAgc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KHN0cnVjdCBkbWFfZmVu
Y2VfdW53cmFwICpjdXJzb3IpDQogCXJldHVybiBfX2RtYV9mZW5jZV91bndyYXBfYXJyYXkoY3Vy
c29yKTsNCiB9DQogRVhQT1JUX1NZTUJPTF9HUEwoZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KTsNCisN
CisvKiBJbXBsZW1lbnRhdGlvbiBmb3IgdGhlIGRtYV9mZW5jZV9tZXJnZSgpIG1hcmNvLCBkb24n
dCB1c2UgZGlyZWN0bHkgKi8NCitzdHJ1Y3QgZG1hX2ZlbmNlICpfX2RtYV9mZW5jZV91bndyYXBf
bWVyZ2UodW5zaWduZWQgaW50IG51bV9mZW5jZXMsDQorCQkJCQkgICBzdHJ1Y3QgZG1hX2ZlbmNl
ICoqZmVuY2VzLA0KKwkJCQkJICAgc3RydWN0IGRtYV9mZW5jZV91bndyYXAgKml0ZXIpDQorew0K
KwlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5ICpyZXN1bHQ7DQorCXN0cnVjdCBkbWFfZmVuY2UgKnRt
cCwgKiphcnJheTsNCisJdW5zaWduZWQgaW50IGk7DQorCXNpemVfdCBjb3VudDsNCisNCisJY291
bnQgPSAwOw0KKwlmb3IgKGkgPSAwOyBpIDwgbnVtX2ZlbmNlczsgKytpKSB7DQorCQlkbWFfZmVu
Y2VfdW53cmFwX2Zvcl9lYWNoKHRtcCwgJml0ZXJbaV0sIGZlbmNlc1tpXSkNCisJCQkrK2NvdW50
Ow0KKwl9DQorDQorCWlmIChjb3VudCA9PSAwKQ0KKwkJcmV0dXJuIGRtYV9mZW5jZV9nZXRfc3R1
YigpOw0KKw0KKwlhcnJheSA9IGttYWxsb2NfYXJyYXkoY291bnQsIHNpemVvZigqYXJyYXkpLCBH
RlBfS0VSTkVMKTsNCisJaWYgKCFhcnJheSkNCisJCXJldHVybiBOVUxMOw0KKw0KKwkvKg0KKwkg
KiBUaGlzIHRyYXNoZXMgdGhlIGlucHV0IGZlbmNlIGFycmF5IGFuZCB1c2VzIGl0IGFzIHBvc2l0
aW9uIGZvciB0aGUNCisJICogZm9sbG93aW5nIG1lcmdlIGxvb3AuIFRoaXMgd29ya3MgYmVjYXVz
ZSB0aGUgZG1hX2ZlbmNlX21lcmdlKCkNCisJICogd3JhcHBlciBtYWNybyBpcyBjcmVhdGluZyB0
aGlzIHRlbXBvcmFyeSBhcnJheSBvbiB0aGUgc3RhY2sgdG9nZXRoZXINCisJICogd2l0aCB0aGUg
aXRlcmF0b3JzLg0KKwkgKi8NCisJZm9yIChpID0gMDsgaSA8IG51bV9mZW5jZXM7ICsraSkNCisJ
CWZlbmNlc1tpXSA9IGRtYV9mZW5jZV91bndyYXBfZmlyc3QoZmVuY2VzW2ldLCAmaXRlcltpXSk7
DQorDQorCWNvdW50ID0gMDsNCisJZG8gew0KKwkJdW5zaWduZWQgaW50IHNlbDsNCisNCityZXN0
YXJ0Og0KKwkJdG1wID0gTlVMTDsNCisJCWZvciAoaSA9IDA7IGkgPCBudW1fZmVuY2VzOyArK2kp
IHsNCisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpuZXh0ID0gZmVuY2VzW2ldOw0KKw0KKwkJCWlmICgh
bmV4dCkNCisJCQkJY29udGludWU7DQorDQorCQkJLyoNCisJCQkgKiBXZSBjYW4ndCBndWFyYW50
ZWUgdGhhdCBpbnB1dGUgZmVuY2VzIGFyZSBvcmRlcmVkIGJ5DQorCQkJICogY29udGV4dCwgYnV0
IGl0IGlzIHN0aWxsIHF1aXRlIGxpa2VseSB3aGVuIHRoaXMNCisJCQkgKiBmdW5jdGlvbiBpcyB1
c2VkIG11bHRpcGxlIHRpbWVzLiBTbyBhdHRlbXB0IHRvIG9yZGVyDQorCQkJICogdGhlIGZlbmNl
cyBieSBjb250ZXh0IGFzIHdlIHBhc3Mgb3ZlciB0aGVtIGFuZCBtZXJnZQ0KKwkJCSAqIGZlbmNl
cyB3aXRoIHRoZSBzYW1lIGNvbnRleHQuDQorCQkJICovDQorCQkJaWYgKCF0bXAgfHwgdG1wLT5j
b250ZXh0ID4gbmV4dC0+Y29udGV4dCkgew0KKwkJCQl0bXAgPSBuZXh0Ow0KKwkJCQlzZWwgPSBp
Ow0KKw0KKwkJCX0gZWxzZSBpZiAodG1wLT5jb250ZXh0IDwgbmV4dC0+Y29udGV4dCkgew0KKwkJ
CQljb250aW51ZTsNCisNCisJCQl9IGVsc2UgaWYgKGRtYV9mZW5jZV9pc19sYXRlcih0bXAsIG5l
eHQpKSB7DQorCQkJCWZlbmNlc1tpXSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmaXRlcltpXSk7
DQorCQkJCWdvdG8gcmVzdGFydDsNCisJCQl9IGVsc2Ugew0KKwkJCQlmZW5jZXNbc2VsXSA9IGRt
YV9mZW5jZV91bndyYXBfbmV4dCgmaXRlcltzZWxdKTsNCisJCQkJZ290byByZXN0YXJ0Ow0KKwkJ
CX0NCisJCX0NCisNCisJCWlmICh0bXApIHsNCisJCQlhcnJheVtjb3VudCsrXSA9IGRtYV9mZW5j
ZV9nZXQodG1wKTsNCisJCQlmZW5jZXNbc2VsXSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmaXRl
cltzZWxdKTsNCisJCX0NCisJfSB3aGlsZSAodG1wKTsNCisNCisJaWYgKGNvdW50ID09IDApIHsN
CisJCXRtcCA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOw0KKwkJZ290byByZXR1cm5fdG1wOw0KKwl9
DQorDQorCWlmIChjb3VudCA9PSAxKSB7DQorCQl0bXAgPSBhcnJheVswXTsNCisJCWdvdG8gcmV0
dXJuX3RtcDsNCisJfQ0KKw0KKwlyZXN1bHQgPSBkbWFfZmVuY2VfYXJyYXlfY3JlYXRlKGNvdW50
LCBhcnJheSwNCisJCQkJCWRtYV9mZW5jZV9jb250ZXh0X2FsbG9jKDEpLA0KKwkJCQkJMSwgZmFs
c2UpOw0KKwlpZiAoIXJlc3VsdCkgew0KKwkJdG1wID0gTlVMTDsNCisJCWdvdG8gcmV0dXJuX3Rt
cDsNCisJfQ0KKwlyZXR1cm4gJnJlc3VsdC0+YmFzZTsNCisNCityZXR1cm5fdG1wOg0KKwlrZnJl
ZShhcnJheSk7DQorCXJldHVybiB0bXA7DQorfQ0KK0VYUE9SVF9TWU1CT0xfR1BMKF9fZG1hX2Zl
bmNlX3Vud3JhcF9tZXJnZSk7DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1m
ZW5jZS11bndyYXAuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9zdC1kbWEtZmVuY2UtdW53cmFwLmMNCmlu
ZGV4IGUyMGM1YTdkY2ZlNC4uNDEwNWQ1ZWE4ZGRlIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9kbWEt
YnVmL3N0LWRtYS1mZW5jZS11bndyYXAuYw0KKysrIGIvZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1m
ZW5jZS11bndyYXAuYw0KQEAgLTIzOCw2ICsyMzgsMTEzIEBAIHN0YXRpYyBpbnQgdW53cmFwX2No
YWluX2FycmF5KHZvaWQgKmFyZykNCiAJcmV0dXJuIGVycjsNCiB9DQogDQorc3RhdGljIGludCB1
bndyYXBfbWVyZ2Uodm9pZCAqYXJnKQ0KK3sNCisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsICpm
MSwgKmYyLCAqZjM7DQorCXN0cnVjdCBkbWFfZmVuY2VfdW53cmFwIGl0ZXI7DQorCWludCBlcnIg
PSAwOw0KKw0KKwlmMSA9IG1vY2tfZmVuY2UoKTsNCisJaWYgKCFmMSkNCisJCXJldHVybiAtRU5P
TUVNOw0KKw0KKwlmMiA9IG1vY2tfZmVuY2UoKTsNCisJaWYgKCFmMikgew0KKwkJZXJyID0gLUVO
T01FTTsNCisJCWdvdG8gZXJyb3JfcHV0X2YxOw0KKwl9DQorDQorCWYzID0gZG1hX2ZlbmNlX3Vu
d3JhcF9tZXJnZShmMSwgZjIpOw0KKwlpZiAoIWYzKSB7DQorCQllcnIgPSAtRU5PTUVNOw0KKwkJ
Z290byBlcnJvcl9wdXRfZjI7DQorCX0NCisNCisJZG1hX2ZlbmNlX3Vud3JhcF9mb3JfZWFjaChm
ZW5jZSwgJml0ZXIsIGYzKSB7DQorCQlpZiAoZmVuY2UgPT0gZjEpIHsNCisJCQlkbWFfZmVuY2Vf
cHV0KGYxKTsNCisJCQlmMSA9IE5VTEw7DQorCQl9IGVsc2UgaWYgKGZlbmNlID09IGYyKSB7DQor
CQkJZG1hX2ZlbmNlX3B1dChmMik7DQorCQkJZjIgPSBOVUxMOw0KKwkJfSBlbHNlIHsNCisJCQlw
cl9lcnIoIlVuZXhwZWN0ZWQgZmVuY2UhXG4iKTsNCisJCQllcnIgPSAtRUlOVkFMOw0KKwkJfQ0K
Kwl9DQorDQorCWlmIChmMSB8fCBmMikgew0KKwkJcHJfZXJyKCJOb3QgYWxsIGZlbmNlcyBzZWVu
IVxuIik7DQorCQllcnIgPSAtRUlOVkFMOw0KKwl9DQorDQorCWRtYV9mZW5jZV9wdXQoZjMpOw0K
K2Vycm9yX3B1dF9mMjoNCisJZG1hX2ZlbmNlX3B1dChmMik7DQorZXJyb3JfcHV0X2YxOg0KKwlk
bWFfZmVuY2VfcHV0KGYxKTsNCisJcmV0dXJuIGVycjsNCit9DQorDQorc3RhdGljIGludCB1bndy
YXBfbWVyZ2VfY29tcGxleCh2b2lkICphcmcpDQorew0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSwgKmYxLCAqZjIsICpmMywgKmY0LCAqZjU7DQorCXN0cnVjdCBkbWFfZmVuY2VfdW53cmFwIGl0
ZXI7DQorCWludCBlcnIgPSAtRU5PTUVNOw0KKw0KKwlmMSA9IG1vY2tfZmVuY2UoKTsNCisJaWYg
KCFmMSkNCisJCXJldHVybiAtRU5PTUVNOw0KKw0KKwlmMiA9IG1vY2tfZmVuY2UoKTsNCisJaWYg
KCFmMikNCisJCWdvdG8gZXJyb3JfcHV0X2YxOw0KKw0KKwlmMyA9IGRtYV9mZW5jZV91bndyYXBf
bWVyZ2UoZjEsIGYyKTsNCisJaWYgKCFmMykNCisJCWdvdG8gZXJyb3JfcHV0X2YyOw0KKw0KKwkv
KiBUaGUgcmVzdWx0aW5nIGFycmF5IGhhcyB0aGUgZmVuY2VzIGluIHJldmVyc2UgKi8NCisJZjQg
PSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKGYyLCBmMSk7DQorCWlmICghZjQpDQorCQlnb3RvIGVy
cm9yX3B1dF9mMzsNCisNCisJLyogU2lnbmFsZWQgZmVuY2VzIHNob3VsZCBiZSBmaWx0ZXJlZCwg
dGhlIHR3byBhcnJheXMgbWVyZ2VkLiAqLw0KKwlmNSA9IGRtYV9mZW5jZV91bndyYXBfbWVyZ2Uo
ZjMsIGY0LCBkbWFfZmVuY2VfZ2V0X3N0dWIoKSk7DQorCWlmICghZjUpDQorCQlnb3RvIGVycm9y
X3B1dF9mNDsNCisNCisJZXJyID0gMDsNCisJZG1hX2ZlbmNlX3Vud3JhcF9mb3JfZWFjaChmZW5j
ZSwgJml0ZXIsIGY1KSB7DQorCQlpZiAoZmVuY2UgPT0gZjEpIHsNCisJCQlkbWFfZmVuY2VfcHV0
KGYxKTsNCisJCQlmMSA9IE5VTEw7DQorCQl9IGVsc2UgaWYgKGZlbmNlID09IGYyKSB7DQorCQkJ
ZG1hX2ZlbmNlX3B1dChmMik7DQorCQkJZjIgPSBOVUxMOw0KKwkJfSBlbHNlIHsNCisJCQlwcl9l
cnIoIlVuZXhwZWN0ZWQgZmVuY2UhXG4iKTsNCisJCQllcnIgPSAtRUlOVkFMOw0KKwkJfQ0KKwl9
DQorDQorCWlmIChmMSB8fCBmMikgew0KKwkJcHJfZXJyKCJOb3QgYWxsIGZlbmNlcyBzZWVuIVxu
Iik7DQorCQllcnIgPSAtRUlOVkFMOw0KKwl9DQorDQorCWRtYV9mZW5jZV9wdXQoZjUpOw0KK2Vy
cm9yX3B1dF9mNDoNCisJZG1hX2ZlbmNlX3B1dChmNCk7DQorZXJyb3JfcHV0X2YzOg0KKwlkbWFf
ZmVuY2VfcHV0KGYzKTsNCitlcnJvcl9wdXRfZjI6DQorCWRtYV9mZW5jZV9wdXQoZjIpOw0KK2Vy
cm9yX3B1dF9mMToNCisJZG1hX2ZlbmNlX3B1dChmMSk7DQorCXJldHVybiBlcnI7DQorfQ0KKw0K
IGludCBkbWFfZmVuY2VfdW53cmFwKHZvaWQpDQogew0KIAlzdGF0aWMgY29uc3Qgc3RydWN0IHN1
YnRlc3QgdGVzdHNbXSA9IHsNCkBAIC0yNDUsNiArMzUyLDggQEAgaW50IGRtYV9mZW5jZV91bndy
YXAodm9pZCkNCiAJCVNVQlRFU1QodW53cmFwX2FycmF5KSwNCiAJCVNVQlRFU1QodW53cmFwX2No
YWluKSwNCiAJCVNVQlRFU1QodW53cmFwX2NoYWluX2FycmF5KSwNCisJCVNVQlRFU1QodW53cmFw
X21lcmdlKSwNCisJCVNVQlRFU1QodW53cmFwX21lcmdlX2NvbXBsZXgpLA0KIAl9Ow0KIA0KIAly
ZXR1cm4gc3VidGVzdHModGVzdHMsIE5VTEwpOw0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1
Zi9zeW5jX2ZpbGUuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9zeW5jX2ZpbGUuYw0KaW5kZXggMGZlNTY0
NTM5MTY2Li4zZWJlYzE5YThlMDIgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2RtYS1idWYvc3luY19m
aWxlLmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9zeW5jX2ZpbGUuYw0KQEAgLTE0Niw1MCArMTQ2
LDYgQEAgY2hhciAqc3luY19maWxlX2dldF9uYW1lKHN0cnVjdCBzeW5jX2ZpbGUgKnN5bmNfZmls
ZSwgY2hhciAqYnVmLCBpbnQgbGVuKQ0KIAlyZXR1cm4gYnVmOw0KIH0NCiANCi1zdGF0aWMgaW50
IHN5bmNfZmlsZV9zZXRfZmVuY2Uoc3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlLA0KLQkJCSAg
ICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2VzLCBpbnQgbnVtX2ZlbmNlcykNCi17DQotCXN0
cnVjdCBkbWFfZmVuY2VfYXJyYXkgKmFycmF5Ow0KLQ0KLQkvKg0KLQkgKiBUaGUgcmVmZXJlbmNl
IGZvciB0aGUgZmVuY2VzIGluIHRoZSBuZXcgc3luY19maWxlIGFuZCBoZWxkDQotCSAqIGluIGFk
ZF9mZW5jZSgpIGR1cmluZyB0aGUgbWVyZ2UgcHJvY2VkdXJlLCBzbyBmb3IgbnVtX2ZlbmNlcyA9
PSAxDQotCSAqIHdlIGFscmVhZHkgb3duIGEgbmV3IHJlZmVyZW5jZSB0byB0aGUgZmVuY2UuIEZv
ciBudW1fZmVuY2UgPiAxDQotCSAqIHdlIG93biB0aGUgcmVmZXJlbmNlIG9mIHRoZSBkbWFfZmVu
Y2VfYXJyYXkgY3JlYXRpb24uDQotCSAqLw0KLQ0KLQlpZiAobnVtX2ZlbmNlcyA9PSAwKSB7DQot
CQlzeW5jX2ZpbGUtPmZlbmNlID0gZG1hX2ZlbmNlX2dldF9zdHViKCk7DQotCQlrZnJlZShmZW5j
ZXMpOw0KLQ0KLQl9IGVsc2UgaWYgKG51bV9mZW5jZXMgPT0gMSkgew0KLQkJc3luY19maWxlLT5m
ZW5jZSA9IGZlbmNlc1swXTsNCi0JCWtmcmVlKGZlbmNlcyk7DQotDQotCX0gZWxzZSB7DQotCQlh
cnJheSA9IGRtYV9mZW5jZV9hcnJheV9jcmVhdGUobnVtX2ZlbmNlcywgZmVuY2VzLA0KLQkJCQkJ
ICAgICAgIGRtYV9mZW5jZV9jb250ZXh0X2FsbG9jKDEpLA0KLQkJCQkJICAgICAgIDEsIGZhbHNl
KTsNCi0JCWlmICghYXJyYXkpDQotCQkJcmV0dXJuIC1FTk9NRU07DQotDQotCQlzeW5jX2ZpbGUt
PmZlbmNlID0gJmFycmF5LT5iYXNlOw0KLQl9DQotDQotCXJldHVybiAwOw0KLX0NCi0NCi1zdGF0
aWMgdm9pZCBhZGRfZmVuY2Uoc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlcywNCi0JCSAgICAgIGlu
dCAqaSwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpDQotew0KLQlmZW5jZXNbKmldID0gZmVuY2U7
DQotDQotCWlmICghZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkgew0KLQkJZG1hX2ZlbmNl
X2dldChmZW5jZSk7DQotCQkoKmkpKys7DQotCX0NCi19DQotDQogLyoqDQogICogc3luY19maWxl
X21lcmdlKCkgLSBtZXJnZSB0d28gc3luY19maWxlcw0KICAqIEBuYW1lOgluYW1lIG9mIG5ldyBm
ZW5jZQ0KQEAgLTIwMyw4NCArMTU5LDIxIEBAIHN0YXRpYyB2b2lkIGFkZF9mZW5jZShzdHJ1Y3Qg
ZG1hX2ZlbmNlICoqZmVuY2VzLA0KIHN0YXRpYyBzdHJ1Y3Qgc3luY19maWxlICpzeW5jX2ZpbGVf
bWVyZ2UoY29uc3QgY2hhciAqbmFtZSwgc3RydWN0IHN5bmNfZmlsZSAqYSwNCiAJCQkJCSBzdHJ1
Y3Qgc3luY19maWxlICpiKQ0KIHsNCi0Jc3RydWN0IGRtYV9mZW5jZSAqYV9mZW5jZSwgKmJfZmVu
Y2UsICoqZmVuY2VzOw0KLQlzdHJ1Y3QgZG1hX2ZlbmNlX3Vud3JhcCBhX2l0ZXIsIGJfaXRlcjsN
Ci0JdW5zaWduZWQgaW50IGluZGV4LCBudW1fZmVuY2VzOw0KIAlzdHJ1Y3Qgc3luY19maWxlICpz
eW5jX2ZpbGU7DQorCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOw0KIA0KIAlzeW5jX2ZpbGUgPSBz
eW5jX2ZpbGVfYWxsb2MoKTsNCiAJaWYgKCFzeW5jX2ZpbGUpDQogCQlyZXR1cm4gTlVMTDsNCiAN
Ci0JbnVtX2ZlbmNlcyA9IDA7DQotCWRtYV9mZW5jZV91bndyYXBfZm9yX2VhY2goYV9mZW5jZSwg
JmFfaXRlciwgYS0+ZmVuY2UpDQotCQkrK251bV9mZW5jZXM7DQotCWRtYV9mZW5jZV91bndyYXBf
Zm9yX2VhY2goYl9mZW5jZSwgJmJfaXRlciwgYi0+ZmVuY2UpDQotCQkrK251bV9mZW5jZXM7DQot
DQotCWlmIChudW1fZmVuY2VzID4gSU5UX01BWCkNCi0JCWdvdG8gZXJyX2ZyZWVfc3luY19maWxl
Ow0KLQ0KLQlmZW5jZXMgPSBrY2FsbG9jKG51bV9mZW5jZXMsIHNpemVvZigqZmVuY2VzKSwgR0ZQ
X0tFUk5FTCk7DQotCWlmICghZmVuY2VzKQ0KLQkJZ290byBlcnJfZnJlZV9zeW5jX2ZpbGU7DQot
DQotCS8qDQotCSAqIFdlIGNhbid0IGd1YXJhbnRlZSB0aGF0IGZlbmNlcyBpbiBib3RoIGEgYW5k
IGIgYXJlIG9yZGVyZWQsIGJ1dCBpdCBpcw0KLQkgKiBzdGlsbCBxdWl0ZSBsaWtlbHkuDQotCSAq
DQotCSAqIFNvIGF0dGVtcHQgdG8gb3JkZXIgdGhlIGZlbmNlcyBhcyB3ZSBwYXNzIG92ZXIgdGhl
bSBhbmQgbWVyZ2UgZmVuY2VzDQotCSAqIHdpdGggdGhlIHNhbWUgY29udGV4dC4NCi0JICovDQot
DQotCWluZGV4ID0gMDsNCi0JZm9yIChhX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9maXJzdChh
LT5mZW5jZSwgJmFfaXRlciksDQotCSAgICAgYl9mZW5jZSA9IGRtYV9mZW5jZV91bndyYXBfZmly
c3QoYi0+ZmVuY2UsICZiX2l0ZXIpOw0KLQkgICAgIGFfZmVuY2UgfHwgYl9mZW5jZTsgKSB7DQot
DQotCQlpZiAoIWJfZmVuY2UpIHsNCi0JCQlhZGRfZmVuY2UoZmVuY2VzLCAmaW5kZXgsIGFfZmVu
Y2UpOw0KLQkJCWFfZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJmFfaXRlcik7DQotDQot
CQl9IGVsc2UgaWYgKCFhX2ZlbmNlKSB7DQotCQkJYWRkX2ZlbmNlKGZlbmNlcywgJmluZGV4LCBi
X2ZlbmNlKTsNCi0JCQliX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZiX2l0ZXIpOw0K
LQ0KLQkJfSBlbHNlIGlmIChhX2ZlbmNlLT5jb250ZXh0IDwgYl9mZW5jZS0+Y29udGV4dCkgew0K
LQkJCWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYV9mZW5jZSk7DQotCQkJYV9mZW5jZSA9IGRt
YV9mZW5jZV91bndyYXBfbmV4dCgmYV9pdGVyKTsNCi0NCi0JCX0gZWxzZSBpZiAoYl9mZW5jZS0+
Y29udGV4dCA8IGFfZmVuY2UtPmNvbnRleHQpIHsNCi0JCQlhZGRfZmVuY2UoZmVuY2VzLCAmaW5k
ZXgsIGJfZmVuY2UpOw0KLQkJCWJfZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJmJfaXRl
cik7DQotDQotCQl9IGVsc2UgaWYgKF9fZG1hX2ZlbmNlX2lzX2xhdGVyKGFfZmVuY2UtPnNlcW5v
LCBiX2ZlbmNlLT5zZXFubywNCi0JCQkJCQlhX2ZlbmNlLT5vcHMpKSB7DQotCQkJYWRkX2ZlbmNl
KGZlbmNlcywgJmluZGV4LCBhX2ZlbmNlKTsNCi0JCQlhX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3Jh
cF9uZXh0KCZhX2l0ZXIpOw0KLQkJCWJfZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJmJf
aXRlcik7DQotDQotCQl9IGVsc2Ugew0KLQkJCWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYl9m
ZW5jZSk7DQotCQkJYV9mZW5jZSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmYV9pdGVyKTsNCi0J
CQliX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZiX2l0ZXIpOw0KLQkJfQ0KKwlmZW5j
ZSA9IGRtYV9mZW5jZV91bndyYXBfbWVyZ2UoYS0+ZmVuY2UsIGItPmZlbmNlKTsNCisJaWYgKCFm
ZW5jZSkgew0KKwkJZnB1dChzeW5jX2ZpbGUtPmZpbGUpOw0KKwkJcmV0dXJuIE5VTEw7DQogCX0N
Ci0NCi0JaWYgKHN5bmNfZmlsZV9zZXRfZmVuY2Uoc3luY19maWxlLCBmZW5jZXMsIGluZGV4KSA8
IDApDQotCQlnb3RvIGVycl9wdXRfZmVuY2VzOw0KLQ0KKwlzeW5jX2ZpbGUtPmZlbmNlID0gZmVu
Y2U7DQogCXN0cmxjcHkoc3luY19maWxlLT51c2VyX25hbWUsIG5hbWUsIHNpemVvZihzeW5jX2Zp
bGUtPnVzZXJfbmFtZSkpOw0KIAlyZXR1cm4gc3luY19maWxlOw0KLQ0KLWVycl9wdXRfZmVuY2Vz
Og0KLQl3aGlsZSAoaW5kZXgpDQotCQlkbWFfZmVuY2VfcHV0KGZlbmNlc1stLWluZGV4XSk7DQot
CWtmcmVlKGZlbmNlcyk7DQotDQotZXJyX2ZyZWVfc3luY19maWxlOg0KLQlmcHV0KHN5bmNfZmls
ZS0+ZmlsZSk7DQotCXJldHVybiBOVUxMOw0KIH0NCiANCiBzdGF0aWMgaW50IHN5bmNfZmlsZV9y
ZWxlYXNlKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQ0KZGlmZiAtLWdp
dCBhL2luY2x1ZGUvbGludXgvZG1hLWZlbmNlLXVud3JhcC5oIGIvaW5jbHVkZS9saW51eC9kbWEt
ZmVuY2UtdW53cmFwLmgNCmluZGV4IGE0ZDM0MmZlZjhlMC4uMzkwZGUxZWU5ZDM1IDEwMDY0NA0K
LS0tIGEvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UtdW53cmFwLmgNCisrKyBiL2luY2x1ZGUvbGlu
dXgvZG1hLWZlbmNlLXVud3JhcC5oDQpAQCAtNTIsNCArNTIsMjggQEAgc3RydWN0IGRtYV9mZW5j
ZSAqZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KHN0cnVjdCBkbWFfZmVuY2VfdW53cmFwICpjdXJzb3Ip
Ow0KIAkgICAgIGZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KGN1cnNvcikpCQkJXA0KIAkJ
aWYgKCFkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZmVuY2UpKQ0KIA0KK3N0cnVjdCBkbWFfZmVuY2Ug
Kl9fZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSh1bnNpZ25lZCBpbnQgbnVtX2ZlbmNlcywNCisJCQkJ
CSAgIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZXMsDQorCQkJCQkgICBzdHJ1Y3QgZG1hX2ZlbmNl
X3Vud3JhcCAqY3Vyc29ycyk7DQorDQorLyoqDQorICogZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSAt
IHVud3JhcCBhbmQgbWVyZ2UgZmVuY2VzDQorICoNCisgKiBBbGwgZmVuY2VzIGdpdmVuIGFzIHBh
cmFtZXRlcnMgYXJlIHVud3JhcHBlZCBhbmQgbWVyZ2VkIGJhY2sgdG9nZXRoZXIgYXMgZmxhdA0K
KyAqIGRtYV9mZW5jZV9hcnJheS4gVXNlZnVsIGlmIG11bHRpcGxlIGNvbnRhaW5lcnMgbmVlZCB0
byBiZSBtZXJnZWQgdG9nZXRoZXIuDQorICoNCisgKiBJbXBsZW1lbnRlZCBhcyBhIG1hY3JvIHRv
IGFsbG9jYXRlIHRoZSBuZWNlc3NhcnkgYXJyYXlzIG9uIHRoZSBzdGFjayBhbmQNCisgKiBhY2Nv
dW50IHRoZSBzdGFjayBmcmFtZSBzaXplIHRvIHRoZSBjYWxsZXIuDQorICoNCisgKiBSZXR1cm5z
IE5VTEwgb24gbWVtb3J5IGFsbG9jYXRpb24gZmFpbHVyZSwgYSBkbWFfZmVuY2Ugb2JqZWN0IHJl
cHJlc2VudGluZw0KKyAqIGFsbCB0aGUgZ2l2ZW4gZmVuY2VzIG90aGVyd2lzZS4NCisgKi8NCisj
ZGVmaW5lIGRtYV9mZW5jZV91bndyYXBfbWVyZ2UoLi4uKQkJCQkJXA0KKwkoewkJCQkJCQkJXA0K
KwkJc3RydWN0IGRtYV9mZW5jZSAqX19mW10gPSB7IF9fVkFfQVJHU19fIH07CQlcDQorCQlzdHJ1
Y3QgZG1hX2ZlbmNlX3Vud3JhcCBfX2NbQVJSQVlfU0laRShfX2YpXTsJCVwNCisJCQkJCQkJCQlc
DQorCQlfX2RtYV9mZW5jZV91bndyYXBfbWVyZ2UoQVJSQVlfU0laRShfX2YpLCBfX2YsIF9fYyk7
CVwNCisJfSkNCisNCiAjZW5kaWYNCi0tIA0KMi4yNS4xDQoNCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0IC0t
IGxpbmFyby1tbS1zaWdAbGlzdHMubGluYXJvLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVt
YWlsIHRvIGxpbmFyby1tbS1zaWctbGVhdmVAbGlzdHMubGluYXJvLm9yZwo=
