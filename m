Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id E12F64F7AB4
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  7 Apr 2022 11:00:18 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 12AC3402CD
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  7 Apr 2022 09:00:18 +0000 (UTC)
Received: from mail-ej1-f52.google.com (mail-ej1-f52.google.com [209.85.218.52])
	by lists.linaro.org (Postfix) with ESMTPS id DA2F3402C4
	for <linaro-mm-sig@lists.linaro.org>; Thu,  7 Apr 2022 08:59:54 +0000 (UTC)
Received: by mail-ej1-f52.google.com with SMTP id p15so9404270ejc.7
        for <linaro-mm-sig@lists.linaro.org>; Thu, 07 Apr 2022 01:59:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=rjWw05in0bn2oijZvXjXe7/Vcame5enYOhOrH6N1JuA=;
        b=YvE2CPb0iozubqDj2AIGumM/d6wxPUT1wMOp0Nr0eeD8Wge3wRq52PM5sKMsuuixAP
         r8iNmKjT0MAUpbi5D1jgGFnGOczvoyFgftlUv54QH6AkyxmnGcpECFZ2xR2UcR6qMIht
         pUS86HlYed/N0zpXPPNeJCMWNhmH6B7ogQiTUMzdcmvPNUJghXLVj4iEH4rqucsu/hTU
         82BKwV2epgqeDadGDJ/b1v15xQMSl6Fn41v6gdiZv2Es1jjvYD8N2Gi5rA/Wu7TAOGRI
         EjSeXfiSBsCBgBWuk/I8b6tsAiYRedVgVRmVYJdEaRagK5CSX1DNmckAHDweGgiQoZ+O
         xSbQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=rjWw05in0bn2oijZvXjXe7/Vcame5enYOhOrH6N1JuA=;
        b=ZUisV831yFEOF/yMZB1WqR8zWDRCc0x8kdB02hiDHqwKlPtL3OY3A0VPCFWwnr5jss
         zv+UntnbmirWHEBUTR1IUgjElIFO2MI3+iUjnhB50kQrJ2CIutLGBDwobL7dnTGRE/T+
         QUaPDkqLLU+gtk2KAMBeidhTGcgFNuZP4w4bqqb3Nla54ZifFs7BDWsu/8sfYWtU7RwC
         L0oPb9O7rVfaiG0u/r+pv2gA53iqmaOudZUCD+jxvAotRgKyNLibIqK/nfmbMkg6t4qI
         vjvL05FmDlQlZfH/EJgm79fw4LHlRHD8akjhv/U9DykqxIzexM1e6/21fdXOZ73a0GjV
         407g==
X-Gm-Message-State: AOAM533Uy6Z5NSpXz829GCuPAQidO7aBxNFxfg+Gt8kQx8eVYIYC2oW5
	p/Dm05DR/qy6rrOMQWAxlSo=
X-Google-Smtp-Source: ABdhPJwMSv5PCu1UCUgMnqgMVqFc4Ao6WzzOeUM6UlifqnxKY4SjgVg5bdKRHNA40E6DgZ1OQbENJg==
X-Received: by 2002:a17:906:9397:b0:6e7:eb3a:ec2d with SMTP id l23-20020a170906939700b006e7eb3aec2dmr12171586ejx.257.1649321993683;
        Thu, 07 Apr 2022 01:59:53 -0700 (PDT)
Received: from able.fritz.box (p57b0b9e1.dip0.t-ipconnect.de. [87.176.185.225])
        by smtp.gmail.com with ESMTPSA id h26-20020a170906111a00b006e778bd4fc8sm5186563eja.38.2022.04.07.01.59.52
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 07 Apr 2022 01:59:53 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
To: daniel.vetter@ffwll.ch,
	dri-devel@lists.freedesktop.org,
	linux-media@vger.kernel.org,
	linaro-mm-sig@lists.linaro.org,
	intel-gfx@lists.freedesktop.org
Date: Thu,  7 Apr 2022 10:59:34 +0200
Message-Id: <20220407085946.744568-4-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220407085946.744568-1-christian.koenig@amd.com>
References: <20220407085946.744568-1-christian.koenig@amd.com>
MIME-Version: 1.0
Message-ID-Hash: CW43SUE4KBHMCI4B6BOLVFMRFZ2P4JUJ
X-Message-ID-Hash: CW43SUE4KBHMCI4B6BOLVFMRFZ2P4JUJ
X-MailFrom: ckoenig.leichtzumerken@gmail.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>, amd-gfx@lists.freedesktop.org
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH 03/15] dma-buf & drm/amdgpu: remove dma_resv workaround
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/CW43SUE4KBHMCI4B6BOLVFMRFZ2P4JUJ/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

UmV3b3JrIHRoZSBpbnRlcm5hbHMgb2YgdGhlIGRtYV9yZXN2IG9iamVjdCB0byBhbGxvdyBhZGRp
bmcgbW9yZSB0aGFuIG9uZQ0Kd3JpdGUgZmVuY2UgYW5kIHJlbWVtYmVyIGZvciBlYWNoIGZlbmNl
IHdoYXQgcHVycG9zZSBpdCBoYWQuDQoNClRoaXMgYWxsb3dzIHJlbW92aW5nIHRoZSB3b3JrYXJv
dW5kIGZyb20gYW1kZ3B1IHdoaWNoIHVzZWQgYSBjb250YWluZXIgZm9yDQp0aGlzIGluc3RlYWQu
DQoNClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1k
LmNvbT4NClJldmlld2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNo
Pg0KQ2M6IGFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnDQotLS0NCiBkcml2ZXJzL2RtYS1i
dWYvZG1hLXJlc3YuYyAgICAgICAgICAgICAgICAgIHwgMzUzICsrKysrKysrLS0tLS0tLS0tLS0t
DQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2JvX2xpc3QuaCB8ICAgMSAtDQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgICB8ICA1MyArLS0NCiBp
bmNsdWRlL2xpbnV4L2RtYS1yZXN2LmggICAgICAgICAgICAgICAgICAgIHwgIDQ3ICstLQ0KIDQg
ZmlsZXMgY2hhbmdlZCwgMTU3IGluc2VydGlvbnMoKyksIDI5NyBkZWxldGlvbnMoLSkNCg0KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jIGIvZHJpdmVycy9kbWEtYnVmL2Rt
YS1yZXN2LmMNCmluZGV4IDU0M2RhZTY1NjZkMi4uMzc4ZDQ3ZTFjZmVhIDEwMDY0NA0KLS0tIGEv
ZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVz
di5jDQpAQCAtNDQsMTIgKzQ0LDEyIEBADQogLyoqDQogICogRE9DOiBSZXNlcnZhdGlvbiBPYmpl
Y3QgT3ZlcnZpZXcNCiAgKg0KLSAqIFRoZSByZXNlcnZhdGlvbiBvYmplY3QgcHJvdmlkZXMgYSBt
ZWNoYW5pc20gdG8gbWFuYWdlIHNoYXJlZCBhbmQNCi0gKiBleGNsdXNpdmUgZmVuY2VzIGFzc29j
aWF0ZWQgd2l0aCBhIGJ1ZmZlci4gIEEgcmVzZXJ2YXRpb24gb2JqZWN0DQotICogY2FuIGhhdmUg
YXR0YWNoZWQgb25lIGV4Y2x1c2l2ZSBmZW5jZSAobm9ybWFsbHkgYXNzb2NpYXRlZCB3aXRoDQot
ICogd3JpdGUgb3BlcmF0aW9ucykgb3IgTiBzaGFyZWQgZmVuY2VzIChyZWFkIG9wZXJhdGlvbnMp
LiAgVGhlIFJDVQ0KLSAqIG1lY2hhbmlzbSBpcyB1c2VkIHRvIHByb3RlY3QgcmVhZCBhY2Nlc3Mg
dG8gZmVuY2VzIGZyb20gbG9ja2VkDQotICogd3JpdGUtc2lkZSB1cGRhdGVzLg0KKyAqIFRoZSBy
ZXNlcnZhdGlvbiBvYmplY3QgcHJvdmlkZXMgYSBtZWNoYW5pc20gdG8gbWFuYWdlIGEgY29udGFp
bmVyIG9mDQorICogZG1hX2ZlbmNlIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggYSByZXNvdXJjZS4g
QSByZXNlcnZhdGlvbiBvYmplY3QNCisgKiBjYW4gaGF2ZSBhbnkgbnVtYmVyIG9mIGZlbmNlcyBh
dHRhY2hlcyB0byBpdC4gRWFjaCBmZW5jZSBjYXJyaWVzIGFuIHVzYWdlDQorICogcGFyYW1ldGVy
IGRldGVybWluaW5nIGhvdyB0aGUgb3BlcmF0aW9uIHJlcHJlc2VudGVkIGJ5IHRoZSBmZW5jZSBp
cyB1c2luZyB0aGUNCisgKiByZXNvdXJjZS4gVGhlIFJDVSBtZWNoYW5pc20gaXMgdXNlZCB0byBw
cm90ZWN0IHJlYWQgYWNjZXNzIHRvIGZlbmNlcyBmcm9tDQorICogbG9ja2VkIHdyaXRlLXNpZGUg
dXBkYXRlcy4NCiAgKg0KICAqIFNlZSBzdHJ1Y3QgZG1hX3Jlc3YgZm9yIG1vcmUgZGV0YWlscy4N
CiAgKi8NCkBAIC01NywzOSArNTcsNTkgQEANCiBERUZJTkVfV0RfQ0xBU1MocmVzZXJ2YXRpb25f
d3dfY2xhc3MpOw0KIEVYUE9SVF9TWU1CT0wocmVzZXJ2YXRpb25fd3dfY2xhc3MpOw0KIA0KKy8q
IE1hc2sgZm9yIHRoZSBsb3dlciBmZW5jZSBwb2ludGVyIGJpdHMgKi8NCisjZGVmaW5lIERNQV9S
RVNWX0xJU1RfTUFTSwkweDMNCisNCiBzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCB7DQogCXN0cnVjdCBy
Y3VfaGVhZCByY3U7DQotCXUzMiBzaGFyZWRfY291bnQsIHNoYXJlZF9tYXg7DQotCXN0cnVjdCBk
bWFfZmVuY2UgX19yY3UgKnNoYXJlZFtdOw0KKwl1MzIgbnVtX2ZlbmNlcywgbWF4X2ZlbmNlczsN
CisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqdGFibGVbXTsNCiB9Ow0KIA0KLS8qKg0KLSAqIGRt
YV9yZXN2X2xpc3RfYWxsb2MgLSBhbGxvY2F0ZSBmZW5jZSBsaXN0DQotICogQHNoYXJlZF9tYXg6
IG51bWJlciBvZiBmZW5jZXMgd2UgbmVlZCBzcGFjZSBmb3INCi0gKg0KKy8qIEV4dHJhY3QgdGhl
IGZlbmNlIGFuZCB1c2FnZSBmbGFncyBmcm9tIGFuIFJDVSBwcm90ZWN0ZWQgZW50cnkgaW4gdGhl
IGxpc3QuICovDQorc3RhdGljIHZvaWQgZG1hX3Jlc3ZfbGlzdF9lbnRyeShzdHJ1Y3QgZG1hX3Jl
c3ZfbGlzdCAqbGlzdCwgdW5zaWduZWQgaW50IGluZGV4LA0KKwkJCQlzdHJ1Y3QgZG1hX3Jlc3Yg
KnJlc3YsIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZSwNCisJCQkJZW51bSBkbWFfcmVzdl91c2Fn
ZSAqdXNhZ2UpDQorew0KKwlsb25nIHRtcDsNCisNCisJdG1wID0gKGxvbmcpcmN1X2RlcmVmZXJl
bmNlX2NoZWNrKGxpc3QtPnRhYmxlW2luZGV4XSwNCisJCQkJCSAgcmVzdiA/IGRtYV9yZXN2X2hl
bGQocmVzdikgOiB0cnVlKTsNCisJKmZlbmNlID0gKHN0cnVjdCBkbWFfZmVuY2UgKikodG1wICYg
fkRNQV9SRVNWX0xJU1RfTUFTSyk7DQorCWlmICh1c2FnZSkNCisJCSp1c2FnZSA9IHRtcCAmIERN
QV9SRVNWX0xJU1RfTUFTSzsNCit9DQorDQorLyogU2V0IHRoZSBmZW5jZSBhbmQgdXNhZ2UgZmxh
Z3MgYXQgdGhlIHNwZWNpZmljIGluZGV4IGluIHRoZSBsaXN0LiAqLw0KK3N0YXRpYyB2b2lkIGRt
YV9yZXN2X2xpc3Rfc2V0KHN0cnVjdCBkbWFfcmVzdl9saXN0ICpsaXN0LA0KKwkJCSAgICAgIHVu
c2lnbmVkIGludCBpbmRleCwNCisJCQkgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwNCisJ
CQkgICAgICBlbnVtIGRtYV9yZXN2X3VzYWdlIHVzYWdlKQ0KK3sNCisJbG9uZyB0bXAgPSAoKGxv
bmcpZmVuY2UpIHwgdXNhZ2U7DQorDQorCVJDVV9JTklUX1BPSU5URVIobGlzdC0+dGFibGVbaW5k
ZXhdLCAoc3RydWN0IGRtYV9mZW5jZSAqKXRtcCk7DQorfQ0KKw0KKy8qDQogICogQWxsb2NhdGUg
YSBuZXcgZG1hX3Jlc3ZfbGlzdCBhbmQgbWFrZSBzdXJlIHRvIGNvcnJlY3RseSBpbml0aWFsaXpl
DQotICogc2hhcmVkX21heC4NCisgKiBtYXhfZmVuY2VzLg0KICAqLw0KLXN0YXRpYyBzdHJ1Y3Qg
ZG1hX3Jlc3ZfbGlzdCAqZG1hX3Jlc3ZfbGlzdF9hbGxvYyh1bnNpZ25lZCBpbnQgc2hhcmVkX21h
eCkNCitzdGF0aWMgc3RydWN0IGRtYV9yZXN2X2xpc3QgKmRtYV9yZXN2X2xpc3RfYWxsb2ModW5z
aWduZWQgaW50IG1heF9mZW5jZXMpDQogew0KIAlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqbGlzdDsN
CiANCi0JbGlzdCA9IGttYWxsb2Moc3RydWN0X3NpemUobGlzdCwgc2hhcmVkLCBzaGFyZWRfbWF4
KSwgR0ZQX0tFUk5FTCk7DQorCWxpc3QgPSBrbWFsbG9jKHN0cnVjdF9zaXplKGxpc3QsIHRhYmxl
LCBtYXhfZmVuY2VzKSwgR0ZQX0tFUk5FTCk7DQogCWlmICghbGlzdCkNCiAJCXJldHVybiBOVUxM
Ow0KIA0KLQlsaXN0LT5zaGFyZWRfbWF4ID0gKGtzaXplKGxpc3QpIC0gb2Zmc2V0b2YodHlwZW9m
KCpsaXN0KSwgc2hhcmVkKSkgLw0KLQkJc2l6ZW9mKCpsaXN0LT5zaGFyZWQpOw0KKwlsaXN0LT5t
YXhfZmVuY2VzID0gKGtzaXplKGxpc3QpIC0gb2Zmc2V0b2YodHlwZW9mKCpsaXN0KSwgdGFibGUp
KSAvDQorCQlzaXplb2YoKmxpc3QtPnRhYmxlKTsNCiANCiAJcmV0dXJuIGxpc3Q7DQogfQ0KIA0K
LS8qKg0KLSAqIGRtYV9yZXN2X2xpc3RfZnJlZSAtIGZyZWUgZmVuY2UgbGlzdA0KLSAqIEBsaXN0
OiBsaXN0IHRvIGZyZWUNCi0gKg0KLSAqIEZyZWUgYSBkbWFfcmVzdl9saXN0IGFuZCBtYWtlIHN1
cmUgdG8gZHJvcCBhbGwgcmVmZXJlbmNlcy4NCi0gKi8NCisvKiBGcmVlIGEgZG1hX3Jlc3ZfbGlz
dCBhbmQgbWFrZSBzdXJlIHRvIGRyb3AgYWxsIHJlZmVyZW5jZXMuICovDQogc3RhdGljIHZvaWQg
ZG1hX3Jlc3ZfbGlzdF9mcmVlKHN0cnVjdCBkbWFfcmVzdl9saXN0ICpsaXN0KQ0KIHsNCiAJdW5z
aWduZWQgaW50IGk7DQpAQCAtOTcsOSArMTE3LDEyIEBAIHN0YXRpYyB2b2lkIGRtYV9yZXN2X2xp
c3RfZnJlZShzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqbGlzdCkNCiAJaWYgKCFsaXN0KQ0KIAkJcmV0
dXJuOw0KIA0KLQlmb3IgKGkgPSAwOyBpIDwgbGlzdC0+c2hhcmVkX2NvdW50OyArK2kpDQotCQlk
bWFfZmVuY2VfcHV0KHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQobGlzdC0+c2hhcmVkW2ldLCB0
cnVlKSk7DQorCWZvciAoaSA9IDA7IGkgPCBsaXN0LT5udW1fZmVuY2VzOyArK2kpIHsNCisJCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlOw0KIA0KKwkJZG1hX3Jlc3ZfbGlzdF9lbnRyeShsaXN0LCBp
LCBOVUxMLCAmZmVuY2UsIE5VTEwpOw0KKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7DQorCX0NCiAJ
a2ZyZWVfcmN1KGxpc3QsIHJjdSk7DQogfQ0KIA0KQEAgLTExMiw4ICsxMzUsNyBAQCB2b2lkIGRt
YV9yZXN2X2luaXQoc3RydWN0IGRtYV9yZXN2ICpvYmopDQogCXd3X211dGV4X2luaXQoJm9iai0+
bG9jaywgJnJlc2VydmF0aW9uX3d3X2NsYXNzKTsNCiAJc2VxY291bnRfd3dfbXV0ZXhfaW5pdCgm
b2JqLT5zZXEsICZvYmotPmxvY2spOw0KIA0KLQlSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVuY2Us
IE5VTEwpOw0KLQlSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVuY2VfZXhjbCwgTlVMTCk7DQorCVJD
VV9JTklUX1BPSU5URVIob2JqLT5mZW5jZXMsIE5VTEwpOw0KIH0NCiBFWFBPUlRfU1lNQk9MKGRt
YV9yZXN2X2luaXQpOw0KIA0KQEAgLTEyMyw0NiArMTQ1LDMyIEBAIEVYUE9SVF9TWU1CT0woZG1h
X3Jlc3ZfaW5pdCk7DQogICovDQogdm9pZCBkbWFfcmVzdl9maW5pKHN0cnVjdCBkbWFfcmVzdiAq
b2JqKQ0KIHsNCi0Jc3RydWN0IGRtYV9yZXN2X2xpc3QgKmZvYmo7DQotCXN0cnVjdCBkbWFfZmVu
Y2UgKmV4Y2w7DQotDQogCS8qDQogCSAqIFRoaXMgb2JqZWN0IHNob3VsZCBiZSBkZWFkIGFuZCBh
bGwgcmVmZXJlbmNlcyBtdXN0IGhhdmUNCiAJICogYmVlbiByZWxlYXNlZCB0byBpdCwgc28gbm8g
bmVlZCB0byBiZSBwcm90ZWN0ZWQgd2l0aCByY3UuDQogCSAqLw0KLQlleGNsID0gcmN1X2RlcmVm
ZXJlbmNlX3Byb3RlY3RlZChvYmotPmZlbmNlX2V4Y2wsIDEpOw0KLQlpZiAoZXhjbCkNCi0JCWRt
YV9mZW5jZV9wdXQoZXhjbCk7DQotDQotCWZvYmogPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVk
KG9iai0+ZmVuY2UsIDEpOw0KLQlkbWFfcmVzdl9saXN0X2ZyZWUoZm9iaik7DQorCWRtYV9yZXN2
X2xpc3RfZnJlZShyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9iai0+ZmVuY2VzLCB0cnVlKSk7
DQogCXd3X211dGV4X2Rlc3Ryb3koJm9iai0+bG9jayk7DQogfQ0KIEVYUE9SVF9TWU1CT0woZG1h
X3Jlc3ZfZmluaSk7DQogDQotc3RhdGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICoNCi1kbWFf
cmVzdl9leGNsX2ZlbmNlKHN0cnVjdCBkbWFfcmVzdiAqb2JqKQ0KLXsNCi0gICAgICAgcmV0dXJu
IHJjdV9kZXJlZmVyZW5jZV9jaGVjayhvYmotPmZlbmNlX2V4Y2wsIGRtYV9yZXN2X2hlbGQob2Jq
KSk7DQotfQ0KLQ0KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9yZXN2X2xpc3QgKmRtYV9yZXN2
X3NoYXJlZF9saXN0KHN0cnVjdCBkbWFfcmVzdiAqb2JqKQ0KKy8qIERlcmVmZXJlbmNlIHRoZSBm
ZW5jZXMgd2hpbGUgZW5zdXJpbmcgUkNVIHJ1bGVzICovDQorc3RhdGljIGlubGluZSBzdHJ1Y3Qg
ZG1hX3Jlc3ZfbGlzdCAqZG1hX3Jlc3ZfZmVuY2VzX2xpc3Qoc3RydWN0IGRtYV9yZXN2ICpvYmop
DQogew0KLQlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX2NoZWNrKG9iai0+ZmVuY2UsIGRtYV9yZXN2
X2hlbGQob2JqKSk7DQorCXJldHVybiByY3VfZGVyZWZlcmVuY2VfY2hlY2sob2JqLT5mZW5jZXMs
IGRtYV9yZXN2X2hlbGQob2JqKSk7DQogfQ0KIA0KIC8qKg0KLSAqIGRtYV9yZXN2X3Jlc2VydmVf
ZmVuY2VzIC0gUmVzZXJ2ZSBzcGFjZSB0byBhZGQgc2hhcmVkIGZlbmNlcyB0bw0KLSAqIGEgZG1h
X3Jlc3YuDQorICogZG1hX3Jlc3ZfcmVzZXJ2ZV9mZW5jZXMgLSBSZXNlcnZlIHNwYWNlIHRvIGFk
ZCBmZW5jZXMgdG8gYSBkbWFfcmVzdiBvYmplY3QuDQogICogQG9iajogcmVzZXJ2YXRpb24gb2Jq
ZWN0DQogICogQG51bV9mZW5jZXM6IG51bWJlciBvZiBmZW5jZXMgd2Ugd2FudCB0byBhZGQNCiAg
Kg0KLSAqIFNob3VsZCBiZSBjYWxsZWQgYmVmb3JlIGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2Uo
KS4gIE11c3QNCi0gKiBiZSBjYWxsZWQgd2l0aCBAb2JqIGxvY2tlZCB0aHJvdWdoIGRtYV9yZXN2
X2xvY2soKS4NCisgKiBTaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBkbWFfcmVzdl9hZGRfZmVuY2Uo
KS4gIE11c3QgYmUgY2FsbGVkIHdpdGggQG9iag0KKyAqIGxvY2tlZCB0aHJvdWdoIGRtYV9yZXN2
X2xvY2soKS4NCiAgKg0KICAqIE5vdGUgdGhhdCB0aGUgcHJlYWxsb2NhdGVkIHNsb3RzIG5lZWQg
dG8gYmUgcmUtcmVzZXJ2ZWQgaWYgQG9iaiBpcyB1bmxvY2tlZA0KLSAqIGF0IGFueSB0aW1lIGJl
Zm9yZSBjYWxsaW5nIGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2UoKS4gVGhpcyBpcyB2YWxpZGF0
ZWQNCi0gKiB3aGVuIENPTkZJR19ERUJVR19NVVRFWEVTIGlzIGVuYWJsZWQuDQorICogYXQgYW55
IHRpbWUgYmVmb3JlIGNhbGxpbmcgZG1hX3Jlc3ZfYWRkX2ZlbmNlKCkuIFRoaXMgaXMgdmFsaWRh
dGVkIHdoZW4NCisgKiBDT05GSUdfREVCVUdfTVVURVhFUyBpcyBlbmFibGVkLg0KICAqDQogICog
UkVUVVJOUw0KICAqIFplcm8gZm9yIHN1Y2Nlc3MsIG9yIC1lcnJubw0KQEAgLTE3NCwxMSArMTgy
LDExIEBAIGludCBkbWFfcmVzdl9yZXNlcnZlX2ZlbmNlcyhzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwg
dW5zaWduZWQgaW50IG51bV9mZW5jZXMpDQogDQogCWRtYV9yZXN2X2Fzc2VydF9oZWxkKG9iaik7
DQogDQotCW9sZCA9IGRtYV9yZXN2X3NoYXJlZF9saXN0KG9iaik7DQotCWlmIChvbGQgJiYgb2xk
LT5zaGFyZWRfbWF4KSB7DQotCQlpZiAoKG9sZC0+c2hhcmVkX2NvdW50ICsgbnVtX2ZlbmNlcykg
PD0gb2xkLT5zaGFyZWRfbWF4KQ0KKwlvbGQgPSBkbWFfcmVzdl9mZW5jZXNfbGlzdChvYmopOw0K
KwlpZiAob2xkICYmIG9sZC0+bWF4X2ZlbmNlcykgew0KKwkJaWYgKChvbGQtPm51bV9mZW5jZXMg
KyBudW1fZmVuY2VzKSA8PSBvbGQtPm1heF9mZW5jZXMpDQogCQkJcmV0dXJuIDA7DQotCQltYXgg
PSBtYXgob2xkLT5zaGFyZWRfY291bnQgKyBudW1fZmVuY2VzLCBvbGQtPnNoYXJlZF9tYXggKiAy
KTsNCisJCW1heCA9IG1heChvbGQtPm51bV9mZW5jZXMgKyBudW1fZmVuY2VzLCBvbGQtPm1heF9m
ZW5jZXMgKiAyKTsNCiAJfSBlbHNlIHsNCiAJCW1heCA9IG1heCg0dWwsIHJvdW5kdXBfcG93X29m
X3R3byhudW1fZmVuY2VzKSk7DQogCX0NCkBAIC0xOTMsMjcgKzIwMSwyNyBAQCBpbnQgZG1hX3Jl
c3ZfcmVzZXJ2ZV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2ICpvYmosIHVuc2lnbmVkIGludCBudW1f
ZmVuY2VzKQ0KIAkgKiByZWZlcmVuY2VzIGZyb20gdGhlIG9sZCBzdHJ1Y3QgYXJlIGNhcnJpZWQg
b3ZlciB0bw0KIAkgKiB0aGUgbmV3Lg0KIAkgKi8NCi0JZm9yIChpID0gMCwgaiA9IDAsIGsgPSBt
YXg7IGkgPCAob2xkID8gb2xkLT5zaGFyZWRfY291bnQgOiAwKTsgKytpKSB7DQorCWZvciAoaSA9
IDAsIGogPSAwLCBrID0gbWF4OyBpIDwgKG9sZCA/IG9sZC0+bnVtX2ZlbmNlcyA6IDApOyArK2kp
IHsNCisJCWVudW0gZG1hX3Jlc3ZfdXNhZ2UgdXNhZ2U7DQogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZTsNCiANCi0JCWZlbmNlID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChvbGQtPnNoYXJl
ZFtpXSwNCi0JCQkJCQkgIGRtYV9yZXN2X2hlbGQob2JqKSk7DQorCQlkbWFfcmVzdl9saXN0X2Vu
dHJ5KG9sZCwgaSwgb2JqLCAmZmVuY2UsICZ1c2FnZSk7DQogCQlpZiAoZG1hX2ZlbmNlX2lzX3Np
Z25hbGVkKGZlbmNlKSkNCi0JCQlSQ1VfSU5JVF9QT0lOVEVSKG5ldy0+c2hhcmVkWy0ta10sIGZl
bmNlKTsNCisJCQlSQ1VfSU5JVF9QT0lOVEVSKG5ldy0+dGFibGVbLS1rXSwgZmVuY2UpOw0KIAkJ
ZWxzZQ0KLQkJCVJDVV9JTklUX1BPSU5URVIobmV3LT5zaGFyZWRbaisrXSwgZmVuY2UpOw0KKwkJ
CWRtYV9yZXN2X2xpc3Rfc2V0KG5ldywgaisrLCBmZW5jZSwgdXNhZ2UpOw0KIAl9DQotCW5ldy0+
c2hhcmVkX2NvdW50ID0gajsNCisJbmV3LT5udW1fZmVuY2VzID0gajsNCiANCiAJLyoNCiAJICog
V2UgYXJlIG5vdCBjaGFuZ2luZyB0aGUgZWZmZWN0aXZlIHNldCBvZiBmZW5jZXMgaGVyZSBzbyBj
YW4NCiAJICogbWVyZWx5IHVwZGF0ZSB0aGUgcG9pbnRlciB0byB0aGUgbmV3IGFycmF5OyBib3Ro
IGV4aXN0aW5nDQogCSAqIHJlYWRlcnMgYW5kIG5ldyByZWFkZXJzIHdpbGwgc2VlIGV4YWN0bHkg
dGhlIHNhbWUgc2V0IG9mDQotCSAqIGFjdGl2ZSAodW5zaWduYWxlZCkgc2hhcmVkIGZlbmNlcy4g
SW5kaXZpZHVhbCBmZW5jZXMgYW5kIHRoZQ0KKwkgKiBhY3RpdmUgKHVuc2lnbmFsZWQpIGZlbmNl
cy4gSW5kaXZpZHVhbCBmZW5jZXMgYW5kIHRoZQ0KIAkgKiBvbGQgYXJyYXkgYXJlIHByb3RlY3Rl
ZCBieSBSQ1UgYW5kIHNvIHdpbGwgbm90IHZhbmlzaCB1bmRlcg0KIAkgKiB0aGUgZ2F6ZSBvZiB0
aGUgcmN1X3JlYWRfbG9jaygpIHJlYWRlcnMuDQogCSAqLw0KLQlyY3VfYXNzaWduX3BvaW50ZXIo
b2JqLT5mZW5jZSwgbmV3KTsNCisJcmN1X2Fzc2lnbl9wb2ludGVyKG9iai0+ZmVuY2VzLCBuZXcp
Ow0KIA0KIAlpZiAoIW9sZCkNCiAJCXJldHVybiAwOw0KQEAgLTIyMiw3ICsyMzAsNyBAQCBpbnQg
ZG1hX3Jlc3ZfcmVzZXJ2ZV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2ICpvYmosIHVuc2lnbmVkIGlu
dCBudW1fZmVuY2VzKQ0KIAlmb3IgKGkgPSBrOyBpIDwgbWF4OyArK2kpIHsNCiAJCXN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlOw0KIA0KLQkJZmVuY2UgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVk
KG5ldy0+c2hhcmVkW2ldLA0KKwkJZmVuY2UgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG5l
dy0+dGFibGVbaV0sDQogCQkJCQkJICBkbWFfcmVzdl9oZWxkKG9iaikpOw0KIAkJZG1hX2ZlbmNl
X3B1dChmZW5jZSk7DQogCX0NCkBAIC0yMzQsMzggKzI0MiwzOSBAQCBFWFBPUlRfU1lNQk9MKGRt
YV9yZXN2X3Jlc2VydmVfZmVuY2VzKTsNCiANCiAjaWZkZWYgQ09ORklHX0RFQlVHX01VVEVYRVMN
CiAvKioNCi0gKiBkbWFfcmVzdl9yZXNldF9tYXhfZmVuY2VzIC0gcmVzZXQgc2hhcmVkIGZlbmNl
cyBmb3IgZGVidWdnaW5nDQorICogZG1hX3Jlc3ZfcmVzZXRfbWF4X2ZlbmNlcyAtIHJlc2V0IGZl
bmNlcyBmb3IgZGVidWdnaW5nDQogICogQG9iajogdGhlIGRtYV9yZXN2IG9iamVjdCB0byByZXNl
dA0KICAqDQotICogUmVzZXQgdGhlIG51bWJlciBvZiBwcmUtcmVzZXJ2ZWQgc2hhcmVkIHNsb3Rz
IHRvIHRlc3QgdGhhdCBkcml2ZXJzIGRvDQorICogUmVzZXQgdGhlIG51bWJlciBvZiBwcmUtcmVz
ZXJ2ZWQgZmVuY2Ugc2xvdHMgdG8gdGVzdCB0aGF0IGRyaXZlcnMgZG8NCiAgKiBjb3JyZWN0IHNs
b3QgYWxsb2NhdGlvbiB1c2luZyBkbWFfcmVzdl9yZXNlcnZlX2ZlbmNlcygpLiBTZWUgYWxzbw0K
LSAqICZkbWFfcmVzdl9saXN0LnNoYXJlZF9tYXguDQorICogJmRtYV9yZXN2X2xpc3QubWF4X2Zl
bmNlcy4NCiAgKi8NCiB2b2lkIGRtYV9yZXN2X3Jlc2V0X21heF9mZW5jZXMoc3RydWN0IGRtYV9y
ZXN2ICpvYmopDQogew0KLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqZmVuY2VzID0gZG1hX3Jlc3Zf
c2hhcmVkX2xpc3Qob2JqKTsNCisJc3RydWN0IGRtYV9yZXN2X2xpc3QgKmZlbmNlcyA9IGRtYV9y
ZXN2X2ZlbmNlc19saXN0KG9iaik7DQogDQogCWRtYV9yZXN2X2Fzc2VydF9oZWxkKG9iaik7DQog
DQotCS8qIFRlc3Qgc2hhcmVkIGZlbmNlIHNsb3QgcmVzZXJ2YXRpb24gKi8NCisJLyogVGVzdCBm
ZW5jZSBzbG90IHJlc2VydmF0aW9uICovDQogCWlmIChmZW5jZXMpDQotCQlmZW5jZXMtPnNoYXJl
ZF9tYXggPSBmZW5jZXMtPnNoYXJlZF9jb3VudDsNCisJCWZlbmNlcy0+bWF4X2ZlbmNlcyA9IGZl
bmNlcy0+bnVtX2ZlbmNlczsNCiB9DQogRVhQT1JUX1NZTUJPTChkbWFfcmVzdl9yZXNldF9tYXhf
ZmVuY2VzKTsNCiAjZW5kaWYNCiANCiAvKioNCi0gKiBkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNl
IC0gQWRkIGEgZmVuY2UgdG8gYSBzaGFyZWQgc2xvdA0KKyAqIGRtYV9yZXN2X2FkZF9mZW5jZSAt
IEFkZCBhIGZlbmNlIHRvIHRoZSBkbWFfcmVzdiBvYmoNCiAgKiBAb2JqOiB0aGUgcmVzZXJ2YXRp
b24gb2JqZWN0DQotICogQGZlbmNlOiB0aGUgc2hhcmVkIGZlbmNlIHRvIGFkZA0KKyAqIEBmZW5j
ZTogdGhlIGZlbmNlIHRvIGFkZA0KKyAqIEB1c2FnZTogaG93IHRoZSBmZW5jZSBpcyB1c2VkLCBz
ZWUgZW51bSBkbWFfcmVzdl91c2FnZQ0KICAqDQotICogQWRkIGEgZmVuY2UgdG8gYSBzaGFyZWQg
c2xvdCwgQG9iaiBtdXN0IGJlIGxvY2tlZCB3aXRoIGRtYV9yZXN2X2xvY2soKSwgYW5kDQorICog
QWRkIGEgZmVuY2UgdG8gYSBzbG90LCBAb2JqIG11c3QgYmUgbG9ja2VkIHdpdGggZG1hX3Jlc3Zf
bG9jaygpLCBhbmQNCiAgKiBkbWFfcmVzdl9yZXNlcnZlX2ZlbmNlcygpIGhhcyBiZWVuIGNhbGxl
ZC4NCiAgKg0KICAqIFNlZSBhbHNvICZkbWFfcmVzdi5mZW5jZSBmb3IgYSBkaXNjdXNzaW9uIG9m
IHRoZSBzZW1hbnRpY3MuDQogICovDQotc3RhdGljIHZvaWQgZG1hX3Jlc3ZfYWRkX3NoYXJlZF9m
ZW5jZShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwNCi0JCQkJICAgICAgc3RydWN0IGRtYV9mZW5jZSAq
ZmVuY2UpDQordm9pZCBkbWFfcmVzdl9hZGRfZmVuY2Uoc3RydWN0IGRtYV9yZXN2ICpvYmosIHN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlLA0KKwkJCWVudW0gZG1hX3Jlc3ZfdXNhZ2UgdXNhZ2UpDQog
ew0KIAlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqZm9iajsNCiAJc3RydWN0IGRtYV9mZW5jZSAqb2xk
Ow0KQEAgLTI4MCwzMiArMjg5LDMzIEBAIHN0YXRpYyB2b2lkIGRtYV9yZXN2X2FkZF9zaGFyZWRf
ZmVuY2Uoc3RydWN0IGRtYV9yZXN2ICpvYmosDQogCSAqLw0KIAlXQVJOX09OKGRtYV9mZW5jZV9p
c19jb250YWluZXIoZmVuY2UpKTsNCiANCi0JZm9iaiA9IGRtYV9yZXN2X3NoYXJlZF9saXN0KG9i
aik7DQotCWNvdW50ID0gZm9iai0+c2hhcmVkX2NvdW50Ow0KKwlmb2JqID0gZG1hX3Jlc3ZfZmVu
Y2VzX2xpc3Qob2JqKTsNCisJY291bnQgPSBmb2JqLT5udW1fZmVuY2VzOw0KIA0KIAl3cml0ZV9z
ZXFjb3VudF9iZWdpbigmb2JqLT5zZXEpOw0KIA0KIAlmb3IgKGkgPSAwOyBpIDwgY291bnQ7ICsr
aSkgew0KKwkJZW51bSBkbWFfcmVzdl91c2FnZSBvbGRfdXNhZ2U7DQogDQotCQlvbGQgPSByY3Vf
ZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGZvYmotPnNoYXJlZFtpXSwNCi0JCQkJCQlkbWFfcmVzdl9o
ZWxkKG9iaikpOw0KLQkJaWYgKG9sZC0+Y29udGV4dCA9PSBmZW5jZS0+Y29udGV4dCB8fA0KKwkJ
ZG1hX3Jlc3ZfbGlzdF9lbnRyeShmb2JqLCBpLCBvYmosICZvbGQsICZvbGRfdXNhZ2UpOw0KKwkJ
aWYgKChvbGQtPmNvbnRleHQgPT0gZmVuY2UtPmNvbnRleHQgJiYgb2xkX3VzYWdlID49IHVzYWdl
KSB8fA0KIAkJICAgIGRtYV9mZW5jZV9pc19zaWduYWxlZChvbGQpKQ0KIAkJCWdvdG8gcmVwbGFj
ZTsNCiAJfQ0KIA0KLQlCVUdfT04oZm9iai0+c2hhcmVkX2NvdW50ID49IGZvYmotPnNoYXJlZF9t
YXgpOw0KKwlCVUdfT04oZm9iai0+bnVtX2ZlbmNlcyA+PSBmb2JqLT5tYXhfZmVuY2VzKTsNCiAJ
b2xkID0gTlVMTDsNCiAJY291bnQrKzsNCiANCiByZXBsYWNlOg0KLQlSQ1VfSU5JVF9QT0lOVEVS
KGZvYmotPnNoYXJlZFtpXSwgZmVuY2UpOw0KLQkvKiBwb2ludGVyIHVwZGF0ZSBtdXN0IGJlIHZp
c2libGUgYmVmb3JlIHdlIGV4dGVuZCB0aGUgc2hhcmVkX2NvdW50ICovDQotCXNtcF9zdG9yZV9t
Yihmb2JqLT5zaGFyZWRfY291bnQsIGNvdW50KTsNCisJZG1hX3Jlc3ZfbGlzdF9zZXQoZm9iaiwg
aSwgZmVuY2UsIHVzYWdlKTsNCisJLyogcG9pbnRlciB1cGRhdGUgbXVzdCBiZSB2aXNpYmxlIGJl
Zm9yZSB3ZSBleHRlbmQgdGhlIG51bV9mZW5jZXMgKi8NCisJc21wX3N0b3JlX21iKGZvYmotPm51
bV9mZW5jZXMsIGNvdW50KTsNCiANCiAJd3JpdGVfc2VxY291bnRfZW5kKCZvYmotPnNlcSk7DQog
CWRtYV9mZW5jZV9wdXQob2xkKTsNCiB9DQorRVhQT1JUX1NZTUJPTChkbWFfcmVzdl9hZGRfZmVu
Y2UpOw0KIA0KIC8qKg0KICAqIGRtYV9yZXN2X3JlcGxhY2VfZmVuY2VzIC0gcmVwbGFjZSBmZW5j
ZXMgaW4gdGhlIGRtYV9yZXN2IG9iag0KQEAgLTMyNiwxMjggKzMzNiw2MyBAQCB2b2lkIGRtYV9y
ZXN2X3JlcGxhY2VfZmVuY2VzKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCB1aW50NjRfdCBjb250ZXh0
LA0KIAkJCSAgICAgZW51bSBkbWFfcmVzdl91c2FnZSB1c2FnZSkNCiB7DQogCXN0cnVjdCBkbWFf
cmVzdl9saXN0ICpsaXN0Ow0KLQlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7DQogCXVuc2lnbmVkIGlu
dCBpOw0KIA0KLQkvKiBPbmx5IHJlYWRlcnMgc3VwcG9ydGVkIGZvciBub3cgKi8NCi0JV0FSTl9P
Tih1c2FnZSAhPSBETUFfUkVTVl9VU0FHRV9SRUFEKTsNCi0NCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hl
bGQob2JqKTsNCiANCisJbGlzdCA9IGRtYV9yZXN2X2ZlbmNlc19saXN0KG9iaik7DQogCXdyaXRl
X3NlcWNvdW50X2JlZ2luKCZvYmotPnNlcSk7DQorCWZvciAoaSA9IDA7IGxpc3QgJiYgaSA8IGxp
c3QtPm51bV9mZW5jZXM7ICsraSkgew0KKwkJc3RydWN0IGRtYV9mZW5jZSAqb2xkOw0KIA0KLQlv
bGQgPSBkbWFfcmVzdl9leGNsX2ZlbmNlKG9iaik7DQotCWlmIChvbGQtPmNvbnRleHQgPT0gY29u
dGV4dCkgew0KLQkJUkNVX0lOSVRfUE9JTlRFUihvYmotPmZlbmNlX2V4Y2wsIGRtYV9mZW5jZV9n
ZXQocmVwbGFjZW1lbnQpKTsNCi0JCWRtYV9mZW5jZV9wdXQob2xkKTsNCi0JfQ0KLQ0KLQlsaXN0
ID0gZG1hX3Jlc3Zfc2hhcmVkX2xpc3Qob2JqKTsNCi0JZm9yIChpID0gMDsgbGlzdCAmJiBpIDwg
bGlzdC0+c2hhcmVkX2NvdW50OyArK2kpIHsNCi0JCW9sZCA9IHJjdV9kZXJlZmVyZW5jZV9wcm90
ZWN0ZWQobGlzdC0+c2hhcmVkW2ldLA0KLQkJCQkJCWRtYV9yZXN2X2hlbGQob2JqKSk7DQorCQlk
bWFfcmVzdl9saXN0X2VudHJ5KGxpc3QsIGksIG9iaiwgJm9sZCwgTlVMTCk7DQogCQlpZiAob2xk
LT5jb250ZXh0ICE9IGNvbnRleHQpDQogCQkJY29udGludWU7DQogDQotCQlyY3VfYXNzaWduX3Bv
aW50ZXIobGlzdC0+c2hhcmVkW2ldLCBkbWFfZmVuY2VfZ2V0KHJlcGxhY2VtZW50KSk7DQorCQlk
bWFfcmVzdl9saXN0X3NldChsaXN0LCBpLCByZXBsYWNlbWVudCwgdXNhZ2UpOw0KIAkJZG1hX2Zl
bmNlX3B1dChvbGQpOw0KIAl9DQotDQogCXdyaXRlX3NlcWNvdW50X2VuZCgmb2JqLT5zZXEpOw0K
IH0NCiBFWFBPUlRfU1lNQk9MKGRtYV9yZXN2X3JlcGxhY2VfZmVuY2VzKTsNCiANCi0vKioNCi0g
KiBkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZSAtIEFkZCBhbiBleGNsdXNpdmUgZmVuY2UuDQotICog
QG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdA0KLSAqIEBmZW5jZTogdGhlIGV4Y2x1c2l2ZSBm
ZW5jZSB0byBhZGQNCi0gKg0KLSAqIEFkZCBhIGZlbmNlIHRvIHRoZSBleGNsdXNpdmUgc2xvdC4g
QG9iaiBtdXN0IGJlIGxvY2tlZCB3aXRoIGRtYV9yZXN2X2xvY2soKS4NCi0gKiBTZWUgYWxzbyAm
ZG1hX3Jlc3YuZmVuY2VfZXhjbCBmb3IgYSBkaXNjdXNzaW9uIG9mIHRoZSBzZW1hbnRpY3MuDQot
ICovDQotc3RhdGljIHZvaWQgZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uoc3RydWN0IGRtYV9yZXN2
ICpvYmosDQotCQkJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkNCi17DQotCXN0cnVjdCBk
bWFfZmVuY2UgKm9sZF9mZW5jZSA9IGRtYV9yZXN2X2V4Y2xfZmVuY2Uob2JqKTsNCi0NCi0JZG1h
X3Jlc3ZfYXNzZXJ0X2hlbGQob2JqKTsNCi0NCi0JZG1hX2ZlbmNlX2dldChmZW5jZSk7DQotDQot
CXdyaXRlX3NlcWNvdW50X2JlZ2luKCZvYmotPnNlcSk7DQotCS8qIHdyaXRlX3NlcWNvdW50X2Jl
Z2luIHByb3ZpZGVzIHRoZSBuZWNlc3NhcnkgbWVtb3J5IGJhcnJpZXIgKi8NCi0JUkNVX0lOSVRf
UE9JTlRFUihvYmotPmZlbmNlX2V4Y2wsIGZlbmNlKTsNCi0Jd3JpdGVfc2VxY291bnRfZW5kKCZv
YmotPnNlcSk7DQotDQotCWRtYV9mZW5jZV9wdXQob2xkX2ZlbmNlKTsNCi19DQotDQotLyoqDQot
ICogZG1hX3Jlc3ZfYWRkX2ZlbmNlIC0gQWRkIGEgZmVuY2UgdG8gdGhlIGRtYV9yZXN2IG9iag0K
LSAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBvYmplY3QNCi0gKiBAZmVuY2U6IHRoZSBmZW5jZSB0
byBhZGQNCi0gKiBAdXNhZ2U6IGhvdyB0aGUgZmVuY2UgaXMgdXNlZCwgc2VlIGVudW0gZG1hX3Jl
c3ZfdXNhZ2UNCi0gKg0KLSAqIEFkZCBhIGZlbmNlIHRvIGEgc2xvdCwgQG9iaiBtdXN0IGJlIGxv
Y2tlZCB3aXRoIGRtYV9yZXN2X2xvY2soKSwgYW5kDQotICogZG1hX3Jlc3ZfcmVzZXJ2ZV9mZW5j
ZXMoKSBoYXMgYmVlbiBjYWxsZWQuDQotICoNCi0gKiBTZWUgYWxzbyAmZG1hX3Jlc3YuZmVuY2Ug
Zm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGUgc2VtYW50aWNzLg0KLSAqLw0KLXZvaWQgZG1hX3Jlc3Zf
YWRkX2ZlbmNlKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwN
Ci0JCQllbnVtIGRtYV9yZXN2X3VzYWdlIHVzYWdlKQ0KLXsNCi0JaWYgKHVzYWdlID09IERNQV9S
RVNWX1VTQUdFX1dSSVRFKQ0KLQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLCBmZW5jZSk7
DQotCWVsc2UNCi0JCWRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2Uob2JqLCBmZW5jZSk7DQotfQ0K
LUVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfYWRkX2ZlbmNlKTsNCi0NCi0vKiBSZXN0YXJ0IHRoZSBp
dGVyYXRvciBieSBpbml0aWFsaXppbmcgYWxsIHRoZSBuZWNlc3NhcnkgZmllbGRzLCBidXQgbm90
IHRoZQ0KLSAqIHJlbGF0aW9uIHRvIHRoZSBkbWFfcmVzdiBvYmplY3QuICovDQorLyogUmVzdGFy
dCB0aGUgdW5sb2NrZWQgaXRlcmF0aW9uIGJ5IGluaXRpYWxpemluZyB0aGUgY3Vyc29yIG9iamVj
dC4gKi8NCiBzdGF0aWMgdm9pZCBkbWFfcmVzdl9pdGVyX3Jlc3RhcnRfdW5sb2NrZWQoc3RydWN0
IGRtYV9yZXN2X2l0ZXIgKmN1cnNvcikNCiB7DQogCWN1cnNvci0+c2VxID0gcmVhZF9zZXFjb3Vu
dF9iZWdpbigmY3Vyc29yLT5vYmotPnNlcSk7DQotCWN1cnNvci0+aW5kZXggPSAtMTsNCi0JY3Vy
c29yLT5zaGFyZWRfY291bnQgPSAwOw0KLQlpZiAoY3Vyc29yLT51c2FnZSA+PSBETUFfUkVTVl9V
U0FHRV9SRUFEKSB7DQotCQljdXJzb3ItPmZlbmNlcyA9IGRtYV9yZXN2X3NoYXJlZF9saXN0KGN1
cnNvci0+b2JqKTsNCi0JCWlmIChjdXJzb3ItPmZlbmNlcykNCi0JCQljdXJzb3ItPnNoYXJlZF9j
b3VudCA9IGN1cnNvci0+ZmVuY2VzLT5zaGFyZWRfY291bnQ7DQotCX0gZWxzZSB7DQotCQljdXJz
b3ItPmZlbmNlcyA9IE5VTEw7DQotCX0NCisJY3Vyc29yLT5pbmRleCA9IDA7DQorCWN1cnNvci0+
bnVtX2ZlbmNlcyA9IDA7DQorCWN1cnNvci0+ZmVuY2VzID0gZG1hX3Jlc3ZfZmVuY2VzX2xpc3Qo
Y3Vyc29yLT5vYmopOw0KKwlpZiAoY3Vyc29yLT5mZW5jZXMpDQorCQljdXJzb3ItPm51bV9mZW5j
ZXMgPSBjdXJzb3ItPmZlbmNlcy0+bnVtX2ZlbmNlczsNCiAJY3Vyc29yLT5pc19yZXN0YXJ0ZWQg
PSB0cnVlOw0KIH0NCiANCiAvKiBXYWxrIHRvIHRoZSBuZXh0IG5vdCBzaWduYWxlZCBmZW5jZSBh
bmQgZ3JhYiBhIHJlZmVyZW5jZSB0byBpdCAqLw0KIHN0YXRpYyB2b2lkIGRtYV9yZXN2X2l0ZXJf
d2Fsa191bmxvY2tlZChzdHJ1Y3QgZG1hX3Jlc3ZfaXRlciAqY3Vyc29yKQ0KIHsNCi0Jc3RydWN0
IGRtYV9yZXN2ICpvYmogPSBjdXJzb3ItPm9iajsNCisJaWYgKCFjdXJzb3ItPmZlbmNlcykNCisJ
CXJldHVybjsNCiANCiAJZG8gew0KIAkJLyogRHJvcCB0aGUgcmVmZXJlbmNlIGZyb20gdGhlIHBy
ZXZpb3VzIHJvdW5kICovDQogCQlkbWFfZmVuY2VfcHV0KGN1cnNvci0+ZmVuY2UpOw0KIA0KLQkJ
aWYgKGN1cnNvci0+aW5kZXggPT0gLTEpIHsNCi0JCQljdXJzb3ItPmZlbmNlID0gZG1hX3Jlc3Zf
ZXhjbF9mZW5jZShvYmopOw0KLQkJCWN1cnNvci0+aW5kZXgrKzsNCi0JCQlpZiAoIWN1cnNvci0+
ZmVuY2UpDQotCQkJCWNvbnRpbnVlOw0KLQ0KLQkJfSBlbHNlIGlmICghY3Vyc29yLT5mZW5jZXMg
fHwNCi0JCQkgICBjdXJzb3ItPmluZGV4ID49IGN1cnNvci0+c2hhcmVkX2NvdW50KSB7DQorCQlp
ZiAoY3Vyc29yLT5pbmRleCA+PSBjdXJzb3ItPm51bV9mZW5jZXMpIHsNCiAJCQljdXJzb3ItPmZl
bmNlID0gTlVMTDsNCiAJCQlicmVhazsNCiANCi0JCX0gZWxzZSB7DQotCQkJc3RydWN0IGRtYV9y
ZXN2X2xpc3QgKmZlbmNlcyA9IGN1cnNvci0+ZmVuY2VzOw0KLQkJCXVuc2lnbmVkIGludCBpZHgg
PSBjdXJzb3ItPmluZGV4Kys7DQotDQotCQkJY3Vyc29yLT5mZW5jZSA9IHJjdV9kZXJlZmVyZW5j
ZShmZW5jZXMtPnNoYXJlZFtpZHhdKTsNCiAJCX0NCisNCisJCWRtYV9yZXN2X2xpc3RfZW50cnko
Y3Vyc29yLT5mZW5jZXMsIGN1cnNvci0+aW5kZXgrKywNCisJCQkJICAgIGN1cnNvci0+b2JqLCAm
Y3Vyc29yLT5mZW5jZSwNCisJCQkJICAgICZjdXJzb3ItPmZlbmNlX3VzYWdlKTsNCiAJCWN1cnNv
ci0+ZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShjdXJzb3ItPmZlbmNlKTsNCi0JCWlmICghY3Vy
c29yLT5mZW5jZSB8fCAhZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGN1cnNvci0+ZmVuY2UpKQ0KKwkJ
aWYgKCFjdXJzb3ItPmZlbmNlKQ0KKwkJCWJyZWFrOw0KKw0KKwkJaWYgKCFkbWFfZmVuY2VfaXNf
c2lnbmFsZWQoY3Vyc29yLT5mZW5jZSkgJiYNCisJCSAgICBjdXJzb3ItPnVzYWdlID49IGN1cnNv
ci0+ZmVuY2VfdXNhZ2UpDQogCQkJYnJlYWs7DQogCX0gd2hpbGUgKHRydWUpOw0KIH0NCkBAIC01
MjIsMTUgKzQ2Nyw5IEBAIHN0cnVjdCBkbWFfZmVuY2UgKmRtYV9yZXN2X2l0ZXJfZmlyc3Qoc3Ry
dWN0IGRtYV9yZXN2X2l0ZXIgKmN1cnNvcikNCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQoY3Vyc29y
LT5vYmopOw0KIA0KIAljdXJzb3ItPmluZGV4ID0gMDsNCi0JaWYgKGN1cnNvci0+dXNhZ2UgPj0g
RE1BX1JFU1ZfVVNBR0VfUkVBRCkNCi0JCWN1cnNvci0+ZmVuY2VzID0gZG1hX3Jlc3Zfc2hhcmVk
X2xpc3QoY3Vyc29yLT5vYmopOw0KLQllbHNlDQotCQljdXJzb3ItPmZlbmNlcyA9IE5VTEw7DQot
DQotCWZlbmNlID0gZG1hX3Jlc3ZfZXhjbF9mZW5jZShjdXJzb3ItPm9iaik7DQotCWlmICghZmVu
Y2UpDQotCQlmZW5jZSA9IGRtYV9yZXN2X2l0ZXJfbmV4dChjdXJzb3IpOw0KKwljdXJzb3ItPmZl
bmNlcyA9IGRtYV9yZXN2X2ZlbmNlc19saXN0KGN1cnNvci0+b2JqKTsNCiANCisJZmVuY2UgPSBk
bWFfcmVzdl9pdGVyX25leHQoY3Vyc29yKTsNCiAJY3Vyc29yLT5pc19yZXN0YXJ0ZWQgPSB0cnVl
Ow0KIAlyZXR1cm4gZmVuY2U7DQogfQ0KQEAgLTU0NSwxNyArNDg0LDIyIEBAIEVYUE9SVF9TWU1C
T0xfR1BMKGRtYV9yZXN2X2l0ZXJfZmlyc3QpOw0KICAqLw0KIHN0cnVjdCBkbWFfZmVuY2UgKmRt
YV9yZXN2X2l0ZXJfbmV4dChzdHJ1Y3QgZG1hX3Jlc3ZfaXRlciAqY3Vyc29yKQ0KIHsNCi0JdW5z
aWduZWQgaW50IGlkeDsNCisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7DQogDQogCWRtYV9yZXN2
X2Fzc2VydF9oZWxkKGN1cnNvci0+b2JqKTsNCiANCiAJY3Vyc29yLT5pc19yZXN0YXJ0ZWQgPSBm
YWxzZTsNCi0JaWYgKCFjdXJzb3ItPmZlbmNlcyB8fCBjdXJzb3ItPmluZGV4ID49IGN1cnNvci0+
ZmVuY2VzLT5zaGFyZWRfY291bnQpDQotCQlyZXR1cm4gTlVMTDsNCiANCi0JaWR4ID0gY3Vyc29y
LT5pbmRleCsrOw0KLQlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdXJzb3ItPmZl
bmNlcy0+c2hhcmVkW2lkeF0sDQotCQkJCQkgZG1hX3Jlc3ZfaGVsZChjdXJzb3ItPm9iaikpOw0K
KwlkbyB7DQorCQlpZiAoIWN1cnNvci0+ZmVuY2VzIHx8DQorCQkgICAgY3Vyc29yLT5pbmRleCA+
PSBjdXJzb3ItPmZlbmNlcy0+bnVtX2ZlbmNlcykNCisJCQlyZXR1cm4gTlVMTDsNCisNCisJCWRt
YV9yZXN2X2xpc3RfZW50cnkoY3Vyc29yLT5mZW5jZXMsIGN1cnNvci0+aW5kZXgrKywNCisJCQkJ
ICAgIGN1cnNvci0+b2JqLCAmZmVuY2UsICZjdXJzb3ItPmZlbmNlX3VzYWdlKTsNCisJfSB3aGls
ZSAoY3Vyc29yLT5mZW5jZV91c2FnZSA+IGN1cnNvci0+dXNhZ2UpOw0KKw0KKwlyZXR1cm4gZmVu
Y2U7DQogfQ0KIEVYUE9SVF9TWU1CT0xfR1BMKGRtYV9yZXN2X2l0ZXJfbmV4dCk7DQogDQpAQCAt
NTcwLDU3ICs1MTQsNDMgQEAgaW50IGRtYV9yZXN2X2NvcHlfZmVuY2VzKHN0cnVjdCBkbWFfcmVz
diAqZHN0LCBzdHJ1Y3QgZG1hX3Jlc3YgKnNyYykNCiB7DQogCXN0cnVjdCBkbWFfcmVzdl9pdGVy
IGN1cnNvcjsNCiAJc3RydWN0IGRtYV9yZXN2X2xpc3QgKmxpc3Q7DQotCXN0cnVjdCBkbWFfZmVu
Y2UgKmYsICpleGNsOw0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmOw0KIA0KIAlkbWFfcmVzdl9hc3Nl
cnRfaGVsZChkc3QpOw0KIA0KIAlsaXN0ID0gTlVMTDsNCi0JZXhjbCA9IE5VTEw7DQogDQogCWRt
YV9yZXN2X2l0ZXJfYmVnaW4oJmN1cnNvciwgc3JjLCBETUFfUkVTVl9VU0FHRV9SRUFEKTsNCiAJ
ZG1hX3Jlc3ZfZm9yX2VhY2hfZmVuY2VfdW5sb2NrZWQoJmN1cnNvciwgZikgew0KIA0KIAkJaWYg
KGRtYV9yZXN2X2l0ZXJfaXNfcmVzdGFydGVkKCZjdXJzb3IpKSB7DQogCQkJZG1hX3Jlc3ZfbGlz
dF9mcmVlKGxpc3QpOw0KLQkJCWRtYV9mZW5jZV9wdXQoZXhjbCk7DQotDQotCQkJaWYgKGN1cnNv
ci5zaGFyZWRfY291bnQpIHsNCi0JCQkJbGlzdCA9IGRtYV9yZXN2X2xpc3RfYWxsb2MoY3Vyc29y
LnNoYXJlZF9jb3VudCk7DQotCQkJCWlmICghbGlzdCkgew0KLQkJCQkJZG1hX3Jlc3ZfaXRlcl9l
bmQoJmN1cnNvcik7DQotCQkJCQlyZXR1cm4gLUVOT01FTTsNCi0JCQkJfQ0KIA0KLQkJCQlsaXN0
LT5zaGFyZWRfY291bnQgPSAwOw0KLQ0KLQkJCX0gZWxzZSB7DQotCQkJCWxpc3QgPSBOVUxMOw0K
KwkJCWxpc3QgPSBkbWFfcmVzdl9saXN0X2FsbG9jKGN1cnNvci5udW1fZmVuY2VzKTsNCisJCQlp
ZiAoIWxpc3QpIHsNCisJCQkJZG1hX3Jlc3ZfaXRlcl9lbmQoJmN1cnNvcik7DQorCQkJCXJldHVy
biAtRU5PTUVNOw0KIAkJCX0NCi0JCQlleGNsID0gTlVMTDsNCisJCQlsaXN0LT5udW1fZmVuY2Vz
ID0gMDsNCiAJCX0NCiANCiAJCWRtYV9mZW5jZV9nZXQoZik7DQotCQlpZiAoZG1hX3Jlc3ZfaXRl
cl91c2FnZSgmY3Vyc29yKSA9PSBETUFfUkVTVl9VU0FHRV9XUklURSkNCi0JCQlleGNsID0gZjsN
Ci0JCWVsc2UNCi0JCQlSQ1VfSU5JVF9QT0lOVEVSKGxpc3QtPnNoYXJlZFtsaXN0LT5zaGFyZWRf
Y291bnQrK10sIGYpOw0KKwkJZG1hX3Jlc3ZfbGlzdF9zZXQobGlzdCwgbGlzdC0+bnVtX2ZlbmNl
cysrLCBmLA0KKwkJCQkgIGRtYV9yZXN2X2l0ZXJfdXNhZ2UoJmN1cnNvcikpOw0KIAl9DQogCWRt
YV9yZXN2X2l0ZXJfZW5kKCZjdXJzb3IpOw0KIA0KIAl3cml0ZV9zZXFjb3VudF9iZWdpbigmZHN0
LT5zZXEpOw0KLQlleGNsID0gcmN1X3JlcGxhY2VfcG9pbnRlcihkc3QtPmZlbmNlX2V4Y2wsIGV4
Y2wsIGRtYV9yZXN2X2hlbGQoZHN0KSk7DQotCWxpc3QgPSByY3VfcmVwbGFjZV9wb2ludGVyKGRz
dC0+ZmVuY2UsIGxpc3QsIGRtYV9yZXN2X2hlbGQoZHN0KSk7DQorCWxpc3QgPSByY3VfcmVwbGFj
ZV9wb2ludGVyKGRzdC0+ZmVuY2VzLCBsaXN0LCBkbWFfcmVzdl9oZWxkKGRzdCkpOw0KIAl3cml0
ZV9zZXFjb3VudF9lbmQoJmRzdC0+c2VxKTsNCiANCiAJZG1hX3Jlc3ZfbGlzdF9mcmVlKGxpc3Qp
Ow0KLQlkbWFfZmVuY2VfcHV0KGV4Y2wpOw0KLQ0KIAlyZXR1cm4gMDsNCiB9DQogRVhQT1JUX1NZ
TUJPTChkbWFfcmVzdl9jb3B5X2ZlbmNlcyk7DQogDQogLyoqDQotICogZG1hX3Jlc3ZfZ2V0X2Zl
bmNlcyAtIEdldCBhbiBvYmplY3QncyBzaGFyZWQgYW5kIGV4Y2x1c2l2ZQ0KKyAqIGRtYV9yZXN2
X2dldF9mZW5jZXMgLSBHZXQgYW4gb2JqZWN0J3MgZmVuY2VzDQogICogZmVuY2VzIHdpdGhvdXQg
dXBkYXRlIHNpZGUgbG9jayBoZWxkDQogICogQG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdA0K
ICAqIEB1c2FnZTogY29udHJvbHMgd2hpY2ggZmVuY2VzIHRvIGluY2x1ZGUsIHNlZSBlbnVtIGRt
YV9yZXN2X3VzYWdlLg0KQEAgLTY0OSw3ICs1NzksNyBAQCBpbnQgZG1hX3Jlc3ZfZ2V0X2ZlbmNl
cyhzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgZW51bSBkbWFfcmVzdl91c2FnZSB1c2FnZSwNCiAJCQl3
aGlsZSAoKm51bV9mZW5jZXMpDQogCQkJCWRtYV9mZW5jZV9wdXQoKCpmZW5jZXMpWy0tKCpudW1f
ZmVuY2VzKV0pOw0KIA0KLQkJCWNvdW50ID0gY3Vyc29yLnNoYXJlZF9jb3VudCArIDE7DQorCQkJ
Y291bnQgPSBjdXJzb3IubnVtX2ZlbmNlcyArIDE7DQogDQogCQkJLyogRXZlbnR1YWxseSByZS1h
bGxvY2F0ZSB0aGUgYXJyYXkgKi8NCiAJCQkqZmVuY2VzID0ga3JlYWxsb2NfYXJyYXkoKmZlbmNl
cywgY291bnQsDQpAQCAtNzIzLDggKzY1Myw3IEBAIGludCBkbWFfcmVzdl9nZXRfc2luZ2xldG9u
KHN0cnVjdCBkbWFfcmVzdiAqb2JqLCBlbnVtIGRtYV9yZXN2X3VzYWdlIHVzYWdlLA0KIEVYUE9S
VF9TWU1CT0xfR1BMKGRtYV9yZXN2X2dldF9zaW5nbGV0b24pOw0KIA0KIC8qKg0KLSAqIGRtYV9y
ZXN2X3dhaXRfdGltZW91dCAtIFdhaXQgb24gcmVzZXJ2YXRpb24ncyBvYmplY3RzDQotICogc2hh
cmVkIGFuZC9vciBleGNsdXNpdmUgZmVuY2VzLg0KKyAqIGRtYV9yZXN2X3dhaXRfdGltZW91dCAt
IFdhaXQgb24gcmVzZXJ2YXRpb24ncyBvYmplY3RzIGZlbmNlcw0KICAqIEBvYmo6IHRoZSByZXNl
cnZhdGlvbiBvYmplY3QNCiAgKiBAdXNhZ2U6IGNvbnRyb2xzIHdoaWNoIGZlbmNlcyB0byBpbmNs
dWRlLCBzZWUgZW51bSBkbWFfcmVzdl91c2FnZS4NCiAgKiBAaW50cjogaWYgdHJ1ZSwgZG8gaW50
ZXJydXB0aWJsZSB3YWl0DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2JvX2xpc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9ib19s
aXN0LmgNCmluZGV4IDA0NGI0MWYwYmZkOS4uNTI5ZDUyYTIwNGNmIDEwMDY0NA0KLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2JvX2xpc3QuaA0KKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2JvX2xpc3QuaA0KQEAgLTM0LDcgKzM0LDYgQEAgc3Ry
dWN0IGFtZGdwdV9mcHJpdjsNCiBzdHJ1Y3QgYW1kZ3B1X2JvX2xpc3RfZW50cnkgew0KIAlzdHJ1
Y3QgdHRtX3ZhbGlkYXRlX2J1ZmZlcgl0djsNCiAJc3RydWN0IGFtZGdwdV9ib192YQkJKmJvX3Zh
Ow0KLQlzdHJ1Y3QgZG1hX2ZlbmNlX2NoYWluCQkqY2hhaW47DQogCXVpbnQzMl90CQkJcHJpb3Jp
dHk7DQogCXN0cnVjdCBwYWdlCQkJKip1c2VyX3BhZ2VzOw0KIAlib29sCQkJCXVzZXJfaW52YWxp
ZGF0ZWQ7DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Nz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYw0KaW5kZXggNzZmZDkx
NjQyNGQ2Li44ZGUyODM5OTc3NjkgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfY3MuYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2NzLmMNCkBAIC01NzQsMTQgKzU3NCw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2NzX3BhcnNlcl9i
b3Moc3RydWN0IGFtZGdwdV9jc19wYXJzZXIgKnAsDQogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9
IHR0bV90b19hbWRncHVfYm8oZS0+dHYuYm8pOw0KIA0KIAkJZS0+Ym9fdmEgPSBhbWRncHVfdm1f
Ym9fZmluZCh2bSwgYm8pOw0KLQ0KLQkJaWYgKGJvLT50Ym8uYmFzZS5kbWFfYnVmICYmICFhbWRn
cHVfYm9fZXhwbGljaXRfc3luYyhibykpIHsNCi0JCQllLT5jaGFpbiA9IGRtYV9mZW5jZV9jaGFp
bl9hbGxvYygpOw0KLQkJCWlmICghZS0+Y2hhaW4pIHsNCi0JCQkJciA9IC1FTk9NRU07DQotCQkJ
CWdvdG8gZXJyb3JfdmFsaWRhdGU7DQotCQkJfQ0KLQkJfQ0KIAl9DQogDQogCS8qIE1vdmUgZmVu
Y2Ugd2FpdGluZyBhZnRlciBnZXR0aW5nIHJlc2VydmF0aW9uIGxvY2sgb2YNCkBAIC02NDIsMTMg
KzYzNCw4IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2NzX3BhcnNlcl9ib3Moc3RydWN0IGFtZGdwdV9j
c19wYXJzZXIgKnAsDQogCX0NCiANCiBlcnJvcl92YWxpZGF0ZToNCi0JaWYgKHIpIHsNCi0JCWFt
ZGdwdV9ib19saXN0X2Zvcl9lYWNoX2VudHJ5KGUsIHAtPmJvX2xpc3QpIHsNCi0JCQlkbWFfZmVu
Y2VfY2hhaW5fZnJlZShlLT5jaGFpbik7DQotCQkJZS0+Y2hhaW4gPSBOVUxMOw0KLQkJfQ0KKwlp
ZiAocikNCiAJCXR0bV9ldV9iYWNrb2ZmX3Jlc2VydmF0aW9uKCZwLT50aWNrZXQsICZwLT52YWxp
ZGF0ZWQpOw0KLQl9DQogb3V0Og0KIAlyZXR1cm4gcjsNCiB9DQpAQCAtNjg4LDE3ICs2NzUsOSBA
QCBzdGF0aWMgdm9pZCBhbWRncHVfY3NfcGFyc2VyX2Zpbmkoc3RydWN0IGFtZGdwdV9jc19wYXJz
ZXIgKnBhcnNlciwgaW50IGVycm9yLA0KIHsNCiAJdW5zaWduZWQgaTsNCiANCi0JaWYgKGVycm9y
ICYmIGJhY2tvZmYpIHsNCi0JCXN0cnVjdCBhbWRncHVfYm9fbGlzdF9lbnRyeSAqZTsNCi0NCi0J
CWFtZGdwdV9ib19saXN0X2Zvcl9lYWNoX2VudHJ5KGUsIHBhcnNlci0+Ym9fbGlzdCkgew0KLQkJ
CWRtYV9mZW5jZV9jaGFpbl9mcmVlKGUtPmNoYWluKTsNCi0JCQllLT5jaGFpbiA9IE5VTEw7DQot
CQl9DQotDQorCWlmIChlcnJvciAmJiBiYWNrb2ZmKQ0KIAkJdHRtX2V1X2JhY2tvZmZfcmVzZXJ2
YXRpb24oJnBhcnNlci0+dGlja2V0LA0KIAkJCQkJICAgJnBhcnNlci0+dmFsaWRhdGVkKTsNCi0J
fQ0KIA0KIAlmb3IgKGkgPSAwOyBpIDwgcGFyc2VyLT5udW1fcG9zdF9kZXBzOyBpKyspIHsNCiAJ
CWRybV9zeW5jb2JqX3B1dChwYXJzZXItPnBvc3RfZGVwc1tpXS5zeW5jb2JqKTsNCkBAIC0xMjcy
LDMxICsxMjUxLDkgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfc3VibWl0KHN0cnVjdCBhbWRncHVf
Y3NfcGFyc2VyICpwLA0KIA0KIAlhbWRncHVfdm1fbW92ZV90b19scnVfdGFpbChwLT5hZGV2LCAm
ZnByaXYtPnZtKTsNCiANCi0JYW1kZ3B1X2JvX2xpc3RfZm9yX2VhY2hfZW50cnkoZSwgcC0+Ym9f
bGlzdCkgew0KLQkJc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gZS0+dHYuYm8tPmJhc2UucmVzdjsN
Ci0JCXN0cnVjdCBkbWFfZmVuY2VfY2hhaW4gKmNoYWluID0gZS0+Y2hhaW47DQotCQlzdHJ1Y3Qg
ZG1hX3Jlc3ZfaXRlciBjdXJzb3I7DQotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsNCi0NCi0J
CWlmICghY2hhaW4pDQotCQkJY29udGludWU7DQotDQotCQkvKg0KLQkJICogVGVtcG9yYXJ5IHdv
cmthcm91bmQgZG1hX3Jlc3Ygc2hvcnRjb21taW5ncyBieSB3cmFwcGluZyB1cA0KLQkJICogdGhl
IHN1Ym1pc3Npb24gaW4gYSBkbWFfZmVuY2VfY2hhaW4gYW5kIGFkZCBpdCBhcyBleGNsdXNpdmUN
Ci0JCSAqIGZlbmNlLg0KLQkJICoNCi0JCSAqIFRPRE86IFJlbW92ZSB0b2dldGhlciB3aXRoIGRt
YV9yZXN2IHJld29yay4NCi0JCSAqLw0KLQkJZG1hX3Jlc3ZfZm9yX2VhY2hfZmVuY2UoJmN1cnNv
ciwgcmVzdiwNCi0JCQkJCURNQV9SRVNWX1VTQUdFX1dSSVRFLA0KLQkJCQkJZmVuY2UpIHsNCi0J
CQlicmVhazsNCi0JCX0NCi0JCWRtYV9mZW5jZV9jaGFpbl9pbml0KGNoYWluLCBmZW5jZSwgZG1h
X2ZlbmNlX2dldChwLT5mZW5jZSksIDEpOw0KLQkJcmN1X2Fzc2lnbl9wb2ludGVyKHJlc3YtPmZl
bmNlX2V4Y2wsICZjaGFpbi0+YmFzZSk7DQotCQllLT5jaGFpbiA9IE5VTEw7DQotCX0NCisJLyog
TWFrZSBzdXJlIGFsbCBCT3MgYXJlIHJlbWVtYmVyZWQgYXMgd3JpdGVycyAqLw0KKwlhbWRncHVf
Ym9fbGlzdF9mb3JfZWFjaF9lbnRyeShlLCBwLT5ib19saXN0KQ0KKwkJZS0+dHYubnVtX3NoYXJl
ZCA9IDA7DQogDQogCXR0bV9ldV9mZW5jZV9idWZmZXJfb2JqZWN0cygmcC0+dGlja2V0LCAmcC0+
dmFsaWRhdGVkLCBwLT5mZW5jZSk7DQogCW11dGV4X3VubG9jaygmcC0+YWRldi0+bm90aWZpZXJf
bG9jayk7DQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9kbWEtcmVzdi5oIGIvaW5jbHVkZS9s
aW51eC9kbWEtcmVzdi5oDQppbmRleCA5OGRjNTIzNGI0ODcuLjdiYjdlN2VkYmI2ZiAxMDA2NDQN
Ci0tLSBhL2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaA0KKysrIGIvaW5jbHVkZS9saW51eC9kbWEt
cmVzdi5oDQpAQCAtOTksOCArOTksOCBAQCBzdGF0aWMgaW5saW5lIGVudW0gZG1hX3Jlc3ZfdXNh
Z2UgZG1hX3Jlc3ZfdXNhZ2VfcncoYm9vbCB3cml0ZSkNCiAvKioNCiAgKiBzdHJ1Y3QgZG1hX3Jl
c3YgLSBhIHJlc2VydmF0aW9uIG9iamVjdCBtYW5hZ2VzIGZlbmNlcyBmb3IgYSBidWZmZXINCiAg
Kg0KLSAqIFRoZXJlIGFyZSBtdWx0aXBsZSB1c2VzIGZvciB0aGlzLCB3aXRoIHNvbWV0aW1lcyBz
bGlnaHRseSBkaWZmZXJlbnQgcnVsZXMgaW4NCi0gKiBob3cgdGhlIGZlbmNlIHNsb3RzIGFyZSB1
c2VkLg0KKyAqIFRoaXMgaXMgYSBjb250YWluZXIgZm9yIGRtYV9mZW5jZSBvYmplY3RzIHdoaWNo
IG5lZWRzIHRvIGhhbmRsZSBtdWx0aXBsZSB1c2UNCisgKiBjYXNlcy4NCiAgKg0KICAqIE9uZSB1
c2UgaXMgdG8gc3luY2hyb25pemUgY3Jvc3MtZHJpdmVyIGFjY2VzcyB0byBhIHN0cnVjdCBkbWFf
YnVmLCBlaXRoZXIgZm9yDQogICogZHluYW1pYyBidWZmZXIgbWFuYWdlbWVudCBvciBqdXN0IHRv
IGhhbmRsZSBpbXBsaWNpdCBzeW5jaHJvbml6YXRpb24gYmV0d2Vlbg0KQEAgLTEzMCw0NyArMTMw
LDIyIEBAIHN0cnVjdCBkbWFfcmVzdiB7DQogCSAqIEBzZXE6DQogCSAqDQogCSAqIFNlcXVlbmNl
IGNvdW50IGZvciBtYW5hZ2luZyBSQ1UgcmVhZC1zaWRlIHN5bmNocm9uaXphdGlvbiwgYWxsb3dz
DQotCSAqIHJlYWQtb25seSBhY2Nlc3MgdG8gQGZlbmNlX2V4Y2wgYW5kIEBmZW5jZSB3aGlsZSBl
bnN1cmluZyB3ZSB0YWtlIGENCi0JICogY29uc2lzdGVudCBzbmFwc2hvdC4NCisJICogcmVhZC1v
bmx5IGFjY2VzcyB0byBAZmVuY2VzIHdoaWxlIGVuc3VyaW5nIHdlIHRha2UgYSBjb25zaXN0ZW50
DQorCSAqIHNuYXBzaG90Lg0KIAkgKi8NCiAJc2VxY291bnRfd3dfbXV0ZXhfdCBzZXE7DQogDQog
CS8qKg0KLQkgKiBAZmVuY2VfZXhjbDoNCisJICogQGZlbmNlczoNCiAJICoNCi0JICogVGhlIGV4
Y2x1c2l2ZSBmZW5jZSwgaWYgdGhlcmUgaXMgb25lIGN1cnJlbnRseS4NCisJICogQXJyYXkgb2Yg
ZmVuY2VzIHdoaWNoIHdoZXJlIGFkZGVkIHRvIHRoZSBkbWFfcmVzdiBvYmplY3QNCiAJICoNCi0J
ICogVG8gZ3VhcmFudGVlIHRoYXQgbm8gZmVuY2VzIGFyZSBsb3N0LCB0aGlzIG5ldyBmZW5jZSBt
dXN0IHNpZ25hbA0KLQkgKiBvbmx5IGFmdGVyIHRoZSBwcmV2aW91cyBleGNsdXNpdmUgZmVuY2Ug
aGFzIHNpZ25hbGxlZC4gSWYNCi0JICogc2VtYW50aWNhbGx5IG9ubHkgYSBuZXcgYWNjZXNzIGlz
IGFkZGVkIHdpdGhvdXQgYWN0dWFsbHkgdHJlYXRpbmcgdGhlDQotCSAqIHByZXZpb3VzIG9uZSBh
cyBhIGRlcGVuZGVuY3kgdGhlIGV4Y2x1c2l2ZSBmZW5jZXMgY2FuIGJlIHN0cnVuZw0KLQkgKiB0
b2dldGhlciB1c2luZyBzdHJ1Y3QgZG1hX2ZlbmNlX2NoYWluLg0KLQkgKg0KLQkgKiBOb3RlIHRo
YXQgYWN0dWFsIHNlbWFudGljcyBvZiB3aGF0IGFuIGV4Y2x1c2l2ZSBvciBzaGFyZWQgZmVuY2Ug
bWVhbg0KLQkgKiBpcyBkZWZpbmVkIGJ5IHRoZSB1c2VyLCBmb3IgcmVzZXJ2YXRpb24gb2JqZWN0
cyBzaGFyZWQgYWNyb3NzIGRyaXZlcnMNCi0JICogc2VlICZkbWFfYnVmLnJlc3YuDQotCSAqLw0K
LQlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpmZW5jZV9leGNsOw0KLQ0KLQkvKioNCi0JICogQGZl
bmNlOg0KLQkgKg0KLQkgKiBMaXN0IG9mIGN1cnJlbnQgc2hhcmVkIGZlbmNlcy4NCi0JICoNCi0J
ICogVGhlcmUgYXJlIG5vIG9yZGVyaW5nIGNvbnN0cmFpbnRzIG9mIHNoYXJlZCBmZW5jZXMgYWdh
aW5zdCB0aGUNCi0JICogZXhjbHVzaXZlIGZlbmNlIHNsb3QuIElmIGEgd2FpdGVyIG5lZWRzIHRv
IHdhaXQgZm9yIGFsbCBhY2Nlc3MsIGl0DQotCSAqIGhhcyB0byB3YWl0IGZvciBib3RoIHNldHMg
b2YgZmVuY2VzIHRvIHNpZ25hbC4NCi0JICoNCi0JICogQSBuZXcgZmVuY2UgaXMgYWRkZWQgYnkg
Y2FsbGluZyBkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKCkuIFNpbmNlDQotCSAqIHRoaXMgb2Z0
ZW4gbmVlZHMgdG8gYmUgZG9uZSBwYXN0IHRoZSBwb2ludCBvZiBubyByZXR1cm4gaW4gY29tbWFu
ZA0KKwkgKiBBIG5ldyBmZW5jZSBpcyBhZGRlZCBieSBjYWxsaW5nIGRtYV9yZXN2X2FkZF9mZW5j
ZSgpLiBTaW5jZSB0aGlzDQorCSAqIG9mdGVuIG5lZWRzIHRvIGJlIGRvbmUgcGFzdCB0aGUgcG9p
bnQgb2Ygbm8gcmV0dXJuIGluIGNvbW1hbmQNCiAJICogc3VibWlzc2lvbiBpdCBjYW5ub3QgZmFp
bCwgYW5kIHRoZXJlZm9yZSBzdWZmaWNpZW50IHNsb3RzIG5lZWQgdG8gYmUNCiAJICogcmVzZXJ2
ZWQgYnkgY2FsbGluZyBkbWFfcmVzdl9yZXNlcnZlX2ZlbmNlcygpLg0KLQkgKg0KLQkgKiBOb3Rl
IHRoYXQgYWN0dWFsIHNlbWFudGljcyBvZiB3aGF0IGFuIGV4Y2x1c2l2ZSBvciBzaGFyZWQgZmVu
Y2UgbWVhbg0KLQkgKiBpcyBkZWZpbmVkIGJ5IHRoZSB1c2VyLCBmb3IgcmVzZXJ2YXRpb24gb2Jq
ZWN0cyBzaGFyZWQgYWNyb3NzIGRyaXZlcnMNCi0JICogc2VlICZkbWFfYnVmLnJlc3YuDQogCSAq
Lw0KLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCBfX3JjdSAqZmVuY2U7DQorCXN0cnVjdCBkbWFfcmVz
dl9saXN0IF9fcmN1ICpmZW5jZXM7DQogfTsNCiANCiAvKioNCkBAIC0yMDcsOCArMTgyLDggQEAg
c3RydWN0IGRtYV9yZXN2X2l0ZXIgew0KIAkvKiogQGZlbmNlczogdGhlIHNoYXJlZCBmZW5jZXM7
IHByaXZhdGUsICpNVVNUKiBub3QgZGVyZWZlcmVuY2UgICovDQogCXN0cnVjdCBkbWFfcmVzdl9s
aXN0ICpmZW5jZXM7DQogDQotCS8qKiBAc2hhcmVkX2NvdW50OiBudW1iZXIgb2Ygc2hhcmVkIGZl
bmNlcyAqLw0KLQl1bnNpZ25lZCBpbnQgc2hhcmVkX2NvdW50Ow0KKwkvKiogQG51bV9mZW5jZXM6
IG51bWJlciBvZiBmZW5jZXMgKi8NCisJdW5zaWduZWQgaW50IG51bV9mZW5jZXM7DQogDQogCS8q
KiBAaXNfcmVzdGFydGVkOiB0cnVlIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHJldHVybmVkIGZlbmNl
ICovDQogCWJvb2wgaXNfcmVzdGFydGVkOw0KLS0gDQoyLjI1LjENCg0KX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTGluYXJvLW1tLXNpZyBtYWlsaW5nIGxp
c3QgLS0gbGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3JnClRvIHVuc3Vic2NyaWJlIHNlbmQg
YW4gZW1haWwgdG8gbGluYXJvLW1tLXNpZy1sZWF2ZUBsaXN0cy5saW5hcm8ub3JnCg==
