Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 944F251D772
	for <lists+linaro-mm-sig@lfdr.de>; Fri,  6 May 2022 14:19:43 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id CDF0C3EF16
	for <lists+linaro-mm-sig@lfdr.de>; Fri,  6 May 2022 12:19:42 +0000 (UTC)
Received: from mail-ed1-f48.google.com (mail-ed1-f48.google.com [209.85.208.48])
	by lists.linaro.org (Postfix) with ESMTPS id AF1FD47FC2
	for <linaro-mm-sig@lists.linaro.org>; Fri,  6 May 2022 12:19:26 +0000 (UTC)
Received: by mail-ed1-f48.google.com with SMTP id k27so8501033edk.4
        for <linaro-mm-sig@lists.linaro.org>; Fri, 06 May 2022 05:19:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=TcXqvBMAvIEOTq3291B/986PFv2BmH9rCOo1VT0/FiY=;
        b=F2OqGPZINLRPot+WbMlldVlUvLGoRuykacjFpF2QXuHlakWmjsSuqRa16h/Nyswhqe
         F+z6zOocqCZjpGvnnsJH4qh5+6H2SDATwE8TroYgm9ocwDHZVQ052qPgCGJ843aS8YJt
         mIZOcvTLqgIW1hz2Tl+w/I1F00Nk+AM2CGM834AUv9XcgOELbhmeVwFw6rmdyeOfmb/s
         xY2OUPqICwZQYcv4FLKmBVfOw3qsZzyWWAGxMu9AEv6MPURN5gNkCcTO4zE3w8alnkWa
         EJ+6Xch4J66tXU+CDTZcRuxCJfFYGnVryYd/LvWSg6Vnfqs/9QFbz+V+2SuP1ntswRND
         q19A==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=TcXqvBMAvIEOTq3291B/986PFv2BmH9rCOo1VT0/FiY=;
        b=kNisJ8enLyWHnynORCfVWTBNX4wxrJiLLKP1hvW4TyPy9V1vZgdTuJ5hpZnNAcN3jS
         t2mdD3AGpdJBFFWeDfO79tGXq786gT6nnUF5/my/BXy0xfP2CBxYlDmqr8EkYVEC3By/
         UHTMupsV0emn5HaoVHxLN6ljln+wBii2cPlqo7ZE4G/mLSWlXm2RubVxPISWbJWYyjfO
         sUKYsdqenGbhMTnfqbGCTqms/pbLoAtKXqnBmzWMi2IYxpEoAPS9QEcsB3RRbxSdKmWE
         hKV0cKEDiuwgBWMTcUvRseIYSegByc72O4IFhlPE6+KkZmZE29nW6MnzkgvoxrBbiett
         IZvg==
X-Gm-Message-State: AOAM5311LQ7ghLG98BWriJuuFrbPyXWun/KC15yVEySux6U2edpxOAO1
	8ptM9/iGqqj/wsvps5kiQrc=
X-Google-Smtp-Source: ABdhPJw3yZI01mhxPNSUjFCDJLEr3eO+Gn7T2CCop6foY+zjots2fGOwkGZW8rxhTvu618KV4SM2uQ==
X-Received: by 2002:a05:6402:198:b0:410:83e3:21d7 with SMTP id r24-20020a056402019800b0041083e321d7mr3236818edv.159.1651839565700;
        Fri, 06 May 2022 05:19:25 -0700 (PDT)
Received: from able.fritz.box (p57b0b3fd.dip0.t-ipconnect.de. [87.176.179.253])
        by smtp.gmail.com with ESMTPSA id jl27-20020a17090775db00b006f3ef214e63sm1874445ejc.201.2022.05.06.05.19.24
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 06 May 2022 05:19:25 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
To: daniel@ffwll.ch,
	linaro-mm-sig@lists.linaro.org
Date: Fri,  6 May 2022 14:19:19 +0200
Message-Id: <20220506121920.1410-4-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220506121920.1410-1-christian.koenig@amd.com>
References: <20220506121920.1410-1-christian.koenig@amd.com>
MIME-Version: 1.0
Message-ID-Hash: HQXKYM2GYAAROH5TZK4LTEOW6K7BLOH7
X-Message-ID-Hash: HQXKYM2GYAAROH5TZK4LTEOW6K7BLOH7
X-MailFrom: ckoenig.leichtzumerken@gmail.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH 4/5] dma-buf: generalize dma_fence unwrap & merging v2
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/HQXKYM2GYAAROH5TZK4LTEOW6K7BLOH7/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

SW50cm9kdWNlIGEgZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSgpIG1hY3JvIHdoaWNoIGFsbG93cyB0
byB1bndyYXAgZmVuY2VzDQp3aGljaCBwb3RlbnRpYWxseSBjYW4gYmUgY29udGFpbmVycyBhcyB3
ZWxsIGFuZCB0aGVuIG1lcmdlIHRoZW0gYmFjaw0KdG9nZXRoZXIgaW50byBhIGZsYXQgZG1hX2Zl
bmNlX2FycmF5Lg0KDQp2MjogcmVuYW1lIHRoZSBmdW5jdGlvbiwgYWRkIHNvbWUgbW9yZSBjb21t
ZW50cyBhYm91dCBob3cgdGhlIHdyYXBwZXIgaXMNCiAgICB1c2VkLCBtb3ZlIGZpbHRlcmluZyBv
ZiBzaWduYWxlZCBmZW5jZXMgaW50byB0aGUgdW53cmFwIGl0ZXJhdG9yLA0KICAgIGFkZCBjb21w
bGV4IHNlbGZ0ZXN0IHdoaWNoIGNvdmVycyBtb3JlIGNhc2VzLg0KDQpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+DQpSZXZpZXdlZC1ieTog
RGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4NCi0tLQ0KIGRyaXZlcnMvZG1h
LWJ1Zi9kbWEtZmVuY2UtdW53cmFwLmMgICAgfCAgOTkgKysrKysrKysrKysrKysrKysrKysrDQog
ZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS11bndyYXAuYyB8IDEwOSArKysrKysrKysrKysr
KysrKysrKysrKw0KIGRyaXZlcnMvZG1hLWJ1Zi9zeW5jX2ZpbGUuYyAgICAgICAgICAgfCAxMTkg
KystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiBpbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS11bndy
YXAuaCAgICAgIHwgIDI0ICsrKysrKw0KIDQgZmlsZXMgY2hhbmdlZCwgMjM4IGluc2VydGlvbnMo
KyksIDExMyBkZWxldGlvbnMoLSkNCg0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEt
ZmVuY2UtdW53cmFwLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLXVud3JhcC5jDQppbmRl
eCBjM2JlZGJjNTgzMmEuLmY4NDRlMmFmZWIzYSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UtdW53cmFwLmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UtdW53
cmFwLmMNCkBAIC0xMSw2ICsxMSw3IEBADQogI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJh
eS5oPg0KICNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UtY2hhaW4uaD4NCiAjaW5jbHVkZSA8bGlu
dXgvZG1hLWZlbmNlLXVud3JhcC5oPg0KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+DQogDQogLyog
SW50ZXJuYWwgaGVscGVyIHRvIHN0YXJ0IG5ldyBhcnJheSBpdGVyYXRpb24sIGRvbid0IHVzZSBk
aXJlY3RseSAqLw0KIHN0YXRpYyBzdHJ1Y3QgZG1hX2ZlbmNlICoNCkBAIC02OSwzICs3MCwxMDEg
QEAgc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KHN0cnVjdCBkbWFfZmVu
Y2VfdW53cmFwICpjdXJzb3IpDQogCXJldHVybiB0bXA7DQogfQ0KIEVYUE9SVF9TWU1CT0xfR1BM
KGRtYV9mZW5jZV91bndyYXBfbmV4dCk7DQorDQorLyogSW1wbGVtZW50YXRpb24gZm9yIHRoZSBk
bWFfZmVuY2VfbWVyZ2UoKSBtYXJjbywgZG9uJ3QgdXNlIGRpcmVjdGx5ICovDQorc3RydWN0IGRt
YV9mZW5jZSAqX19kbWFfZmVuY2VfdW53cmFwX21lcmdlKHVuc2lnbmVkIGludCBudW1fZmVuY2Vz
LA0KKwkJCQkJICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlcywNCisJCQkJCSAgIHN0cnVjdCBk
bWFfZmVuY2VfdW53cmFwICppdGVyKQ0KK3sNCisJc3RydWN0IGRtYV9mZW5jZV9hcnJheSAqcmVz
dWx0Ow0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICp0bXAsICoqYXJyYXk7DQorCXVuc2lnbmVkIGludCBp
Ow0KKwlzaXplX3QgY291bnQ7DQorDQorCWNvdW50ID0gMDsNCisJZm9yIChpID0gMDsgaSA8IG51
bV9mZW5jZXM7ICsraSkgew0KKwkJZG1hX2ZlbmNlX3Vud3JhcF9mb3JfZWFjaCh0bXAsICZpdGVy
W2ldLCBmZW5jZXNbaV0pDQorCQkJKytjb3VudDsNCisJfQ0KKw0KKwlpZiAoY291bnQgPT0gMCkN
CisJCXJldHVybiBkbWFfZmVuY2VfZ2V0X3N0dWIoKTsNCisNCisJYXJyYXkgPSBrbWFsbG9jX2Fy
cmF5KGNvdW50LCBzaXplb2YoKmFycmF5KSwgR0ZQX0tFUk5FTCk7DQorCWlmICghYXJyYXkpDQor
CQlyZXR1cm4gTlVMTDsNCisNCisJLyoNCisJICogVGhpcyB0cmFzaGVzIHRoZSBpbnB1dCBmZW5j
ZSBhcnJheSBhbmQgdXNlcyBpdCBhcyBwb3NpdGlvbiBmb3IgdGhlDQorCSAqIGZvbGxvd2luZyBt
ZXJnZSBsb29wLiBUaGlzIHdvcmtzIGJlY2F1c2UgdGhlIGRtYV9mZW5jZV9tZXJnZSgpDQorCSAq
IHdyYXBwZXIgbWFjcm8gaXMgY3JlYXRpbmcgdGhpcyB0ZW1wb3JhcnkgYXJyYXkgb24gdGhlIHN0
YWNrIHRvZ2V0aGVyDQorCSAqIHdpdGggdGhlIGl0ZXJhdG9ycy4NCisJICovDQorCWZvciAoaSA9
IDA7IGkgPCBudW1fZmVuY2VzOyArK2kpDQorCQlmZW5jZXNbaV0gPSBkbWFfZmVuY2VfdW53cmFw
X2ZpcnN0KGZlbmNlc1tpXSwgJml0ZXJbaV0pOw0KKw0KKwljb3VudCA9IDA7DQorCWRvIHsNCisJ
CXVuc2lnbmVkIGludCBzZWw7DQorDQorcmVzdGFydDoNCisJCXRtcCA9IE5VTEw7DQorCQlmb3Ig
KGkgPSAwOyBpIDwgbnVtX2ZlbmNlczsgKytpKSB7DQorCQkJc3RydWN0IGRtYV9mZW5jZSAqbmV4
dCA9IGZlbmNlc1tpXTsNCisNCisJCQlpZiAoIW5leHQpDQorCQkJCWNvbnRpbnVlOw0KKw0KKwkJ
CS8qDQorCQkJICogV2UgY2FuJ3QgZ3VhcmFudGVlIHRoYXQgaW5wdXRlIGZlbmNlcyBhcmUgb3Jk
ZXJlZCBieQ0KKwkJCSAqIGNvbnRleHQsIGJ1dCBpdCBpcyBzdGlsbCBxdWl0ZSBsaWtlbHkgd2hl
biB0aGlzDQorCQkJICogZnVuY3Rpb24gaXMgdXNlZCBtdWx0aXBsZSB0aW1lcy4gU28gYXR0ZW1w
dCB0byBvcmRlcg0KKwkJCSAqIHRoZSBmZW5jZXMgYnkgY29udGV4dCBhcyB3ZSBwYXNzIG92ZXIg
dGhlbSBhbmQgbWVyZ2UNCisJCQkgKiBmZW5jZXMgd2l0aCB0aGUgc2FtZSBjb250ZXh0Lg0KKwkJ
CSAqLw0KKwkJCWlmICghdG1wIHx8IHRtcC0+Y29udGV4dCA+IG5leHQtPmNvbnRleHQpIHsNCisJ
CQkJdG1wID0gbmV4dDsNCisJCQkJc2VsID0gaTsNCisNCisJCQl9IGVsc2UgaWYgKHRtcC0+Y29u
dGV4dCA8IG5leHQtPmNvbnRleHQpIHsNCisJCQkJY29udGludWU7DQorDQorCQkJfSBlbHNlIGlm
IChkbWFfZmVuY2VfaXNfbGF0ZXIodG1wLCBuZXh0KSkgew0KKwkJCQlmZW5jZXNbaV0gPSBkbWFf
ZmVuY2VfdW53cmFwX25leHQoJml0ZXJbaV0pOw0KKwkJCQlnb3RvIHJlc3RhcnQ7DQorCQkJfSBl
bHNlIHsNCisJCQkJZmVuY2VzW3NlbF0gPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJml0ZXJbc2Vs
XSk7DQorCQkJCWdvdG8gcmVzdGFydDsNCisJCQl9DQorCQl9DQorDQorCQlpZiAodG1wKSB7DQor
CQkJYXJyYXlbY291bnQrK10gPSBkbWFfZmVuY2VfZ2V0KHRtcCk7DQorCQkJZmVuY2VzW3NlbF0g
PSBkbWFfZmVuY2VfdW53cmFwX25leHQoJml0ZXJbc2VsXSk7DQorCQl9DQorCX0gd2hpbGUgKHRt
cCk7DQorDQorCWlmIChjb3VudCA9PSAwKSB7DQorCQl0bXAgPSBkbWFfZmVuY2VfZ2V0X3N0dWIo
KTsNCisJCWdvdG8gcmV0dXJuX3RtcDsNCisJfQ0KKw0KKwlpZiAoY291bnQgPT0gMSkgew0KKwkJ
dG1wID0gYXJyYXlbMF07DQorCQlnb3RvIHJldHVybl90bXA7DQorCX0NCisNCisJcmVzdWx0ID0g
ZG1hX2ZlbmNlX2FycmF5X2NyZWF0ZShjb3VudCwgYXJyYXksDQorCQkJCQlkbWFfZmVuY2VfY29u
dGV4dF9hbGxvYygxKSwNCisJCQkJCTEsIGZhbHNlKTsNCisJaWYgKCFyZXN1bHQpIHsNCisJCXRt
cCA9IE5VTEw7DQorCQlnb3RvIHJldHVybl90bXA7DQorCX0NCisJcmV0dXJuICZyZXN1bHQtPmJh
c2U7DQorDQorcmV0dXJuX3RtcDoNCisJa2ZyZWUoYXJyYXkpOw0KKwlyZXR1cm4gdG1wOw0KK30N
CitFWFBPUlRfU1lNQk9MX0dQTChfX2RtYV9mZW5jZV91bndyYXBfbWVyZ2UpOw0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZG1hLWJ1Zi9zdC1kbWEtZmVuY2UtdW53cmFwLmMgYi9kcml2ZXJzL2RtYS1i
dWYvc3QtZG1hLWZlbmNlLXVud3JhcC5jDQppbmRleCBlMjBjNWE3ZGNmZTQuLjQxMDVkNWVhOGRk
ZSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9zdC1kbWEtZmVuY2UtdW53cmFwLmMNCisr
KyBiL2RyaXZlcnMvZG1hLWJ1Zi9zdC1kbWEtZmVuY2UtdW53cmFwLmMNCkBAIC0yMzgsNiArMjM4
LDExMyBAQCBzdGF0aWMgaW50IHVud3JhcF9jaGFpbl9hcnJheSh2b2lkICphcmcpDQogCXJldHVy
biBlcnI7DQogfQ0KIA0KK3N0YXRpYyBpbnQgdW53cmFwX21lcmdlKHZvaWQgKmFyZykNCit7DQor
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqZjEsICpmMiwgKmYzOw0KKwlzdHJ1Y3QgZG1hX2Zl
bmNlX3Vud3JhcCBpdGVyOw0KKwlpbnQgZXJyID0gMDsNCisNCisJZjEgPSBtb2NrX2ZlbmNlKCk7
DQorCWlmICghZjEpDQorCQlyZXR1cm4gLUVOT01FTTsNCisNCisJZjIgPSBtb2NrX2ZlbmNlKCk7
DQorCWlmICghZjIpIHsNCisJCWVyciA9IC1FTk9NRU07DQorCQlnb3RvIGVycm9yX3B1dF9mMTsN
CisJfQ0KKw0KKwlmMyA9IGRtYV9mZW5jZV91bndyYXBfbWVyZ2UoZjEsIGYyKTsNCisJaWYgKCFm
Mykgew0KKwkJZXJyID0gLUVOT01FTTsNCisJCWdvdG8gZXJyb3JfcHV0X2YyOw0KKwl9DQorDQor
CWRtYV9mZW5jZV91bndyYXBfZm9yX2VhY2goZmVuY2UsICZpdGVyLCBmMykgew0KKwkJaWYgKGZl
bmNlID09IGYxKSB7DQorCQkJZG1hX2ZlbmNlX3B1dChmMSk7DQorCQkJZjEgPSBOVUxMOw0KKwkJ
fSBlbHNlIGlmIChmZW5jZSA9PSBmMikgew0KKwkJCWRtYV9mZW5jZV9wdXQoZjIpOw0KKwkJCWYy
ID0gTlVMTDsNCisJCX0gZWxzZSB7DQorCQkJcHJfZXJyKCJVbmV4cGVjdGVkIGZlbmNlIVxuIik7
DQorCQkJZXJyID0gLUVJTlZBTDsNCisJCX0NCisJfQ0KKw0KKwlpZiAoZjEgfHwgZjIpIHsNCisJ
CXByX2VycigiTm90IGFsbCBmZW5jZXMgc2VlbiFcbiIpOw0KKwkJZXJyID0gLUVJTlZBTDsNCisJ
fQ0KKw0KKwlkbWFfZmVuY2VfcHV0KGYzKTsNCitlcnJvcl9wdXRfZjI6DQorCWRtYV9mZW5jZV9w
dXQoZjIpOw0KK2Vycm9yX3B1dF9mMToNCisJZG1hX2ZlbmNlX3B1dChmMSk7DQorCXJldHVybiBl
cnI7DQorfQ0KKw0KK3N0YXRpYyBpbnQgdW53cmFwX21lcmdlX2NvbXBsZXgodm9pZCAqYXJnKQ0K
K3sNCisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsICpmMSwgKmYyLCAqZjMsICpmNCwgKmY1Ow0K
KwlzdHJ1Y3QgZG1hX2ZlbmNlX3Vud3JhcCBpdGVyOw0KKwlpbnQgZXJyID0gLUVOT01FTTsNCisN
CisJZjEgPSBtb2NrX2ZlbmNlKCk7DQorCWlmICghZjEpDQorCQlyZXR1cm4gLUVOT01FTTsNCisN
CisJZjIgPSBtb2NrX2ZlbmNlKCk7DQorCWlmICghZjIpDQorCQlnb3RvIGVycm9yX3B1dF9mMTsN
CisNCisJZjMgPSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKGYxLCBmMik7DQorCWlmICghZjMpDQor
CQlnb3RvIGVycm9yX3B1dF9mMjsNCisNCisJLyogVGhlIHJlc3VsdGluZyBhcnJheSBoYXMgdGhl
IGZlbmNlcyBpbiByZXZlcnNlICovDQorCWY0ID0gZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZShmMiwg
ZjEpOw0KKwlpZiAoIWY0KQ0KKwkJZ290byBlcnJvcl9wdXRfZjM7DQorDQorCS8qIFNpZ25hbGVk
IGZlbmNlcyBzaG91bGQgYmUgZmlsdGVyZWQsIHRoZSB0d28gYXJyYXlzIG1lcmdlZC4gKi8NCisJ
ZjUgPSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKGYzLCBmNCwgZG1hX2ZlbmNlX2dldF9zdHViKCkp
Ow0KKwlpZiAoIWY1KQ0KKwkJZ290byBlcnJvcl9wdXRfZjQ7DQorDQorCWVyciA9IDA7DQorCWRt
YV9mZW5jZV91bndyYXBfZm9yX2VhY2goZmVuY2UsICZpdGVyLCBmNSkgew0KKwkJaWYgKGZlbmNl
ID09IGYxKSB7DQorCQkJZG1hX2ZlbmNlX3B1dChmMSk7DQorCQkJZjEgPSBOVUxMOw0KKwkJfSBl
bHNlIGlmIChmZW5jZSA9PSBmMikgew0KKwkJCWRtYV9mZW5jZV9wdXQoZjIpOw0KKwkJCWYyID0g
TlVMTDsNCisJCX0gZWxzZSB7DQorCQkJcHJfZXJyKCJVbmV4cGVjdGVkIGZlbmNlIVxuIik7DQor
CQkJZXJyID0gLUVJTlZBTDsNCisJCX0NCisJfQ0KKw0KKwlpZiAoZjEgfHwgZjIpIHsNCisJCXBy
X2VycigiTm90IGFsbCBmZW5jZXMgc2VlbiFcbiIpOw0KKwkJZXJyID0gLUVJTlZBTDsNCisJfQ0K
Kw0KKwlkbWFfZmVuY2VfcHV0KGY1KTsNCitlcnJvcl9wdXRfZjQ6DQorCWRtYV9mZW5jZV9wdXQo
ZjQpOw0KK2Vycm9yX3B1dF9mMzoNCisJZG1hX2ZlbmNlX3B1dChmMyk7DQorZXJyb3JfcHV0X2Yy
Og0KKwlkbWFfZmVuY2VfcHV0KGYyKTsNCitlcnJvcl9wdXRfZjE6DQorCWRtYV9mZW5jZV9wdXQo
ZjEpOw0KKwlyZXR1cm4gZXJyOw0KK30NCisNCiBpbnQgZG1hX2ZlbmNlX3Vud3JhcCh2b2lkKQ0K
IHsNCiAJc3RhdGljIGNvbnN0IHN0cnVjdCBzdWJ0ZXN0IHRlc3RzW10gPSB7DQpAQCAtMjQ1LDYg
KzM1Miw4IEBAIGludCBkbWFfZmVuY2VfdW53cmFwKHZvaWQpDQogCQlTVUJURVNUKHVud3JhcF9h
cnJheSksDQogCQlTVUJURVNUKHVud3JhcF9jaGFpbiksDQogCQlTVUJURVNUKHVud3JhcF9jaGFp
bl9hcnJheSksDQorCQlTVUJURVNUKHVud3JhcF9tZXJnZSksDQorCQlTVUJURVNUKHVud3JhcF9t
ZXJnZV9jb21wbGV4KSwNCiAJfTsNCiANCiAJcmV0dXJuIHN1YnRlc3RzKHRlc3RzLCBOVUxMKTsN
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc3luY19maWxlLmMgYi9kcml2ZXJzL2RtYS1i
dWYvc3luY19maWxlLmMNCmluZGV4IDBmZTU2NDUzOTE2Ni4uM2ViZWMxOWE4ZTAyIDEwMDY0NA0K
LS0tIGEvZHJpdmVycy9kbWEtYnVmL3N5bmNfZmlsZS5jDQorKysgYi9kcml2ZXJzL2RtYS1idWYv
c3luY19maWxlLmMNCkBAIC0xNDYsNTAgKzE0Niw2IEBAIGNoYXIgKnN5bmNfZmlsZV9nZXRfbmFt
ZShzdHJ1Y3Qgc3luY19maWxlICpzeW5jX2ZpbGUsIGNoYXIgKmJ1ZiwgaW50IGxlbikNCiAJcmV0
dXJuIGJ1ZjsNCiB9DQogDQotc3RhdGljIGludCBzeW5jX2ZpbGVfc2V0X2ZlbmNlKHN0cnVjdCBz
eW5jX2ZpbGUgKnN5bmNfZmlsZSwNCi0JCQkgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNl
cywgaW50IG51bV9mZW5jZXMpDQotew0KLQlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5ICphcnJheTsN
Ci0NCi0JLyoNCi0JICogVGhlIHJlZmVyZW5jZSBmb3IgdGhlIGZlbmNlcyBpbiB0aGUgbmV3IHN5
bmNfZmlsZSBhbmQgaGVsZA0KLQkgKiBpbiBhZGRfZmVuY2UoKSBkdXJpbmcgdGhlIG1lcmdlIHBy
b2NlZHVyZSwgc28gZm9yIG51bV9mZW5jZXMgPT0gMQ0KLQkgKiB3ZSBhbHJlYWR5IG93biBhIG5l
dyByZWZlcmVuY2UgdG8gdGhlIGZlbmNlLiBGb3IgbnVtX2ZlbmNlID4gMQ0KLQkgKiB3ZSBvd24g
dGhlIHJlZmVyZW5jZSBvZiB0aGUgZG1hX2ZlbmNlX2FycmF5IGNyZWF0aW9uLg0KLQkgKi8NCi0N
Ci0JaWYgKG51bV9mZW5jZXMgPT0gMCkgew0KLQkJc3luY19maWxlLT5mZW5jZSA9IGRtYV9mZW5j
ZV9nZXRfc3R1YigpOw0KLQkJa2ZyZWUoZmVuY2VzKTsNCi0NCi0JfSBlbHNlIGlmIChudW1fZmVu
Y2VzID09IDEpIHsNCi0JCXN5bmNfZmlsZS0+ZmVuY2UgPSBmZW5jZXNbMF07DQotCQlrZnJlZShm
ZW5jZXMpOw0KLQ0KLQl9IGVsc2Ugew0KLQkJYXJyYXkgPSBkbWFfZmVuY2VfYXJyYXlfY3JlYXRl
KG51bV9mZW5jZXMsIGZlbmNlcywNCi0JCQkJCSAgICAgICBkbWFfZmVuY2VfY29udGV4dF9hbGxv
YygxKSwNCi0JCQkJCSAgICAgICAxLCBmYWxzZSk7DQotCQlpZiAoIWFycmF5KQ0KLQkJCXJldHVy
biAtRU5PTUVNOw0KLQ0KLQkJc3luY19maWxlLT5mZW5jZSA9ICZhcnJheS0+YmFzZTsNCi0JfQ0K
LQ0KLQlyZXR1cm4gMDsNCi19DQotDQotc3RhdGljIHZvaWQgYWRkX2ZlbmNlKHN0cnVjdCBkbWFf
ZmVuY2UgKipmZW5jZXMsDQotCQkgICAgICBpbnQgKmksIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQ0KLXsNCi0JZmVuY2VzWyppXSA9IGZlbmNlOw0KLQ0KLQlpZiAoIWRtYV9mZW5jZV9pc19zaWdu
YWxlZChmZW5jZSkpIHsNCi0JCWRtYV9mZW5jZV9nZXQoZmVuY2UpOw0KLQkJKCppKSsrOw0KLQl9
DQotfQ0KLQ0KIC8qKg0KICAqIHN5bmNfZmlsZV9tZXJnZSgpIC0gbWVyZ2UgdHdvIHN5bmNfZmls
ZXMNCiAgKiBAbmFtZToJbmFtZSBvZiBuZXcgZmVuY2UNCkBAIC0yMDMsODQgKzE1OSwyMSBAQCBz
dGF0aWMgdm9pZCBhZGRfZmVuY2Uoc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlcywNCiBzdGF0aWMg
c3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlX21lcmdlKGNvbnN0IGNoYXIgKm5hbWUsIHN0cnVj
dCBzeW5jX2ZpbGUgKmEsDQogCQkJCQkgc3RydWN0IHN5bmNfZmlsZSAqYikNCiB7DQotCXN0cnVj
dCBkbWFfZmVuY2UgKmFfZmVuY2UsICpiX2ZlbmNlLCAqKmZlbmNlczsNCi0Jc3RydWN0IGRtYV9m
ZW5jZV91bndyYXAgYV9pdGVyLCBiX2l0ZXI7DQotCXVuc2lnbmVkIGludCBpbmRleCwgbnVtX2Zl
bmNlczsNCiAJc3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlOw0KKwlzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZTsNCiANCiAJc3luY19maWxlID0gc3luY19maWxlX2FsbG9jKCk7DQogCWlmICghc3lu
Y19maWxlKQ0KIAkJcmV0dXJuIE5VTEw7DQogDQotCW51bV9mZW5jZXMgPSAwOw0KLQlkbWFfZmVu
Y2VfdW53cmFwX2Zvcl9lYWNoKGFfZmVuY2UsICZhX2l0ZXIsIGEtPmZlbmNlKQ0KLQkJKytudW1f
ZmVuY2VzOw0KLQlkbWFfZmVuY2VfdW53cmFwX2Zvcl9lYWNoKGJfZmVuY2UsICZiX2l0ZXIsIGIt
PmZlbmNlKQ0KLQkJKytudW1fZmVuY2VzOw0KLQ0KLQlpZiAobnVtX2ZlbmNlcyA+IElOVF9NQVgp
DQotCQlnb3RvIGVycl9mcmVlX3N5bmNfZmlsZTsNCi0NCi0JZmVuY2VzID0ga2NhbGxvYyhudW1f
ZmVuY2VzLCBzaXplb2YoKmZlbmNlcyksIEdGUF9LRVJORUwpOw0KLQlpZiAoIWZlbmNlcykNCi0J
CWdvdG8gZXJyX2ZyZWVfc3luY19maWxlOw0KLQ0KLQkvKg0KLQkgKiBXZSBjYW4ndCBndWFyYW50
ZWUgdGhhdCBmZW5jZXMgaW4gYm90aCBhIGFuZCBiIGFyZSBvcmRlcmVkLCBidXQgaXQgaXMNCi0J
ICogc3RpbGwgcXVpdGUgbGlrZWx5Lg0KLQkgKg0KLQkgKiBTbyBhdHRlbXB0IHRvIG9yZGVyIHRo
ZSBmZW5jZXMgYXMgd2UgcGFzcyBvdmVyIHRoZW0gYW5kIG1lcmdlIGZlbmNlcw0KLQkgKiB3aXRo
IHRoZSBzYW1lIGNvbnRleHQuDQotCSAqLw0KLQ0KLQlpbmRleCA9IDA7DQotCWZvciAoYV9mZW5j
ZSA9IGRtYV9mZW5jZV91bndyYXBfZmlyc3QoYS0+ZmVuY2UsICZhX2l0ZXIpLA0KLQkgICAgIGJf
ZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX2ZpcnN0KGItPmZlbmNlLCAmYl9pdGVyKTsNCi0JICAg
ICBhX2ZlbmNlIHx8IGJfZmVuY2U7ICkgew0KLQ0KLQkJaWYgKCFiX2ZlbmNlKSB7DQotCQkJYWRk
X2ZlbmNlKGZlbmNlcywgJmluZGV4LCBhX2ZlbmNlKTsNCi0JCQlhX2ZlbmNlID0gZG1hX2ZlbmNl
X3Vud3JhcF9uZXh0KCZhX2l0ZXIpOw0KLQ0KLQkJfSBlbHNlIGlmICghYV9mZW5jZSkgew0KLQkJ
CWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYl9mZW5jZSk7DQotCQkJYl9mZW5jZSA9IGRtYV9m
ZW5jZV91bndyYXBfbmV4dCgmYl9pdGVyKTsNCi0NCi0JCX0gZWxzZSBpZiAoYV9mZW5jZS0+Y29u
dGV4dCA8IGJfZmVuY2UtPmNvbnRleHQpIHsNCi0JCQlhZGRfZmVuY2UoZmVuY2VzLCAmaW5kZXgs
IGFfZmVuY2UpOw0KLQkJCWFfZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJmFfaXRlcik7
DQotDQotCQl9IGVsc2UgaWYgKGJfZmVuY2UtPmNvbnRleHQgPCBhX2ZlbmNlLT5jb250ZXh0KSB7
DQotCQkJYWRkX2ZlbmNlKGZlbmNlcywgJmluZGV4LCBiX2ZlbmNlKTsNCi0JCQliX2ZlbmNlID0g
ZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZiX2l0ZXIpOw0KLQ0KLQkJfSBlbHNlIGlmIChfX2RtYV9m
ZW5jZV9pc19sYXRlcihhX2ZlbmNlLT5zZXFubywgYl9mZW5jZS0+c2Vxbm8sDQotCQkJCQkJYV9m
ZW5jZS0+b3BzKSkgew0KLQkJCWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYV9mZW5jZSk7DQot
CQkJYV9mZW5jZSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmYV9pdGVyKTsNCi0JCQliX2ZlbmNl
ID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZiX2l0ZXIpOw0KLQ0KLQkJfSBlbHNlIHsNCi0JCQlh
ZGRfZmVuY2UoZmVuY2VzLCAmaW5kZXgsIGJfZmVuY2UpOw0KLQkJCWFfZmVuY2UgPSBkbWFfZmVu
Y2VfdW53cmFwX25leHQoJmFfaXRlcik7DQotCQkJYl9mZW5jZSA9IGRtYV9mZW5jZV91bndyYXBf
bmV4dCgmYl9pdGVyKTsNCi0JCX0NCisJZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKGEt
PmZlbmNlLCBiLT5mZW5jZSk7DQorCWlmICghZmVuY2UpIHsNCisJCWZwdXQoc3luY19maWxlLT5m
aWxlKTsNCisJCXJldHVybiBOVUxMOw0KIAl9DQotDQotCWlmIChzeW5jX2ZpbGVfc2V0X2ZlbmNl
KHN5bmNfZmlsZSwgZmVuY2VzLCBpbmRleCkgPCAwKQ0KLQkJZ290byBlcnJfcHV0X2ZlbmNlczsN
Ci0NCisJc3luY19maWxlLT5mZW5jZSA9IGZlbmNlOw0KIAlzdHJsY3B5KHN5bmNfZmlsZS0+dXNl
cl9uYW1lLCBuYW1lLCBzaXplb2Yoc3luY19maWxlLT51c2VyX25hbWUpKTsNCiAJcmV0dXJuIHN5
bmNfZmlsZTsNCi0NCi1lcnJfcHV0X2ZlbmNlczoNCi0Jd2hpbGUgKGluZGV4KQ0KLQkJZG1hX2Zl
bmNlX3B1dChmZW5jZXNbLS1pbmRleF0pOw0KLQlrZnJlZShmZW5jZXMpOw0KLQ0KLWVycl9mcmVl
X3N5bmNfZmlsZToNCi0JZnB1dChzeW5jX2ZpbGUtPmZpbGUpOw0KLQlyZXR1cm4gTlVMTDsNCiB9
DQogDQogc3RhdGljIGludCBzeW5jX2ZpbGVfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBz
dHJ1Y3QgZmlsZSAqZmlsZSkNCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS11
bndyYXAuaCBiL2luY2x1ZGUvbGludXgvZG1hLWZlbmNlLXVud3JhcC5oDQppbmRleCBlOWQxMTQ2
MzcyOTQuLjQzYzhhOWJiZWU4OCAxMDA2NDQNCi0tLSBhL2luY2x1ZGUvbGludXgvZG1hLWZlbmNl
LXVud3JhcC5oDQorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS11bndyYXAuaA0KQEAgLTQ4
LDQgKzQ4LDI4IEBAIHN0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV91bndyYXBfbmV4dChzdHJ1
Y3QgZG1hX2ZlbmNlX3Vud3JhcCAqY3Vyc29yKTsNCiAJZm9yIChmZW5jZSA9IGRtYV9mZW5jZV91
bndyYXBfZmlyc3QoaGVhZCwgY3Vyc29yKTsgZmVuY2U7CVwNCiAJICAgICBmZW5jZSA9IGRtYV9m
ZW5jZV91bndyYXBfbmV4dChjdXJzb3IpKQ0KIA0KK3N0cnVjdCBkbWFfZmVuY2UgKl9fZG1hX2Zl
bmNlX3Vud3JhcF9tZXJnZSh1bnNpZ25lZCBpbnQgbnVtX2ZlbmNlcywNCisJCQkJCSAgIHN0cnVj
dCBkbWFfZmVuY2UgKipmZW5jZXMsDQorCQkJCQkgICBzdHJ1Y3QgZG1hX2ZlbmNlX3Vud3JhcCAq
Y3Vyc29ycyk7DQorDQorLyoqDQorICogZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSAtIHVud3JhcCBh
bmQgbWVyZ2UgZmVuY2VzDQorICoNCisgKiBBbGwgZmVuY2VzIGdpdmVuIGFzIHBhcmFtZXRlcnMg
YXJlIHVud3JhcHBlZCBhbmQgbWVyZ2VkIGJhY2sgdG9nZXRoZXIgYXMgZmxhdA0KKyAqIGRtYV9m
ZW5jZV9hcnJheS4gVXNlZnVsIGlmIG11bHRpcGxlIGNvbnRhaW5lcnMgbmVlZCB0byBiZSBtZXJn
ZWQgdG9nZXRoZXIuDQorICoNCisgKiBJbXBsZW1lbnRlZCBhcyBhIG1hY3JvIHRvIGFsbG9jYXRl
IHRoZSBuZWNlc3NhcnkgYXJyYXlzIG9uIHRoZSBzdGFjayBhbmQNCisgKiBhY2NvdW50IHRoZSBz
dGFjayBmcmFtZSBzaXplIHRvIHRoZSBjYWxsZXIuDQorICoNCisgKiBSZXR1cm5zIE5VTEwgb24g
bWVtb3J5IGFsbG9jYXRpb24gZmFpbHVyZSwgYSBkbWFfZmVuY2Ugb2JqZWN0IHJlcHJlc2VudGlu
Zw0KKyAqIGFsbCB0aGUgZ2l2ZW4gZmVuY2VzIG90aGVyd2lzZS4NCisgKi8NCisjZGVmaW5lIGRt
YV9mZW5jZV91bndyYXBfbWVyZ2UoLi4uKQkJCQkJXA0KKwkoewkJCQkJCQkJXA0KKwkJc3RydWN0
IGRtYV9mZW5jZSAqX19mW10gPSB7IF9fVkFfQVJHU19fIH07CQlcDQorCQlzdHJ1Y3QgZG1hX2Zl
bmNlX3Vud3JhcCBfX2NbQVJSQVlfU0laRShfX2YpXTsJCVwNCisJCQkJCQkJCQlcDQorCQlfX2Rt
YV9mZW5jZV91bndyYXBfbWVyZ2UoQVJSQVlfU0laRShfX2YpLCBfX2YsIF9fYyk7CVwNCisJfSkN
CisNCiAjZW5kaWYNCi0tIA0KMi4yNS4xDQoNCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBsaXN0IC0tIGxpbmFyby1t
bS1zaWdAbGlzdHMubGluYXJvLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVtYWlsIHRvIGxp
bmFyby1tbS1zaWctbGVhdmVAbGlzdHMubGluYXJvLm9yZwo=
