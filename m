Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 32D313E131B
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  5 Aug 2021 12:47:53 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D7E8466009
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  5 Aug 2021 10:47:51 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id CB32C6141B; Thu,  5 Aug 2021 10:47:40 +0000 (UTC)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 813E362F00;
	Thu,  5 Aug 2021 10:47:35 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id E1BF9634D5
 for <linaro-mm-sig@lists.linaro.org>; Thu,  5 Aug 2021 10:47:26 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id E132A63396; Thu,  5 Aug 2021 10:47:25 +0000 (UTC)
Received: from mail-ed1-f42.google.com (mail-ed1-f42.google.com
 [209.85.208.42])
 by lists.linaro.org (Postfix) with ESMTPS id 960B562F00
 for <linaro-mm-sig@lists.linaro.org>; Thu,  5 Aug 2021 10:47:22 +0000 (UTC)
Received: by mail-ed1-f42.google.com with SMTP id p21so7672090edi.9
 for <linaro-mm-sig@lists.linaro.org>; Thu, 05 Aug 2021 03:47:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=RNtq6hCIBFIpKrgTS3fF+5pLM27NieV8t2gZ4HTzwW8=;
 b=Wc15l1UemZE3M9THOYbK3HTsSSrCJw3WbK6TMe03c3Qb7kNg+6cSO3ftgu3lFwygb3
 8IdfKkq+wGKfBxcmexsVEKYc1JvAuqlFbAsgpu9Ixu4GnAWgVEXiic1BQBjHBEBNlcSl
 N+hPLcftdUAx6Wf+ckeDQCY7Sj+L0NScYLw1c=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=RNtq6hCIBFIpKrgTS3fF+5pLM27NieV8t2gZ4HTzwW8=;
 b=LDZVLRktm3YaUFzRzUO+OPGzEqHa/mkZGJoXRdOfXITMgRcrK8VvLJRVSDP/g+lu3s
 BhZTIRdAfhdsob1Jv7c6Y0Ot0nylL7DswL4OEH24vMjr3MBYRcgL61fApVBFBHYbOp80
 T4gToxtlF1/440NgMvDhfYbUo6PWtwHkm6cROjIB/vVe20D3Ccc4Rsmod4aKDXKyvHHE
 9Gaf+661SybqXPQ9sH0S/4Bo6mBrm1GFO9Mka4i6DETw8+TmMzPUPljWc+0/C+AIXzxA
 g95kECWU42uDxXD3D/ggAgeBr01sH7kniACC3wRQ7yg1ygJZl+Pi+9DUoX4RDZ6/8Buz
 5PYg==
X-Gm-Message-State: AOAM5323a98ZhN1X4LLngvWzsnwXCzEY6cVYzIdmgBXLlBF3m/aXzE1l
 DPI19CeW/hDd6DQUtBj6S0oYww==
X-Google-Smtp-Source: ABdhPJyi03Vr6QQ78F9N7ACtlZUpWcUyU35iHMBs996IL7VwAHRgK4eZAKaCXC/G6FRI1bBGkuxaLg==
X-Received: by 2002:aa7:d144:: with SMTP id r4mr5641668edo.111.1628160441604; 
 Thu, 05 Aug 2021 03:47:21 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id p5sm1578809ejl.73.2021.08.05.03.47.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 05 Aug 2021 03:47:21 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Date: Thu,  5 Aug 2021 12:46:56 +0200
Message-Id: <20210805104705.862416-12-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.32.0
In-Reply-To: <20210805104705.862416-1-daniel.vetter@ffwll.ch>
References: <20210805104705.862416-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Subject: [Linaro-mm-sig] [PATCH v5 11/20] drm/etnaviv: Use scheduler
 dependency handling
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Cc: Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 etnaviv@lists.freedesktop.org,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 linaro-mm-sig@lists.linaro.org,
 Christian Gmeiner <christian.gmeiner@gmail.com>,
 Russell King <linux+etnaviv@armlinux.org.uk>,
 Daniel Vetter <daniel.vetter@intel.com>, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

V2UgbmVlZCB0byBwdWxsIHRoZSBkcm1fc2NoZWRfam9iX2luaXQgbXVjaCBlYXJsaWVyLCBidXQg
dGhhdCdzIHZlcnkKbWlub3Igc3VyZ2VyeS4KCnYyOiBBY3R1YWxseSBmaXggdXAgY2xlYW51cCBw
YXRocyBieSBjYWxsaW5nIGRybV9zY2hlZF9qb2JfaW5pdCwgd2hpY2gKSSB3YW50ZWQgdG8gdG8g
aW4gdGhlIHByZXZpb3VzIHJvdW5kIChhbmQgZGlkLCBmb3IgYWxsIG90aGVyIGRyaXZlcnMpLgpT
cG90dGVkIGJ5IEx1Y2FzLgoKdjM6IFJlYmFzZSBvdmVyIHJlbmFtZWQgZnVuY3Rpb25zIHRvIGFk
ZCBkZXBlbmRlbmNpZXMuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0
dGVyQGludGVsLmNvbT4KQ2M6IEx1Y2FzIFN0YWNoIDxsLnN0YWNoQHBlbmd1dHJvbml4LmRlPgpD
YzogUnVzc2VsbCBLaW5nIDxsaW51eCtldG5hdml2QGFybWxpbnV4Lm9yZy51az4KQ2M6IENocmlz
dGlhbiBHbWVpbmVyIDxjaHJpc3RpYW4uZ21laW5lckBnbWFpbC5jb20+CkNjOiBTdW1pdCBTZW13
YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8ub3JnPgpDYzogIkNocmlzdGlhbiBLw7ZuaWciIDxjaHJp
c3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBldG5hdml2QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpD
YzogbGludXgtbWVkaWFAdmdlci5rZXJuZWwub3JnCkNjOiBsaW5hcm8tbW0tc2lnQGxpc3RzLmxp
bmFyby5vcmcKLS0tCiBkcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbS5oICAgICAg
ICB8ICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYyB8
IDYwICsrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZf
c2NoZWQuYyAgICAgIHwgNjMgKy0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfc2NoZWQuaCAgICAgIHwgIDMgKy0KIDQgZmlsZXMgY2hhbmdlZCwgMzcg
aW5zZXJ0aW9ucygrKSwgOTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uaCBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2
aXZfZ2VtLmgKaW5kZXggOThlNjBkZjg4MmI2Li42MzY4OGU2ZTQ1ODAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2V0bmF2aXYvZXRuYXZpdl9nZW0uaApAQCAtODAsOSArODAsNiBAQCBzdHJ1Y3QgZXRuYXZpdl9n
ZW1fc3VibWl0X2JvIHsKIAl1NjQgdmE7CiAJc3RydWN0IGV0bmF2aXZfZ2VtX29iamVjdCAqb2Jq
OwogCXN0cnVjdCBldG5hdml2X3ZyYW1fbWFwcGluZyAqbWFwcGluZzsKLQlzdHJ1Y3QgZG1hX2Zl
bmNlICpleGNsOwotCXVuc2lnbmVkIGludCBucl9zaGFyZWQ7Ci0Jc3RydWN0IGRtYV9mZW5jZSAq
KnNoYXJlZDsKIH07CiAKIC8qIENyZWF0ZWQgcGVyIHN1Ym1pdC1pb2N0bCwgdG8gdHJhY2sgYm8n
cyBhbmQgY21kc3RyZWFtIGJ1ZnMsIGV0YywKQEAgLTk1LDcgKzkyLDcgQEAgc3RydWN0IGV0bmF2
aXZfZ2VtX3N1Ym1pdCB7CiAJc3RydWN0IGV0bmF2aXZfZmlsZV9wcml2YXRlICpjdHg7CiAJc3Ry
dWN0IGV0bmF2aXZfZ3B1ICpncHU7CiAJc3RydWN0IGV0bmF2aXZfaW9tbXVfY29udGV4dCAqbW11
X2NvbnRleHQsICpwcmV2X21tdV9jb250ZXh0OwotCXN0cnVjdCBkbWFfZmVuY2UgKm91dF9mZW5j
ZSwgKmluX2ZlbmNlOworCXN0cnVjdCBkbWFfZmVuY2UgKm91dF9mZW5jZTsKIAlpbnQgb3V0X2Zl
bmNlX2lkOwogCXN0cnVjdCBsaXN0X2hlYWQgbm9kZTsgLyogR1BVIGFjdGl2ZSBzdWJtaXQgbGlz
dCAqLwogCXN0cnVjdCBldG5hdml2X2NtZGJ1ZiBjbWRidWY7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfZ2VtX3N1Ym1pdC5jCmluZGV4IDRkZDdkOWQ1NDFjMC4uZTNkNDM2Nzhl
YjA5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJt
aXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYwpA
QCAtMTg4LDE2ICsxODgsMTEgQEAgc3RhdGljIGludCBzdWJtaXRfZmVuY2Vfc3luYyhzdHJ1Y3Qg
ZXRuYXZpdl9nZW1fc3VibWl0ICpzdWJtaXQpCiAJCWlmIChzdWJtaXQtPmZsYWdzICYgRVROQV9T
VUJNSVRfTk9fSU1QTElDSVQpCiAJCQljb250aW51ZTsKIAotCQlpZiAoYm8tPmZsYWdzICYgRVRO
QV9TVUJNSVRfQk9fV1JJVEUpIHsKLQkJCXJldCA9IGRtYV9yZXN2X2dldF9mZW5jZXMocm9iaiwg
JmJvLT5leGNsLAotCQkJCQkJICAmYm8tPm5yX3NoYXJlZCwKLQkJCQkJCSAgJmJvLT5zaGFyZWQp
OwotCQkJaWYgKHJldCkKLQkJCQlyZXR1cm4gcmV0OwotCQl9IGVsc2UgewotCQkJYm8tPmV4Y2wg
PSBkbWFfcmVzdl9nZXRfZXhjbF91bmxvY2tlZChyb2JqKTsKLQkJfQotCisJCXJldCA9IGRybV9z
Y2hlZF9qb2JfYWRkX2ltcGxpY2l0X2RlcGVuZGVuY2llcygmc3VibWl0LT5zY2hlZF9qb2IsCisJ
CQkJCQkJICAgICAgJmJvLT5vYmotPmJhc2UsCisJCQkJCQkJICAgICAgYm8tPmZsYWdzICYgRVRO
QV9TVUJNSVRfQk9fV1JJVEUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKIAl9CiAKIAly
ZXR1cm4gcmV0OwpAQCAtNDAzLDggKzM5OCw2IEBAIHN0YXRpYyB2b2lkIHN1Ym1pdF9jbGVhbnVw
KHN0cnVjdCBrcmVmICprcmVmKQogCiAJd2FrZV91cF9hbGwoJnN1Ym1pdC0+Z3B1LT5mZW5jZV9l
dmVudCk7CiAKLQlpZiAoc3VibWl0LT5pbl9mZW5jZSkKLQkJZG1hX2ZlbmNlX3B1dChzdWJtaXQt
PmluX2ZlbmNlKTsKIAlpZiAoc3VibWl0LT5vdXRfZmVuY2UpIHsKIAkJLyogZmlyc3QgcmVtb3Zl
IGZyb20gSURSLCBzbyBmZW5jZSBjYW4gbm90IGJlIGZvdW5kIGFueW1vcmUgKi8KIAkJbXV0ZXhf
bG9jaygmc3VibWl0LT5ncHUtPmZlbmNlX2xvY2spOwpAQCAtNTI5LDcgKzUyMiw3IEBAIGludCBl
dG5hdml2X2lvY3RsX2dlbV9zdWJtaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAlyZXQgPSBldG5hdml2X2NtZGJ1Zl9pbml0KHByaXYtPmNtZGJ1Zl9zdWJhbGxvYywgJnN1
Ym1pdC0+Y21kYnVmLAogCQkJCSAgQUxJR04oYXJncy0+c3RyZWFtX3NpemUsIDgpICsgOCk7CiAJ
aWYgKHJldCkKLQkJZ290byBlcnJfc3VibWl0X29iamVjdHM7CisJCWdvdG8gZXJyX3N1Ym1pdF9w
dXQ7CiAKIAlzdWJtaXQtPmN0eCA9IGZpbGUtPmRyaXZlcl9wcml2OwogCWV0bmF2aXZfaW9tbXVf
Y29udGV4dF9nZXQoc3VibWl0LT5jdHgtPm1tdSk7CkBAIC01MzcsNTEgKzUzMCw2MiBAQCBpbnQg
ZXRuYXZpdl9pb2N0bF9nZW1fc3VibWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiAJc3VibWl0LT5leGVjX3N0YXRlID0gYXJncy0+ZXhlY19zdGF0ZTsKIAlzdWJtaXQtPmZs
YWdzID0gYXJncy0+ZmxhZ3M7CiAKKwlyZXQgPSBkcm1fc2NoZWRfam9iX2luaXQoJnN1Ym1pdC0+
c2NoZWRfam9iLAorCQkJCSAmY3R4LT5zY2hlZF9lbnRpdHlbYXJncy0+cGlwZV0sCisJCQkJIHN1
Ym1pdC0+Y3R4KTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9zdWJtaXRfcHV0OworCiAJcmV0ID0g
c3VibWl0X2xvb2t1cF9vYmplY3RzKHN1Ym1pdCwgZmlsZSwgYm9zLCBhcmdzLT5ucl9ib3MpOwog
CWlmIChyZXQpCi0JCWdvdG8gZXJyX3N1Ym1pdF9vYmplY3RzOworCQlnb3RvIGVycl9zdWJtaXRf
am9iOwogCiAJaWYgKChwcml2LT5tbXVfZ2xvYmFsLT52ZXJzaW9uICE9IEVUTkFWSVZfSU9NTVVf
VjIpICYmCiAJICAgICFldG5hdml2X2NtZF92YWxpZGF0ZV9vbmUoZ3B1LCBzdHJlYW0sIGFyZ3Mt
PnN0cmVhbV9zaXplIC8gNCwKIAkJCQkgICAgICByZWxvY3MsIGFyZ3MtPm5yX3JlbG9jcykpIHsK
IAkJcmV0ID0gLUVJTlZBTDsKLQkJZ290byBlcnJfc3VibWl0X29iamVjdHM7CisJCWdvdG8gZXJy
X3N1Ym1pdF9qb2I7CiAJfQogCiAJaWYgKGFyZ3MtPmZsYWdzICYgRVROQV9TVUJNSVRfRkVOQ0Vf
RkRfSU4pIHsKLQkJc3VibWl0LT5pbl9mZW5jZSA9IHN5bmNfZmlsZV9nZXRfZmVuY2UoYXJncy0+
ZmVuY2VfZmQpOwotCQlpZiAoIXN1Ym1pdC0+aW5fZmVuY2UpIHsKKwkJc3RydWN0IGRtYV9mZW5j
ZSAqaW5fZmVuY2UgPSBzeW5jX2ZpbGVfZ2V0X2ZlbmNlKGFyZ3MtPmZlbmNlX2ZkKTsKKwkJaWYg
KCFpbl9mZW5jZSkgewogCQkJcmV0ID0gLUVJTlZBTDsKLQkJCWdvdG8gZXJyX3N1Ym1pdF9vYmpl
Y3RzOworCQkJZ290byBlcnJfc3VibWl0X2pvYjsKIAkJfQorCisJCXJldCA9IGRybV9zY2hlZF9q
b2JfYWRkX2RlcGVuZGVuY3koJnN1Ym1pdC0+c2NoZWRfam9iLAorCQkJCQkJICAgaW5fZmVuY2Up
OworCQlpZiAocmV0KQorCQkJZ290byBlcnJfc3VibWl0X2pvYjsKIAl9CiAKIAlyZXQgPSBzdWJt
aXRfcGluX29iamVjdHMoc3VibWl0KTsKIAlpZiAocmV0KQotCQlnb3RvIGVycl9zdWJtaXRfb2Jq
ZWN0czsKKwkJZ290byBlcnJfc3VibWl0X2pvYjsKIAogCXJldCA9IHN1Ym1pdF9yZWxvYyhzdWJt
aXQsIHN0cmVhbSwgYXJncy0+c3RyZWFtX3NpemUgLyA0LAogCQkJICAgcmVsb2NzLCBhcmdzLT5u
cl9yZWxvY3MpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyX3N1Ym1pdF9vYmplY3RzOworCQlnb3Rv
IGVycl9zdWJtaXRfam9iOwogCiAJcmV0ID0gc3VibWl0X3BlcmZtb25fdmFsaWRhdGUoc3VibWl0
LCBhcmdzLT5leGVjX3N0YXRlLCBwbXJzKTsKIAlpZiAocmV0KQotCQlnb3RvIGVycl9zdWJtaXRf
b2JqZWN0czsKKwkJZ290byBlcnJfc3VibWl0X2pvYjsKIAogCW1lbWNweShzdWJtaXQtPmNtZGJ1
Zi52YWRkciwgc3RyZWFtLCBhcmdzLT5zdHJlYW1fc2l6ZSk7CiAKIAlyZXQgPSBzdWJtaXRfbG9j
a19vYmplY3RzKHN1Ym1pdCwgJnRpY2tldCk7CiAJaWYgKHJldCkKLQkJZ290byBlcnJfc3VibWl0
X29iamVjdHM7CisJCWdvdG8gZXJyX3N1Ym1pdF9qb2I7CiAKIAlyZXQgPSBzdWJtaXRfZmVuY2Vf
c3luYyhzdWJtaXQpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyX3N1Ym1pdF9vYmplY3RzOworCQln
b3RvIGVycl9zdWJtaXRfam9iOwogCi0JcmV0ID0gZXRuYXZpdl9zY2hlZF9wdXNoX2pvYigmY3R4
LT5zY2hlZF9lbnRpdHlbYXJncy0+cGlwZV0sIHN1Ym1pdCk7CisJcmV0ID0gZXRuYXZpdl9zY2hl
ZF9wdXNoX2pvYihzdWJtaXQpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyX3N1Ym1pdF9vYmplY3Rz
OworCQlnb3RvIGVycl9zdWJtaXRfam9iOwogCiAJc3VibWl0X2F0dGFjaF9vYmplY3RfZmVuY2Vz
KHN1Ym1pdCk7CiAKQEAgLTU5NSw3ICs1OTksNyBAQCBpbnQgZXRuYXZpdl9pb2N0bF9nZW1fc3Vi
bWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXN5bmNfZmlsZSA9IHN5
bmNfZmlsZV9jcmVhdGUoc3VibWl0LT5vdXRfZmVuY2UpOwogCQlpZiAoIXN5bmNfZmlsZSkgewog
CQkJcmV0ID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX3N1Ym1pdF9vYmplY3RzOworCQkJZ290byBl
cnJfc3VibWl0X2pvYjsKIAkJfQogCQlmZF9pbnN0YWxsKG91dF9mZW5jZV9mZCwgc3luY19maWxl
LT5maWxlKTsKIAl9CkBAIC02MDMsNyArNjA3LDkgQEAgaW50IGV0bmF2aXZfaW9jdGxfZ2VtX3N1
Ym1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWFyZ3MtPmZlbmNlX2Zk
ID0gb3V0X2ZlbmNlX2ZkOwogCWFyZ3MtPmZlbmNlID0gc3VibWl0LT5vdXRfZmVuY2VfaWQ7CiAK
LWVycl9zdWJtaXRfb2JqZWN0czoKK2Vycl9zdWJtaXRfam9iOgorCWRybV9zY2hlZF9qb2JfY2xl
YW51cCgmc3VibWl0LT5zY2hlZF9qb2IpOworZXJyX3N1Ym1pdF9wdXQ6CiAJZXRuYXZpdl9zdWJt
aXRfcHV0KHN1Ym1pdCk7CiAKIGVycl9zdWJtaXRfd3dfYWNxdWlyZToKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfc2NoZWQuYyBiL2RyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfc2NoZWQuYwppbmRleCAxODBiYjYzM2Q1YzUuLjJiYmJkNmNjYzk1ZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9zY2hlZC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfc2NoZWQuYwpAQCAtMTcsNTggKzE3LDYg
QEAgbW9kdWxlX3BhcmFtX25hbWVkKGpvYl9oYW5nX2xpbWl0LCBldG5hdml2X2pvYl9oYW5nX2xp
bWl0LCBpbnQgLCAwNDQ0KTsKIHN0YXRpYyBpbnQgZXRuYXZpdl9od19qb2JzX2xpbWl0ID0gNDsK
IG1vZHVsZV9wYXJhbV9uYW1lZChod19qb2JfbGltaXQsIGV0bmF2aXZfaHdfam9ic19saW1pdCwg
aW50ICwgMDQ0NCk7CiAKLXN0YXRpYyBzdHJ1Y3QgZG1hX2ZlbmNlICoKLWV0bmF2aXZfc2NoZWRf
ZGVwZW5kZW5jeShzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAqc2NoZWRfam9iLAotCQkJIHN0cnVjdCBk
cm1fc2NoZWRfZW50aXR5ICplbnRpdHkpCi17Ci0Jc3RydWN0IGV0bmF2aXZfZ2VtX3N1Ym1pdCAq
c3VibWl0ID0gdG9fZXRuYXZpdl9zdWJtaXQoc2NoZWRfam9iKTsKLQlzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZTsKLQlpbnQgaTsKLQotCWlmICh1bmxpa2VseShzdWJtaXQtPmluX2ZlbmNlKSkgewot
CQlmZW5jZSA9IHN1Ym1pdC0+aW5fZmVuY2U7Ci0JCXN1Ym1pdC0+aW5fZmVuY2UgPSBOVUxMOwot
Ci0JCWlmICghZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkKLQkJCXJldHVybiBmZW5jZTsK
LQotCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKLQl9Ci0KLQlmb3IgKGkgPSAwOyBpIDwgc3VibWl0
LT5ucl9ib3M7IGkrKykgewotCQlzdHJ1Y3QgZXRuYXZpdl9nZW1fc3VibWl0X2JvICpibyA9ICZz
dWJtaXQtPmJvc1tpXTsKLQkJaW50IGo7Ci0KLQkJaWYgKGJvLT5leGNsKSB7Ci0JCQlmZW5jZSA9
IGJvLT5leGNsOwotCQkJYm8tPmV4Y2wgPSBOVUxMOwotCi0JCQlpZiAoIWRtYV9mZW5jZV9pc19z
aWduYWxlZChmZW5jZSkpCi0JCQkJcmV0dXJuIGZlbmNlOwotCi0JCQlkbWFfZmVuY2VfcHV0KGZl
bmNlKTsKLQkJfQotCi0JCWZvciAoaiA9IDA7IGogPCBiby0+bnJfc2hhcmVkOyBqKyspIHsKLQkJ
CWlmICghYm8tPnNoYXJlZFtqXSkKLQkJCQljb250aW51ZTsKLQotCQkJZmVuY2UgPSBiby0+c2hh
cmVkW2pdOwotCQkJYm8tPnNoYXJlZFtqXSA9IE5VTEw7Ci0KLQkJCWlmICghZG1hX2ZlbmNlX2lz
X3NpZ25hbGVkKGZlbmNlKSkKLQkJCQlyZXR1cm4gZmVuY2U7Ci0KLQkJCWRtYV9mZW5jZV9wdXQo
ZmVuY2UpOwotCQl9Ci0JCWtmcmVlKGJvLT5zaGFyZWQpOwotCQliby0+bnJfc2hhcmVkID0gMDsK
LQkJYm8tPnNoYXJlZCA9IE5VTEw7Ci0JfQotCi0JcmV0dXJuIE5VTEw7Ci19Ci0KIHN0YXRpYyBz
dHJ1Y3QgZG1hX2ZlbmNlICpldG5hdml2X3NjaGVkX3J1bl9qb2Ioc3RydWN0IGRybV9zY2hlZF9q
b2IgKnNjaGVkX2pvYikKIHsKIAlzdHJ1Y3QgZXRuYXZpdl9nZW1fc3VibWl0ICpzdWJtaXQgPSB0
b19ldG5hdml2X3N1Ym1pdChzY2hlZF9qb2IpOwpAQCAtMTQwLDI5ICs4OCwyMiBAQCBzdGF0aWMg
dm9pZCBldG5hdml2X3NjaGVkX2ZyZWVfam9iKHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9q
b2IpCiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3NjaGVkX2JhY2tlbmRfb3BzIGV0bmF2
aXZfc2NoZWRfb3BzID0gewotCS5kZXBlbmRlbmN5ID0gZXRuYXZpdl9zY2hlZF9kZXBlbmRlbmN5
LAogCS5ydW5fam9iID0gZXRuYXZpdl9zY2hlZF9ydW5fam9iLAogCS50aW1lZG91dF9qb2IgPSBl
dG5hdml2X3NjaGVkX3RpbWVkb3V0X2pvYiwKIAkuZnJlZV9qb2IgPSBldG5hdml2X3NjaGVkX2Zy
ZWVfam9iLAogfTsKIAotaW50IGV0bmF2aXZfc2NoZWRfcHVzaF9qb2Ioc3RydWN0IGRybV9zY2hl
ZF9lbnRpdHkgKnNjaGVkX2VudGl0eSwKLQkJCSAgIHN0cnVjdCBldG5hdml2X2dlbV9zdWJtaXQg
KnN1Ym1pdCkKK2ludCBldG5hdml2X3NjaGVkX3B1c2hfam9iKHN0cnVjdCBldG5hdml2X2dlbV9z
dWJtaXQgKnN1Ym1pdCkKIHsKIAlpbnQgcmV0ID0gMDsKIAogCS8qCiAJICogSG9sZCB0aGUgZmVu
Y2UgbG9jayBhY3Jvc3MgdGhlIHdob2xlIG9wZXJhdGlvbiB0byBhdm9pZCBqb2JzIGJlaW5nCiAJ
ICogcHVzaGVkIG91dCBvZiBvcmRlciB3aXRoIHJlZ2FyZCB0byB0aGVpciBzY2hlZCBmZW5jZSBz
ZXFub3MgYXMKLQkgKiBhbGxvY2F0ZWQgaW4gZHJtX3NjaGVkX2pvYl9pbml0LgorCSAqIGFsbG9j
YXRlZCBpbiBkcm1fc2NoZWRfam9iX2FybS4KIAkgKi8KIAltdXRleF9sb2NrKCZzdWJtaXQtPmdw
dS0+ZmVuY2VfbG9jayk7CiAKLQlyZXQgPSBkcm1fc2NoZWRfam9iX2luaXQoJnN1Ym1pdC0+c2No
ZWRfam9iLCBzY2hlZF9lbnRpdHksCi0JCQkJIHN1Ym1pdC0+Y3R4KTsKLQlpZiAocmV0KQotCQln
b3RvIG91dF91bmxvY2s7Ci0KIAlkcm1fc2NoZWRfam9iX2FybSgmc3VibWl0LT5zY2hlZF9qb2Ip
OwogCiAJc3VibWl0LT5vdXRfZmVuY2UgPSBkbWFfZmVuY2VfZ2V0KCZzdWJtaXQtPnNjaGVkX2pv
Yi5zX2ZlbmNlLT5maW5pc2hlZCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZp
di9ldG5hdml2X3NjaGVkLmggYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X3NjaGVk
LmgKaW5kZXggYzBhNjc5NmUyMmM5Li5iYWViZmEwNjlhZmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9ldG5hdml2L2V0bmF2aXZfc2NoZWQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRu
YXZpdi9ldG5hdml2X3NjaGVkLmgKQEAgLTE4LDcgKzE4LDYgQEAgc3RydWN0IGV0bmF2aXZfZ2Vt
X3N1Ym1pdCAqdG9fZXRuYXZpdl9zdWJtaXQoc3RydWN0IGRybV9zY2hlZF9qb2IgKnNjaGVkX2pv
YikKIAogaW50IGV0bmF2aXZfc2NoZWRfaW5pdChzdHJ1Y3QgZXRuYXZpdl9ncHUgKmdwdSk7CiB2
b2lkIGV0bmF2aXZfc2NoZWRfZmluaShzdHJ1Y3QgZXRuYXZpdl9ncHUgKmdwdSk7Ci1pbnQgZXRu
YXZpdl9zY2hlZF9wdXNoX2pvYihzdHJ1Y3QgZHJtX3NjaGVkX2VudGl0eSAqc2NoZWRfZW50aXR5
LAotCQkJICAgc3RydWN0IGV0bmF2aXZfZ2VtX3N1Ym1pdCAqc3VibWl0KTsKK2ludCBldG5hdml2
X3NjaGVkX3B1c2hfam9iKHN0cnVjdCBldG5hdml2X2dlbV9zdWJtaXQgKnN1Ym1pdCk7CiAKICNl
bmRpZiAvKiBfX0VUTkFWSVZfU0NIRURfSF9fICovCi0tIAoyLjMyLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkxpbmFyby1tbS1zaWcgbWFpbGluZyBs
aXN0CkxpbmFyby1tbS1zaWdAbGlzdHMubGluYXJvLm9yZwpodHRwczovL2xpc3RzLmxpbmFyby5v
cmcvbWFpbG1hbi9saXN0aW5mby9saW5hcm8tbW0tc2lnCg==
