Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id C7137519F34
	for <lists+linaro-mm-sig@lfdr.de>; Wed,  4 May 2022 14:23:19 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 0BD1840435
	for <lists+linaro-mm-sig@lfdr.de>; Wed,  4 May 2022 12:23:19 +0000 (UTC)
Received: from mail-wr1-f48.google.com (mail-wr1-f48.google.com [209.85.221.48])
	by lists.linaro.org (Postfix) with ESMTPS id 8405540300
	for <linaro-mm-sig@lists.linaro.org>; Wed,  4 May 2022 12:23:01 +0000 (UTC)
Received: by mail-wr1-f48.google.com with SMTP id w4so1765173wrg.12
        for <linaro-mm-sig@lists.linaro.org>; Wed, 04 May 2022 05:23:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20210112;
        h=from:to:cc:subject:date:message-id:in-reply-to:references
         :mime-version:content-transfer-encoding;
        bh=cCmIXxOgxptQJSrmAcVYIt5j3EZExT9IriTMt5gM9c0=;
        b=qogOA9kdFReb7ukD17deyl/hAvfbrcNoTuN9yxc/OGvg6RoiA6YN8JOrpr84cZsD4T
         Wymu4YwiGpaBChoAWnO+AGOT9FUf7Jxlgglz1GM6d/XrLUp+Hi/3XqkryOSq/7bkTmKv
         d8DGUhKK6MVIrOizOHlSowbjB3uNVn4ocEfRVuV2gGVkY7qaRXrf/5UFa2gF8a8KmnP0
         3Zshl1if7E54fGifaWW/DnOYWVsyYPIPYiq2enm+kdsXugsgxEFeLOUmtM4/AJqVsCCa
         RVSbecq80vT2BN0+o+TBq8F+T1TFag5r9eZRD/k9o11K+HzLdpECz26DHcIhsBXPz5wZ
         AbOw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20210112;
        h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
         :references:mime-version:content-transfer-encoding;
        bh=cCmIXxOgxptQJSrmAcVYIt5j3EZExT9IriTMt5gM9c0=;
        b=McRjgpAA7U9heD/1KfxVcbU/n+dRuvaM96EheQhSPha71fPyPlXIrXHnqxTme1MZT8
         FYtP+D2xX1qpd4GY2o4N16e984dfbuzKtixERzR1DUXXVIZ09Ns2bdyRnC10QGl2uPry
         SrQKLGbQWoXcyLZ4fcm8fzV5ZOdKjwD2eaxlZ8cUsK5nB3+Z0R/gB3h1Qm5jZp4U7BiP
         daylgYqNsbQs7dgRzScPiS0oKRvfpqqML/y1YS1T37+hnqGvVsyTQ0ryLxpicQAW3c3g
         V+hNqV/MyMGvJRafB8Mf5WGFOqMCq5T1P3IruYOHeId/9VIhgWs3VtS+TPppkmH1HoP+
         SVoA==
X-Gm-Message-State: AOAM531Rv/YdfqXorOFC0127/AfPVi01r1l60jg7u19uEUtHtA0Czabw
	jwgHfzK5vg3QMjF2BlQCcmU=
X-Google-Smtp-Source: ABdhPJzqVoGHn4ArhP+IT98Sl68njUhKS4/0PhaHVrQx7Uc6GdVOi5fIjL4aefILxBfqxeniPZfC3w==
X-Received: by 2002:a5d:56c9:0:b0:20a:c54c:70e2 with SMTP id m9-20020a5d56c9000000b0020ac54c70e2mr16316470wrw.415.1651666981102;
        Wed, 04 May 2022 05:23:01 -0700 (PDT)
Received: from able.fritz.box (p57b0b7c9.dip0.t-ipconnect.de. [87.176.183.201])
        by smtp.gmail.com with ESMTPSA id l28-20020a05600c1d1c00b003942a244ed1sm1462119wms.22.2022.05.04.05.23.00
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Wed, 04 May 2022 05:23:00 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
To: daniel@ffwll.ch,
	dri-devel@lists.freedesktop.org,
	linaro-mm-sig@lists.linaro.org,
	linux-media@vger.kernel.org
Date: Wed,  4 May 2022 14:22:55 +0200
Message-Id: <20220504122256.1654-4-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20220504122256.1654-1-christian.koenig@amd.com>
References: <20220504122256.1654-1-christian.koenig@amd.com>
MIME-Version: 1.0
Message-ID-Hash: SISZGPK6ZQ2747JKPSZCTXXXXX6NGAPC
X-Message-ID-Hash: SISZGPK6ZQ2747JKPSZCTXXXXX6NGAPC
X-MailFrom: ckoenig.leichtzumerken@gmail.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; digests; suspicious-header
CC: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH 4/5] dma-buf: generalize dma_fence unwrap & merging v2
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/SISZGPK6ZQ2747JKPSZCTXXXXX6NGAPC/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64

SW50cm9kdWNlIGEgZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSgpIG1hY3JvIHdoaWNoIGFsbG93cyB0
byB1bndyYXAgZmVuY2VzDQp3aGljaCBwb3RlbnRpYWxseSBjYW4gYmUgY29udGFpbmVycyBhcyB3
ZWxsIGFuZCB0aGVuIG1lcmdlIHRoZW0gYmFjaw0KdG9nZXRoZXIgaW50byBhIGZsYXQgZG1hX2Zl
bmNlX2FycmF5Lg0KDQp2MjogcmVuYW1lIHRoZSBmdW5jdGlvbiwgYWRkIHNvbWUgbW9yZSBjb21t
ZW50cyBhYm91dCBob3cgdGhlIHdyYXBwZXIgaXMNCiAgICB1c2VkLCBtb3ZlIGZpbHRlcmluZyBv
ZiBzaWduYWxlZCBmZW5jZXMgaW50byB0aGUgdW53cmFwIGl0ZXJhdG9yLA0KICAgIGFkZCBjb21w
bGV4IHNlbGZ0ZXN0IHdoaWNoIGNvdmVycyBtb3JlIGNhc2VzLg0KDQpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+DQotLS0NCiBkcml2ZXJz
L2RtYS1idWYvZG1hLWZlbmNlLXVud3JhcC5jICAgIHwgIDk5ICsrKysrKysrKysrKysrKysrKysr
Kw0KIGRyaXZlcnMvZG1hLWJ1Zi9zdC1kbWEtZmVuY2UtdW53cmFwLmMgfCAxMDkgKysrKysrKysr
KysrKysrKysrKysrKysNCiBkcml2ZXJzL2RtYS1idWYvc3luY19maWxlLmMgICAgICAgICAgIHwg
MTE5ICsrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogaW5jbHVkZS9saW51eC9kbWEtZmVuY2Ut
dW53cmFwLmggICAgICB8ICAyNCArKysrKysNCiA0IGZpbGVzIGNoYW5nZWQsIDIzOCBpbnNlcnRp
b25zKCspLCAxMTMgZGVsZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYv
ZG1hLWZlbmNlLXVud3JhcC5jIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS11bndyYXAuYw0K
aW5kZXggN2IwYjkxMDg2ZGVkLi40ZWQ1ZWE4ODA3ZDcgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2Rt
YS1idWYvZG1hLWZlbmNlLXVud3JhcC5jDQorKysgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNl
LXVud3JhcC5jDQpAQCAtMTEsNiArMTEsNyBAQA0KICNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2Ut
YXJyYXkuaD4NCiAjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLWNoYWluLmg+DQogI2luY2x1ZGUg
PGxpbnV4L2RtYS1mZW5jZS11bndyYXAuaD4NCisjaW5jbHVkZSA8bGludXgvc2xhYi5oPg0KIA0K
IC8qIEludGVybmFsIGhlbHBlciB0byBzdGFydCBuZXcgYXJyYXkgaXRlcmF0aW9uLCBkb24ndCB1
c2UgZGlyZWN0bHkgKi8NCiBzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSAqDQpAQCAtNjYsMyArNjcs
MTAxIEBAIHN0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV91bndyYXBfbmV4dChzdHJ1Y3QgZG1h
X2ZlbmNlX3Vud3JhcCAqY3Vyc29yKQ0KIAlyZXR1cm4gdG1wOw0KIH0NCiBFWFBPUlRfU1lNQk9M
X0dQTChkbWFfZmVuY2VfdW53cmFwX25leHQpOw0KKw0KKy8qIEltcGxlbWVudGF0aW9uIGZvciB0
aGUgZG1hX2ZlbmNlX21lcmdlKCkgbWFyY28sIGRvbid0IHVzZSBkaXJlY3RseSAqLw0KK3N0cnVj
dCBkbWFfZmVuY2UgKl9fZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZSh1bnNpZ25lZCBpbnQgbnVtX2Zl
bmNlcywNCisJCQkJCSAgIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZXMsDQorCQkJCQkgICBzdHJ1
Y3QgZG1hX2ZlbmNlX3Vud3JhcCAqaXRlcikNCit7DQorCXN0cnVjdCBkbWFfZmVuY2VfYXJyYXkg
KnJlc3VsdDsNCisJc3RydWN0IGRtYV9mZW5jZSAqdG1wLCAqKmFycmF5Ow0KKwl1bnNpZ25lZCBp
bnQgaTsNCisJc2l6ZV90IGNvdW50Ow0KKw0KKwljb3VudCA9IDA7DQorCWZvciAoaSA9IDA7IGkg
PCBudW1fZmVuY2VzOyArK2kpIHsNCisJCWRtYV9mZW5jZV91bndyYXBfZm9yX2VhY2godG1wLCAm
aXRlcltpXSwgZmVuY2VzW2ldKQ0KKwkJCSsrY291bnQ7DQorCX0NCisNCisJaWYgKGNvdW50ID09
IDApDQorCQlyZXR1cm4gZG1hX2ZlbmNlX2dldF9zdHViKCk7DQorDQorCWFycmF5ID0ga21hbGxv
Y19hcnJheShjb3VudCwgc2l6ZW9mKCphcnJheSksIEdGUF9LRVJORUwpOw0KKwlpZiAoIWFycmF5
KQ0KKwkJcmV0dXJuIE5VTEw7DQorDQorCS8qDQorCSAqIFRoaXMgdHJhc2hlcyB0aGUgaW5wdXQg
ZmVuY2UgYXJyYXkgYW5kIHVzZXMgaXQgYXMgcG9zaXRpb24gZm9yIHRoZQ0KKwkgKiBmb2xsb3dp
bmcgbWVyZ2UgbG9vcC4gVGhpcyB3b3JrcyBiZWNhdXNlIHRoZSBkbWFfZmVuY2VfbWVyZ2UoKQ0K
KwkgKiB3cmFwcGVyIG1hY3JvIGlzIGNyZWF0aW5nIHRoaXMgdGVtcG9yYXJ5IGFycmF5IG9uIHRo
ZSBzdGFjayB0b2dldGhlcg0KKwkgKiB3aXRoIHRoZSBpdGVyYXRvcnMuDQorCSAqLw0KKwlmb3Ig
KGkgPSAwOyBpIDwgbnVtX2ZlbmNlczsgKytpKQ0KKwkJZmVuY2VzW2ldID0gZG1hX2ZlbmNlX3Vu
d3JhcF9maXJzdChmZW5jZXNbaV0sICZpdGVyW2ldKTsNCisNCisJY291bnQgPSAwOw0KKwlkbyB7
DQorCQl1bnNpZ25lZCBpbnQgc2VsOw0KKw0KK3Jlc3RhcnQ6DQorCQl0bXAgPSBOVUxMOw0KKwkJ
Zm9yIChpID0gMDsgaSA8IG51bV9mZW5jZXM7ICsraSkgew0KKwkJCXN0cnVjdCBkbWFfZmVuY2Ug
Km5leHQgPSBmZW5jZXNbaV07DQorDQorCQkJaWYgKCFuZXh0KQ0KKwkJCQljb250aW51ZTsNCisN
CisJCQkvKg0KKwkJCSAqIFdlIGNhbid0IGd1YXJhbnRlZSB0aGF0IGlucHV0ZSBmZW5jZXMgYXJl
IG9yZGVyZWQgYnkNCisJCQkgKiBjb250ZXh0LCBidXQgaXQgaXMgc3RpbGwgcXVpdGUgbGlrZWx5
IHdoZW4gdGhpcw0KKwkJCSAqIGZ1bmN0aW9uIGlzIHVzZWQgbXVsdGlwbGUgdGltZXMuIFNvIGF0
dGVtcHQgdG8gb3JkZXINCisJCQkgKiB0aGUgZmVuY2VzIGJ5IGNvbnRleHQgYXMgd2UgcGFzcyBv
dmVyIHRoZW0gYW5kIG1lcmdlDQorCQkJICogZmVuY2VzIHdpdGggdGhlIHNhbWUgY29udGV4dC4N
CisJCQkgKi8NCisJCQlpZiAoIXRtcCB8fCB0bXAtPmNvbnRleHQgPiBuZXh0LT5jb250ZXh0KSB7
DQorCQkJCXRtcCA9IG5leHQ7DQorCQkJCXNlbCA9IGk7DQorDQorCQkJfSBlbHNlIGlmICh0bXAt
PmNvbnRleHQgPCBuZXh0LT5jb250ZXh0KSB7DQorCQkJCWNvbnRpbnVlOw0KKw0KKwkJCX0gZWxz
ZSBpZiAoZG1hX2ZlbmNlX2lzX2xhdGVyKHRtcCwgbmV4dCkpIHsNCisJCQkJZmVuY2VzW2ldID0g
ZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZpdGVyW2ldKTsNCisJCQkJZ290byByZXN0YXJ0Ow0KKwkJ
CX0gZWxzZSB7DQorCQkJCWZlbmNlc1tzZWxdID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZpdGVy
W3NlbF0pOw0KKwkJCQlnb3RvIHJlc3RhcnQ7DQorCQkJfQ0KKwkJfQ0KKw0KKwkJaWYgKHRtcCkg
ew0KKwkJCWFycmF5W2NvdW50KytdID0gZG1hX2ZlbmNlX2dldCh0bXApOw0KKwkJCWZlbmNlc1tz
ZWxdID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZpdGVyW3NlbF0pOw0KKwkJfQ0KKwl9IHdoaWxl
ICh0bXApOw0KKw0KKwlpZiAoY291bnQgPT0gMCkgew0KKwkJdG1wID0gZG1hX2ZlbmNlX2dldF9z
dHViKCk7DQorCQlnb3RvIHJldHVybl90bXA7DQorCX0NCisNCisJaWYgKGNvdW50ID09IDEpIHsN
CisJCXRtcCA9IGFycmF5WzBdOw0KKwkJZ290byByZXR1cm5fdG1wOw0KKwl9DQorDQorCXJlc3Vs
dCA9IGRtYV9mZW5jZV9hcnJheV9jcmVhdGUoY291bnQsIGFycmF5LA0KKwkJCQkJZG1hX2ZlbmNl
X2NvbnRleHRfYWxsb2MoMSksDQorCQkJCQkxLCBmYWxzZSk7DQorCWlmICghcmVzdWx0KSB7DQor
CQl0bXAgPSBOVUxMOw0KKwkJZ290byByZXR1cm5fdG1wOw0KKwl9DQorCXJldHVybiAmcmVzdWx0
LT5iYXNlOw0KKw0KK3JldHVybl90bXA6DQorCWtmcmVlKGFycmF5KTsNCisJcmV0dXJuIHRtcDsN
Cit9DQorRVhQT1JUX1NZTUJPTF9HUEwoX19kbWFfZmVuY2VfdW53cmFwX21lcmdlKTsNCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLXVud3JhcC5jIGIvZHJpdmVycy9k
bWEtYnVmL3N0LWRtYS1mZW5jZS11bndyYXAuYw0KaW5kZXggNTk2MjhhZGQ5M2Y1Li4zYThhY2E2
NTE5MzggMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLXVud3JhcC5j
DQorKysgYi9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLXVud3JhcC5jDQpAQCAtMjQwLDYg
KzI0MCwxMTMgQEAgc3RhdGljIGludCB1bndyYXBfY2hhaW5fYXJyYXkodm9pZCAqYXJnKQ0KIAly
ZXR1cm4gZXJyOw0KIH0NCiANCitzdGF0aWMgaW50IHVud3JhcF9tZXJnZSh2b2lkICphcmcpDQor
ew0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgKmYxLCAqZjIsICpmMzsNCisJc3RydWN0IGRt
YV9mZW5jZV91bndyYXAgaXRlcjsNCisJaW50IGVyciA9IDA7DQorDQorCWYxID0gbW9ja19mZW5j
ZSgpOw0KKwlpZiAoIWYxKQ0KKwkJcmV0dXJuIC1FTk9NRU07DQorDQorCWYyID0gbW9ja19mZW5j
ZSgpOw0KKwlpZiAoIWYyKSB7DQorCQllcnIgPSAtRU5PTUVNOw0KKwkJZ290byBlcnJvcl9wdXRf
ZjE7DQorCX0NCisNCisJZjMgPSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKGYxLCBmMik7DQorCWlm
ICghZjMpIHsNCisJCWVyciA9IC1FTk9NRU07DQorCQlnb3RvIGVycm9yX3B1dF9mMjsNCisJfQ0K
Kw0KKwlkbWFfZmVuY2VfdW53cmFwX2Zvcl9lYWNoKGZlbmNlLCAmaXRlciwgZjMpIHsNCisJCWlm
IChmZW5jZSA9PSBmMSkgew0KKwkJCWRtYV9mZW5jZV9wdXQoZjEpOw0KKwkJCWYxID0gTlVMTDsN
CisJCX0gZWxzZSBpZiAoZmVuY2UgPT0gZjIpIHsNCisJCQlkbWFfZmVuY2VfcHV0KGYyKTsNCisJ
CQlmMiA9IE5VTEw7DQorCQl9IGVsc2Ugew0KKwkJCXByX2VycigiVW5leHBlY3RlZCBmZW5jZSFc
biIpOw0KKwkJCWVyciA9IC1FSU5WQUw7DQorCQl9DQorCX0NCisNCisJaWYgKGYxIHx8IGYyKSB7
DQorCQlwcl9lcnIoIk5vdCBhbGwgZmVuY2VzIHNlZW4hXG4iKTsNCisJCWVyciA9IC1FSU5WQUw7
DQorCX0NCisNCisJZG1hX2ZlbmNlX3B1dChmMyk7DQorZXJyb3JfcHV0X2YyOg0KKwlkbWFfZmVu
Y2VfcHV0KGYyKTsNCitlcnJvcl9wdXRfZjE6DQorCWRtYV9mZW5jZV9wdXQoZjEpOw0KKwlyZXR1
cm4gZXJyOw0KK30NCisNCitzdGF0aWMgaW50IHVud3JhcF9tZXJnZV9jb21wbGV4KHZvaWQgKmFy
ZykNCit7DQorCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqZjEsICpmMiwgKmYzLCAqZjQsICpm
NTsNCisJc3RydWN0IGRtYV9mZW5jZV91bndyYXAgaXRlcjsNCisJaW50IGVyciA9IC1FTk9NRU07
DQorDQorCWYxID0gbW9ja19mZW5jZSgpOw0KKwlpZiAoIWYxKQ0KKwkJcmV0dXJuIC1FTk9NRU07
DQorDQorCWYyID0gbW9ja19mZW5jZSgpOw0KKwlpZiAoIWYyKQ0KKwkJZ290byBlcnJvcl9wdXRf
ZjE7DQorDQorCWYzID0gZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZShmMSwgZjIpOw0KKwlpZiAoIWYz
KQ0KKwkJZ290byBlcnJvcl9wdXRfZjI7DQorDQorCS8qIFRoZSByZXN1bHRpbmcgYXJyYXkgaGFz
IHRoZSBmZW5jZXMgaW4gcmV2ZXJzZSAqLw0KKwlmNCA9IGRtYV9mZW5jZV91bndyYXBfbWVyZ2Uo
ZjIsIGYxKTsNCisJaWYgKCFmNCkNCisJCWdvdG8gZXJyb3JfcHV0X2YzOw0KKw0KKwkvKiBTaWdu
YWxlZCBmZW5jZXMgc2hvdWxkIGJlIGZpbHRlcmVkLCB0aGUgdHdvIGFycmF5cyBtZXJnZWQuICov
DQorCWY1ID0gZG1hX2ZlbmNlX3Vud3JhcF9tZXJnZShmMywgZjQsIGRtYV9mZW5jZV9nZXRfc3R1
YigpKTsNCisJaWYgKCFmNSkNCisJCWdvdG8gZXJyb3JfcHV0X2Y0Ow0KKw0KKwllcnIgPSAwOw0K
KwlkbWFfZmVuY2VfdW53cmFwX2Zvcl9lYWNoKGZlbmNlLCAmaXRlciwgZjUpIHsNCisJCWlmIChm
ZW5jZSA9PSBmMSkgew0KKwkJCWRtYV9mZW5jZV9wdXQoZjEpOw0KKwkJCWYxID0gTlVMTDsNCisJ
CX0gZWxzZSBpZiAoZmVuY2UgPT0gZjIpIHsNCisJCQlkbWFfZmVuY2VfcHV0KGYyKTsNCisJCQlm
MiA9IE5VTEw7DQorCQl9IGVsc2Ugew0KKwkJCXByX2VycigiVW5leHBlY3RlZCBmZW5jZSFcbiIp
Ow0KKwkJCWVyciA9IC1FSU5WQUw7DQorCQl9DQorCX0NCisNCisJaWYgKGYxIHx8IGYyKSB7DQor
CQlwcl9lcnIoIk5vdCBhbGwgZmVuY2VzIHNlZW4hXG4iKTsNCisJCWVyciA9IC1FSU5WQUw7DQor
CX0NCisNCisJZG1hX2ZlbmNlX3B1dChmNSk7DQorZXJyb3JfcHV0X2Y0Og0KKwlkbWFfZmVuY2Vf
cHV0KGY0KTsNCitlcnJvcl9wdXRfZjM6DQorCWRtYV9mZW5jZV9wdXQoZjMpOw0KK2Vycm9yX3B1
dF9mMjoNCisJZG1hX2ZlbmNlX3B1dChmMik7DQorZXJyb3JfcHV0X2YxOg0KKwlkbWFfZmVuY2Vf
cHV0KGYxKTsNCisJcmV0dXJuIGVycjsNCit9DQorDQogaW50IGRtYV9mZW5jZV91bndyYXAodm9p
ZCkNCiB7DQogCXN0YXRpYyBjb25zdCBzdHJ1Y3Qgc3VidGVzdCB0ZXN0c1tdID0gew0KQEAgLTI0
Nyw2ICszNTQsOCBAQCBpbnQgZG1hX2ZlbmNlX3Vud3JhcCh2b2lkKQ0KIAkJU1VCVEVTVCh1bndy
YXBfYXJyYXkpLA0KIAkJU1VCVEVTVCh1bndyYXBfY2hhaW4pLA0KIAkJU1VCVEVTVCh1bndyYXBf
Y2hhaW5fYXJyYXkpLA0KKwkJU1VCVEVTVCh1bndyYXBfbWVyZ2UpLA0KKwkJU1VCVEVTVCh1bndy
YXBfbWVyZ2VfY29tcGxleCksDQogCX07DQogDQogCXJldHVybiBzdWJ0ZXN0cyh0ZXN0cywgTlVM
TCk7DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL3N5bmNfZmlsZS5jIGIvZHJpdmVycy9k
bWEtYnVmL3N5bmNfZmlsZS5jDQppbmRleCAwZmU1NjQ1MzkxNjYuLjNlYmVjMTlhOGUwMiAxMDA2
NDQNCi0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9zeW5jX2ZpbGUuYw0KKysrIGIvZHJpdmVycy9kbWEt
YnVmL3N5bmNfZmlsZS5jDQpAQCAtMTQ2LDUwICsxNDYsNiBAQCBjaGFyICpzeW5jX2ZpbGVfZ2V0
X25hbWUoc3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlLCBjaGFyICpidWYsIGludCBsZW4pDQog
CXJldHVybiBidWY7DQogfQ0KIA0KLXN0YXRpYyBpbnQgc3luY19maWxlX3NldF9mZW5jZShzdHJ1
Y3Qgc3luY19maWxlICpzeW5jX2ZpbGUsDQotCQkJICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKipm
ZW5jZXMsIGludCBudW1fZmVuY2VzKQ0KLXsNCi0Jc3RydWN0IGRtYV9mZW5jZV9hcnJheSAqYXJy
YXk7DQotDQotCS8qDQotCSAqIFRoZSByZWZlcmVuY2UgZm9yIHRoZSBmZW5jZXMgaW4gdGhlIG5l
dyBzeW5jX2ZpbGUgYW5kIGhlbGQNCi0JICogaW4gYWRkX2ZlbmNlKCkgZHVyaW5nIHRoZSBtZXJn
ZSBwcm9jZWR1cmUsIHNvIGZvciBudW1fZmVuY2VzID09IDENCi0JICogd2UgYWxyZWFkeSBvd24g
YSBuZXcgcmVmZXJlbmNlIHRvIHRoZSBmZW5jZS4gRm9yIG51bV9mZW5jZSA+IDENCi0JICogd2Ug
b3duIHRoZSByZWZlcmVuY2Ugb2YgdGhlIGRtYV9mZW5jZV9hcnJheSBjcmVhdGlvbi4NCi0JICov
DQotDQotCWlmIChudW1fZmVuY2VzID09IDApIHsNCi0JCXN5bmNfZmlsZS0+ZmVuY2UgPSBkbWFf
ZmVuY2VfZ2V0X3N0dWIoKTsNCi0JCWtmcmVlKGZlbmNlcyk7DQotDQotCX0gZWxzZSBpZiAobnVt
X2ZlbmNlcyA9PSAxKSB7DQotCQlzeW5jX2ZpbGUtPmZlbmNlID0gZmVuY2VzWzBdOw0KLQkJa2Zy
ZWUoZmVuY2VzKTsNCi0NCi0JfSBlbHNlIHsNCi0JCWFycmF5ID0gZG1hX2ZlbmNlX2FycmF5X2Ny
ZWF0ZShudW1fZmVuY2VzLCBmZW5jZXMsDQotCQkJCQkgICAgICAgZG1hX2ZlbmNlX2NvbnRleHRf
YWxsb2MoMSksDQotCQkJCQkgICAgICAgMSwgZmFsc2UpOw0KLQkJaWYgKCFhcnJheSkNCi0JCQly
ZXR1cm4gLUVOT01FTTsNCi0NCi0JCXN5bmNfZmlsZS0+ZmVuY2UgPSAmYXJyYXktPmJhc2U7DQot
CX0NCi0NCi0JcmV0dXJuIDA7DQotfQ0KLQ0KLXN0YXRpYyB2b2lkIGFkZF9mZW5jZShzdHJ1Y3Qg
ZG1hX2ZlbmNlICoqZmVuY2VzLA0KLQkJICAgICAgaW50ICppLCBzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZSkNCi17DQotCWZlbmNlc1sqaV0gPSBmZW5jZTsNCi0NCi0JaWYgKCFkbWFfZmVuY2VfaXNf
c2lnbmFsZWQoZmVuY2UpKSB7DQotCQlkbWFfZmVuY2VfZ2V0KGZlbmNlKTsNCi0JCSgqaSkrKzsN
Ci0JfQ0KLX0NCi0NCiAvKioNCiAgKiBzeW5jX2ZpbGVfbWVyZ2UoKSAtIG1lcmdlIHR3byBzeW5j
X2ZpbGVzDQogICogQG5hbWU6CW5hbWUgb2YgbmV3IGZlbmNlDQpAQCAtMjAzLDg0ICsxNTksMjEg
QEAgc3RhdGljIHZvaWQgYWRkX2ZlbmNlKHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZXMsDQogc3Rh
dGljIHN0cnVjdCBzeW5jX2ZpbGUgKnN5bmNfZmlsZV9tZXJnZShjb25zdCBjaGFyICpuYW1lLCBz
dHJ1Y3Qgc3luY19maWxlICphLA0KIAkJCQkJIHN0cnVjdCBzeW5jX2ZpbGUgKmIpDQogew0KLQlz
dHJ1Y3QgZG1hX2ZlbmNlICphX2ZlbmNlLCAqYl9mZW5jZSwgKipmZW5jZXM7DQotCXN0cnVjdCBk
bWFfZmVuY2VfdW53cmFwIGFfaXRlciwgYl9pdGVyOw0KLQl1bnNpZ25lZCBpbnQgaW5kZXgsIG51
bV9mZW5jZXM7DQogCXN0cnVjdCBzeW5jX2ZpbGUgKnN5bmNfZmlsZTsNCisJc3RydWN0IGRtYV9m
ZW5jZSAqZmVuY2U7DQogDQogCXN5bmNfZmlsZSA9IHN5bmNfZmlsZV9hbGxvYygpOw0KIAlpZiAo
IXN5bmNfZmlsZSkNCiAJCXJldHVybiBOVUxMOw0KIA0KLQludW1fZmVuY2VzID0gMDsNCi0JZG1h
X2ZlbmNlX3Vud3JhcF9mb3JfZWFjaChhX2ZlbmNlLCAmYV9pdGVyLCBhLT5mZW5jZSkNCi0JCSsr
bnVtX2ZlbmNlczsNCi0JZG1hX2ZlbmNlX3Vud3JhcF9mb3JfZWFjaChiX2ZlbmNlLCAmYl9pdGVy
LCBiLT5mZW5jZSkNCi0JCSsrbnVtX2ZlbmNlczsNCi0NCi0JaWYgKG51bV9mZW5jZXMgPiBJTlRf
TUFYKQ0KLQkJZ290byBlcnJfZnJlZV9zeW5jX2ZpbGU7DQotDQotCWZlbmNlcyA9IGtjYWxsb2Mo
bnVtX2ZlbmNlcywgc2l6ZW9mKCpmZW5jZXMpLCBHRlBfS0VSTkVMKTsNCi0JaWYgKCFmZW5jZXMp
DQotCQlnb3RvIGVycl9mcmVlX3N5bmNfZmlsZTsNCi0NCi0JLyoNCi0JICogV2UgY2FuJ3QgZ3Vh
cmFudGVlIHRoYXQgZmVuY2VzIGluIGJvdGggYSBhbmQgYiBhcmUgb3JkZXJlZCwgYnV0IGl0IGlz
DQotCSAqIHN0aWxsIHF1aXRlIGxpa2VseS4NCi0JICoNCi0JICogU28gYXR0ZW1wdCB0byBvcmRl
ciB0aGUgZmVuY2VzIGFzIHdlIHBhc3Mgb3ZlciB0aGVtIGFuZCBtZXJnZSBmZW5jZXMNCi0JICog
d2l0aCB0aGUgc2FtZSBjb250ZXh0Lg0KLQkgKi8NCi0NCi0JaW5kZXggPSAwOw0KLQlmb3IgKGFf
ZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX2ZpcnN0KGEtPmZlbmNlLCAmYV9pdGVyKSwNCi0JICAg
ICBiX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9maXJzdChiLT5mZW5jZSwgJmJfaXRlcik7DQot
CSAgICAgYV9mZW5jZSB8fCBiX2ZlbmNlOyApIHsNCi0NCi0JCWlmICghYl9mZW5jZSkgew0KLQkJ
CWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYV9mZW5jZSk7DQotCQkJYV9mZW5jZSA9IGRtYV9m
ZW5jZV91bndyYXBfbmV4dCgmYV9pdGVyKTsNCi0NCi0JCX0gZWxzZSBpZiAoIWFfZmVuY2UpIHsN
Ci0JCQlhZGRfZmVuY2UoZmVuY2VzLCAmaW5kZXgsIGJfZmVuY2UpOw0KLQkJCWJfZmVuY2UgPSBk
bWFfZmVuY2VfdW53cmFwX25leHQoJmJfaXRlcik7DQotDQotCQl9IGVsc2UgaWYgKGFfZmVuY2Ut
PmNvbnRleHQgPCBiX2ZlbmNlLT5jb250ZXh0KSB7DQotCQkJYWRkX2ZlbmNlKGZlbmNlcywgJmlu
ZGV4LCBhX2ZlbmNlKTsNCi0JCQlhX2ZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9uZXh0KCZhX2l0
ZXIpOw0KLQ0KLQkJfSBlbHNlIGlmIChiX2ZlbmNlLT5jb250ZXh0IDwgYV9mZW5jZS0+Y29udGV4
dCkgew0KLQkJCWFkZF9mZW5jZShmZW5jZXMsICZpbmRleCwgYl9mZW5jZSk7DQotCQkJYl9mZW5j
ZSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmYl9pdGVyKTsNCi0NCi0JCX0gZWxzZSBpZiAoX19k
bWFfZmVuY2VfaXNfbGF0ZXIoYV9mZW5jZS0+c2Vxbm8sIGJfZmVuY2UtPnNlcW5vLA0KLQkJCQkJ
CWFfZmVuY2UtPm9wcykpIHsNCi0JCQlhZGRfZmVuY2UoZmVuY2VzLCAmaW5kZXgsIGFfZmVuY2Up
Ow0KLQkJCWFfZmVuY2UgPSBkbWFfZmVuY2VfdW53cmFwX25leHQoJmFfaXRlcik7DQotCQkJYl9m
ZW5jZSA9IGRtYV9mZW5jZV91bndyYXBfbmV4dCgmYl9pdGVyKTsNCi0NCi0JCX0gZWxzZSB7DQot
CQkJYWRkX2ZlbmNlKGZlbmNlcywgJmluZGV4LCBiX2ZlbmNlKTsNCi0JCQlhX2ZlbmNlID0gZG1h
X2ZlbmNlX3Vud3JhcF9uZXh0KCZhX2l0ZXIpOw0KLQkJCWJfZmVuY2UgPSBkbWFfZmVuY2VfdW53
cmFwX25leHQoJmJfaXRlcik7DQotCQl9DQorCWZlbmNlID0gZG1hX2ZlbmNlX3Vud3JhcF9tZXJn
ZShhLT5mZW5jZSwgYi0+ZmVuY2UpOw0KKwlpZiAoIWZlbmNlKSB7DQorCQlmcHV0KHN5bmNfZmls
ZS0+ZmlsZSk7DQorCQlyZXR1cm4gTlVMTDsNCiAJfQ0KLQ0KLQlpZiAoc3luY19maWxlX3NldF9m
ZW5jZShzeW5jX2ZpbGUsIGZlbmNlcywgaW5kZXgpIDwgMCkNCi0JCWdvdG8gZXJyX3B1dF9mZW5j
ZXM7DQotDQorCXN5bmNfZmlsZS0+ZmVuY2UgPSBmZW5jZTsNCiAJc3RybGNweShzeW5jX2ZpbGUt
PnVzZXJfbmFtZSwgbmFtZSwgc2l6ZW9mKHN5bmNfZmlsZS0+dXNlcl9uYW1lKSk7DQogCXJldHVy
biBzeW5jX2ZpbGU7DQotDQotZXJyX3B1dF9mZW5jZXM6DQotCXdoaWxlIChpbmRleCkNCi0JCWRt
YV9mZW5jZV9wdXQoZmVuY2VzWy0taW5kZXhdKTsNCi0Ja2ZyZWUoZmVuY2VzKTsNCi0NCi1lcnJf
ZnJlZV9zeW5jX2ZpbGU6DQotCWZwdXQoc3luY19maWxlLT5maWxlKTsNCi0JcmV0dXJuIE5VTEw7
DQogfQ0KIA0KIHN0YXRpYyBpbnQgc3luY19maWxlX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9k
ZSwgc3RydWN0IGZpbGUgKmZpbGUpDQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9kbWEtZmVu
Y2UtdW53cmFwLmggYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS11bndyYXAuaA0KaW5kZXggZTlk
MTE0NjM3Mjk0Li40M2M4YTliYmVlODggMTAwNjQ0DQotLS0gYS9pbmNsdWRlL2xpbnV4L2RtYS1m
ZW5jZS11bndyYXAuaA0KKysrIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UtdW53cmFwLmgNCkBA
IC00OCw0ICs0OCwyOCBAQCBzdHJ1Y3QgZG1hX2ZlbmNlICpkbWFfZmVuY2VfdW53cmFwX25leHQo
c3RydWN0IGRtYV9mZW5jZV91bndyYXAgKmN1cnNvcik7DQogCWZvciAoZmVuY2UgPSBkbWFfZmVu
Y2VfdW53cmFwX2ZpcnN0KGhlYWQsIGN1cnNvcik7IGZlbmNlOwlcDQogCSAgICAgZmVuY2UgPSBk
bWFfZmVuY2VfdW53cmFwX25leHQoY3Vyc29yKSkNCiANCitzdHJ1Y3QgZG1hX2ZlbmNlICpfX2Rt
YV9mZW5jZV91bndyYXBfbWVyZ2UodW5zaWduZWQgaW50IG51bV9mZW5jZXMsDQorCQkJCQkgICBz
dHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2VzLA0KKwkJCQkJICAgc3RydWN0IGRtYV9mZW5jZV91bndy
YXAgKmN1cnNvcnMpOw0KKw0KKy8qKg0KKyAqIGRtYV9mZW5jZV91bndyYXBfbWVyZ2UgLSB1bndy
YXAgYW5kIG1lcmdlIGZlbmNlcw0KKyAqDQorICogQWxsIGZlbmNlcyBnaXZlbiBhcyBwYXJhbWV0
ZXJzIGFyZSB1bndyYXBwZWQgYW5kIG1lcmdlZCBiYWNrIHRvZ2V0aGVyIGFzIGZsYXQNCisgKiBk
bWFfZmVuY2VfYXJyYXkuIFVzZWZ1bCBpZiBtdWx0aXBsZSBjb250YWluZXJzIG5lZWQgdG8gYmUg
bWVyZ2VkIHRvZ2V0aGVyLg0KKyAqDQorICogSW1wbGVtZW50ZWQgYXMgYSBtYWNybyB0byBhbGxv
Y2F0ZSB0aGUgbmVjZXNzYXJ5IGFycmF5cyBvbiB0aGUgc3RhY2sgYW5kDQorICogYWNjb3VudCB0
aGUgc3RhY2sgZnJhbWUgc2l6ZSB0byB0aGUgY2FsbGVyLg0KKyAqDQorICogUmV0dXJucyBOVUxM
IG9uIG1lbW9yeSBhbGxvY2F0aW9uIGZhaWx1cmUsIGEgZG1hX2ZlbmNlIG9iamVjdCByZXByZXNl
bnRpbmcNCisgKiBhbGwgdGhlIGdpdmVuIGZlbmNlcyBvdGhlcndpc2UuDQorICovDQorI2RlZmlu
ZSBkbWFfZmVuY2VfdW53cmFwX21lcmdlKC4uLikJCQkJCVwNCisJKHsJCQkJCQkJCVwNCisJCXN0
cnVjdCBkbWFfZmVuY2UgKl9fZltdID0geyBfX1ZBX0FSR1NfXyB9OwkJXA0KKwkJc3RydWN0IGRt
YV9mZW5jZV91bndyYXAgX19jW0FSUkFZX1NJWkUoX19mKV07CQlcDQorCQkJCQkJCQkJXA0KKwkJ
X19kbWFfZmVuY2VfdW53cmFwX21lcmdlKEFSUkFZX1NJWkUoX19mKSwgX19mLCBfX2MpOwlcDQor
CX0pDQorDQogI2VuZGlmDQotLSANCjIuMjUuMQ0KDQpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpMaW5hcm8tbW0tc2lnIG1haWxpbmcgbGlzdCAtLSBsaW5h
cm8tbW0tc2lnQGxpc3RzLmxpbmFyby5vcmcKVG8gdW5zdWJzY3JpYmUgc2VuZCBhbiBlbWFpbCB0
byBsaW5hcm8tbW0tc2lnLWxlYXZlQGxpc3RzLmxpbmFyby5vcmcK
