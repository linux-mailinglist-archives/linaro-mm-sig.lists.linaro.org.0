Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 180595A8E30
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  1 Sep 2022 08:17:18 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 4D0633EED8
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  1 Sep 2022 06:17:17 +0000 (UTC)
Received: from mail-m11885.qiye.163.com (mail-m11885.qiye.163.com [115.236.118.85])
	by lists.linaro.org (Postfix) with ESMTPS id 04CD43EC48
	for <linaro-mm-sig@lists.linaro.org>; Tue,  9 Aug 2022 09:35:43 +0000 (UTC)
Received: from [192.168.111.100] (unknown [58.22.7.114])
	by mail-m11885.qiye.163.com (Hmail) with ESMTPA id A41224C0488;
	Tue,  9 Aug 2022 09:12:46 +0800 (CST)
Message-ID: <717f4fb6-9523-6358-eb10-94fc08a1e1b2@rock-chips.com>
Date: Tue, 9 Aug 2022 09:12:45 +0800
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101
 Thunderbird/102.1.1
Content-Language: en-US
To: =?UTF-8?Q?Christian_K=c3=b6nig?= <christian.koenig@amd.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>
References: <20220802113316.18340-1-jeffy.chen@rock-chips.com>
 <61e6fd7e-fde7-19ae-0e31-0ad8013d0e48@amd.com>
From: Chen Jeffy <jeffy.chen@rock-chips.com>
In-Reply-To: <61e6fd7e-fde7-19ae-0e31-0ad8013d0e48@amd.com>
X-HM-Spam-Status: e1kfGhgUHx5ZQUtXWQgPGg8OCBgUHx5ZQUlOS1dZFg8aDwILHllBWSg2Ly
	tZV1koWUFJSktLSjdXWS1ZQUlXWQ8JGhUIEh9ZQVlCTEoaVkgdTRhDTRkdSBkdTVUTARMWGhIXJB
	QOD1lXWRgSC1lBWU5DVUlJVUxVSkpPWVdZFhoPEhUdFFlBWU9LSFVKSktITkhVS1kG
X-HM-Sender-Digest: e1kMHhlZQR0aFwgeV1kSHx4VD1lBWUc6Pwg6Nhw*AT0xLy8ICh4fKj9I
	NRMwCwFVSlVKTU1LS0tMTk1MTk5JVTMWGhIXVREeHR0CVRgTHhU7CRQYEFYYExILCFUYFBZFWVdZ
	EgtZQVlOQ1VJSVVMVUpKT1lXWQgBWUFMQ0pONwY+
X-HM-Tid: 0a8280294ef12eb9kusna41224c0488
X-MailFrom: jeffy.chen@rock-chips.com
X-Mailman-Rule-Hits: nonmember-moderation
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation
Message-ID-Hash: UVJGMF3L2FJBPGQSK373LV65IC35G6FV
X-Message-ID-Hash: UVJGMF3L2FJBPGQSK373LV65IC35G6FV
X-Mailman-Approved-At: Thu, 01 Sep 2022 06:17:05 +0000
CC: Andy Yan <andy.yan@rock-chips.com>, Jianqun Xu <jay.xu@rock-chips.com>, Maxime Ripard <mripard@kernel.org>, Sumit Semwal <sumit.semwal@linaro.org>, Thomas Zimmermann <tzimmermann@suse.de>, linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org, linaro-mm-sig@lists.linaro.org, David Airlie <airlied@linux.ie>, Maarten Lankhorst <maarten.lankhorst@linux.intel.com>, linux-media@vger.kernel.org, Daniel Vetter <daniel@ffwll.ch>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] Re: [PATCH] drm/gem: Fix GEM handle release errors
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/UVJGMF3L2FJBPGQSK373LV65IC35G6FV/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Type: text/plain; charset="utf-8"; format="flowed"
Content-Transfer-Encoding: base64

SGkgQ2hyaXN0aWFuLA0KDQpTb3JyeSwgaSd2ZSBzZW50IGEgdjIgYmVmb3JlLCBwbGVhc2UgY2hl
Y2sgdGhhdC4NCg0KT24gOC85IOaYn+acn+S6jCAyOjA1LCBDaHJpc3RpYW4gS8O2bmlnIHdyb3Rl
Og0KPiANCj4gDQo+IEFtIDAyLjA4LjIyIHVtIDEzOjMzIHNjaHJpZWIgSmVmZnkgQ2hlbjoNCj4+
IEN1cnJlbnRseSB3ZSBhcmUgYXNzdW1pbmcgYSBvbmUgdG8gb25lIG1hcHBpbmcgYmV0d2VlbiBk
bWFidWYgYW5kIGhhbmRsZQ0KPj4gd2hlbiByZWxlYXNpbmcgR0VNIGhhbmRsZXMuDQo+Pg0KPj4g
QnV0IHRoYXQgaXMgbm90IGFsd2F5cyB0cnVlLCBzaW5jZSB3ZSB3b3VsZCBjcmVhdGUgZXh0cmEg
aGFuZGxlcyBmb3IgdGhlDQo+PiBHRU0gb2JqIGluIGNhc2VzIGxpa2UgZ2VtX29wZW4oKSBhbmQg
Z2V0ZmJ7LDJ9KCkuDQo+Pg0KPj4gQSBzaW1pbGFyIGlzc3VlIHdhcyByZXBvcnRlZCBhdDoNCj4+
IGh0dHBzOi8vbG9yZS5rZXJuZWwub3JnL2FsbC8yMDIxMTEwNTA4MzMwOC4zOTIxNTYtMS1qYXku
eHVAcm9jay1jaGlwcy5jb20vDQo+Pg0KPj4gQW5vdGhlciBwcm9ibGVtIGlzIHRoYXQgdGhlIGRy
bV9nZW1fcmVtb3ZlX3ByaW1lX2hhbmRsZXMoKSBub3cgb25seQ0KPj4gcmVtb3ZlIGhhbmRsZSB0
byB0aGUgZXhwb3J0ZWQgZG1hYnVmIChnZW1fb2JqLT5kbWFfYnVmKSwgc28gdGhlIGltcG9ydGVk
DQo+PiBvbmVzIHdvdWxkIGxlYWs6DQo+PiBXQVJOSU5HOiBDUFU6IDIgUElEOiAyMzYgYXQgZHJp
dmVycy9ncHUvZHJtL2RybV9wcmltZS5jOjIyOCANCj4+IGRybV9wcmltZV9kZXN0cm95X2ZpbGVf
cHJpdmF0ZSsweDE4LzB4MjQNCj4+DQo+PiBMZXQncyBmaXggdGhlc2UgYnkgdXNpbmcgaGFuZGxl
IHRvIGZpbmQgdGhlIGV4YWN0IG1hcCB0byByZW1vdmUuDQo+Pg0KPj4gU2lnbmVkLW9mZi1ieTog
SmVmZnkgQ2hlbiA8amVmZnkuY2hlbkByb2NrLWNoaXBzLmNvbT4NCj4+IC0tLQ0KPj4NCj4+IMKg
IGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmPCoMKgwqDCoMKgIHwgMTcgKy0tLS0tLS0tLS0tLS0t
LS0NCj4+IMKgIGRyaXZlcnMvZ3B1L2RybS9kcm1faW50ZXJuYWwuaCB8wqAgNCArKy0tDQo+PiDC
oCBkcml2ZXJzL2dwdS9kcm0vZHJtX3ByaW1lLmPCoMKgwqAgfCAxNiArKysrKysrKysrLS0tLS0t
DQo+PiDCoCAzIGZpbGVzIGNoYW5nZWQsIDEzIGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygt
KQ0KPj4NCj4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW0uYw0KPj4gaW5kZXggZWIwYzJkMDQxZjEzLi5lZDM5ZGEzODM1NzAg
MTAwNjQ0DQo+PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jDQo+PiArKysgYi9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbS5jDQo+PiBAQCAtMTY4LDIxICsxNjgsNiBAQCB2b2lkIGRybV9n
ZW1fcHJpdmF0ZV9vYmplY3RfaW5pdChzdHJ1Y3QgDQo+PiBkcm1fZGV2aWNlICpkZXYsDQo+PiDC
oCB9DQo+PiDCoCBFWFBPUlRfU1lNQk9MKGRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdCk7DQo+
PiAtc3RhdGljIHZvaWQNCj4+IC1kcm1fZ2VtX3JlbW92ZV9wcmltZV9oYW5kbGVzKHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgDQo+PiBkcm1fZmlsZSAqZmlscCkNCj4+IC17DQo+
PiAtwqDCoMKgIC8qDQo+PiAtwqDCoMKgwqAgKiBOb3RlOiBvYmotPmRtYV9idWYgY2FuJ3QgZGlz
YXBwZWFyIGFzIGxvbmcgYXMgd2Ugc3RpbGwgaG9sZCBhDQo+PiAtwqDCoMKgwqAgKiBoYW5kbGUg
cmVmZXJlbmNlIGluIG9iai0+aGFuZGxlX2NvdW50Lg0KPj4gLcKgwqDCoMKgICovDQo+PiAtwqDC
oMKgIG11dGV4X2xvY2soJmZpbHAtPnByaW1lLmxvY2spOw0KPj4gLcKgwqDCoCBpZiAob2JqLT5k
bWFfYnVmKSB7DQo+PiAtwqDCoMKgwqDCoMKgwqAgZHJtX3ByaW1lX3JlbW92ZV9idWZfaGFuZGxl
X2xvY2tlZCgmZmlscC0+cHJpbWUsDQo+PiAtwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKg
wqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBvYmotPmRtYV9idWYpOw0KPj4gLcKgwqDCoCB9DQo+PiAt
wqDCoMKgIG11dGV4X3VubG9jaygmZmlscC0+cHJpbWUubG9jayk7DQo+PiAtfQ0KPj4gLQ0KPj4g
wqAgLyoqDQo+PiDCoMKgICogZHJtX2dlbV9vYmplY3RfaGFuZGxlX2ZyZWUgLSByZWxlYXNlIHJl
c291cmNlcyBib3VuZCB0byB1c2Vyc3BhY2UgDQo+PiBoYW5kbGVzDQo+PiDCoMKgICogQG9iajog
R0VNIG9iamVjdCB0byBjbGVhbiB1cC4NCj4+IEBAIC0yNTMsNyArMjM4LDcgQEAgZHJtX2dlbV9v
YmplY3RfcmVsZWFzZV9oYW5kbGUoaW50IGlkLCB2b2lkICpwdHIsIA0KPj4gdm9pZCAqZGF0YSkN
Cj4+IMKgwqDCoMKgwqAgaWYgKG9iai0+ZnVuY3MtPmNsb3NlKQ0KPj4gwqDCoMKgwqDCoMKgwqDC
oMKgIG9iai0+ZnVuY3MtPmNsb3NlKG9iaiwgZmlsZV9wcml2KTsNCj4+IC3CoMKgwqAgZHJtX2dl
bV9yZW1vdmVfcHJpbWVfaGFuZGxlcyhvYmosIGZpbGVfcHJpdik7DQo+PiArwqDCoMKgIGRybV9w
cmltZV9yZW1vdmVfYnVmX2hhbmRsZSgmZmlsZV9wcml2LT5wcmltZSwgaWQpOw0KPj4gwqDCoMKg
wqDCoCBkcm1fdm1hX25vZGVfcmV2b2tlKCZvYmotPnZtYV9ub2RlLCBmaWxlX3ByaXYpOw0KPj4g
wqDCoMKgwqDCoCBkcm1fZ2VtX29iamVjdF9oYW5kbGVfcHV0X3VubG9ja2VkKG9iaik7DQo+PiBk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9pbnRlcm5hbC5oIA0KPj4gYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2ludGVybmFsLmgNCj4+IGluZGV4IDFmYmJjMTlmMWFjMC4uN2JiOThlNmE0
NDZkIDEwMDY0NA0KPj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9pbnRlcm5hbC5oDQo+PiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFsLmgNCj4+IEBAIC03NCw4ICs3NCw4IEBA
IGludCBkcm1fcHJpbWVfZmRfdG9faGFuZGxlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlIA0KPj4g
KmRldiwgdm9pZCAqZGF0YSwNCj4+IMKgIHZvaWQgZHJtX3ByaW1lX2luaXRfZmlsZV9wcml2YXRl
KHN0cnVjdCBkcm1fcHJpbWVfZmlsZV9wcml2YXRlIA0KPj4gKnByaW1lX2Zwcml2KTsNCj4+IMKg
IHZvaWQgZHJtX3ByaW1lX2Rlc3Ryb3lfZmlsZV9wcml2YXRlKHN0cnVjdCBkcm1fcHJpbWVfZmls
ZV9wcml2YXRlIA0KPj4gKnByaW1lX2Zwcml2KTsNCj4+IC12b2lkIGRybV9wcmltZV9yZW1vdmVf
YnVmX2hhbmRsZV9sb2NrZWQoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgDQo+PiAqcHJp
bWVfZnByaXYsDQo+PiAtwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgc3Ry
dWN0IGRtYV9idWYgKmRtYV9idWYpOw0KPj4gK3ZvaWQgZHJtX3ByaW1lX3JlbW92ZV9idWZfaGFu
ZGxlKHN0cnVjdCBkcm1fcHJpbWVfZmlsZV9wcml2YXRlIA0KPj4gKnByaW1lX2Zwcml2LA0KPj4g
K8KgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgIHVpbnQzMl90IGhhbmRsZSk7DQo+PiDC
oCAvKiBkcm1fZHJ2LmMgKi8NCj4+IMKgIHN0cnVjdCBkcm1fbWlub3IgKmRybV9taW5vcl9hY3F1
aXJlKHVuc2lnbmVkIGludCBtaW5vcl9pZCk7DQo+PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9wcmltZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9wcmltZS5jDQo+PiBpbmRleCBl
M2YwOWYxODExMGMuLmMyODUxOGFiNjJkMCAxMDA2NDQNCj4+IC0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fcHJpbWUuYw0KPj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9wcmltZS5jDQo+PiBA
QCAtMTkwLDI5ICsxOTAsMzMgQEAgc3RhdGljIGludCBkcm1fcHJpbWVfbG9va3VwX2J1Zl9oYW5k
bGUoc3RydWN0IA0KPj4gZHJtX3ByaW1lX2ZpbGVfcHJpdmF0ZSAqcHJpbWVfZnByaQ0KPj4gwqDC
oMKgwqDCoCByZXR1cm4gLUVOT0VOVDsNCj4+IMKgIH0NCj4+IC12b2lkIGRybV9wcmltZV9yZW1v
dmVfYnVmX2hhbmRsZV9sb2NrZWQoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgDQo+PiAq
cHJpbWVfZnByaXYsDQo+PiAtwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAg
c3RydWN0IGRtYV9idWYgKmRtYV9idWYpDQo+PiArdm9pZCBkcm1fcHJpbWVfcmVtb3ZlX2J1Zl9o
YW5kbGUoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgDQo+PiAqcHJpbWVfZnByaXYsDQo+
PiArwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgdWludDMyX3QgaGFuZGxlKQ0KPj4g
wqAgew0KPj4gwqDCoMKgwqDCoCBzdHJ1Y3QgcmJfbm9kZSAqcmI7DQo+PiArwqDCoMKgIG11dGV4
X2xvY2soJnByaW1lX2Zwcml2LT5sb2NrKTsNCj4+ICsNCj4+IMKgwqDCoMKgwqAgcmIgPSBwcmlt
ZV9mcHJpdi0+ZG1hYnVmcy5yYl9ub2RlOw0KPj4gwqDCoMKgwqDCoCB3aGlsZSAocmIpIHsNCj4+
IMKgwqDCoMKgwqDCoMKgwqDCoCBzdHJ1Y3QgZHJtX3ByaW1lX21lbWJlciAqbWVtYmVyOw0KPj4g
wqDCoMKgwqDCoMKgwqDCoMKgIG1lbWJlciA9IHJiX2VudHJ5KHJiLCBzdHJ1Y3QgZHJtX3ByaW1l
X21lbWJlciwgZG1hYnVmX3JiKTsNCj4+IC3CoMKgwqDCoMKgwqDCoCBpZiAobWVtYmVyLT5kbWFf
YnVmID09IGRtYV9idWYpIHsNCj4+ICvCoMKgwqDCoMKgwqDCoCBpZiAobWVtYmVyLT5oYW5kbGUg
PT0gaGFuZGxlKSB7DQo+PiDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCByYl9lcmFzZSgmbWVt
YmVyLT5oYW5kbGVfcmIsICZwcmltZV9mcHJpdi0+aGFuZGxlcyk7DQo+PiDCoMKgwqDCoMKgwqDC
oMKgwqDCoMKgwqDCoCByYl9lcmFzZSgmbWVtYmVyLT5kbWFidWZfcmIsICZwcmltZV9mcHJpdi0+
ZG1hYnVmcyk7DQo+PiAtwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBkbWFfYnVmX3B1dChkbWFfYnVm
KTsNCj4+ICvCoMKgwqDCoMKgwqDCoMKgwqDCoMKgIGRtYV9idWZfcHV0KG1lbWJlci0+ZG1hX2J1
Zik7DQo+PiDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqDCoCBrZnJlZShtZW1iZXIpOw0KPj4gLcKg
wqDCoMKgwqDCoMKgwqDCoMKgwqAgcmV0dXJuOw0KPj4gLcKgwqDCoMKgwqDCoMKgIH0gZWxzZSBp
ZiAobWVtYmVyLT5kbWFfYnVmIDwgZG1hX2J1Zikgew0KPj4gK8KgwqDCoMKgwqDCoMKgwqDCoMKg
wqAgYnJlYWs7DQo+PiArwqDCoMKgwqDCoMKgwqAgfSBlbHNlIGlmIChtZW1iZXItPmhhbmRsZSA8
IGhhbmRsZSkgew0KPiANCj4gSnVzdCB0byBtYWtlIGl0IGNsZWFyIG9uY2UgbW9yZS4gVGhhdCBj
aGFuZ2UgaGVyZSBpcyBjb21wbGV0ZWx5IGJyb2tlbi4NCj4gDQo+IFRoZSByYiBpcyBpbmRleGVk
IGJ5IHRoZSBkbWFfYnVmIG9iamVjdCwgbm90IHRoZSBoYW5kbGUuDQo+IA0KPiBSZWdhcmRzLA0K
PiBDaHJpc3RpYW4uDQo+IA0KPj4gwqDCoMKgwqDCoMKgwqDCoMKgwqDCoMKgwqAgcmIgPSByYi0+
cmJfcmlnaHQ7DQo+PiDCoMKgwqDCoMKgwqDCoMKgwqAgfSBlbHNlIHsNCj4+IMKgwqDCoMKgwqDC
oMKgwqDCoMKgwqDCoMKgIHJiID0gcmItPnJiX2xlZnQ7DQo+PiDCoMKgwqDCoMKgwqDCoMKgwqAg
fQ0KPj4gwqDCoMKgwqDCoCB9DQo+PiArDQo+PiArwqDCoMKgIG11dGV4X3VubG9jaygmcHJpbWVf
ZnByaXYtPmxvY2spOw0KPj4gwqAgfQ0KPj4gwqAgdm9pZCBkcm1fcHJpbWVfaW5pdF9maWxlX3By
aXZhdGUoc3RydWN0IGRybV9wcmltZV9maWxlX3ByaXZhdGUgDQo+PiAqcHJpbWVfZnByaXYpDQo+
IA0KPiANCg0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
TGluYXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QgLS0gbGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8u
b3JnClRvIHVuc3Vic2NyaWJlIHNlbmQgYW4gZW1haWwgdG8gbGluYXJvLW1tLXNpZy1sZWF2ZUBs
aXN0cy5saW5hcm8ub3JnCg==
