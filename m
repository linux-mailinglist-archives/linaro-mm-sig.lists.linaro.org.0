Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id E33662B6D38
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 17 Nov 2020 19:24:33 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 11A5F666EF
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 17 Nov 2020 18:24:33 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id F1FB3666F0; Tue, 17 Nov 2020 18:24:32 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id D074D6661F;
	Tue, 17 Nov 2020 18:20:50 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id A04C0666E5
 for <linaro-mm-sig@lists.linaro.org>; Tue, 17 Nov 2020 18:20:35 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 9141766596; Tue, 17 Nov 2020 18:20:35 +0000 (UTC)
Received: from mail-pf1-f195.google.com (mail-pf1-f195.google.com
 [209.85.210.195])
 by lists.linaro.org (Postfix) with ESMTPS id 435C766596
 for <linaro-mm-sig@lists.linaro.org>; Tue, 17 Nov 2020 18:19:53 +0000 (UTC)
Received: by mail-pf1-f195.google.com with SMTP id y7so17791265pfq.11
 for <linaro-mm-sig@lists.linaro.org>; Tue, 17 Nov 2020 10:19:53 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=mAgEy75lX1l08pwNKZ1bwH8Dg3sIGTaA6LNhifIcl8w=;
 b=F8bGKmevkvs2Jk4llY5rvRixdcXZfkO5YABLsk23YL3L94VRonNdrsp1BkE8kWuLY+
 kfxDTJfkIXufhHveFLZRI/a1xGVthPEe5rJXEHOp6FGnKC68GJntTpGJKOSAaxjL4U37
 zooDZuRmzBfcqYaKjUS7vRmxRDFHgoaijHU8RO5OONR7RWqjD8G/A4KKDGuLJEDhDjCq
 2o7AGdearL4hTOxVRjftNIxzJBkPFgMNHZsUSE+Z2pKs7sXV7fMiGqnGged3r5MKGbln
 PGVRI2kbB5KAA7YJIzoLTBQqbNQOjVDemaBdnEKVdIwRjGfUsMScvc1YLHK03ashKnrl
 APYw==
X-Gm-Message-State: AOAM530rj3oob5Rs/o6H+TqIPMJJqAM6VDCufaPJO8USDFfDAtEwxdeq
 KAc4YHC4WD1g67n5WDVvVVQ=
X-Google-Smtp-Source: ABdhPJw6U2WzRE+W1IQuANAReU9W4CsUAyehfYTYekO3eDffAVo2cKA+Es/xydW1mMdAGU2RJGzAig==
X-Received: by 2002:aa7:9a50:0:b029:18b:fa6b:f738 with SMTP id
 x16-20020aa79a500000b029018bfa6bf738mr576927pfj.64.1605637192345; 
 Tue, 17 Nov 2020 10:19:52 -0800 (PST)
Received: from bbox-1.mtv.corp.google.com
 ([2620:15c:211:201:7220:84ff:fe09:5e58])
 by smtp.gmail.com with ESMTPSA id h8sm4302639pjc.54.2020.11.17.10.19.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 17 Nov 2020 10:19:51 -0800 (PST)
From: Minchan Kim <minchan@kernel.org>
To: Andrew Morton <akpm@linux-foundation.org>
Date: Tue, 17 Nov 2020 10:19:34 -0800
Message-Id: <20201117181935.3613581-4-minchan@kernel.org>
X-Mailer: git-send-email 2.29.2.299.gdc1121823c-goog
In-Reply-To: <20201117181935.3613581-1-minchan@kernel.org>
References: <20201117181935.3613581-1-minchan@kernel.org>
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: robh@kernel.org, devicetree@vger.kernel.org, linux-media@vger.kernel.org,
 david@redhat.com, Minchan Kim <minchan@kernel.org>,
 LKML <linux-kernel@vger.kernel.org>, willy@infradead.org,
 Brian.Starkey@arm.com, linaro-mm-sig@lists.linaro.org,
 linux-mm <linux-mm@kvack.org>, john.stultz@linaro.org,
 christian.koenig@amd.com, joaodias@google.com, hridya@google.com,
 iamjoonsoo.kim@lge.com, pullip.cho@samsung.com, surenb@google.com,
 vbabka@suse.cz, hyesoo.yu@samsung.com
Subject: [Linaro-mm-sig] [PATCH 3/4] dma-buf: heaps: add chunk heap to
	dmabuf heaps
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RnJvbTogSHllc29vIFl1IDxoeWVzb28ueXVAc2Ftc3VuZy5jb20+CgpUaGlzIHBhdGNoIHN1cHBv
cnRzIGNodW5rIGhlYXAgdGhhdCBhbGxvY2F0ZXMgdGhlIGJ1ZmZlcnMgdGhhdCBhcmUKbWFkZSB1
cCBvZiBhIGxpc3Qgb2YgZml4ZWQgc2l6ZSBjaHVua3MgdGFrZW4gZnJvbSBhIENNQS4KClRoZSBj
aHVuayBoZWFwIGRvZXNuJ3QgdXNlIGhlYXAtaGVscGVyIGFsdGhvdWdoIGl0IGNhbiByZW1vdmUK
ZHVwbGljYXRlZCBjb2RlIHNpbmNlIGhlYXAtaGVscGVyIGlzIHVuZGVyIGRlcHJlY2F0ZWQgcHJv
Y2Vzcy5bMV0KClsxXSBodHRwczovL2xvcmUua2VybmVsLm9yZy9wYXRjaHdvcmsvcGF0Y2gvMTMz
NjAwMgoKU2lnbmVkLW9mZi1ieTogSHllc29vIFl1IDxoeWVzb28ueXVAc2Ftc3VuZy5jb20+ClNp
Z25lZC1vZmYtYnk6IE1pbmNoYW4gS2ltIDxtaW5jaGFuQGtlcm5lbC5vcmc+Ci0tLQogZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL0tjb25maWcgICAgICB8ICAgOSArCiBkcml2ZXJzL2RtYS1idWYvaGVh
cHMvTWFrZWZpbGUgICAgIHwgICAxICsKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jaHVua19oZWFw
LmMgfCA0NTggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwg
NDY4IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvaGVh
cHMvY2h1bmtfaGVhcC5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25m
aWcgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwppbmRleCBhNWVlZjA2YzQyMjYuLjlj
YzUzNjZiOGY1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKKysr
IGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKQEAgLTEyLDMgKzEyLDEyIEBAIGNvbmZp
ZyBETUFCVUZfSEVBUFNfQ01BCiAJICBDaG9vc2UgdGhpcyBvcHRpb24gdG8gZW5hYmxlIGRtYS1i
dWYgQ01BIGhlYXAuIFRoaXMgaGVhcCBpcyBiYWNrZWQKIAkgIGJ5IHRoZSBDb250aWd1b3VzIE1l
bW9yeSBBbGxvY2F0b3IgKENNQSkuIElmIHlvdXIgc3lzdGVtIGhhcyB0aGVzZQogCSAgcmVnaW9u
cywgeW91IHNob3VsZCBzYXkgWSBoZXJlLgorCitjb25maWcgRE1BQlVGX0hFQVBTX0NIVU5LCisJ
dHJpc3RhdGUgIkRNQS1CVUYgQ0hVTksgSGVhcCIKKwlkZXBlbmRzIG9uIERNQUJVRl9IRUFQUyAm
JiBETUFfQ01BCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSBkbWEtYnVm
IENIVU5LIGhlYXAuIFRoaXMgaGVhcCBpcyBiYWNrZWQKKwkgIGJ5IHRoZSBDb250aWd1b3VzIE1l
bW9yeSBBbGxvY2F0b3IgKENNQSkgYW5kIGFsbG9jYXRlcyB0aGUgYnVmZmVycyB0aGF0CisJICBh
cnJhbmdlZCBpbnRvIGEgbGlzdCBvZiBmaXhlZCBzaXplIGNodW5rcyB0YWtlbiBmcm9tIENNQS4g
Q2h1bmsgc2l6ZQorCSAgaXMgY29uZmlndXJlZCB3aGVuIHRoZSBoZWFwIGlzIGNyZWF0ZWQuCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgYi9kcml2ZXJzL2RtYS1i
dWYvaGVhcHMvTWFrZWZpbGUKaW5kZXggNmU1NGNkZWMzZGEwLi4zYjJhMDk4NjlmZDggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2RtYS1i
dWYvaGVhcHMvTWFrZWZpbGUKQEAgLTIsMyArMiw0IEBACiBvYmoteQkJCQkJKz0gaGVhcC1oZWxw
ZXJzLm8KIG9iai0kKENPTkZJR19ETUFCVUZfSEVBUFNfU1lTVEVNKQkrPSBzeXN0ZW1faGVhcC5v
CiBvYmotJChDT05GSUdfRE1BQlVGX0hFQVBTX0NNQSkJCSs9IGNtYV9oZWFwLm8KK29iai0kKENP
TkZJR19ETUFCVUZfSEVBUFNfQ0hVTkspCSs9IGNodW5rX2hlYXAubwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL2NodW5rX2hlYXAuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9j
aHVua19oZWFwLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi40Mjc1
OTRmNTZlMTgKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY2h1bmtf
aGVhcC5jCkBAIC0wLDAgKzEsNDU4IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BM
LTIuMAorLyoKKyAqIElPTiBNZW1vcnkgQWxsb2NhdG9yIGNodW5rIGhlYXAgZXhwb3J0ZXIKKyAq
CisgKiBDb3B5cmlnaHQgKGMpIDIwMjAgU2Ftc3VuZyBFbGVjdHJvbmljcyBDby4sIEx0ZC4KKyAq
IEF1dGhvcjogPGh5ZXNvby55dUBzYW1zdW5nLmNvbT4gZm9yIFNhbXN1bmcgRWxlY3Ryb25pY3Mu
CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxp
bnV4L2NtYS5oPgorI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2Rt
YS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtaGVhcC5oPgorI2luY2x1ZGUgPGxpbnV4L2Rt
YS1tYXAtb3BzLmg+CisjaW5jbHVkZSA8bGludXgvZXJyLmg+CisjaW5jbHVkZSA8bGludXgvZXJy
bm8uaD4KKyNpbmNsdWRlIDxsaW51eC9oaWdobWVtLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxl
Lmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4L3NjYXR0ZXJsaXN0
Lmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQvc2lnbmFsLmg+CisjaW5jbHVkZSA8bGludXgvb2Zf
cmVzZXJ2ZWRfbWVtLmg+CisjaW5jbHVkZSA8bGludXgvb2YuaD4KKworc3RydWN0IGNodW5rX2hl
YXAgeworCXN0cnVjdCBkbWFfaGVhcCAqaGVhcDsKKwl1bnNpZ25lZCBpbnQgb3JkZXI7CisJc3Ry
dWN0IGNtYSAqY21hOworfTsKKworc3RydWN0IGNodW5rX2hlYXBfYnVmZmVyIHsKKwlzdHJ1Y3Qg
Y2h1bmtfaGVhcCAqaGVhcDsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGF0dGFjaG1lbnRzOworCXN0cnVj
dCBtdXRleCBsb2NrOworCXN0cnVjdCBzZ190YWJsZSBzZ190YWJsZTsKKwl1bnNpZ25lZCBsb25n
IGxlbjsKKwlpbnQgdm1hcF9jbnQ7CisJdm9pZCAqdmFkZHI7Cit9OworCitzdHJ1Y3QgY2h1bmtf
aGVhcF9hdHRhY2htZW50IHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJc3RydWN0IHNnX3RhYmxl
ICp0YWJsZTsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGxpc3Q7CisJYm9vbCBtYXBwZWQ7Cit9OworCitz
dGF0aWMgc3RydWN0IHNnX3RhYmxlICpkdXBfc2dfdGFibGUoc3RydWN0IHNnX3RhYmxlICp0YWJs
ZSkKK3sKKwlzdHJ1Y3Qgc2dfdGFibGUgKm5ld190YWJsZTsKKwlpbnQgcmV0LCBpOworCXN0cnVj
dCBzY2F0dGVybGlzdCAqc2csICpuZXdfc2c7CisKKwluZXdfdGFibGUgPSBremFsbG9jKHNpemVv
ZigqbmV3X3RhYmxlKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFuZXdfdGFibGUpCisJCXJldHVybiBF
UlJfUFRSKC1FTk9NRU0pOworCisJcmV0ID0gc2dfYWxsb2NfdGFibGUobmV3X3RhYmxlLCB0YWJs
ZS0+b3JpZ19uZW50cywgR0ZQX0tFUk5FTCk7CisJaWYgKHJldCkgeworCQlrZnJlZShuZXdfdGFi
bGUpOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwl9CisKKwluZXdfc2cgPSBuZXdfdGFi
bGUtPnNnbDsKKwlmb3JfZWFjaF9zZ3RhYmxlX3NnKHRhYmxlLCBzZywgaSkgeworCQlzZ19zZXRf
cGFnZShuZXdfc2csIHNnX3BhZ2Uoc2cpLCBzZy0+bGVuZ3RoLCBzZy0+b2Zmc2V0KTsKKwkJbmV3
X3NnID0gc2dfbmV4dChuZXdfc2cpOworCX0KKworCXJldHVybiBuZXdfdGFibGU7Cit9CisKK3N0
YXRpYyBpbnQgY2h1bmtfaGVhcF9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCkKK3sKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9i
dWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9hdHRhY2ht
ZW50ICphOworCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7CisKKwlhID0ga3phbGxvYyhzaXplb2Yo
KmEpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWEpCisJCXJldHVybiAtRU5PTUVNOworCisJdGFibGUg
PSBkdXBfc2dfdGFibGUoJmJ1ZmZlci0+c2dfdGFibGUpOworCWlmIChJU19FUlIodGFibGUpKSB7
CisJCWtmcmVlKGEpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlhLT50YWJsZSA9IHRhYmxl
OworCWEtPmRldiA9IGF0dGFjaG1lbnQtPmRldjsKKwlJTklUX0xJU1RfSEVBRCgmYS0+bGlzdCk7
CisJYS0+bWFwcGVkID0gZmFsc2U7CisKKwlhdHRhY2htZW50LT5wcml2ID0gYTsKKworCW11dGV4
X2xvY2soJmJ1ZmZlci0+bG9jayk7CisJbGlzdF9hZGQoJmEtPmxpc3QsICZidWZmZXItPmF0dGFj
aG1lbnRzKTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQgY2h1bmtfaGVhcF9kZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwg
c3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCkKK3sKKwlzdHJ1Y3QgY2h1bmtf
aGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgY2h1bmtfaGVhcF9h
dHRhY2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+
bG9jayk7CisJbGlzdF9kZWwoJmEtPmxpc3QpOworCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2Nr
KTsKKworCXNnX2ZyZWVfdGFibGUoYS0+dGFibGUpOworCWtmcmVlKGEtPnRhYmxlKTsKKwlrZnJl
ZShhKTsKK30KKworc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqY2h1bmtfaGVhcF9tYXBfZG1hX2J1
ZihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50LAorCQkJCQkgICAgICAgZW51
bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQoreworCXN0cnVjdCBjaHVua19oZWFwX2F0
dGFjaG1lbnQgKmEgPSBhdHRhY2htZW50LT5wcml2OworCXN0cnVjdCBzZ190YWJsZSAqdGFibGUg
PSBhLT50YWJsZTsKKwlpbnQgcmV0OworCisJcmV0ID0gZG1hX21hcF9zZ3RhYmxlKGF0dGFjaG1l
bnQtPmRldiwgdGFibGUsIGRpcmVjdGlvbiwgMCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIEVSUl9Q
VFIocmV0KTsKKworCWEtPm1hcHBlZCA9IHRydWU7CisJcmV0dXJuIHRhYmxlOworfQorCitzdGF0
aWMgdm9pZCBjaHVua19oZWFwX3VubWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVu
dCAqYXR0YWNobWVudCwKKwkJCQkgICAgIHN0cnVjdCBzZ190YWJsZSAqdGFibGUsCisJCQkJICAg
ICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJc3RydWN0IGNodW5rX2hl
YXBfYXR0YWNobWVudCAqYSA9IGF0dGFjaG1lbnQtPnByaXY7CisKKwlhLT5tYXBwZWQgPSBmYWxz
ZTsKKwlkbWFfdW5tYXBfc2d0YWJsZShhdHRhY2htZW50LT5kZXYsIHRhYmxlLCBkaXJlY3Rpb24s
IDApOworfQorCitzdGF0aWMgaW50IGNodW5rX2hlYXBfZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNz
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkJCQllbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBk
aXJlY3Rpb24pCit7CisJc3RydWN0IGNodW5rX2hlYXBfYnVmZmVyICpidWZmZXIgPSBkbWFidWYt
PnByaXY7CisJc3RydWN0IGNodW5rX2hlYXBfYXR0YWNobWVudCAqYTsKKworCW11dGV4X2xvY2so
JmJ1ZmZlci0+bG9jayk7CisKKwlpZiAoYnVmZmVyLT52bWFwX2NudCkKKwkJaW52YWxpZGF0ZV9r
ZXJuZWxfdm1hcF9yYW5nZShidWZmZXItPnZhZGRyLCBidWZmZXItPmxlbik7CisKKwlsaXN0X2Zv
cl9lYWNoX2VudHJ5KGEsICZidWZmZXItPmF0dGFjaG1lbnRzLCBsaXN0KSB7CisJCWlmICghYS0+
bWFwcGVkKQorCQkJY29udGludWU7CisJCWRtYV9zeW5jX3NndGFibGVfZm9yX2NwdShhLT5kZXYs
IGEtPnRhYmxlLCBkaXJlY3Rpb24pOworCX0KKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaHVua19oZWFwX2RtYV9idWZfZW5kX2Nw
dV9hY2Nlc3Moc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCQkJICAgICAgZW51bSBkbWFfZGF0
YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQoreworCXN0cnVjdCBjaHVua19oZWFwX2J1ZmZlciAqYnVm
ZmVyID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBjaHVua19oZWFwX2F0dGFjaG1lbnQgKmE7CisK
KwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOworCisJaWYgKGJ1ZmZlci0+dm1hcF9jbnQpCisJ
CWZsdXNoX2tlcm5lbF92bWFwX3JhbmdlKGJ1ZmZlci0+dmFkZHIsIGJ1ZmZlci0+bGVuKTsKKwor
CWxpc3RfZm9yX2VhY2hfZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMsIGxpc3QpIHsKKwkJ
aWYgKCFhLT5tYXBwZWQpCisJCQljb250aW51ZTsKKwkJZG1hX3N5bmNfc2d0YWJsZV9mb3JfZGV2
aWNlKGEtPmRldiwgYS0+dGFibGUsIGRpcmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygmYnVm
ZmVyLT5sb2NrKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNodW5rX2hlYXBfbW1h
cChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKK3sK
KwlzdHJ1Y3QgY2h1bmtfaGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1
Y3Qgc2dfdGFibGUgKnRhYmxlID0gJmJ1ZmZlci0+c2dfdGFibGU7CisJdW5zaWduZWQgbG9uZyBh
ZGRyID0gdm1hLT52bV9zdGFydDsKKwlzdHJ1Y3Qgc2dfcGFnZV9pdGVyIHBpdGVyOworCWludCBy
ZXQ7CisKKwlmb3JfZWFjaF9zZ3RhYmxlX3BhZ2UodGFibGUsICZwaXRlciwgdm1hLT52bV9wZ29m
ZikgeworCQlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHNnX3BhZ2VfaXRlcl9wYWdlKCZwaXRlcik7CisK
KwkJcmV0ID0gcmVtYXBfcGZuX3JhbmdlKHZtYSwgYWRkciwgcGFnZV90b19wZm4ocGFnZSksIFBB
R0VfU0laRSwKKwkJCQkgICAgICB2bWEtPnZtX3BhZ2VfcHJvdCk7CisJCWlmIChyZXQpCisJCQly
ZXR1cm4gcmV0OworCQlhZGRyID0gUEFHRV9TSVpFOworCQlpZiAoYWRkciA+PSB2bWEtPnZtX2Vu
ZCkKKwkJCXJldHVybiAwOworCX0KKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgKmNodW5r
X2hlYXBfZG9fdm1hcChzdHJ1Y3QgY2h1bmtfaGVhcF9idWZmZXIgKmJ1ZmZlcikKK3sKKwlzdHJ1
Y3Qgc2dfdGFibGUgKnRhYmxlID0gJmJ1ZmZlci0+c2dfdGFibGU7CisJaW50IG5wYWdlcyA9IFBB
R0VfQUxJR04oYnVmZmVyLT5sZW4pIC8gUEFHRV9TSVpFOworCXN0cnVjdCBwYWdlICoqcGFnZXMg
PSB2bWFsbG9jKHNpemVvZihzdHJ1Y3QgcGFnZSAqKSAqIG5wYWdlcyk7CisJc3RydWN0IHBhZ2Ug
Kip0bXAgPSBwYWdlczsKKwlzdHJ1Y3Qgc2dfcGFnZV9pdGVyIHBpdGVyOworCXZvaWQgKnZhZGRy
OworCisJaWYgKCFwYWdlcykKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlmb3JfZWFj
aF9zZ3RhYmxlX3BhZ2UodGFibGUsICZwaXRlciwgMCkgeworCQlXQVJOX09OKHRtcCAtIHBhZ2Vz
ID49IG5wYWdlcyk7CisJCSp0bXArKyA9IHNnX3BhZ2VfaXRlcl9wYWdlKCZwaXRlcik7CisJfQor
CisJdmFkZHIgPSB2bWFwKHBhZ2VzLCBucGFnZXMsIFZNX01BUCwgUEFHRV9LRVJORUwpOworCXZm
cmVlKHBhZ2VzKTsKKworCWlmICghdmFkZHIpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwor
CisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgaW50IGNodW5rX2hlYXBfdm1hcChzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3QgZG1hX2J1Zl9tYXAgKm1hcCkKK3sKKwlzdHJ1Y3QgY2h1
bmtfaGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlpbnQgcmV0ID0gMDsKKwl2
b2lkICp2YWRkcjsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+bG9jayk7CisJaWYgKGJ1ZmZlci0+
dm1hcF9jbnQpIHsKKwkJdmFkZHIgPSBidWZmZXItPnZhZGRyOworCQlnb3RvIGRvbmU7CisJfQor
CisJdmFkZHIgPSBjaHVua19oZWFwX2RvX3ZtYXAoYnVmZmVyKTsKKwlpZiAoSVNfRVJSKHZhZGRy
KSkgeworCQlyZXQgPSBQVFJfRVJSKHZhZGRyKTsKKwkJZ290byBlcnI7CisJfQorCisJYnVmZmVy
LT52YWRkciA9IHZhZGRyOworZG9uZToKKwlidWZmZXItPnZtYXBfY250Kys7CisJZG1hX2J1Zl9t
YXBfc2V0X3ZhZGRyKG1hcCwgdmFkZHIpOworZXJyOgorCW11dGV4X3VubG9jaygmYnVmZmVyLT5s
b2NrKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGNodW5rX2hlYXBfdnVubWFw
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQoreworCXN0
cnVjdCBjaHVua19oZWFwX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJbXV0ZXhf
bG9jaygmYnVmZmVyLT5sb2NrKTsKKwlpZiAoIS0tYnVmZmVyLT52bWFwX2NudCkgeworCQl2dW5t
YXAoYnVmZmVyLT52YWRkcik7CisJCWJ1ZmZlci0+dmFkZHIgPSBOVUxMOworCX0KKwltdXRleF91
bmxvY2soJmJ1ZmZlci0+bG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIGNodW5rX2hlYXBfZG1hX2J1
Zl9yZWxlYXNlKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCit7CisJc3RydWN0IGNodW5rX2hlYXBf
YnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IGNodW5rX2hlYXAgKmNodW5r
X2hlYXAgPSBidWZmZXItPmhlYXA7CisJc3RydWN0IHNnX3RhYmxlICp0YWJsZTsKKwlzdHJ1Y3Qg
c2NhdHRlcmxpc3QgKnNnOworCWludCBpOworCisJdGFibGUgPSAmYnVmZmVyLT5zZ190YWJsZTsK
Kwlmb3JfZWFjaF9zZ3RhYmxlX3NnKHRhYmxlLCBzZywgaSkKKwkJY21hX3JlbGVhc2UoY2h1bmtf
aGVhcC0+Y21hLCBzZ19wYWdlKHNnKSwgMSA8PCBjaHVua19oZWFwLT5vcmRlcik7CisJc2dfZnJl
ZV90YWJsZSh0YWJsZSk7CisJa2ZyZWUoYnVmZmVyKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVj
dCBkbWFfYnVmX29wcyBjaHVua19oZWFwX2J1Zl9vcHMgPSB7CisJLmF0dGFjaCA9IGNodW5rX2hl
YXBfYXR0YWNoLAorCS5kZXRhY2ggPSBjaHVua19oZWFwX2RldGFjaCwKKwkubWFwX2RtYV9idWYg
PSBjaHVua19oZWFwX21hcF9kbWFfYnVmLAorCS51bm1hcF9kbWFfYnVmID0gY2h1bmtfaGVhcF91
bm1hcF9kbWFfYnVmLAorCS5iZWdpbl9jcHVfYWNjZXNzID0gY2h1bmtfaGVhcF9kbWFfYnVmX2Jl
Z2luX2NwdV9hY2Nlc3MsCisJLmVuZF9jcHVfYWNjZXNzID0gY2h1bmtfaGVhcF9kbWFfYnVmX2Vu
ZF9jcHVfYWNjZXNzLAorCS5tbWFwID0gY2h1bmtfaGVhcF9tbWFwLAorCS52bWFwID0gY2h1bmtf
aGVhcF92bWFwLAorCS52dW5tYXAgPSBjaHVua19oZWFwX3Z1bm1hcCwKKwkucmVsZWFzZSA9IGNo
dW5rX2hlYXBfZG1hX2J1Zl9yZWxlYXNlLAorfTsKKworc3RhdGljIGludCBjaHVua19oZWFwX2Fs
bG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwgdW5zaWduZWQgbG9uZyBsZW4sCisJCQkgICAg
ICAgdW5zaWduZWQgbG9uZyBmZF9mbGFncywgdW5zaWduZWQgbG9uZyBoZWFwX2ZsYWdzKQorewor
CXN0cnVjdCBjaHVua19oZWFwICpjaHVua19oZWFwID0gZG1hX2hlYXBfZ2V0X2RydmRhdGEoaGVh
cCk7CisJc3RydWN0IGNodW5rX2hlYXBfYnVmZmVyICpidWZmZXI7CisJREVGSU5FX0RNQV9CVUZf
RVhQT1JUX0lORk8oZXhwX2luZm8pOworCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7CisJc3RydWN0
IHNnX3RhYmxlICp0YWJsZTsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOworCXN0cnVjdCBwYWdl
ICoqcGFnZXM7CisJdW5zaWduZWQgaW50IGNodW5rX3NpemUgPSBQQUdFX1NJWkUgPDwgY2h1bmtf
aGVhcC0+b3JkZXI7CisJdW5zaWduZWQgaW50IGNvdW50LCBhbGxvY2VkID0gMDsKKwl1bnNpZ25l
ZCBpbnQgbnVtX3JldHJ5ID0gNTsKKwlpbnQgcmV0ID0gLUVOT01FTTsKKwlwZ29mZl90IHBnOwor
CisJYnVmZmVyID0ga3phbGxvYyhzaXplb2YoKmJ1ZmZlciksIEdGUF9LRVJORUwpOworCWlmICgh
YnVmZmVyKQorCQlyZXR1cm4gcmV0OworCisJSU5JVF9MSVNUX0hFQUQoJmJ1ZmZlci0+YXR0YWNo
bWVudHMpOworCW11dGV4X2luaXQoJmJ1ZmZlci0+bG9jayk7CisJYnVmZmVyLT5oZWFwID0gY2h1
bmtfaGVhcDsKKwlidWZmZXItPmxlbiA9IEFMSUdOKGxlbiwgY2h1bmtfc2l6ZSk7CisJY291bnQg
PSBidWZmZXItPmxlbiAvIGNodW5rX3NpemU7CisKKwlwYWdlcyA9IGt2bWFsbG9jX2FycmF5KGNv
dW50LCBzaXplb2YoKnBhZ2VzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwYWdlcykKKwkJZ290byBl
cnJfcGFnZXM7CisKKwl3aGlsZSAobnVtX3JldHJ5LS0pIHsKKwkJdW5zaWduZWQgbG9uZyBucl9w
YWdlczsKKworCQlyZXQgPSBjbWFfYWxsb2NfYnVsayhjaHVua19oZWFwLT5jbWEsIGNodW5rX2hl
YXAtPm9yZGVyLAorCQkJCSAgICAgbnVtX3JldHJ5ID8gX19HRlBfTk9SRVRSWSA6IDAsCisJCQkJ
ICAgICBjaHVua19oZWFwLT5vcmRlciwgY291bnQgLSBhbGxvY2VkLAorCQkJCSAgICAgcGFnZXMg
KyBhbGxvY2VkLCAmbnJfcGFnZXMpOworCQlhbGxvY2VkICs9IG5yX3BhZ2VzOworCQlpZiAoYWxs
b2NlZCA9PSBjb3VudCkKKwkJCWJyZWFrOworCQlpZiAocmV0ICE9IC1FQlVTWSkKKwkJCWJyZWFr
OworCisJfQorCWlmIChyZXQgPCAwKQorCQlnb3RvIGVycl9hbGxvYzsKKworCXRhYmxlID0gJmJ1
ZmZlci0+c2dfdGFibGU7CisJaWYgKHNnX2FsbG9jX3RhYmxlKHRhYmxlLCBjb3VudCwgR0ZQX0tF
Uk5FTCkpCisJCWdvdG8gZXJyX2FsbG9jOworCisJc2cgPSB0YWJsZS0+c2dsOworCWZvciAocGcg
PSAwOyBwZyA8IGNvdW50OyBwZysrKSB7CisJCXNnX3NldF9wYWdlKHNnLCBwYWdlc1twZ10sIGNo
dW5rX3NpemUsIDApOworCQlzZyA9IHNnX25leHQoc2cpOworCX0KKworCWV4cF9pbmZvLm9wcyA9
ICZjaHVua19oZWFwX2J1Zl9vcHM7CisJZXhwX2luZm8uc2l6ZSA9IGJ1ZmZlci0+bGVuOworCWV4
cF9pbmZvLmZsYWdzID0gZmRfZmxhZ3M7CisJZXhwX2luZm8ucHJpdiA9IGJ1ZmZlcjsKKwlkbWFi
dWYgPSBkbWFfYnVmX2V4cG9ydCgmZXhwX2luZm8pOworCWlmIChJU19FUlIoZG1hYnVmKSkgewor
CQlyZXQgPSBQVFJfRVJSKGRtYWJ1Zik7CisJCWdvdG8gZXJyX2V4cG9ydDsKKwl9CisJa3ZmcmVl
KHBhZ2VzKTsKKworCXJldCA9IGRtYV9idWZfZmQoZG1hYnVmLCBmZF9mbGFncyk7CisJaWYgKHJl
dCA8IDApIHsKKwkJZG1hX2J1Zl9wdXQoZG1hYnVmKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwly
ZXR1cm4gMDsKK2Vycl9leHBvcnQ6CisJc2dfZnJlZV90YWJsZSh0YWJsZSk7CitlcnJfYWxsb2M6
CisJZm9yIChwZyA9IDA7IHBnIDwgYWxsb2NlZDsgcGcrKykKKwkJY21hX3JlbGVhc2UoY2h1bmtf
aGVhcC0+Y21hLCBwYWdlc1twZ10sIDEgPDwgY2h1bmtfaGVhcC0+b3JkZXIpOworCWt2ZnJlZShw
YWdlcyk7CitlcnJfcGFnZXM6CisJa2ZyZWUoYnVmZmVyKTsKKworCXJldHVybiByZXQ7Cit9CisK
K3N0YXRpYyB2b2lkIHJtZW1fcmVtb3ZlX2NhbGxiYWNrKHZvaWQgKnApCit7CisJb2ZfcmVzZXJ2
ZWRfbWVtX2RldmljZV9yZWxlYXNlKChzdHJ1Y3QgZGV2aWNlICopcCk7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNodW5rX2hlYXBfb3BzID0geworCS5hbGxvY2F0ZSA9
IGNodW5rX2hlYXBfYWxsb2NhdGUsCit9OworCitzdGF0aWMgaW50IGNodW5rX2hlYXBfcHJvYmUo
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgY2h1bmtfaGVhcCAqY2h1
bmtfaGVhcDsKKwlzdHJ1Y3QgZG1hX2hlYXBfZXhwb3J0X2luZm8gZXhwX2luZm87CisJdW5zaWdu
ZWQgaW50IGFsaWdubWVudDsKKwlpbnQgcmV0OworCisJcmV0ID0gb2ZfcmVzZXJ2ZWRfbWVtX2Rl
dmljZV9pbml0KCZwZGV2LT5kZXYpOworCWlmIChyZXQgfHwgIXBkZXYtPmRldi5jbWFfYXJlYSkg
eworCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJUaGUgQ01BIHJlc2VydmVkIGFyZWEgaXMgbm90IGFz
c2lnbmVkIChyZXQgJWQpIiwgcmV0KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0ID0g
ZGV2bV9hZGRfYWN0aW9uKCZwZGV2LT5kZXYsIHJtZW1fcmVtb3ZlX2NhbGxiYWNrLCAmcGRldi0+
ZGV2KTsKKwlpZiAocmV0KSB7CisJCW9mX3Jlc2VydmVkX21lbV9kZXZpY2VfcmVsZWFzZSgmcGRl
di0+ZGV2KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwljaHVua19oZWFwID0gZGV2bV9remFsbG9j
KCZwZGV2LT5kZXYsIHNpemVvZigqY2h1bmtfaGVhcCksIEdGUF9LRVJORUwpOworCWlmICghY2h1
bmtfaGVhcCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpZiAob2ZfcHJvcGVydHlfcmVhZF91MzIo
cGRldi0+ZGV2Lm9mX25vZGUsICJhbGlnbm1lbnQiLCAmYWxpZ25tZW50KSkKKwkJY2h1bmtfaGVh
cC0+b3JkZXIgPSAwOworCWVsc2UKKwkJY2h1bmtfaGVhcC0+b3JkZXIgPSBnZXRfb3JkZXIoYWxp
Z25tZW50KTsKKworCWNodW5rX2hlYXAtPmNtYSA9IHBkZXYtPmRldi5jbWFfYXJlYTsKKworCWV4
cF9pbmZvLm5hbWUgPSBjbWFfZ2V0X25hbWUocGRldi0+ZGV2LmNtYV9hcmVhKTsKKwlleHBfaW5m
by5vcHMgPSAmY2h1bmtfaGVhcF9vcHM7CisJZXhwX2luZm8ucHJpdiA9IGNodW5rX2hlYXA7CisK
KwljaHVua19oZWFwLT5oZWFwID0gZG1hX2hlYXBfYWRkKCZleHBfaW5mbyk7CisJaWYgKElTX0VS
UihjaHVua19oZWFwLT5oZWFwKSkKKwkJcmV0dXJuIFBUUl9FUlIoY2h1bmtfaGVhcC0+aGVhcCk7
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgY2h1
bmtfaGVhcF9vZl9tYXRjaFtdID0geworCXsgLmNvbXBhdGlibGUgPSAiZG1hX2hlYXAsY2h1bmsi
LCB9LAorCXsgfSwKK307CisKK01PRFVMRV9ERVZJQ0VfVEFCTEUob2YsIGNodW5rX2hlYXBfb2Zf
bWF0Y2gpOworCitzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2RyaXZlciBjaHVua19oZWFwX2RyaXZl
ciA9IHsKKwkuZHJpdmVyCQk9IHsKKwkJLm5hbWUJPSAiY2h1bmtfaGVhcCIsCisJCS5vZl9tYXRj
aF90YWJsZSA9IGNodW5rX2hlYXBfb2ZfbWF0Y2gsCisJfSwKKwkucHJvYmUJCT0gY2h1bmtfaGVh
cF9wcm9iZSwKK307CisKK3N0YXRpYyBpbnQgX19pbml0IGNodW5rX2hlYXBfaW5pdCh2b2lkKQor
eworCXJldHVybiBwbGF0Zm9ybV9kcml2ZXJfcmVnaXN0ZXIoJmNodW5rX2hlYXBfZHJpdmVyKTsK
K30KK21vZHVsZV9pbml0KGNodW5rX2hlYXBfaW5pdCk7CitNT0RVTEVfREVTQ1JJUFRJT04oIkRN
QS1CVUYgQ2h1bmsgSGVhcCIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwotLSAKMi4yOS4y
LjI5OS5nZGMxMTIxODIzYy1nb29nCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpMaW5hcm8tbW0tc2lnIG1haWxpbmcgbGlzdApMaW5hcm8tbW0tc2lnQGxp
c3RzLmxpbmFyby5vcmcKaHR0cHM6Ly9saXN0cy5saW5hcm8ub3JnL21haWxtYW4vbGlzdGluZm8v
bGluYXJvLW1tLXNpZwo=
