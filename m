Return-Path: <linaro-mm-sig-bounces+lists+linaro-mm-sig=lfdr.de@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [3.208.193.21])
	by mail.lfdr.de (Postfix) with ESMTPS id 5ADB5C4CD33
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 11 Nov 2025 10:59:21 +0100 (CET)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 6FDBC3F844
	for <lists+linaro-mm-sig@lfdr.de>; Tue, 11 Nov 2025 09:59:20 +0000 (UTC)
Received: from sea.source.kernel.org (sea.source.kernel.org [172.234.252.31])
	by lists.linaro.org (Postfix) with ESMTPS id C5AF63F839
	for <linaro-mm-sig@lists.linaro.org>; Tue, 11 Nov 2025 09:58:21 +0000 (UTC)
Authentication-Results: lists.linaro.org;
	dkim=pass header.d=kernel.org header.s=k20201202 header.b=XUY4+UF+;
	dmarc=pass (policy=quarantine) header.from=kernel.org;
	spf=pass (lists.linaro.org: domain of leon@kernel.org designates 172.234.252.31 as permitted sender) smtp.mailfrom=leon@kernel.org
Received: from smtp.kernel.org (transwarp.subspace.kernel.org [100.75.92.58])
	by sea.source.kernel.org (Postfix) with ESMTP id 47F6140A87;
	Tue, 11 Nov 2025 09:58:21 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 801D1C4AF0B;
	Tue, 11 Nov 2025 09:58:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1762855101;
	bh=JMbrxy8ypHgHgSl15UdeV2RJ/cpbWX2+AcI5KUR48AM=;
	h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
	b=XUY4+UF+EXRnN9Hujwe0c68EGBioGoHuy1cdoWJuF8I1px8uJXFiLZ0D5bTmQLjjL
	 ntAQ/6Iy7rATBH57keQpKd1R3hKAxm5d56qGewKfkkdq4spN0tw4OwoV4xcCX1M5Ka
	 4lpv5E5Z5QKl1oo6Km0lBQFlDkLusuSahHnuF0pgBdKx9XCHMAJH4J6vZr5tebdySA
	 LKxI6as0rnpaBsPi3KOv65cLe1UuP3nUNHI0VZ0hsDYoQ9upWJKYnWrfCnfjysg4Qd
	 miwMVbEjUk68yDfPp3JdEN7Tf8jtNacP4AjGu2LlagXdkVEveJcxB2wBW6AphBQ5EE
	 2fg3iLBRhFzJg==
From: Leon Romanovsky <leon@kernel.org>
To: Bjorn Helgaas <bhelgaas@google.com>,
	Logan Gunthorpe <logang@deltatee.com>,
	Jens Axboe <axboe@kernel.dk>,
	Robin Murphy <robin.murphy@arm.com>,
	Joerg Roedel <joro@8bytes.org>,
	Will Deacon <will@kernel.org>,
	Marek Szyprowski <m.szyprowski@samsung.com>,
	Jason Gunthorpe <jgg@ziepe.ca>,
	Leon Romanovsky <leon@kernel.org>,
	Andrew Morton <akpm@linux-foundation.org>,
	Jonathan Corbet <corbet@lwn.net>,
	Sumit Semwal <sumit.semwal@linaro.org>,
	=?utf-8?q?Christian_K=C3=B6nig?= <christian.koenig@amd.com>,
	Kees Cook <kees@kernel.org>,
	"Gustavo A. R. Silva" <gustavoars@kernel.org>,
	Ankit Agrawal <ankita@nvidia.com>,
	Yishai Hadas <yishaih@nvidia.com>,
	Shameer Kolothum <skolothumtho@nvidia.com>,
	Kevin Tian <kevin.tian@intel.com>,
	Alex Williamson <alex@shazbot.org>
Date: Tue, 11 Nov 2025 11:57:48 +0200
Message-ID: <20251111-dmabuf-vfio-v8-6-fd9aa5df478f@nvidia.com>
X-Mailer: git-send-email 2.51.1
In-Reply-To: <20251111-dmabuf-vfio-v8-0-fd9aa5df478f@nvidia.com>
References: <20251111-dmabuf-vfio-v8-0-fd9aa5df478f@nvidia.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
X-Mailer: b4 0.15-dev-3ae27
X-Rspamd-Server: lists.linaro.org
X-Rspamd-Queue-Id: C5AF63F839
X-Spamd-Bar: ----
X-Spamd-Result: default: False [-4.00 / 15.00];
	BAYES_HAM(-3.00)[100.00%];
	DMARC_POLICY_ALLOW(-0.50)[kernel.org,quarantine];
	R_SPF_ALLOW(-0.20)[+ip4:172.234.252.31:c];
	R_DKIM_ALLOW(-0.20)[kernel.org:s=k20201202];
	MIME_GOOD(-0.10)[text/plain];
	DNSWL_BLOCKED(0.00)[172.234.252.31:from,100.75.92.58:received];
	ARC_NA(0.00)[];
	RCVD_VIA_SMTP_AUTH(0.00)[];
	ASN(0.00)[asn:63949, ipnet:172.234.224.0/19, country:SG];
	RCPT_COUNT_TWELVE(0.00)[35];
	MIME_TRACE(0.00)[0:+];
	TO_MATCH_ENVRCPT_SOME(0.00)[];
	FROM_HAS_DN(0.00)[];
	NEURAL_HAM(-0.00)[-1.000];
	RCVD_TLS_LAST(0.00)[];
	FROM_EQ_ENVFROM(0.00)[];
	URIBL_BLOCKED(0.00)[nvidia.com:email,nvidia.com:mid,sea.source.kernel.org:rdns,sea.source.kernel.org:helo,fb.com:email];
	TO_DN_SOME(0.00)[];
	RCVD_COUNT_TWO(0.00)[2];
	DKIM_TRACE(0.00)[kernel.org:+]
X-Rspamd-Action: no action
Message-ID-Hash: HFXXTI4DA3BSEQQCOFWELUUQHGEL4P5S
X-Message-ID-Hash: HFXXTI4DA3BSEQQCOFWELUUQHGEL4P5S
X-MailFrom: leon@kernel.org
X-Mailman-Rule-Hits: nonmember-moderation
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation
CC: Krishnakant Jaju <kjaju@nvidia.com>, Matt Ochs <mochs@nvidia.com>, linux-pci@vger.kernel.org, linux-kernel@vger.kernel.org, linux-block@vger.kernel.org, iommu@lists.linux.dev, linux-mm@kvack.org, linux-doc@vger.kernel.org, linux-media@vger.kernel.org, dri-devel@lists.freedesktop.org, linaro-mm-sig@lists.linaro.org, kvm@vger.kernel.org, linux-hardening@vger.kernel.org, Alex Mastro <amastro@fb.com>, Nicolin Chen <nicolinc@nvidia.com>
X-Mailman-Version: 3.3.5
Precedence: list
Subject: [Linaro-mm-sig] [PATCH v8 06/11] dma-buf: provide phys_vec to scatter-gather mapping routine
List-Id: "Unified memory management interest group." <linaro-mm-sig.lists.linaro.org>
Archived-At: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/message/HFXXTI4DA3BSEQQCOFWELUUQHGEL4P5S/>
List-Archive: <https://lists.linaro.org/archives/list/linaro-mm-sig@lists.linaro.org/>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Owner: <mailto:linaro-mm-sig-owner@lists.linaro.org>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Subscribe: <mailto:linaro-mm-sig-join@lists.linaro.org>
List-Unsubscribe: <mailto:linaro-mm-sig-leave@lists.linaro.org>
Content-Transfer-Encoding: base64

RnJvbTogTGVvbiBSb21hbm92c2t5IDxsZW9ucm9AbnZpZGlhLmNvbT4NCg0KQWRkIGRtYV9idWZf
bWFwKCkgYW5kIGRtYV9idWZfdW5tYXAoKSBoZWxwZXJzIHRvIGNvbnZlcnQgYW4gYXJyYXkgb2YN
Ck1NSU8gcGh5c2ljYWwgYWRkcmVzcyByYW5nZXMgaW50byBzY2F0dGVyLWdhdGhlciB0YWJsZXMg
d2l0aCBwcm9wZXINCkRNQSBtYXBwaW5nLg0KDQpUaGVzZSBjb21tb24gZnVuY3Rpb25zIGFyZSBh
IHN0YXJ0aW5nIHBvaW50IGFuZCBzdXBwb3J0IGFueSBQQ0kNCmRyaXZlcnMgY3JlYXRpbmcgbWFw
cGluZ3MgZnJvbSB0aGVpciBCQVIncyBNTUlPIGFkZHJlc3Nlcy4gVkZJTyBpcyBvbmUNCmNhc2Us
IGFzIHNob3J0bHkgd2lsbCBiZSBSRE1BLiBXZSBjYW4gcmV2aWV3IGV4aXN0aW5nIERSTSBkcml2
ZXJzIHRvDQpyZWZhY3RvciB0aGVtIHNlcGFyYXRlbHkuIFdlIGhvcGUgdGhpcyB3aWxsIGV2b2x2
ZSBpbnRvIHJvdXRpbmVzIHRvDQpoZWxwIGNvbW1vbiBEUk0gdGhhdCBpbmNsdWRlIG1peGVkIENQ
VSBhbmQgTU1JTyBtYXBwaW5ncy4NCg0KQ29tcGFyZWQgdG8gdGhlIGRtYV9tYXBfcmVzb3VyY2Uo
KSBhYnVzZSB0aGlzIGltcGxlbWVudGF0aW9uIGhhbmRsZXMNCnRoZSBjb21wbGljYXRlZCBQQ0kg
UDJQIHNjZW5hcmlvcyBwcm9wZXJseSwgZXNwZWNpYWxseSB3aGVuIGFuIElPTU1VDQppcyBlbmFi
bGVkOg0KDQogLSBEaXJlY3QgYnVzIGFkZHJlc3MgbWFwcGluZyB3aXRob3V0IElPVkEgYWxsb2Nh
dGlvbiBmb3INCiAgIFBDSV9QMlBETUFfTUFQX0JVU19BRERSLCB1c2luZyBwY2lfcDJwZG1hX2J1
c19hZGRyX21hcCgpLiBUaGlzDQogICBoYXBwZW5zIGlmIHRoZSBJT01NVSBpcyBlbmFibGVkIGJ1
dCB0aGUgUENJZSBzd2l0Y2ggQUNTIGZsYWdzIGFsbG93DQogICB0cmFuc2FjdGlvbnMgdG8gYXZv
aWQgdGhlIGhvc3QgYnJpZGdlLg0KDQogICBGdXJ0aGVyLCB0aGlzIGhhbmRsZXMgdGhlIHNsaWdo
dGx5IG9ic2N1cmUsIGNhc2Ugb2YgTU1JTyB3aXRoIGENCiAgIHBoeXNfYWRkcl90IHRoYXQgaXMg
ZGlmZmVyZW50IGZyb20gdGhlIHBoeXNpY2FsIEJBUiBwcm9ncmFtbWluZw0KICAgKGJ1cyBvZmZz
ZXQpLiBUaGUgcGh5c19hZGRyX3QgaXMgY29udmVydGVkIHRvIGEgZG1hX2FkZHJfdCBhbmQNCiAg
IGFjY29tbW9kYXRlcyB0aGlzIGVmZmVjdC4gVGhpcyBlbmFibGVzIGNlcnRhaW4gcmVhbCBzeXN0
ZW1zIHRvDQogICB3b3JrLCBlc3BlY2lhbGx5IG9uIEFSTSBwbGF0Zm9ybXMuDQoNCiAtIE1hcHBp
bmcgdGhyb3VnaCBob3N0IGJyaWRnZSB3aXRoIElPVkEgYWxsb2NhdGlvbiBhbmQgRE1BX0FUVFJf
TU1JTw0KICAgYXR0cmlidXRlIGZvciBNTUlPIG1lbW9yeSByZWdpb25zIChQQ0lfUDJQRE1BX01B
UF9USFJVX0hPU1RfQlJJREdFKS4NCiAgIFRoaXMgaGFwcGVucyB3aGVuIHRoZSBJT01NVSBpcyBl
bmFibGVkIGFuZCB0aGUgQUNTIGZsYWdzIGFyZSBmb3JjaW5nDQogICBhbGwgdHJhZmZpYyB0byB0
aGUgSU9NTVUgLSBpZSBmb3IgdmlydHVhbGl6YXRpb24gc3lzdGVtcy4NCg0KIC0gQ2FzZXMgd2hl
cmUgUDJQIGlzIG5vdCBzdXBwb3J0ZWQgdGhyb3VnaCB0aGUgaG9zdCBicmlkZ2UvQ1BVLiBUaGUN
CiAgIFAyUCBzdWJzeXN0ZW0gaXMgdGhlIHByb3BlciBwbGFjZSB0byBkZXRlY3QgdGhpcyBhbmQg
YmxvY2sgaXQuDQoNCkhlbHBlciBmdW5jdGlvbnMgZmlsbF9zZ19lbnRyeSgpIGFuZCBjYWxjX3Nn
X25lbnRzKCkgaGFuZGxlIHRoZQ0Kc2NhdHRlci1nYXRoZXIgdGFibGUgY29uc3RydWN0aW9uLCBz
cGxpdHRpbmcgbGFyZ2UgcmVnaW9ucyBpbnRvDQpVSU5UX01BWC1zaXplZCBjaHVua3MgdG8gZml0
IHdpdGhpbiBzZy0+bGVuZ3RoIGZpZWxkIGxpbWl0cy4NCg0KU2luY2UgdGhlIHBoeXNpY2FsIGFk
ZHJlc3MgYmFzZWQgRE1BIEFQSSBmb3JiaWRzIHVzZSBvZiB0aGUgQ1BVIGxpc3QNCm9mIHRoZSBz
Y2F0dGVybGlzdCB0aGlzIHdpbGwgcHJvZHVjZSBhIG1hbmdsZWQgc2NhdHRlcmxpc3QgdGhhdCBo
YXMNCmEgZnVsbHkgemVyby1sZW5ndGggYW5kIE5VTEwnZCBDUFUgbGlzdC4gVGhlIGxpc3QgaXMg
MCBsZW5ndGgsDQphbGwgdGhlIHN0cnVjdCBwYWdlIHBvaW50ZXJzIGFyZSBOVUxMIGFuZCB6ZXJv
IHNpemVkLiBUaGlzIGlzIHN0cm9uZ2VyDQphbmQgbW9yZSByb2J1c3QgdGhhbiB0aGUgZXhpc3Rp
bmcgbWFuZ2xlX3NnX3RhYmxlKCkgdGVjaG5pcXVlLiBJdCBpcw0KYSBmdXR1cmUgcHJvamVjdCB0
byBtaWdyYXRlIERNQUJVRiBhcyBhIHN1YnN5c3RlbSBhd2F5IGZyb20gdXNpbmcNCnNjYXR0ZXJs
aXN0IGZvciB0aGlzIGRhdGEgc3RydWN0dXJlLg0KDQpUZXN0ZWQtYnk6IEFsZXggTWFzdHJvIDxh
bWFzdHJvQGZiLmNvbT4NClRlc3RlZC1ieTogTmljb2xpbiBDaGVuIDxuaWNvbGluY0BudmlkaWEu
Y29tPg0KU2lnbmVkLW9mZi1ieTogTGVvbiBSb21hbm92c2t5IDxsZW9ucm9AbnZpZGlhLmNvbT4N
Ci0tLQ0KIGRyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVmLmMgfCAyMzUgKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKw0KIGluY2x1ZGUvbGludXgvZG1hLWJ1Zi5oICAg
fCAgMTggKysrKw0KIDIgZmlsZXMgY2hhbmdlZCwgMjUzIGluc2VydGlvbnMoKykNCg0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVmLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1
Zi5jDQppbmRleCAyYmNmOWNlY2E5OTcuLmNiNTVkZmYxZGFkNSAxMDA2NDQNCi0tLSBhL2RyaXZl
cnMvZG1hLWJ1Zi9kbWEtYnVmLmMNCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVmLmMNCkBA
IC0xMjU0LDYgKzEyNTQsMjQxIEBAIHZvaWQgZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50X3VubG9j
a2VkKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwNCiB9DQogRVhQT1JUX1NZTUJP
TF9OU19HUEwoZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50X3VubG9ja2VkLCAiRE1BX0JVRiIpOw0K
IA0KK3N0YXRpYyBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKmZpbGxfc2dfZW50cnkoc3RydWN0IHNjYXR0
ZXJsaXN0ICpzZ2wsIHNpemVfdCBsZW5ndGgsDQorCQkJCQkgZG1hX2FkZHJfdCBhZGRyKQ0KK3sN
CisJdW5zaWduZWQgaW50IGxlbiwgbmVudHM7DQorCWludCBpOw0KKw0KKwluZW50cyA9IERJVl9S
T1VORF9VUChsZW5ndGgsIFVJTlRfTUFYKTsNCisJZm9yIChpID0gMDsgaSA8IG5lbnRzOyBpKysp
IHsNCisJCWxlbiA9IG1pbl90KHNpemVfdCwgbGVuZ3RoLCBVSU5UX01BWCk7DQorCQlsZW5ndGgg
LT0gbGVuOw0KKwkJLyoNCisJCSAqIERNQUJVRiBhYnVzZXMgc2NhdHRlcmxpc3QgdG8gY3JlYXRl
IGEgc2NhdHRlcmxpc3QNCisJCSAqIHRoYXQgZG9lcyBub3QgaGF2ZSBhbnkgQ1BVIGxpc3QsIG9u
bHkgdGhlIERNQSBsaXN0Lg0KKwkJICogQWx3YXlzIHNldCB0aGUgcGFnZSByZWxhdGVkIHZhbHVl
cyB0byBOVUxMIHRvIGVuc3VyZQ0KKwkJICogaW1wb3J0ZXJzIGNhbid0IHVzZSBpdC4gVGhlIHBo
eXNfYWRkciBiYXNlZCBETUEgQVBJDQorCQkgKiBkb2VzIG5vdCByZXF1aXJlIHRoZSBDUFUgbGlz
dCBmb3IgbWFwcGluZyBvciB1bm1hcHBpbmcuDQorCQkgKi8NCisJCXNnX3NldF9wYWdlKHNnbCwg
TlVMTCwgMCwgMCk7DQorCQlzZ19kbWFfYWRkcmVzcyhzZ2wpID0gYWRkciArIGkgKiBVSU5UX01B
WDsNCisJCXNnX2RtYV9sZW4oc2dsKSA9IGxlbjsNCisJCXNnbCA9IHNnX25leHQoc2dsKTsNCisJ
fQ0KKw0KKwlyZXR1cm4gc2dsOw0KK30NCisNCitzdGF0aWMgdW5zaWduZWQgaW50IGNhbGNfc2df
bmVudHMoc3RydWN0IGRtYV9pb3ZhX3N0YXRlICpzdGF0ZSwNCisJCQkJICBzdHJ1Y3QgZG1hX2J1
Zl9waHlzX3ZlYyAqcGh5c192ZWMsDQorCQkJCSAgc2l6ZV90IG5yX3Jhbmdlcywgc2l6ZV90IHNp
emUpDQorew0KKwl1bnNpZ25lZCBpbnQgbmVudHMgPSAwOw0KKwlzaXplX3QgaTsNCisNCisJaWYg
KCFzdGF0ZSB8fCAhZG1hX3VzZV9pb3ZhKHN0YXRlKSkgew0KKwkJZm9yIChpID0gMDsgaSA8IG5y
X3JhbmdlczsgaSsrKQ0KKwkJCW5lbnRzICs9IERJVl9ST1VORF9VUChwaHlzX3ZlY1tpXS5sZW4s
IFVJTlRfTUFYKTsNCisJfSBlbHNlIHsNCisJCS8qDQorCQkgKiBJbiBJT1ZBIGNhc2UsIHRoZXJl
IGlzIG9ubHkgb25lIFNHIGVudHJ5IHdoaWNoIHNwYW5zDQorCQkgKiBmb3Igd2hvbGUgSU9WQSBh
ZGRyZXNzIHNwYWNlLCBidXQgd2UgbmVlZCB0byBtYWtlIHN1cmUNCisJCSAqIHRoYXQgaXQgZml0
cyBzZy0+bGVuZ3RoLCBtYXliZSB3ZSBuZWVkIG1vcmUuDQorCQkgKi8NCisJCW5lbnRzID0gRElW
X1JPVU5EX1VQKHNpemUsIFVJTlRfTUFYKTsNCisJfQ0KKw0KKwlyZXR1cm4gbmVudHM7DQorfQ0K
Kw0KKy8qKg0KKyAqIHN0cnVjdCBkbWFfYnVmX2RtYSAtIGhvbGRzIERNQSBtYXBwaW5nIGluZm9y
bWF0aW9uDQorICogQHNndDogICAgU2NhdHRlci1nYXRoZXIgdGFibGUNCisgKiBAc3RhdGU6ICBE
TUEgSU9WQSBzdGF0ZSByZWxldmFudCBpbiBJT01NVS1iYXNlZCBETUENCisgKiBAc2l6ZTogICBU
b3RhbCBzaXplIG9mIERNQSB0cmFuc2Zlcg0KKyAqLw0KK3N0cnVjdCBkbWFfYnVmX2RtYSB7DQor
CXN0cnVjdCBzZ190YWJsZSBzZ3Q7DQorCXN0cnVjdCBkbWFfaW92YV9zdGF0ZSAqc3RhdGU7DQor
CXNpemVfdCBzaXplOw0KK307DQorDQorLyoqDQorICogZG1hX2J1Zl9tYXAgLSBSZXR1cm5zIHRo
ZSBzY2F0dGVybGlzdCB0YWJsZSBvZiB0aGUgYXR0YWNobWVudCBmcm9tIGFycmF5cw0KKyAqIG9m
IHBoeXNpY2FsIHZlY3RvcnMuIFRoaXMgZnVuY2l0b24gaXMgaW50ZW5kZWQgZm9yIE1NSU8gbWVt
b3J5IG9ubHkuDQorICogQGF0dGFjaDoJW2luXQlhdHRhY2htZW50IHdob3NlIHNjYXR0ZXJsaXN0
IGlzIHRvIGJlIHJldHVybmVkDQorICogQHByb3ZpZGVyOglbaW5dCXAycGRtYSBwcm92aWRlcg0K
KyAqIEBwaHlzX3ZlYzoJW2luXQlhcnJheSBvZiBwaHlzaWNhbCB2ZWN0b3JzDQorICogQG5yX3Jh
bmdlczoJW2luXQludW1iZXIgb2YgZW50cmllcyBpbiBwaHlzX3ZlYyBhcnJheQ0KKyAqIEBzaXpl
OglbaW5dCXRvdGFsIHNpemUgb2YgcGh5c192ZWMNCisgKiBAZGlyOglbaW5dCWRpcmVjdGlvbiBv
ZiBETUEgdHJhbnNmZXINCisgKg0KKyAqIFJldHVybnMgc2dfdGFibGUgY29udGFpbmluZyB0aGUg
c2NhdHRlcmxpc3QgdG8gYmUgcmV0dXJuZWQ7IHJldHVybnMgRVJSX1BUUg0KKyAqIG9uIGVycm9y
LiBNYXkgcmV0dXJuIC1FSU5UUiBpZiBpdCBpcyBpbnRlcnJ1cHRlZCBieSBhIHNpZ25hbC4NCisg
Kg0KKyAqIE9uIHN1Y2Nlc3MsIHRoZSBETUEgYWRkcmVzc2VzIGFuZCBsZW5ndGhzIGluIHRoZSBy
ZXR1cm5lZCBzY2F0dGVybGlzdCBhcmUNCisgKiBQQUdFX1NJWkUgYWxpZ25lZC4NCisgKg0KKyAq
IEEgbWFwcGluZyBtdXN0IGJlIHVubWFwcGVkIGJ5IHVzaW5nIGRtYV9idWZfdW5tYXAoKS4NCisg
Ki8NCitzdHJ1Y3Qgc2dfdGFibGUgKmRtYV9idWZfbWFwKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1l
bnQgKmF0dGFjaCwNCisJCQkgICAgIHN0cnVjdCBwMnBkbWFfcHJvdmlkZXIgKnByb3ZpZGVyLA0K
KwkJCSAgICAgc3RydWN0IGRtYV9idWZfcGh5c192ZWMgKnBoeXNfdmVjLA0KKwkJCSAgICAgc2l6
ZV90IG5yX3Jhbmdlcywgc2l6ZV90IHNpemUsDQorCQkJICAgICBlbnVtIGRtYV9kYXRhX2RpcmVj
dGlvbiBkaXIpDQorew0KKwl1bnNpZ25lZCBpbnQgbmVudHMsIG1hcHBlZF9sZW4gPSAwOw0KKwlz
dHJ1Y3QgZG1hX2J1Zl9kbWEgKmRtYTsNCisJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZ2w7DQorCWRt
YV9hZGRyX3QgYWRkcjsNCisJc2l6ZV90IGk7DQorCWludCByZXQ7DQorDQorCWRtYV9yZXN2X2Fz
c2VydF9oZWxkKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsNCisNCisJaWYgKFdBUk5fT04oIWF0dGFj
aCB8fCAhYXR0YWNoLT5kbWFidWYgfHwgIXByb3ZpZGVyKSkNCisJCS8qIFRoaXMgZnVuY3Rpb24g
aXMgc3VwcG9zZWQgdG8gd29yayBvbiBNTUlPIG1lbW9yeSBvbmx5ICovDQorCQlyZXR1cm4gRVJS
X1BUUigtRUlOVkFMKTsNCisNCisJZG1hID0ga3phbGxvYyhzaXplb2YoKmRtYSksIEdGUF9LRVJO
RUwpOw0KKwlpZiAoIWRtYSkNCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOw0KKw0KKwlzd2l0
Y2ggKHBjaV9wMnBkbWFfbWFwX3R5cGUocHJvdmlkZXIsIGF0dGFjaC0+ZGV2KSkgew0KKwljYXNl
IFBDSV9QMlBETUFfTUFQX0JVU19BRERSOg0KKwkJLyoNCisJCSAqIFRoZXJlIGlzIG5vIG5lZWQg
aW4gSU9WQSBhdCBhbGwgZm9yIHRoaXMgZmxvdy4NCisJCSAqLw0KKwkJYnJlYWs7DQorCWNhc2Ug
UENJX1AyUERNQV9NQVBfVEhSVV9IT1NUX0JSSURHRToNCisJCWRtYS0+c3RhdGUgPSBremFsbG9j
KHNpemVvZigqZG1hLT5zdGF0ZSksIEdGUF9LRVJORUwpOw0KKwkJaWYgKCFkbWEtPnN0YXRlKSB7
DQorCQkJcmV0ID0gLUVOT01FTTsNCisJCQlnb3RvIGVycl9mcmVlX2RtYTsNCisJCX0NCisNCisJ
CWRtYV9pb3ZhX3RyeV9hbGxvYyhhdHRhY2gtPmRldiwgZG1hLT5zdGF0ZSwgMCwgc2l6ZSk7DQor
CQlicmVhazsNCisJZGVmYXVsdDoNCisJCXJldCA9IC1FSU5WQUw7DQorCQlnb3RvIGVycl9mcmVl
X2RtYTsNCisJfQ0KKw0KKwluZW50cyA9IGNhbGNfc2dfbmVudHMoZG1hLT5zdGF0ZSwgcGh5c192
ZWMsIG5yX3Jhbmdlcywgc2l6ZSk7DQorCXJldCA9IHNnX2FsbG9jX3RhYmxlKCZkbWEtPnNndCwg
bmVudHMsIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsNCisJaWYgKHJldCkNCisJCWdvdG8gZXJy
X2ZyZWVfc3RhdGU7DQorDQorCXNnbCA9IGRtYS0+c2d0LnNnbDsNCisNCisJZm9yIChpID0gMDsg
aSA8IG5yX3JhbmdlczsgaSsrKSB7DQorCQlpZiAoIWRtYS0+c3RhdGUpIHsNCisJCQlhZGRyID0g
cGNpX3AycGRtYV9idXNfYWRkcl9tYXAocHJvdmlkZXIsDQorCQkJCQkJICAgICAgIHBoeXNfdmVj
W2ldLnBhZGRyKTsNCisJCX0gZWxzZSBpZiAoZG1hX3VzZV9pb3ZhKGRtYS0+c3RhdGUpKSB7DQor
CQkJcmV0ID0gZG1hX2lvdmFfbGluayhhdHRhY2gtPmRldiwgZG1hLT5zdGF0ZSwNCisJCQkJCSAg
ICBwaHlzX3ZlY1tpXS5wYWRkciwgMCwNCisJCQkJCSAgICBwaHlzX3ZlY1tpXS5sZW4sIGRpciwN
CisJCQkJCSAgICBETUFfQVRUUl9NTUlPKTsNCisJCQlpZiAocmV0KQ0KKwkJCQlnb3RvIGVycl91
bm1hcF9kbWE7DQorDQorCQkJbWFwcGVkX2xlbiArPSBwaHlzX3ZlY1tpXS5sZW47DQorCQl9IGVs
c2Ugew0KKwkJCWFkZHIgPSBkbWFfbWFwX3BoeXMoYXR0YWNoLT5kZXYsIHBoeXNfdmVjW2ldLnBh
ZGRyLA0KKwkJCQkJICAgIHBoeXNfdmVjW2ldLmxlbiwgZGlyLA0KKwkJCQkJICAgIERNQV9BVFRS
X01NSU8pOw0KKwkJCXJldCA9IGRtYV9tYXBwaW5nX2Vycm9yKGF0dGFjaC0+ZGV2LCBhZGRyKTsN
CisJCQlpZiAocmV0KQ0KKwkJCQlnb3RvIGVycl91bm1hcF9kbWE7DQorCQl9DQorDQorCQlpZiAo
IWRtYS0+c3RhdGUgfHwgIWRtYV91c2VfaW92YShkbWEtPnN0YXRlKSkNCisJCQlzZ2wgPSBmaWxs
X3NnX2VudHJ5KHNnbCwgcGh5c192ZWNbaV0ubGVuLCBhZGRyKTsNCisJfQ0KKw0KKwlpZiAoZG1h
LT5zdGF0ZSAmJiBkbWFfdXNlX2lvdmEoZG1hLT5zdGF0ZSkpIHsNCisJCVdBUk5fT05fT05DRSht
YXBwZWRfbGVuICE9IHNpemUpOw0KKwkJcmV0ID0gZG1hX2lvdmFfc3luYyhhdHRhY2gtPmRldiwg
ZG1hLT5zdGF0ZSwgMCwgbWFwcGVkX2xlbik7DQorCQlpZiAocmV0KQ0KKwkJCWdvdG8gZXJyX3Vu
bWFwX2RtYTsNCisNCisJCXNnbCA9IGZpbGxfc2dfZW50cnkoc2dsLCBtYXBwZWRfbGVuLCBkbWEt
PnN0YXRlLT5hZGRyKTsNCisJfQ0KKw0KKwlkbWEtPnNpemUgPSBzaXplOw0KKw0KKwkvKg0KKwkg
KiBObyBDUFUgbGlzdCBpbmNsdWRlZCDigJQgc2V0IG9yaWdfbmVudHMgPSAwIHNvIG90aGVycyBj
YW4gZGV0ZWN0DQorCSAqIHRoaXMgdmlhIFNHIHRhYmxlICh1c2UgbmVudHMgb25seSkuDQorCSAq
Lw0KKwlkbWEtPnNndC5vcmlnX25lbnRzID0gMDsNCisNCisNCisJLyoNCisJICogU0dMIG11c3Qg
YmUgTlVMTCB0byBpbmRpY2F0ZSB0aGF0IFNHTCBpcyB0aGUgbGFzdCBvbmUNCisJICogYW5kIHdl
IGFsbG9jYXRlZCBjb3JyZWN0IG51bWJlciBvZiBlbnRyaWVzIGluIHNnX2FsbG9jX3RhYmxlKCkN
CisJICovDQorCVdBUk5fT05fT05DRShzZ2wpOw0KKwlyZXR1cm4gJmRtYS0+c2d0Ow0KKw0KK2Vy
cl91bm1hcF9kbWE6DQorCWlmICghaSB8fCAhZG1hLT5zdGF0ZSkgew0KKwkJOyAvKiBEbyBub3Ro
aW5nICovDQorCX0gZWxzZSBpZiAoZG1hX3VzZV9pb3ZhKGRtYS0+c3RhdGUpKSB7DQorCQlkbWFf
aW92YV9kZXN0cm95KGF0dGFjaC0+ZGV2LCBkbWEtPnN0YXRlLCBtYXBwZWRfbGVuLCBkaXIsDQor
CQkJCSBETUFfQVRUUl9NTUlPKTsNCisJfSBlbHNlIHsNCisJCWZvcl9lYWNoX3NndGFibGVfZG1h
X3NnKCZkbWEtPnNndCwgc2dsLCBpKQ0KKwkJCWRtYV91bm1hcF9waHlzKGF0dGFjaC0+ZGV2LCBz
Z19kbWFfYWRkcmVzcyhzZ2wpLA0KKwkJCQkgICAgICAgc2dfZG1hX2xlbihzZ2wpLCBkaXIsIERN
QV9BVFRSX01NSU8pOw0KKwl9DQorCXNnX2ZyZWVfdGFibGUoJmRtYS0+c2d0KTsNCitlcnJfZnJl
ZV9zdGF0ZToNCisJa2ZyZWUoZG1hLT5zdGF0ZSk7DQorZXJyX2ZyZWVfZG1hOg0KKwlrZnJlZShk
bWEpOw0KKwlyZXR1cm4gRVJSX1BUUihyZXQpOw0KK30NCitFWFBPUlRfU1lNQk9MX05TX0dQTChk
bWFfYnVmX21hcCwgIkRNQV9CVUYiKTsNCisNCisvKioNCisgKiBkbWFfYnVmX3VubWFwIC0gdW5t
YXBzIHRoZSBidWZmZXINCisgKiBAYXR0YWNoOglbaW5dCWF0dGFjaG1lbnQgdG8gdW5tYXAgYnVm
ZmVyIGZyb20NCisgKiBAc2d0OglbaW5dCXNjYXR0ZXJsaXN0IGluZm8gb2YgdGhlIGJ1ZmZlciB0
byB1bm1hcA0KKyAqIEBkaXJlY3Rpb246CVtpbl0JZGlyZWN0aW9uIG9mIERNQSB0cmFuc2Zlcg0K
KyAqDQorICogVGhpcyB1bm1hcHMgYSBETUEgbWFwcGluZyBmb3IgQGF0dGFjaGVkIG9idGFpbmVk
IGJ5IGRtYV9idWZfbWFwKCkuDQorICovDQordm9pZCBkbWFfYnVmX3VubWFwKHN0cnVjdCBkbWFf
YnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwgc3RydWN0IHNnX3RhYmxlICpzZ3QsDQorCQkgICBlbnVt
IGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpDQorew0KKwlzdHJ1Y3QgZG1hX2J1Zl9kbWEgKmRtYSA9
IGNvbnRhaW5lcl9vZihzZ3QsIHN0cnVjdCBkbWFfYnVmX2RtYSwgc2d0KTsNCisJaW50IGk7DQor
DQorCWRtYV9yZXN2X2Fzc2VydF9oZWxkKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsNCisNCisJaWYg
KCFkbWEtPnN0YXRlKSB7DQorCQk7IC8qIERvIG5vdGhpbmcgKi8NCisJfSBlbHNlIGlmIChkbWFf
dXNlX2lvdmEoZG1hLT5zdGF0ZSkpIHsNCisJCWRtYV9pb3ZhX2Rlc3Ryb3koYXR0YWNoLT5kZXYs
IGRtYS0+c3RhdGUsIGRtYS0+c2l6ZSwgZGlyLA0KKwkJCQkgRE1BX0FUVFJfTU1JTyk7DQorCX0g
ZWxzZSB7DQorCQlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnbDsNCisNCisJCWZvcl9lYWNoX3NndGFi
bGVfZG1hX3NnKHNndCwgc2dsLCBpKQ0KKwkJCWRtYV91bm1hcF9waHlzKGF0dGFjaC0+ZGV2LCBz
Z19kbWFfYWRkcmVzcyhzZ2wpLA0KKwkJCQkgICAgICAgc2dfZG1hX2xlbihzZ2wpLCBkaXIsIERN
QV9BVFRSX01NSU8pOw0KKwl9DQorDQorCXNnX2ZyZWVfdGFibGUoc2d0KTsNCisJa2ZyZWUoZG1h
LT5zdGF0ZSk7DQorCWtmcmVlKGRtYSk7DQorDQorfQ0KK0VYUE9SVF9TWU1CT0xfTlNfR1BMKGRt
YV9idWZfdW5tYXAsICJETUFfQlVGIik7DQorDQogLyoqDQogICogZG1hX2J1Zl9tb3ZlX25vdGlm
eSAtIG5vdGlmeSBhdHRhY2htZW50cyB0aGF0IERNQS1idWYgaXMgbW92aW5nDQogICoNCmRpZmYg
LS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1idWYuaCBiL2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5o
DQppbmRleCBkNThlMzI5YWMwZTcuLjU0NWJhMjdhNTA0MCAxMDA2NDQNCi0tLSBhL2luY2x1ZGUv
bGludXgvZG1hLWJ1Zi5oDQorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1idWYuaA0KQEAgLTIyLDYg
KzIyLDcgQEANCiAjaW5jbHVkZSA8bGludXgvZnMuaD4NCiAjaW5jbHVkZSA8bGludXgvZG1hLWZl
bmNlLmg+DQogI2luY2x1ZGUgPGxpbnV4L3dhaXQuaD4NCisjaW5jbHVkZSA8bGludXgvcGNpLXAy
cGRtYS5oPg0KIA0KIHN0cnVjdCBkZXZpY2U7DQogc3RydWN0IGRtYV9idWY7DQpAQCAtNTMwLDYg
KzUzMSwxNiBAQCBzdHJ1Y3QgZG1hX2J1Zl9leHBvcnRfaW5mbyB7DQogCXZvaWQgKnByaXY7DQog
fTsNCiANCisvKioNCisgKiBzdHJ1Y3QgZG1hX2J1Zl9waHlzX3ZlYyAtIGRlc2NyaWJlIGNvbnRp
bnVvdXMgY2h1bmsgb2YgbWVtb3J5DQorICogQHBhZGRyOiAgIHBoeXNpY2FsIGFkZHJlc3Mgb2Yg
dGhhdCBjaHVuaw0KKyAqIEBsZW46ICAgICBMZW5ndGggb2YgdGhpcyBjaHVuaw0KKyAqLw0KK3N0
cnVjdCBkbWFfYnVmX3BoeXNfdmVjIHsNCisJcGh5c19hZGRyX3QgcGFkZHI7DQorCXNpemVfdCBs
ZW47DQorfTsNCisNCiAvKioNCiAgKiBERUZJTkVfRE1BX0JVRl9FWFBPUlRfSU5GTyAtIGhlbHBl
ciBtYWNybyBmb3IgZXhwb3J0ZXJzDQogICogQG5hbWU6IGV4cG9ydC1pbmZvIG5hbWUNCkBAIC02
MDksNCArNjIwLDExIEBAIGludCBkbWFfYnVmX3ZtYXBfdW5sb2NrZWQoc3RydWN0IGRtYV9idWYg
KmRtYWJ1Ziwgc3RydWN0IGlvc3lzX21hcCAqbWFwKTsNCiB2b2lkIGRtYV9idWZfdnVubWFwX3Vu
bG9ja2VkKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBpb3N5c19tYXAgKm1hcCk7DQog
c3RydWN0IGRtYV9idWYgKmRtYV9idWZfaXRlcl9iZWdpbih2b2lkKTsNCiBzdHJ1Y3QgZG1hX2J1
ZiAqZG1hX2J1Zl9pdGVyX25leHQoc3RydWN0IGRtYV9idWYgKmRtYnVmKTsNCitzdHJ1Y3Qgc2df
dGFibGUgKmRtYV9idWZfbWFwKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwNCisJ
CQkgICAgIHN0cnVjdCBwMnBkbWFfcHJvdmlkZXIgKnByb3ZpZGVyLA0KKwkJCSAgICAgc3RydWN0
IGRtYV9idWZfcGh5c192ZWMgKnBoeXNfdmVjLA0KKwkJCSAgICAgc2l6ZV90IG5yX3Jhbmdlcywg
c2l6ZV90IHNpemUsDQorCQkJICAgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpOw0KK3Zv
aWQgZG1hX2J1Zl91bm1hcChzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsIHN0cnVj
dCBzZ190YWJsZSAqc2d0LA0KKwkJICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKTsNCiAj
ZW5kaWYgLyogX19ETUFfQlVGX0hfXyAqLw0KDQotLSANCjIuNTEuMQ0KDQpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpMaW5hcm8tbW0tc2lnIG1haWxpbmcg
bGlzdCAtLSBsaW5hcm8tbW0tc2lnQGxpc3RzLmxpbmFyby5vcmcKVG8gdW5zdWJzY3JpYmUgc2Vu
ZCBhbiBlbWFpbCB0byBsaW5hcm8tbW0tc2lnLWxlYXZlQGxpc3RzLmxpbmFyby5vcmcK
