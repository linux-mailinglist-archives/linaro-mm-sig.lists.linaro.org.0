Return-Path: <linaro-mm-sig-bounces@lists.linaro.org>
X-Original-To: lists+linaro-mm-sig@lfdr.de
Delivered-To: lists+linaro-mm-sig@lfdr.de
Received: from lists.linaro.org (lists.linaro.org [107.22.173.205])
	by mail.lfdr.de (Postfix) with ESMTPS id 94B40357F66
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  8 Apr 2021 11:36:37 +0200 (CEST)
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id BA4A1665AA
	for <lists+linaro-mm-sig@lfdr.de>; Thu,  8 Apr 2021 09:36:36 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
	id A822B66718; Thu,  8 Apr 2021 09:36:36 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on lists.linaro.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.9 required=5.0 tests=BAYES_00,MAILING_LIST_MULTI,
	RCVD_IN_DNSWL_NONE,RCVD_IN_MSPIKE_H3,RCVD_IN_MSPIKE_WL,SPF_HELO_NONE
	autolearn=disabled version=3.4.2
Received: from lists.linaro.org (localhost [127.0.0.1])
	by lists.linaro.org (Postfix) with ESMTP id 4ABB166707;
	Thu,  8 Apr 2021 09:35:07 +0000 (UTC)
X-Original-To: linaro-mm-sig@lists.linaro.org
Delivered-To: linaro-mm-sig@lists.linaro.org
Received: from lists.linaro.org (localhost [127.0.0.1])
 by lists.linaro.org (Postfix) with ESMTP id 0FEEE6248D
 for <linaro-mm-sig@lists.linaro.org>; Thu,  8 Apr 2021 09:35:02 +0000 (UTC)
Received: by lists.linaro.org (Postfix, from userid 109)
 id 04EFC66553; Thu,  8 Apr 2021 09:35:01 +0000 (UTC)
Received: from mail-pf1-f181.google.com (mail-pf1-f181.google.com
 [209.85.210.181])
 by lists.linaro.org (Postfix) with ESMTPS id 3E8B465F83
 for <linaro-mm-sig@lists.linaro.org>; Thu,  8 Apr 2021 09:35:00 +0000 (UTC)
Received: by mail-pf1-f181.google.com with SMTP id 11so1373192pfn.9
 for <linaro-mm-sig@lists.linaro.org>; Thu, 08 Apr 2021 02:35:00 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=xxv/WXld0B+xmj9GZnz0sseyRcT1qkV/u/IKiIAEv/Q=;
 b=Lv87J6wbsglFJ3m8KkVSNWb/e00cQbfoDsp6uMeMoBsPsPRXWjecLOj8cxGkInZXKQ
 J5sbZLJStSivcevB7J+Mrw1hDkkPLBld9gissvNldUuT0pX58qxBV75v9usuT2m1iSh4
 FqCwXirrX6FMFlOF9vW8+H19iLFw3tXJpwOjoQxjuG+LeTTtJeYfh8mBv6YsHz8+u5Uq
 bAkNcJsoO5YpMN2051k+fUIBtEtbX0Vxi3NK09qKxgu6cr7peWhK4flWKi6a1okMYQMI
 klJhDK7JDiEbsM9FuJG/wkZ+yjgsCpkDXiW4ExfBwvu2BWaBfFj1NOaMSy3KVhCE08DQ
 4m9w==
X-Gm-Message-State: AOAM533xNPtZZ3fywv0R7k4gQWdRI78FelbqxgY4fbn3RJ4aUdnVw1sz
 eMolSfF+tpkKy3AI9S5UJqwG+w==
X-Google-Smtp-Source: ABdhPJwQWi5xElJ6PagwAG6dmu8IlAkOfxRnYenIQ9DXWTYrSYahtzvtDunCPNt/zSdwNcSNxtOkhg==
X-Received: by 2002:a62:e119:0:b029:245:8e0:820 with SMTP id
 q25-20020a62e1190000b029024508e00820mr1085029pfh.4.1617874499500; 
 Thu, 08 Apr 2021 02:34:59 -0700 (PDT)
Received: from localhost ([2401:fa00:8f:203:25d8:8458:73e8:75ac])
 by smtp.gmail.com with UTF8SMTPSA id h6sm24485707pfb.157.2021.04.08.02.34.56
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Thu, 08 Apr 2021 02:34:59 -0700 (PDT)
From: David Stevens <stevensd@chromium.org>
X-Google-Original-From: David Stevens <stevensd@google.com>
To: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Date: Thu,  8 Apr 2021 18:34:48 +0900
Message-Id: <20210408093448.3897988-1-stevensd@google.com>
X-Mailer: git-send-email 2.31.0.208.g409f899ff0-goog
MIME-Version: 1.0
X-Virus-Scanned: ClamAV using ClamSMTP
Cc: Thomas Zimmermann <tzimmermann@suse.de>, David Airlie <airlied@linux.ie>,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 linux-kernel@vger.kernel.org, Maxime Ripard <mripard@kernel.org>,
 linaro-mm-sig@lists.linaro.org, David Stevens <stevensd@chromium.org>,
 dri-devel@lists.freedesktop.org, Daniel Vetter <daniel@ffwll.ch>,
 linux-media@vger.kernel.org
Subject: [Linaro-mm-sig] [PATCH] drm/syncobj: use newly allocated stub fences
X-BeenThere: linaro-mm-sig@lists.linaro.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: "Unified memory management interest group."
 <linaro-mm-sig.lists.linaro.org>
List-Unsubscribe: <https://lists.linaro.org/mailman/options/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=unsubscribe>
List-Archive: <http://lists.linaro.org/pipermail/linaro-mm-sig/>
List-Post: <mailto:linaro-mm-sig@lists.linaro.org>
List-Help: <mailto:linaro-mm-sig-request@lists.linaro.org?subject=help>
List-Subscribe: <https://lists.linaro.org/mailman/listinfo/linaro-mm-sig>,
 <mailto:linaro-mm-sig-request@lists.linaro.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linaro-mm-sig-bounces@lists.linaro.org
Sender: "Linaro-mm-sig" <linaro-mm-sig-bounces@lists.linaro.org>
X-Virus-Scanned: ClamAV using ClamSMTP

RnJvbTogRGF2aWQgU3RldmVucyA8c3RldmVuc2RAY2hyb21pdW0ub3JnPgoKQWxsb2NhdGUgYSBu
ZXcgcHJpdmF0ZSBzdHViIGZlbmNlIGluIGRybV9zeW5jb2JqX2Fzc2lnbl9udWxsX2hhbmRsZSwK
aW5zdGVhZCBvZiB1c2luZyBhIHN0YXRpYyBzdHViIGZlbmNlLgoKV2hlbiB1c2Vyc3BhY2UgY3Jl
YXRlcyBhIGZlbmNlIHdpdGggRFJNX1NZTkNPQkpfQ1JFQVRFX1NJR05BTEVEIG9yIHdoZW4KdXNl
cnNwYWNlIHNpZ25hbHMgYSBmZW5jZSB2aWEgRFJNX0lPQ1RMX1NZTkNPQkpfU0lHTkFMLCB0aGUg
dGltZXN0YW1wCm9idGFpbmVkIHdoZW4gdGhlIGZlbmNlIGlzIGV4cG9ydGVkIGFuZCBxdWVyaWVk
IHdpdGggU1lOQ19JT0NfRklMRV9JTkZPCnNob3VsZCBtYXRjaCB3aGVuIHRoZSBmZW5jZSdzIHN0
YXR1cyB3YXMgY2hhbmdlZCBmcm9tIHRoZSBwZXJzcGVjdGl2ZSBvZgp1c2Vyc3BhY2UsIHdoaWNo
IGlzIGR1cmluZyB0aGUgcmVzcGVjdGl2ZSBpb2N0bC4KCldoZW4gYSBzdGF0aWMgc3R1YiBmZW5j
ZSBzdGFydGVkIGJlaW5nIHVzZWQgaW4gYnkgdGhlc2UgaW9jdGxzLCB0aGlzCmJlaGF2aW9yIGNo
YW5nZWQuIEluc3RlYWQsIHRoZSB0aW1lc3RhbXAgcmV0dXJuZWQgYnkgU1lOQ19JT0NfRklMRV9J
TkZPCmJlY2FtZSB0aGUgZmlyc3QgdGltZSBhbnl0aGluZyB1c2VkIHRoZSBzdGF0aWMgc3R1YiBm
ZW5jZSwgd2hpY2ggaGFzIG5vCm1lYW5pbmcgdG8gdXNlcnNwYWNlLgoKU2lnbmVkLW9mZi1ieTog
RGF2aWQgU3RldmVucyA8c3RldmVuc2RAY2hyb21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UuYyAgIHwgMzMgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystCiBk
cml2ZXJzL2dwdS9kcm0vZHJtX3N5bmNvYmouYyB8IDI4ICsrKysrKysrKysrKysrKysrKysrLS0t
LS0tLS0KIGluY2x1ZGUvbGludXgvZG1hLWZlbmNlLmggICAgIHwgIDEgKwogMyBmaWxlcyBjaGFu
Z2VkLCA1MyBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwppbmRl
eCBkNjRmYzAzOTI5YmUuLjYwODFlYjk2MjQ5MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVm
L2RtYS1mZW5jZS5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwpAQCAtMjYsNiAr
MjYsMTEgQEAgRVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9zaWduYWxlZCk7CiBz
dGF0aWMgREVGSU5FX1NQSU5MT0NLKGRtYV9mZW5jZV9zdHViX2xvY2spOwogc3RhdGljIHN0cnVj
dCBkbWFfZmVuY2UgZG1hX2ZlbmNlX3N0dWI7CiAKK3N0cnVjdCBkcm1fZmVuY2VfcHJpdmF0ZV9z
dHViIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlIGJhc2U7CisJc3BpbmxvY2tfdCBsb2NrOworfTsKKwog
LyoKICAqIGZlbmNlIGNvbnRleHQgY291bnRlcjogZWFjaCBleGVjdXRpb24gY29udGV4dCBzaG91
bGQgaGF2ZSBpdHMgb3duCiAgKiBmZW5jZSBjb250ZXh0LCB0aGlzIGFsbG93cyBjaGVja2luZyBp
ZiBmZW5jZXMgYmVsb25nIHRvIHRoZSBzYW1lCkBAIC0xMjMsNyArMTI4LDkgQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIGRtYV9mZW5jZV9zdHViX29wcyA9IHsKIC8qKgogICog
ZG1hX2ZlbmNlX2dldF9zdHViIC0gcmV0dXJuIGEgc2lnbmFsZWQgZmVuY2UKICAqCi0gKiBSZXR1
cm4gYSBzdHViIGZlbmNlIHdoaWNoIGlzIGFscmVhZHkgc2lnbmFsZWQuCisgKiBSZXR1cm4gYSBz
dHViIGZlbmNlIHdoaWNoIGlzIGFscmVhZHkgc2lnbmFsZWQuIFRoZSBmZW5jZSdzCisgKiB0aW1l
c3RhbXAgY29ycmVzcG9uZHMgdG8gdGhlIGZpcnN0IHRpbWUgYWZ0ZXIgYm9vdCB0aGlzCisgKiBm
dW5jdGlvbiBpcyBjYWxsZWQuCiAgKi8KIHN0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV9nZXRf
c3R1Yih2b2lkKQogewpAQCAtMTQxLDYgKzE0OCwzMCBAQCBzdHJ1Y3QgZG1hX2ZlbmNlICpkbWFf
ZmVuY2VfZ2V0X3N0dWIodm9pZCkKIH0KIEVYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX2dldF9zdHVi
KTsKIAorLyoqCisgKiBkbWFfZmVuY2VfYWxsb2NhdGVfcHJpdmF0ZV9zdHViIC0gcmV0dXJuIGEg
cHJpdmF0ZSwgc2lnbmFsZWQgZmVuY2UKKyAqCisgKiBSZXR1cm4gYSBuZXdseSBhbGxvY2F0ZWQg
YW5kIHNpZ25hbGVkIHN0dWIgZmVuY2UuCisgKi8KK3N0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5j
ZV9hbGxvY2F0ZV9wcml2YXRlX3N0dWIodm9pZCkKK3sKKwlzdHJ1Y3QgZHJtX2ZlbmNlX3ByaXZh
dGVfc3R1YiAqZmVuY2U7CisKKwlmZW5jZSA9IGt6YWxsb2Moc2l6ZW9mKCpmZW5jZSksIEdGUF9L
RVJORUwpOworCWlmIChmZW5jZSA9PSBOVUxMKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsK
KworCXNwaW5fbG9ja19pbml0KCZmZW5jZS0+bG9jayk7CisJZG1hX2ZlbmNlX2luaXQoJmZlbmNl
LT5iYXNlLAorCQkgICAgICAgJmRtYV9mZW5jZV9zdHViX29wcywKKwkJICAgICAgICZmZW5jZS0+
bG9jaywKKwkJICAgICAgIDAsIDApOworCWRtYV9mZW5jZV9zaWduYWwoJmZlbmNlLT5iYXNlKTsK
KworCXJldHVybiAmZmVuY2UtPmJhc2U7Cit9CitFWFBPUlRfU1lNQk9MKGRtYV9mZW5jZV9hbGxv
Y2F0ZV9wcml2YXRlX3N0dWIpOworCiAvKioKICAqIGRtYV9mZW5jZV9jb250ZXh0X2FsbG9jIC0g
YWxsb2NhdGUgYW4gYXJyYXkgb2YgZmVuY2UgY29udGV4dHMKICAqIEBudW06IGFtb3VudCBvZiBj
b250ZXh0cyB0byBhbGxvY2F0ZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9zeW5j
b2JqLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3N5bmNvYmouYwppbmRleCAzNDkxNDYwNDk4NDku
LmM2MTI1ZTU3YWUzNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9zeW5jb2JqLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9zeW5jb2JqLmMKQEAgLTM1MCwxMiArMzUwLDE1IEBA
IEVYUE9SVF9TWU1CT0woZHJtX3N5bmNvYmpfcmVwbGFjZV9mZW5jZSk7CiAgKgogICogQXNzaWdu
IGEgYWxyZWFkeSBzaWduYWxlZCBzdHViIGZlbmNlIHRvIHRoZSBzeW5jIG9iamVjdC4KICAqLwot
c3RhdGljIHZvaWQgZHJtX3N5bmNvYmpfYXNzaWduX251bGxfaGFuZGxlKHN0cnVjdCBkcm1fc3lu
Y29iaiAqc3luY29iaikKK3N0YXRpYyBpbnQgZHJtX3N5bmNvYmpfYXNzaWduX251bGxfaGFuZGxl
KHN0cnVjdCBkcm1fc3luY29iaiAqc3luY29iaikKIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSA9IGRtYV9mZW5jZV9nZXRfc3R1YigpOworICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
ID0gZG1hX2ZlbmNlX2FsbG9jYXRlX3ByaXZhdGVfc3R1YigpOworICAgICAgIGlmIChJU19FUlIo
ZmVuY2UpKQorCSAgICAgICByZXR1cm4gUFRSX0VSUihmZW5jZSk7CiAKLQlkcm1fc3luY29ial9y
ZXBsYWNlX2ZlbmNlKHN5bmNvYmosIGZlbmNlKTsKLQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKyAg
ICAgICBkcm1fc3luY29ial9yZXBsYWNlX2ZlbmNlKHN5bmNvYmosIGZlbmNlKTsKKyAgICAgICBk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKKyAgICAgICByZXR1cm4gMDsKIH0KIAogLyogNXMgZGVmYXVs
dCBmb3Igd2FpdCBzdWJtaXNzaW9uICovCkBAIC00NjksNiArNDcyLDcgQEAgRVhQT1JUX1NZTUJP
TChkcm1fc3luY29ial9mcmVlKTsKIGludCBkcm1fc3luY29ial9jcmVhdGUoc3RydWN0IGRybV9z
eW5jb2JqICoqb3V0X3N5bmNvYmosIHVpbnQzMl90IGZsYWdzLAogCQkgICAgICAgc3RydWN0IGRt
YV9mZW5jZSAqZmVuY2UpCiB7CisJaW50IHJldDsKIAlzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5bmNv
Ymo7CiAKIAlzeW5jb2JqID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGRybV9zeW5jb2JqKSwgR0ZQ
X0tFUk5FTCk7CkBAIC00NzksOCArNDgzLDEzIEBAIGludCBkcm1fc3luY29ial9jcmVhdGUoc3Ry
dWN0IGRybV9zeW5jb2JqICoqb3V0X3N5bmNvYmosIHVpbnQzMl90IGZsYWdzLAogCUlOSVRfTElT
VF9IRUFEKCZzeW5jb2JqLT5jYl9saXN0KTsKIAlzcGluX2xvY2tfaW5pdCgmc3luY29iai0+bG9j
ayk7CiAKLQlpZiAoZmxhZ3MgJiBEUk1fU1lOQ09CSl9DUkVBVEVfU0lHTkFMRUQpCi0JCWRybV9z
eW5jb2JqX2Fzc2lnbl9udWxsX2hhbmRsZShzeW5jb2JqKTsKKwlpZiAoZmxhZ3MgJiBEUk1fU1lO
Q09CSl9DUkVBVEVfU0lHTkFMRUQpIHsKKwkJcmV0ID0gZHJtX3N5bmNvYmpfYXNzaWduX251bGxf
aGFuZGxlKHN5bmNvYmopOworCQlpZiAocmV0IDwgMCkgeworCQkJZHJtX3N5bmNvYmpfcHV0KHN5
bmNvYmopOworCQkJcmV0dXJuIHJldDsKKwkJfQorCX0KIAogCWlmIChmZW5jZSkKIAkJZHJtX3N5
bmNvYmpfcmVwbGFjZV9mZW5jZShzeW5jb2JqLCBmZW5jZSk7CkBAIC0xMzIyLDggKzEzMzEsMTEg
QEAgZHJtX3N5bmNvYmpfc2lnbmFsX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCiAJaWYgKHJldCA8IDApCiAJCXJldHVybiByZXQ7CiAKLQlmb3IgKGkgPSAwOyBpIDwg
YXJncy0+Y291bnRfaGFuZGxlczsgaSsrKQotCQlkcm1fc3luY29ial9hc3NpZ25fbnVsbF9oYW5k
bGUoc3luY29ianNbaV0pOworCWZvciAoaSA9IDA7IGkgPCBhcmdzLT5jb3VudF9oYW5kbGVzOyBp
KyspIHsKKwkJcmV0ID0gZHJtX3N5bmNvYmpfYXNzaWduX251bGxfaGFuZGxlKHN5bmNvYmpzW2ld
KTsKKwkJaWYgKHJldCA8IDApCisJCQlicmVhazsKKwl9CiAKIAlkcm1fc3luY29ial9hcnJheV9m
cmVlKHN5bmNvYmpzLCBhcmdzLT5jb3VudF9oYW5kbGVzKTsKIApkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS9saW51eC9kbWEtZmVuY2UuaCBiL2luY2x1ZGUvbGludXgvZG1hLWZlbmNlLmgKaW5kZXggOWYx
MmVmYWFhOTNhLi42ZmZiNGIyYzYzNzEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvZG1hLWZl
bmNlLmgKKysrIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaApAQCAtNTg3LDYgKzU4Nyw3IEBA
IHN0YXRpYyBpbmxpbmUgc2lnbmVkIGxvbmcgZG1hX2ZlbmNlX3dhaXQoc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UsIGJvb2wgaW50cikKIH0KIAogc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX2dl
dF9zdHViKHZvaWQpOworc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX2FsbG9jYXRlX3ByaXZh
dGVfc3R1Yih2b2lkKTsKIHU2NCBkbWFfZmVuY2VfY29udGV4dF9hbGxvYyh1bnNpZ25lZCBudW0p
OwogCiAjZGVmaW5lIERNQV9GRU5DRV9UUkFDRShmLCBmbXQsIGFyZ3MuLi4pIFwKLS0gCjIuMzEu
MC4yMDguZzQwOWY4OTlmZjAtZ29vZwoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KTGluYXJvLW1tLXNpZyBtYWlsaW5nIGxpc3QKTGluYXJvLW1tLXNpZ0Bs
aXN0cy5saW5hcm8ub3JnCmh0dHBzOi8vbGlzdHMubGluYXJvLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2xpbmFyby1tbS1zaWcK
